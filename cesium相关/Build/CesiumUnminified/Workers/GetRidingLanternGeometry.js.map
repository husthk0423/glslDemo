{"version":3,"file":"GetRidingLanternGeometry.js","sources":["../../../Source/WorkersES6/GetRidingLanternGeometry.js"],"sourcesContent":["/**\r\n * Created by user on 2020/3/16.\r\n * 走马灯效果geomerty\r\n */\r\nimport Color from '../Core/Color.js';\r\nimport GeometryInstance from '../Core/GeometryInstance.js';\r\nimport Geometry from '../Core/Geometry.js';\r\nimport GeometryAttribute from '../Core/GeometryAttribute.js';\r\nimport ComponentDatatype from '../Core/ComponentDatatype.js';\r\nimport Cartographic from '../Core/Cartographic.js';\r\nimport PrimitiveType from '../Core/PrimitiveType.js';\r\nimport BoundingSphere from '../Core/BoundingSphere.js';\r\n\r\n\r\nclass GetRidingLanternGeometry{\r\n    constructor(options){\r\n        this.positions  = null;\r\n        this.normals  =null;\r\n        this.sts  =null;\r\n        this.indices  =null;\r\n        this.geometrys = options.positions;\r\n        this.color = options.color;\r\n        this.u_tcolor = options.u_tcolor||Color.YELLOW;//设置不透明的时候，alpha小于的颜色值\r\n        this.height = options.height||500.;\r\n        this.speed = options.speed||600;\r\n        this.direction = options.direction||-1;\r\n        this.translucent = options.translucent||false;//添加透明参数,true为透明\r\n\r\n        this.type = options.type||1;\r\n    }\r\n\r\n    createGeometryInstances(){\r\n        let geometryInstances = [];\r\n        for(let i = 0;i<this.geometrys.length;i++){\r\n            let item = this.geometrys[i];\r\n            let op = this.computePositions_dws(item,this.height);\r\n            this.positions  = op.pos;\r\n            this.normals  =op.normals;\r\n            this.sts  =op.sts;\r\n            this.indices  =op.indices;\r\n\r\n            let geometry  = this.createGeometry(this.positions,this.normals,this.sts,this.indices);\r\n            let gi = new GeometryInstance({\r\n                id:Math.random(),\r\n                geometry : geometry\r\n            });\r\n            geometryInstances.push(gi);\r\n        }\r\n        return geometryInstances;\r\n    }\r\n\r\n    createGeometry(pos,n,st,indice){\r\n        let positions = new Float64Array(pos);\r\n        let normals = new Float32Array(n);\r\n        let sts = new Float32Array(st);\r\n        let indices = new Uint16Array(indice);\r\n\r\n        return new Geometry({\r\n            attributes: {\r\n                position: new GeometryAttribute({\r\n                    // 使用double类型的position进行计算\r\n                    componentDatatype : ComponentDatatype.DOUBLE,\r\n                    componentsPerAttribute: 3,\r\n                    values: positions\r\n                }),\r\n                normal: new GeometryAttribute({\r\n                    componentDatatype: ComponentDatatype.FLOAT,\r\n                    componentsPerAttribute: 3,\r\n                    values: normals\r\n                }),\r\n                st: new GeometryAttribute({\r\n                    componentDatatype: ComponentDatatype.FLOAT,\r\n                    componentsPerAttribute: 2,\r\n                    values: sts\r\n                })\r\n            },\r\n            indices: indices,\r\n            primitiveType: PrimitiveType.TRIANGLES,\r\n            boundingSphere: BoundingSphere.fromVertices(positions)\r\n        });\r\n    }\r\n    computePositions_dws(cps,height){\r\n        let count = cps.length;\r\n        let up = [];\r\n        for(let i in cps){\r\n            up.push(this.addHeight(cps[i],height));\r\n        }\r\n        //计算位置\r\n        let pos = [];//坐标\r\n        let sts = [];//纹理\r\n        let indices = [];//索引\r\n        let normal = [];//法向量\r\n        for(let i =0;i<count-1;i++){\r\n            // let ni = (i+1)%count;\r\n            let ni = i+1;\r\n            pos.push(...[ cps[i].x,cps[i].y,cps[i].z ]);\r\n            pos.push(...[ cps[ni].x,cps[ni].y,cps[ni].z ]);\r\n            pos.push(...[ up[ni].x,up[ni].y,up[ni].z ]);\r\n            pos.push(...[ up[i].x,up[i].y,up[i].z ]);\r\n\r\n            normal.push(...[0,0,1]);\r\n            normal.push(...[0,0,1]);\r\n            normal.push(...[0,0,1]);\r\n            normal.push(...[0,0,1]);\r\n\r\n            sts.push(...[0,0,1,0,1,1,0,1,]);//四个点的纹理一次存入\r\n\r\n            let ii = i*4;\r\n            let i1 = ii+1;\r\n            let i2 = ii+2;\r\n            let i3 = ii+3;\r\n            indices.push(...[ ii,i1,i2 ,i2,i3,ii]);\r\n        }\r\n        return {\r\n            pos:pos,\r\n            normals:normal,\r\n            sts:sts,\r\n            indices:indices,\r\n        };\r\n    }\r\n\r\n    addHeight(point,height){\r\n        let tHeight = height||0.0;\r\n        if(!point.hasOwnProperty('height')){\r\n            let cartographic = Cartographic.fromCartesian(point);\r\n            cartographic.height += tHeight;\r\n            return Cartographic.toCartesian(cartographic);\r\n        }else{\r\n            point.height += tHeight;\r\n            return point;\r\n        }\r\n    }\r\n}\r\n\r\nexport default GetRidingLanternGeometry;\r\n"],"names":["Color","GeometryInstance","Geometry","GeometryAttribute","ComponentDatatype","PrimitiveType","BoundingSphere","Cartographic"],"mappings":"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"}