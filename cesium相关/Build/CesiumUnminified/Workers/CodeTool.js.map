{"version":3,"file":"CodeTool.js","sources":["../../../Source/WorkersES6/CodeTool.js"],"sourcesContent":["/**\r\n * 编码工具类\r\n */\r\nclass CodeTool {\r\n\r\n    constructor() {}\r\n\r\n    /**\r\n     * //生成随机头\r\n     * @returns {[]}\r\n     */\r\n    static getHeaderArray(headerLength) {\r\n        let harr = [];\r\n        for (let i = 0; i < headerLength; i++) {\r\n            harr[i] = this._getRandomNum();\r\n        }\r\n        return harr;\r\n    }\r\n\r\n    /**\r\n     * 生成随机数头\r\n     * @returns {number}\r\n     * @private\r\n     */\r\n    static _getRandomNum() {\r\n        let Range = 80;\r\n        let Rand = Math.random();\r\n        return (50 + Math.round(Rand * Range));\r\n    }\r\n\r\n    /**\r\n     * 字符串转byte数组\r\n     * @param str 字符串\r\n     * @param encoding 字符串编码;默认utf8\r\n     * @returns {[]} 字节数组\r\n     */\r\n    static stringToByte(str, encoding) {\r\n        if (encoding === undefined) {\r\n            encoding = \"utf8\";\r\n        }\r\n        let bytes = [];\r\n        let buffer = Buffer.from(str, encoding);\r\n        for (let i = 0; i < buffer.length; i++) {\r\n            bytes.push(buffer[i]);\r\n        }\r\n\r\n        return bytes;\r\n    }\r\n\r\n    /**\r\n     * byte数组转字符串\r\n     * @param bytes 字节数组\r\n     * @param encoding 字符串编码;默认utf8\r\n     * @returns {string}\r\n     */\r\n    static byteToString(bytes, encoding) {\r\n        if (encoding === undefined) {\r\n            encoding = \"utf8\";\r\n        }\r\n        return Buffer.from(bytes).toString(encoding);\r\n    }\r\n\r\n    /**\r\n     * 数字转byte数组\r\n     * @param num\r\n     * @returns {number[]}\r\n     */\r\n    static intToBytes(num) {\r\n        return [(num >> 24) & 0x00ff, (num >> 16) & 0x00ff, (num >> 8) & 0x00ff, num & 0x00ff];\r\n    }\r\n\r\n    /**\r\n     * byte数组转数字\r\n     * @param bytes\r\n     * @returns {number}\r\n     */\r\n    static bytesToInt(bytes) {\r\n        return bytes[0] << 24 | bytes[1] << 16 | bytes[2] << 8 | bytes[3];\r\n    }\r\n\r\n    /**\r\n     * varint转数字\r\n     * @param buffer 单个数字的varint编码\r\n     * @returns {number}\r\n     */\r\n    static varintToInt(buffer) {\r\n        let intBuffer = [];\r\n        let highBuffer = [];\r\n        let j = 3;\r\n        let offset = 0;\r\n        for (let i = buffer.length - 1; i >= 0; i--) {\r\n            if (i - 1 >= 0) {\r\n                highBuffer[0] = (buffer[i - 1] << (7 - offset));\r\n            } else {\r\n                highBuffer[0] = 0;\r\n            }\r\n            if (j === -1) {\r\n                break;\r\n            }\r\n            intBuffer[j] = ((buffer[i] & 0x7f) >> offset | highBuffer[0]);\r\n            j--;\r\n            offset++;\r\n        }\r\n\r\n        let t = intBuffer[0] << 24 & 0xff000000 | intBuffer[1] << 16 & 0x00ff0000 | intBuffer[2] << 8 & 0x0000ff00 | intBuffer[3] & 0x000000ff;\r\n        t = (t >> 1) ^ -(t & 1);\r\n        return t;\r\n    }\r\n\r\n    /**\r\n     * 数字转varint编码\r\n     * @param num\r\n     * @returns {[]|number[]}\r\n     */\r\n    static intToVarint(num) {\r\n        if (num === 0) {\r\n            return [0];\r\n        }\r\n\r\n        num = this._zigZagEncoding(num);\r\n        let buffer = [];\r\n        let now;\r\n        let high = 0;\r\n        for (let i = 5; i > 0; i--) {\r\n            now = num >> ((i - 1) * 7) & 0x7f;\r\n            if (high !== 0) {\r\n                now = now | 0x80;\r\n            }\r\n            if (now !== 0) {\r\n                buffer.push(now);\r\n            }\r\n            high = now;\r\n        }\r\n        return buffer;\r\n    }\r\n\r\n\r\n    /**\r\n     * varint编码转数字数组\r\n     * @param buffer\r\n     * @returns {[]}\r\n     */\r\n    static varintToIntArray(buffer) {\r\n        let varintCode = [];\r\n        let high;\r\n        let bf_index = 0;\r\n        let nums = [];\r\n        for (let i = 0; i < buffer.length; i++) {\r\n            high = 0x00000000 | (buffer[i] >> 7) & 0x01;\r\n            if (high === 0) {\r\n                if (bf_index > 0 && bf_index <= 5) {\r\n                    nums.push(this.varintToInt(varintCode));\r\n                    varintCode = [];\r\n                    bf_index = 0;\r\n                }\r\n            }\r\n            varintCode.push(buffer[i]);\r\n            bf_index++;\r\n\r\n        }\r\n        nums.push(this.varintToInt(varintCode));\r\n        return nums;\r\n    }\r\n\r\n    /**\r\n     * 数字数组转varint编码buffer\r\n     * @param numArray 数字数组\r\n     * @returns {Buffer} varint编码buffer\r\n     */\r\n    static intArrayToVarintBuffer(numArray) {\r\n        let bytea = [];\r\n        let numBytes;\r\n        for (let i = 0; i < numArray.length; i++) {\r\n            numBytes = this.intToVarint(numArray[i]);\r\n            bytea.push(...numBytes);\r\n        }\r\n        return Buffer.from(bytea);\r\n    }\r\n\r\n    /**\r\n     * 负数转正数编码\r\n     * @param num\r\n     * @returns {number}\r\n     * @private\r\n     */\r\n    static _zigZagEncoding(num) {\r\n        return (num >> 31) ^ (num << 1);\r\n    }\r\n\r\n}\r\nexport default CodeTool;"],"names":[],"mappings":"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"}