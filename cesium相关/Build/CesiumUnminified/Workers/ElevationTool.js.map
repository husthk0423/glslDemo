{"version":3,"file":"ElevationTool.js","sources":["../../../Source/WorkersES6/ElevationTool.js"],"sourcesContent":["/**\r\n * Cesium - https://github.com/AnalyticalGraphicsInc/cesium\r\n *\r\n * Copyright 2011-2017 Cesium Contributors\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n *\r\n * Columbus View (Pat. Pend.)\r\n *\r\n * Portions licensed separately.\r\n * See https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md for full licensing details.\r\n */\r\n\r\nimport defer from \"../Core/defer.js\";\r\n/**\r\n* 编码工具类\r\n*/\r\nclass ElevationTool {\r\n\r\n    /**\r\n     *  获取多个指定的数据库名的数据库连接\r\n     * @param indexDbNames\r\n     * @param dbMap\r\n     * @returns {*|Deferred}\r\n     */\r\n    static getDBMap(indexDbNames,dbMap) {\r\n        let deferred = defer();\r\n        let promises = [];\r\n        for(let i = 0;i<indexDbNames.length;i++){\r\n            let indexDbname = indexDbNames[i];\r\n            let defer1 = defer();\r\n            let request = indexedDB.open(indexDbname,1);\r\n            request.onerror = function(){\r\n                console.log(indexDbname+\"数据库创建失败或者异常~\");\r\n                defer1.reject();\r\n            };\r\n            request.onsuccess = function(e){\r\n                console.log(indexDbname+\"数据库连接成功~\");\r\n                dbMap[indexDbname] = e.target.result;\r\n                defer1.resolve(true);\r\n            };\r\n            request.onupgradeneeded = function(e){\r\n                let db = e.target.result;\r\n                dbMap[indexDbname] = db;\r\n                let objectStore = db.createObjectStore(indexDbname,{keyPath:\"key\",autoIncrement: false});\r\n                objectStore.createIndex('key', 'key', { unique: true });\r\n                defer1.resolve(true);\r\n            }\r\n            promises.push(defer1.promise);\r\n        }\r\n\r\n\r\n        Promise.all(promises).then(function() {\r\n            deferred.resolve(true);\r\n        });\r\n\r\n        return deferred;\r\n    }\r\n\r\n\r\n    /**\r\n     * 根据多个指定的数据库名，key的对应的高程数据集合\r\n     * @param dbMap\r\n     * @param indexDbNames\r\n     * @param key\r\n     * @returns {*|Deferred}\r\n     */\r\n    static getElevation(dbMap,indexDbNames,key) {\r\n        let deferred = defer();\r\n        let promises = [];\r\n        let elevationDataMap = [];\r\n        for(let i = 0;i<indexDbNames.length;i++){\r\n            let indexDbname = indexDbNames[i];\r\n            let db = dbMap[indexDbname];\r\n            let transaction = db.transaction([indexDbname]);\r\n            let objectStore = transaction.objectStore(indexDbname);\r\n\r\n            let defer1 = defer();\r\n            let request = objectStore.get(key);\r\n            request.onerror = function(event) {\r\n                elevationDataMap[indexDbname] = null;\r\n                defer1.resolve(null);\r\n                // console.log(indexDbname + '_'+key + '数据查询报错');\r\n            };\r\n\r\n            request.onsuccess = function( event) {\r\n                if (request.result) {\r\n                    elevationDataMap[indexDbname] = request.result;\r\n                    defer1.resolve(request.result);\r\n                } else {\r\n                    elevationDataMap[indexDbname] = null;\r\n                    defer1.resolve(null);\r\n                    // console.log(indexDbname + '_'+key + '数据查询为空！');\r\n                }\r\n            };\r\n\r\n            promises.push(defer.promise);\r\n        }\r\n\r\n\r\n        Promise.all(promises).then(function() {\r\n            deferred.resolve(elevationDataMap);\r\n        });\r\n\r\n        return deferred.promise;\r\n    }\r\n\r\n    static updateElevation(db,indexDbName,key,data) {\r\n        let deferred = defer();\r\n        let request = db.transaction([indexDbName], 'readwrite')\r\n            .objectStore(indexDbName)\r\n            .put({ key: key,data: data});\r\n\r\n        request.onsuccess = function (event) {\r\n            // console.log(indexDbName+'_'+key+'数据入库成功');\r\n            deferred.resolve(true);\r\n        };\r\n\r\n        request.onerror = function (event) {\r\n            // console.log(indexDbName+'_'+key + '数据入库失败');\r\n            deferred.reject();\r\n        };\r\n\r\n        return deferred.promise;\r\n    }\r\n}\r\nexport default ElevationTool;\r\n"],"names":["defer"],"mappings":"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"}