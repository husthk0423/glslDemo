define(["./defaultValue-81eec7ed","./Cartesian2-cce28994","./ArcType-98ec98bf","./arrayRemoveDuplicates-9a47c9b6","./BoundingSphere-2b618cd6","./Color-f5223c05","./ComponentDatatype-c1201c79","./Check-edea0f91","./GeometryAttribute-c4e682f4","./GeometryAttributes-32b29525","./IndexDatatype-2503dc5a","./Math-29cbc3fa","./PolylinePipeline-f785d88a","./VertexFormat-aef87cc2","./GeographicProjection-54ec8d9d","./Matrix4-da4bb68c","./RuntimeError-94b0bf5f","./Rectangle-1bad9972","./Transforms-599d3866","./when-422ea0ae","./Resource-721e53e7","./combine-0897f2e3","./WebGLConstants-1c8239cc","./Matrix2-c857e514","./EllipsoidGeodesic-bc3178c0","./EllipsoidRhumbLine-52cdeee5","./IntersectionTests-878c0e54","./Plane-d04f021c"],(function(e,t,r,a,o,n,i,l,s,c,p,d,u,y,m,f,h,v,C,g,_,b,A,E,P,w,x,T){"use strict";var k=[];function D(e,t,r,a,o){var i,l=k;l.length=o;var s=r.red,c=r.green,p=r.blue,d=r.alpha,u=a.red,y=a.green,m=a.blue,f=a.alpha;if(n.Color.equals(r,a)){for(i=0;i<o;i++)l[i]=n.Color.clone(r);return l}var h=(u-s)/o,v=(y-c)/o,C=(m-p)/o,g=(f-d)/o;for(i=0;i<o;i++)l[i]=new n.Color(s+i*h,c+i*v,p+i*C,d+i*g);return l}function V(a){var o=(a=e.defaultValue(a,e.defaultValue.EMPTY_OBJECT)).positions,i=a.colors,l=e.defaultValue(a.width,1),s=e.defaultValue(a.colorsPerVertex,!1);this._positions=o,this._colors=i,this._width=l,this._colorsPerVertex=s,this._vertexFormat=y.VertexFormat.clone(e.defaultValue(a.vertexFormat,y.VertexFormat.DEFAULT)),this._arcType=e.defaultValue(a.arcType,r.ArcType.GEODESIC),this._granularity=e.defaultValue(a.granularity,d.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=t.Ellipsoid.clone(e.defaultValue(a.ellipsoid,t.Ellipsoid.WGS84)),this._workerName="createPolylineGeometry";var c=1+o.length*t.Cartesian3.packedLength;c+=e.defined(i)?1+i.length*n.Color.packedLength:1,this.packedLength=c+t.Ellipsoid.packedLength+y.VertexFormat.packedLength+4}V.pack=function(r,a,o){var i;o=e.defaultValue(o,0);var l=r._positions,s=l.length;for(a[o++]=s,i=0;i<s;++i,o+=t.Cartesian3.packedLength)t.Cartesian3.pack(l[i],a,o);var c=r._colors;for(s=e.defined(c)?c.length:0,a[o++]=s,i=0;i<s;++i,o+=n.Color.packedLength)n.Color.pack(c[i],a,o);return t.Ellipsoid.pack(r._ellipsoid,a,o),o+=t.Ellipsoid.packedLength,y.VertexFormat.pack(r._vertexFormat,a,o),o+=y.VertexFormat.packedLength,a[o++]=r._width,a[o++]=r._colorsPerVertex?1:0,a[o++]=r._arcType,a[o]=r._granularity,a};var L=t.Ellipsoid.clone(t.Ellipsoid.UNIT_SPHERE),F=new y.VertexFormat,G={positions:void 0,colors:void 0,ellipsoid:L,vertexFormat:F,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};V.unpack=function(r,a,o){var i;a=e.defaultValue(a,0);var l=r[a++],s=new Array(l);for(i=0;i<l;++i,a+=t.Cartesian3.packedLength)s[i]=t.Cartesian3.unpack(r,a);var c=(l=r[a++])>0?new Array(l):void 0;for(i=0;i<l;++i,a+=n.Color.packedLength)c[i]=n.Color.unpack(r,a);var p=t.Ellipsoid.unpack(r,a,L);a+=t.Ellipsoid.packedLength;var d=y.VertexFormat.unpack(r,a,F);a+=y.VertexFormat.packedLength;var u=r[a++],m=1===r[a++],f=r[a++],h=r[a];return e.defined(o)?(o._positions=s,o._colors=c,o._ellipsoid=t.Ellipsoid.clone(p,o._ellipsoid),o._vertexFormat=y.VertexFormat.clone(d,o._vertexFormat),o._width=u,o._colorsPerVertex=m,o._arcType=f,o._granularity=h,o):(G.positions=s,G.colors=c,G.width=u,G.colorsPerVertex=m,G.arcType=f,G.granularity=h,new V(G))};var R=new t.Cartesian3,O=new t.Cartesian3,S=new t.Cartesian3,B=new t.Cartesian3;return V.createGeometry=function(l){var y,m,f,h=l._width,v=l._vertexFormat,C=l._colors,g=l._colorsPerVertex,_=l._arcType,b=l._granularity,A=l._ellipsoid,E=[],P=a.arrayRemoveDuplicates(l._positions,t.Cartesian3.equalsEpsilon,!1,E);if(e.defined(C)&&E.length>0){var w=0,x=E[0];C=C.filter((function(e,t){return!(g?t===x||0===t&&1===x:t+1===x)||(w++,x=E[w],!1)}))}var T=P.length;if(!(T<2||h<=0)){if(_===r.ArcType.GEODESIC||_===r.ArcType.RHUMB){var V,L;_===r.ArcType.GEODESIC?(V=d.CesiumMath.chordLength(b,A.maximumRadius),L=u.PolylinePipeline.numberOfPoints):(V=b,L=u.PolylinePipeline.numberOfPointsRhumbLine);var F=u.PolylinePipeline.extractHeights(P,A);if(e.defined(C)){var G=1;for(y=0;y<T-1;++y)G+=L(P[y],P[y+1],V);var I=new Array(G),M=0;for(y=0;y<T-1;++y){var U=P[y],N=P[y+1],H=C[y],W=L(U,N,V);if(g&&y<G){var Y=D(0,0,H,C[y+1],W),q=Y.length;for(m=0;m<q;++m)I[M++]=Y[m]}else for(m=0;m<W;++m)I[M++]=n.Color.clone(H)}I[M]=n.Color.clone(C[C.length-1]),C=I,k.length=0}P=_===r.ArcType.GEODESIC?u.PolylinePipeline.generateCartesianArc({positions:P,minDistance:V,ellipsoid:A,height:F}):u.PolylinePipeline.generateCartesianRhumbArc({positions:P,granularity:V,ellipsoid:A,height:F})}var j,z=4*(T=P.length)-4,J=new Float64Array(3*z),K=new Float64Array(3*z),Q=new Float64Array(3*z),X=new Float32Array(2*z),Z=v.st?new Float32Array(2*z):void 0,$=e.defined(C)?new Uint8Array(4*z):void 0,ee=0,te=0,re=0,ae=0;for(m=0;m<T;++m){var oe,ne;0===m?(j=R,t.Cartesian3.subtract(P[0],P[1],j),t.Cartesian3.add(P[0],j,j)):j=P[m-1],t.Cartesian3.clone(j,S),t.Cartesian3.clone(P[m],O),m===T-1?(j=R,t.Cartesian3.subtract(P[T-1],P[T-2],j),t.Cartesian3.add(P[T-1],j,j)):j=P[m+1],t.Cartesian3.clone(j,B),e.defined($)&&(oe=0===m||g?C[m]:C[m-1],m!==T-1&&(ne=C[m]));var ie=m===T-1?2:4;for(f=0===m?2:0;f<ie;++f){t.Cartesian3.pack(O,J,ee),t.Cartesian3.pack(S,K,ee),t.Cartesian3.pack(B,Q,ee),ee+=3;var le=f-2<0?-1:1;if(X[te++]=f%2*2-1,X[te++]=le*h,v.st&&(Z[re++]=m/(T-1),Z[re++]=Math.max(X[te-2],0)),e.defined($)){var se=f<2?oe:ne;$[ae++]=n.Color.floatToByte(se.red),$[ae++]=n.Color.floatToByte(se.green),$[ae++]=n.Color.floatToByte(se.blue),$[ae++]=n.Color.floatToByte(se.alpha)}}}var ce=new c.GeometryAttributes;ce.position=new s.GeometryAttribute({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:J}),ce.prevPosition=new s.GeometryAttribute({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:K}),ce.nextPosition=new s.GeometryAttribute({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:Q}),ce.expandAndWidth=new s.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:X}),v.st&&(ce.st=new s.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:Z})),e.defined($)&&(ce.color=new s.GeometryAttribute({componentDatatype:i.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,values:$,normalize:!0}));var pe=p.IndexDatatype.createTypedArray(z,6*T-6),de=0,ue=0,ye=T-1;for(m=0;m<ye;++m)pe[ue++]=de,pe[ue++]=de+2,pe[ue++]=de+1,pe[ue++]=de+1,pe[ue++]=de+2,pe[ue++]=de+3,de+=4;return new s.Geometry({attributes:ce,indices:pe,primitiveType:s.PrimitiveType.TRIANGLES,boundingSphere:o.BoundingSphere.fromPoints(P),geometryType:s.GeometryType.POLYLINES})}},function(r,a){return e.defined(a)&&(r=V.unpack(r,a)),r._ellipsoid=t.Ellipsoid.clone(r._ellipsoid),V.createGeometry(r)}}));
