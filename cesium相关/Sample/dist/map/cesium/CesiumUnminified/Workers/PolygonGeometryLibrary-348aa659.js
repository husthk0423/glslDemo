define(["exports","./ArcType-98ec98bf","./arrayRemoveDuplicates-9a47c9b6","./Cartesian2-cce28994","./ComponentDatatype-c1201c79","./defaultValue-81eec7ed","./EllipsoidRhumbLine-52cdeee5","./GeometryAttribute-c4e682f4","./GeometryAttributes-32b29525","./GeometryPipeline-b8be120b","./IndexDatatype-2503dc5a","./Math-29cbc3fa","./Matrix4-da4bb68c","./PolygonPipeline-8ba20582","./Transforms-599d3866"],(function(e,t,r,i,n,a,o,s,u,l,c,h,f,p,d){"use strict";function y(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(y.prototype,{length:{get:function(){return this._length}}}),y.prototype.enqueue=function(e){this._array.push(e),this._length++},y.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,r=e[t];return e[t]=void 0,++t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,r}},y.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},y.prototype.contains=function(e){return-1!==this._array.indexOf(e)},y.prototype.clear=function(){this._array.length=this._offset=this._length=0},y.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var g={computeHierarchyPackedLength:function(e){for(var t=0,r=[e];r.length>0;){var n=r.pop();if(a.defined(n)){t+=2;var o=n.positions,s=n.holes;if(a.defined(o)&&(t+=o.length*i.Cartesian3.packedLength),a.defined(s))for(var u=s.length,l=0;l<u;++l)r.push(s[l])}}return t},packPolygonHierarchy:function(e,t,r){for(var n=[e];n.length>0;){var o=n.pop();if(a.defined(o)){var s=o.positions,u=o.holes;if(t[r++]=a.defined(s)?s.length:0,t[r++]=a.defined(u)?u.length:0,a.defined(s))for(var l=s.length,c=0;c<l;++c,r+=3)i.Cartesian3.pack(s[c],t,r);if(a.defined(u))for(var h=u.length,f=0;f<h;++f)n.push(u[f])}}return r},unpackPolygonHierarchy:function(e,t){for(var r=e[t++],n=e[t++],a=new Array(r),o=n>0?new Array(n):void 0,s=0;s<r;++s,t+=i.Cartesian3.packedLength)a[s]=i.Cartesian3.unpack(e,t);for(var u=0;u<n;++u)o[u]=g.unpackPolygonHierarchy(e,t),t=o[u].startingIndex,delete o[u].startingIndex;return{positions:a,holes:o,startingIndex:t}}},v=new i.Cartesian3;function m(e,t,r,n){return i.Cartesian3.subtract(t,e,v),i.Cartesian3.multiplyByScalar(v,r/n,v),i.Cartesian3.add(e,v,v),[v.x,v.y,v.z]}g.subdivideLineCount=function(e,t,r){var n=i.Cartesian3.distance(e,t)/r,a=Math.max(0,Math.ceil(h.CesiumMath.log2(n)));return Math.pow(2,a)};var C=new i.Cartographic,b=new i.Cartographic,T=new i.Cartographic,w=new i.Cartesian3;g.subdivideRhumbLineCount=function(e,t,r,i){var n=e.cartesianToCartographic(t,C),a=e.cartesianToCartographic(r,b),s=new o.EllipsoidRhumbLine(n,a,e).surfaceDistance/i,u=Math.max(0,Math.ceil(h.CesiumMath.log2(s)));return Math.pow(2,u)},g.subdivideLine=function(e,t,r,n){var o=g.subdivideLineCount(e,t,r),s=i.Cartesian3.distance(e,t),u=s/o;a.defined(n)||(n=[]);var l=n;l.length=3*o;for(var c=0,h=0;h<o;h++){var f=m(e,t,h*u,s);l[c++]=f[0],l[c++]=f[1],l[c++]=f[2]}return l},g.subdivideRhumbLine=function(e,t,r,i,n){var s=e.cartesianToCartographic(t,C),u=e.cartesianToCartographic(r,b),l=new o.EllipsoidRhumbLine(s,u,e),c=l.surfaceDistance/i,f=Math.max(0,Math.ceil(h.CesiumMath.log2(c))),p=Math.pow(2,f),d=l.surfaceDistance/p;a.defined(n)||(n=[]);var y=n;y.length=3*p;for(var g=0,v=0;v<p;v++){var m=l.interpolateUsingSurfaceDistance(v*d,T),I=e.cartographicToCartesian(m,w);y[g++]=I.x,y[g++]=I.y,y[g++]=I.z}return y};var I=new i.Cartesian3,x=new i.Cartesian3,E=new i.Cartesian3,A=new i.Cartesian3;g.scaleToGeodeticHeightExtruded=function(e,t,r,n,o){n=a.defaultValue(n,i.Ellipsoid.WGS84);var s=I,u=x,l=E,c=A;if(a.defined(e)&&a.defined(e.attributes)&&a.defined(e.attributes.position))for(var h=e.attributes.position.values,f=h.length/2,p=0;p<f;p+=3)i.Cartesian3.fromArray(h,p,l),n.geodeticSurfaceNormal(l,s),c=n.scaleToGeodeticSurface(l,c),u=i.Cartesian3.multiplyByScalar(s,r,u),u=i.Cartesian3.add(c,u,u),h[p+f]=u.x,h[p+1+f]=u.y,h[p+2+f]=u.z,o&&(c=i.Cartesian3.clone(l,c)),u=i.Cartesian3.multiplyByScalar(s,t,u),u=i.Cartesian3.add(c,u,u),h[p]=u.x,h[p+1]=u.y,h[p+2]=u.z;return e},g.polygonOutlinesFromHierarchy=function(e,t,n){var o,s,u,l=[],c=new y;for(c.enqueue(e);0!==c.length;){var h=c.dequeue(),f=h.positions;if(t)for(u=f.length,o=0;o<u;o++)n.scaleToGeodeticSurface(f[o],f[o]);if(!((f=r.arrayRemoveDuplicates(f,i.Cartesian3.equalsEpsilon,!0)).length<3)){var p=h.holes?h.holes.length:0;for(o=0;o<p;o++){var d=h.holes[o],g=d.positions;if(t)for(u=g.length,s=0;s<u;++s)n.scaleToGeodeticSurface(g[s],g[s]);if(!((g=r.arrayRemoveDuplicates(g,i.Cartesian3.equalsEpsilon,!0)).length<3)){l.push(g);var v=0;for(a.defined(d.holes)&&(v=d.holes.length),s=0;s<v;s++)c.enqueue(d.holes[s])}}l.push(f)}}return l},g.polygonsFromHierarchy=function(e,t,n,o){var s=[],u=[],l=new y;for(l.enqueue(e);0!==l.length;){var c,h,f=l.dequeue(),d=f.positions,g=f.holes;if(n)for(h=d.length,c=0;c<h;c++)o.scaleToGeodeticSurface(d[c],d[c]);if(!((d=r.arrayRemoveDuplicates(d,i.Cartesian3.equalsEpsilon,!0)).length<3)){var v=t(d);if(a.defined(v)){var m=[],C=p.PolygonPipeline.computeWindingOrder2D(v);C===p.WindingOrder.CLOCKWISE&&(v.reverse(),d=d.slice().reverse());var b,T=d.slice(),w=a.defined(g)?g.length:0,I=[];for(c=0;c<w;c++){var x=g[c],E=x.positions;if(n)for(h=E.length,b=0;b<h;++b)o.scaleToGeodeticSurface(E[b],E[b]);if(!((E=r.arrayRemoveDuplicates(E,i.Cartesian3.equalsEpsilon,!0)).length<3)){var A=t(E);if(a.defined(A)){(C=p.PolygonPipeline.computeWindingOrder2D(A))===p.WindingOrder.CLOCKWISE&&(A.reverse(),E=E.slice().reverse()),I.push(E),m.push(T.length),T=T.concat(E),v=v.concat(A);var P=0;for(a.defined(x.holes)&&(P=x.holes.length),b=0;b<P;b++)l.enqueue(x.holes[b])}}}s.push({outerRing:d,holes:I}),u.push({positions:T,positions2D:v,holes:m})}}}return{hierarchy:s,polygons:u}};var P=new i.Cartesian2,_=new i.Cartesian3,M=new d.Quaternion,G=new f.Matrix3;g.computeBoundingRectangle=function(e,t,r,n,o){for(var s=d.Quaternion.fromAxisAngle(e,n,M),u=f.Matrix3.fromQuaternion(s,G),l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,h=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,y=r.length,g=0;g<y;++g){var v=i.Cartesian3.clone(r[g],_);f.Matrix3.multiplyByVector(u,v,v);var m=t(v,P);a.defined(m)&&(l=Math.min(l,m.x),c=Math.max(c,m.x),h=Math.min(h,m.y),p=Math.max(p,m.y))}return o.x=l,o.y=h,o.width=c-l,o.height=p-h,o},g.createGeometryFromPositions=function(e,r,i,a,o,u){var c=p.PolygonPipeline.triangulate(r.positions2D,r.holes);c.length<3&&(c=[0,1,2]);var h=r.positions;if(a){for(var f=h.length,d=new Array(3*f),y=0,g=0;g<f;g++){var v=h[g];d[y++]=v.x,d[y++]=v.y,d[y++]=v.z}var m=new s.Geometry({attributes:{position:new s.GeometryAttribute({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d})},indices:c,primitiveType:s.PrimitiveType.TRIANGLES});return o.normal?l.GeometryPipeline.computeNormal(m):m}return u===t.ArcType.GEODESIC?p.PolygonPipeline.computeSubdivision(e,h,c,i):u===t.ArcType.RHUMB?p.PolygonPipeline.computeRhumbLineSubdivision(e,h,c,i):void 0};var L=[],D=new i.Cartesian3,S=new i.Cartesian3;g.computeWallGeometry=function(e,r,a,o,l){var f,p,d,y,v,m=e.length,C=0;if(o)for(p=3*m*2,f=new Array(2*p),d=0;d<m;d++)y=e[d],v=e[(d+1)%m],f[C]=f[C+p]=y.x,f[++C]=f[C+p]=y.y,f[++C]=f[C+p]=y.z,f[++C]=f[C+p]=v.x,f[++C]=f[C+p]=v.y,f[++C]=f[C+p]=v.z,++C;else{var b=h.CesiumMath.chordLength(a,r.maximumRadius),T=0;if(l===t.ArcType.GEODESIC)for(d=0;d<m;d++)T+=g.subdivideLineCount(e[d],e[(d+1)%m],b);else if(l===t.ArcType.RHUMB)for(d=0;d<m;d++)T+=g.subdivideRhumbLineCount(r,e[d],e[(d+1)%m],b);for(p=3*(T+m),f=new Array(2*p),d=0;d<m;d++){var w;y=e[d],v=e[(d+1)%m],l===t.ArcType.GEODESIC?w=g.subdivideLine(y,v,b,L):l===t.ArcType.RHUMB&&(w=g.subdivideRhumbLine(r,y,v,b,L));for(var I=w.length,x=0;x<I;++x,++C)f[C]=w[x],f[C+p]=w[x];f[C]=v.x,f[C+p]=v.x,f[++C]=v.y,f[C+p]=v.y,f[++C]=v.z,f[C+p]=v.z,++C}}m=f.length;var E=c.IndexDatatype.createTypedArray(m/3,m-6*e.length),A=0;for(m/=6,d=0;d<m;d++){var P=d,_=P+1,M=P+m,G=M+1;y=i.Cartesian3.fromArray(f,3*P,D),v=i.Cartesian3.fromArray(f,3*_,S),i.Cartesian3.equalsEpsilon(y,v,h.CesiumMath.EPSILON10,h.CesiumMath.EPSILON10)||(E[A++]=P,E[A++]=M,E[A++]=_,E[A++]=_,E[A++]=M,E[A++]=G)}return new s.Geometry({attributes:new u.GeometryAttributes({position:new s.GeometryAttribute({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:f})}),indices:E,primitiveType:s.PrimitiveType.TRIANGLES})},e.PolygonGeometryLibrary=g}));
