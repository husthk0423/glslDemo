define(["exports","./Cartesian2-cce28994","./Matrix4-da4bb68c","./EllipsoidTangentPlane-3ee186ca","./Math-29cbc3fa","./PolylinePipeline-f785d88a","./Transforms-599d3866","./defaultValue-81eec7ed","./Check-edea0f91"],(function(e,a,r,n,t,i,s,o,l){"use strict";var c=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),C={};function u(e,a){o.defined(C[e])||(C[e]=!0,console.warn(o.defaultValue(a,e)))}u.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.",u.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored",u.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored",u.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored";var d=[new a.Cartesian3,new a.Cartesian3],g=new a.Cartesian3,y=new a.Cartesian3,h=new a.Cartesian3,f=new a.Cartesian3,m=new a.Cartesian3,p=new a.Cartesian3,w=new a.Cartesian3,v=new a.Cartesian3,x=new a.Cartesian3,E=new a.Cartesian3,P=new a.Cartesian3,M={},b=new a.Cartographic;function T(e,r,n,t){var i,s=e[0],o=e[1],l=a.Cartesian3.angleBetween(s,o),c=Math.ceil(l/t),C=new Array(c);if(r===n){for(i=0;i<c;i++)C[i]=r;return C.push(n),C}var u=(n-r)/c;for(i=1;i<c;i++){var d=r+i*u;C[i]=d}return C[0]=r,C.push(n),C}var B=new a.Cartesian3,z=new a.Cartesian3;var S=new a.Cartesian3(-1,0,0),A=new r.Matrix4,D=new r.Matrix4,R=new r.Matrix3,O=r.Matrix3.IDENTITY.clone(),V=new a.Cartesian3,I=new r.Cartesian4,N=new a.Cartesian3;function G(e,t,i,o,l,c,C,u){var d=V,g=I;A=s.Transforms.eastNorthUpToFixedFrame(e,l,A),d=r.Matrix4.multiplyByPointAsVector(A,S,d);var y=function(e,r,t,i){var s=new n.EllipsoidTangentPlane(t,i),o=s.projectPointOntoPlane(a.Cartesian3.add(t,e,B),B),l=s.projectPointOntoPlane(a.Cartesian3.add(t,r,z),z),c=a.Cartesian2.angleBetween(o,l);return l.x*o.y-l.y*o.x>=0?-c:c}(d=a.Cartesian3.normalize(d,d),t,e,l);R=r.Matrix3.fromRotationZ(y,R),N.z=c,A=r.Matrix4.multiplyTransformation(A,r.Matrix4.fromRotationTranslation(R,N,D),A);var h=O;h[0]=C;for(var f=0;f<u;f++)for(var m=0;m<i.length;m+=3)g=a.Cartesian3.fromArray(i,m,g),g=r.Matrix3.multiplyByVector(h,g,g),g=r.Matrix4.multiplyByPoint(A,g,g),o.push(g.x,g.y,g.z);return o}var H=new a.Cartesian3;function L(e,r,n,t,i,s,o){for(var l=0;l<e.length;l+=3){t=G(a.Cartesian3.fromArray(e,l,H),r,n,t,i,s[l/3],o,1)}return t}function j(e,a){for(var r=e.length,n=new Array(3*r),t=0,i=a.x+a.width/2,s=a.y+a.height/2,o=0;o<r;o++)n[t++]=e[o].x-i,n[t++]=0,n[t++]=e[o].y-s;return n}var Q=new s.Quaternion,q=new a.Cartesian3,F=new r.Matrix3;function U(e,n,i,o,l,C,u,d,g,y){var h,f,m=a.Cartesian3.angleBetween(a.Cartesian3.subtract(n,e,E),a.Cartesian3.subtract(i,e,P)),p=o===c.BEVELED?0:Math.ceil(m/t.CesiumMath.toRadians(5));if(h=l?r.Matrix3.fromQuaternion(s.Quaternion.fromAxisAngle(a.Cartesian3.negate(e,E),m/(p+1),Q),F):r.Matrix3.fromQuaternion(s.Quaternion.fromAxisAngle(e,m/(p+1),Q),F),n=a.Cartesian3.clone(n,q),p>0)for(var w=y?2:1,v=0;v<p;v++)n=r.Matrix3.multiplyByVector(h,n,n),f=a.Cartesian3.subtract(n,e,E),f=a.Cartesian3.normalize(f,f),l||(f=a.Cartesian3.negate(f,f)),u=G(C.scaleToGeodeticSurface(n,P),f,d,u,C,g,1,w);else f=a.Cartesian3.subtract(n,e,E),f=a.Cartesian3.normalize(f,f),l||(f=a.Cartesian3.negate(f,f)),u=G(C.scaleToGeodeticSurface(n,P),f,d,u,C,g,1,1),i=a.Cartesian3.clone(i,q),f=a.Cartesian3.subtract(i,e,E),f=a.Cartesian3.normalize(f,f),l||(f=a.Cartesian3.negate(f,f)),u=G(C.scaleToGeodeticSurface(i,P),f,d,u,C,g,1,1);return u}M.removeDuplicatesFromShape=function(e){for(var r=e.length,n=[],t=r-1,i=0;i<r;t=i++){var s=e[t],o=e[i];a.Cartesian2.equals(s,o)||n.push(o)}return n},M.angleIsGreaterThanPi=function(e,r,t,i){var s=new n.EllipsoidTangentPlane(t,i),o=s.projectPointOntoPlane(a.Cartesian3.add(t,e,B),B),l=s.projectPointOntoPlane(a.Cartesian3.add(t,r,z),z);return l.x*o.y-l.y*o.x>=0};var _=new a.Cartesian3,Z=new a.Cartesian3;M.computePositions=function(e,r,n,s,o){var l=s._ellipsoid,C=function(e,a){for(var r=new Array(e.length),n=0;n<e.length;n++){var t=e[n];b=a.cartesianToCartographic(t,b),r[n]=b.height,e[n]=a.scaleToGeodeticSurface(t,t)}return r}(e,l),P=s._granularity,B=s._cornerType,z=o?function(e,a){var r=e.length,n=new Array(6*r),t=0,i=a.x+a.width/2,s=a.y+a.height/2,o=e[0];n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s;for(var l=1;l<r;l++){var c=(o=e[l]).x-i,C=o.y-s;n[t++]=c,n[t++]=0,n[t++]=C,n[t++]=c,n[t++]=0,n[t++]=C}return o=e[0],n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s,n}(r,n):j(r,n),S=o?j(r,n):void 0,A=n.height/2,D=n.width/2,R=e.length,O=[],V=o?[]:void 0,I=g,N=y,H=h,Q=f,q=m,F=p,k=w,W=v,Y=x,J=e[0],K=e[1];Q=l.geodeticSurfaceNormal(J,Q),I=a.Cartesian3.subtract(K,J,I),I=a.Cartesian3.normalize(I,I),W=a.Cartesian3.cross(Q,I,W),W=a.Cartesian3.normalize(W,W);var X,$=C[0],ee=C[1];o&&(V=G(J,W,S,V,l,$+A,1,1)),Y=a.Cartesian3.clone(J,Y),J=K,N=a.Cartesian3.negate(I,N);for(var ae=1;ae<R-1;ae++){var re=o?2:1;if(K=e[ae+1],J.equals(K))u("Positions are too close and are considered equivalent with rounding error.");else{I=a.Cartesian3.subtract(K,J,I),I=a.Cartesian3.normalize(I,I),H=a.Cartesian3.add(I,N,H),H=a.Cartesian3.normalize(H,H),Q=l.geodeticSurfaceNormal(J,Q);var ne=a.Cartesian3.multiplyByScalar(Q,a.Cartesian3.dot(I,Q),_);a.Cartesian3.subtract(I,ne,ne),a.Cartesian3.normalize(ne,ne);var te=a.Cartesian3.multiplyByScalar(Q,a.Cartesian3.dot(N,Q),Z);if(a.Cartesian3.subtract(N,te,te),a.Cartesian3.normalize(te,te),!t.CesiumMath.equalsEpsilon(Math.abs(a.Cartesian3.dot(ne,te)),1,t.CesiumMath.EPSILON7)){H=a.Cartesian3.cross(H,Q,H),H=a.Cartesian3.cross(Q,H,H),H=a.Cartesian3.normalize(H,H);var ie=1/Math.max(.25,a.Cartesian3.magnitude(a.Cartesian3.cross(H,N,E))),se=M.angleIsGreaterThanPi(I,N,J,l);se?(q=a.Cartesian3.add(J,a.Cartesian3.multiplyByScalar(H,ie*D,H),q),F=a.Cartesian3.add(q,a.Cartesian3.multiplyByScalar(W,D,F),F),d[0]=a.Cartesian3.clone(Y,d[0]),d[1]=a.Cartesian3.clone(F,d[1]),X=T(d,$+A,ee+A,P),O=L(i.PolylinePipeline.generateArc({positions:d,granularity:P,ellipsoid:l}),W,z,O,l,X,1),W=a.Cartesian3.cross(Q,I,W),W=a.Cartesian3.normalize(W,W),k=a.Cartesian3.add(q,a.Cartesian3.multiplyByScalar(W,D,k),k),B===c.ROUNDED||B===c.BEVELED?U(q,F,k,B,se,l,O,z,ee+A,o):O=G(J,H=a.Cartesian3.negate(H,H),z,O,l,ee+A,ie,re),Y=a.Cartesian3.clone(k,Y)):(q=a.Cartesian3.add(J,a.Cartesian3.multiplyByScalar(H,ie*D,H),q),F=a.Cartesian3.add(q,a.Cartesian3.multiplyByScalar(W,-D,F),F),d[0]=a.Cartesian3.clone(Y,d[0]),d[1]=a.Cartesian3.clone(F,d[1]),X=T(d,$+A,ee+A,P),O=L(i.PolylinePipeline.generateArc({positions:d,granularity:P,ellipsoid:l}),W,z,O,l,X,1),W=a.Cartesian3.cross(Q,I,W),W=a.Cartesian3.normalize(W,W),k=a.Cartesian3.add(q,a.Cartesian3.multiplyByScalar(W,-D,k),k),B===c.ROUNDED||B===c.BEVELED?U(q,F,k,B,se,l,O,z,ee+A,o):O=G(J,H,z,O,l,ee+A,ie,re),Y=a.Cartesian3.clone(k,Y)),N=a.Cartesian3.negate(I,N)}else O=G(Y,W,z,O,l,$+A,1,1),Y=J;$=ee,ee=C[ae+1],J=K}}d[0]=a.Cartesian3.clone(Y,d[0]),d[1]=a.Cartesian3.clone(J,d[1]),X=T(d,$+A,ee+A,P),O=L(i.PolylinePipeline.generateArc({positions:d,granularity:P,ellipsoid:l}),W,z,O,l,X,1),o&&(V=G(J,W,S,V,l,ee+A,1,1)),R=O.length;var oe=o?R+V.length:R,le=new Float64Array(oe);return le.set(O),o&&le.set(V,R),le},e.CornerType=c,e.PolylineVolumeGeometryLibrary=M,e.oneTimeWarning=u}));
