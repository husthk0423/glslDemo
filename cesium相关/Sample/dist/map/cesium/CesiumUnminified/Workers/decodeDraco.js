define(["./ComponentDatatype-c1201c79","./defaultValue-81eec7ed","./IndexDatatype-2503dc5a","./RuntimeError-94b0bf5f","./createTaskProcessorWorker","./Check-edea0f91","./WebGLConstants-1c8239cc","./Math-29cbc3fa","./when-422ea0ae"],(function(e,t,r,n,a,o,i,u,s){"use strict";var d;function c(e,t){for(var n=e.num_points(),a=e.num_faces(),o=new d.DracoInt32Array,i=3*a,u=r.IndexDatatype.createTypedArray(n,i),s=0,c=0;c<a;++c)t.GetFaceFromMesh(e,c,o),u[s+0]=o.GetValue(0),u[s+1]=o.GetValue(1),u[s+2]=o.GetValue(2),s+=3;return d.destroy(o),{typedArray:u,numberOfIndices:i}}function f(r,n,a){var o,i=r.num_points(),u=a.num_components(),s=new d.AttributeQuantizationTransform;if(s.InitFromAttribute(a)){for(var c=new Array(u),f=0;f<u;++f)c[f]=s.min_value(f);o={quantizationBits:s.quantization_bits(),minValues:c,range:s.range(),octEncoded:!1}}d.destroy(s),(s=new d.AttributeOctahedronTransform).InitFromAttribute(a)&&(o={quantizationBits:s.quantization_bits(),octEncoded:!0}),d.destroy(s);var y,A=i*u;y=t.defined(o)?function(e,t,r,n,a){var o,i;n.quantizationBits<=8?(i=new d.DracoUInt8Array,o=new Uint8Array(a),t.GetAttributeUInt8ForAllPoints(e,r,i)):(i=new d.DracoUInt16Array,o=new Uint16Array(a),t.GetAttributeUInt16ForAllPoints(e,r,i));for(var u=0;u<a;++u)o[u]=i.GetValue(u);return d.destroy(i),o}(r,n,a,o,A):function(e,t,r,n){var a,o;switch(r.data_type()){case 1:case 11:o=new d.DracoInt8Array,a=new Int8Array(n),t.GetAttributeInt8ForAllPoints(e,r,o);break;case 2:o=new d.DracoUInt8Array,a=new Uint8Array(n),t.GetAttributeUInt8ForAllPoints(e,r,o);break;case 3:o=new d.DracoInt16Array,a=new Int16Array(n),t.GetAttributeInt16ForAllPoints(e,r,o);break;case 4:o=new d.DracoUInt16Array,a=new Uint16Array(n),t.GetAttributeUInt16ForAllPoints(e,r,o);break;case 5:case 7:o=new d.DracoInt32Array,a=new Int32Array(n),t.GetAttributeInt32ForAllPoints(e,r,o);break;case 6:case 8:o=new d.DracoUInt32Array,a=new Uint32Array(n),t.GetAttributeUInt32ForAllPoints(e,r,o);break;case 9:case 10:o=new d.DracoFloat32Array,a=new Float32Array(n),t.GetAttributeFloatForAllPoints(e,r,o)}for(var i=0;i<n;++i)a[i]=o.GetValue(i);return d.destroy(o),a}(r,n,a,A);var b=e.ComponentDatatype.fromTypedArray(y);return{array:y,data:{componentsPerAttribute:u,componentDatatype:b,byteOffset:a.byte_offset(),byteStride:e.ComponentDatatype.getSizeInBytes(b)*u,normalized:a.normalized(),quantization:o}}}function y(e){return t.defined(e.bufferView)?function(e){var r=new d.Decoder,a=["POSITION","NORMAL"],o=e.compressedAttributes;if(t.defined(o.COLOR_1)||a.push("COLOR"),t.defined(o.TEXCOORD_1)||a.push("TEX_COORD"),e.dequantizeInShader)for(var i=0;i<a.length;++i)r.SkipAttributeTransform(d[a[i]]);var u=e.bufferView,s=new d.DecoderBuffer;if(s.Init(e.array,u.byteLength),r.GetEncodedGeometryType(s)!==d.TRIANGULAR_MESH)throw new n.RuntimeError("Unsupported draco mesh geometry type.");var y=new d.Mesh,A=r.DecodeBufferToMesh(s,y);if(!A.ok()||0===y.ptr)throw new n.RuntimeError("Error decoding draco mesh geometry: "+A.error_msg());d.destroy(s);var b={};for(var l in o)if(o.hasOwnProperty(l)){var m,w=l;if("TEXCOORD_0"===l&&(w="TEX_COORD"),"COLOR_0"===l&&(w="COLOR"),a.includes(w)){var I=r.GetAttributeId(y,d[w]);m=r.GetAttribute(y,I)}else{var p=o[l];m=r.GetAttributeByUniqueId(y,p)}b[l]=f(y,r,m)}var O={indexArray:c(y,r),attributeData:b};return d.destroy(y),d.destroy(r),O}(e):function(e){var t=new d.Decoder;e.dequantizeInShader&&(t.SkipAttributeTransform(d.POSITION),t.SkipAttributeTransform(d.NORMAL));var r=new d.DecoderBuffer;if(r.Init(e.buffer,e.buffer.length),t.GetEncodedGeometryType(r)!==d.POINT_CLOUD)throw new n.RuntimeError("Draco geometry type must be POINT_CLOUD.");var a=new d.PointCloud,o=t.DecodeBufferToPointCloud(r,a);if(!o.ok()||0===a.ptr)throw new n.RuntimeError("Error decoding draco point cloud: "+o.error_msg());d.destroy(r);var i={},u=e.properties;for(var s in u)if(u.hasOwnProperty(s)){var c;if("POSITION"===s||"NORMAL"===s){var y=t.GetAttributeId(a,d[s]);c=t.GetAttribute(a,y)}else{var A=u[s];c=t.GetAttributeByUniqueId(a,A)}i[s]=f(a,t,c)}return d.destroy(a),d.destroy(t),i}(e)}function A(e){d=e,self.onmessage=a(y),self.postMessage(!0)}return function(e){var r=e.data.webAssemblyConfig;if(t.defined(r))return require([r.modulePath],(function(e){t.defined(r.wasmBinaryFile)?(t.defined(e)||(e=self.DracoDecoderModule),e(r).then((function(e){A(e)}))):A(e())}))}}));
