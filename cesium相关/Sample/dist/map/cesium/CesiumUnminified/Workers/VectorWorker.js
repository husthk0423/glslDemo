define(["./createTaskProcessorWorker","./Transforms-599d3866","./Resource-721e53e7","./Cartesian2-cce28994","./VectorDrawer","./snappyJs","./point-766425d1","./ColorUtil","./defaultValue-81eec7ed","./when-422ea0ae","./Matrix4-da4bb68c","./Check-edea0f91","./Math-29cbc3fa","./RuntimeError-94b0bf5f","./combine-0897f2e3"],(function(e,t,r,l,n,i,o,a,f,s,u,c,h,y,p){"use strict";let d,g=512,b="";function k(e){let t=[],r=0,l=0;for(;r<e.length;){let n=e[r++];if(n<128)t[l++]=n;else if(n>191&&n<224){let i=e[r++];t[l++]=(31&n)<<6|63&i}else if(n>239&&n<365){let i=((7&n)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[l++]=55296+(i>>10),t[l++]=56320+(1023&i)}else{let i=e[r++],o=e[r++];t[l++]=(15&n)<<12|(63&i)<<6|63&o}}let n=[],i=0,o=0,a=0,f=5e4,s=t.length/f-1;for(i=0;i<s;i++)o=i*f,a=(i+1)*f,n.push(String.fromCharCode.apply({},t.slice(o,a)));return o=i*f,a=t.length,n.push(String.fromCharCode.apply({},t.slice(o,a))),n=n.join(""),n}function w(e,t){if(e&&e.layer){(function(e,t){for(let r in e){let l=e[r].features;l||(l=e[r].datas);for(let e=0;e<l.length;e++)C(l[e][2],t)}})(e=e.layer,t.needDecode);let r={},l=new n([e],t.level,r,t.controlVector,t.highLightVector,t.filterLayerId);return d.call({},l,t.level),r}return{}}function C(e,t){if("F"!=e[0])if(Array.isArray(e[0])){let r=e.length;for(let l=0;l<r;l++){C(e[l],t)}}else t&&function(e){let t=[e[0],e[1]];for(let r=2;r<e.length;r++){let l=t[0]+e[r],n=t[1]+e[r+1];e[r]=l,e[r+1]=n,t=[l,n],r++}}(e);else e[0]=[.05*-g,.05*-g,1.05*g,.05*-g,1.05*g,1.05*g,.05*-g,1.05*g]}function F(e,t){let r=[];for(let l=0;l<e.keyArr.length;l++){let n=e[e.keyArr[l]],i=n.style;if(z(i),n.lineFeatues.length>0){let e=new o.LineBucket({style:i,type:"line",tileSize:g});for(let t of n.lineFeatues){S(t,i);let r=m(t);e.addFeature(r)}e=e.serialize(t),r.push(e)}else if(n.fillFeatures.length>0){let e=new o.FillBucket({style:i,type:"fill",tileSize:g}),l=new o.LineBucket({style:i,type:"line",tileSize:g});for(let t of n.fillFeatures){S(t,i);let r=m(t);e.addFeature(r),i.stroke&&l.addFeature(r)}e=e.serialize(t),r.push(e),i.stroke&&(l=l.serialize(t),r.push(l))}}return r}function S(e,t,r){if(!t.sparsity)return;let l=parseFloat(t.sparsity);for(let t=0;t<e.data.length;t++){let r=e.data[t];null==l&&1==l||(e.data[t]=o.simplify(r,l/4,!0))}}function m(e){let t=256/g*32,r=[];for(let l=0;l<e.data.length;l++){r[l]=[];let n=e.data[l];for(let e=0;e<n.length;e++)if(e%2==0){let i=n[e]*t,a=n[e+1]*t;r[l].push(new o.Point(i,a))}}return r}function z(e){let t=new a;if(e.fillColor){t.fromHex(e.fillColor);let r=[t.rgb[0]/255,t.rgb[1]/255,t.rgb[2]/255,1];e.fillColor=r}if(e.strokeColor){t=new a,t.fromHex(e.strokeColor);let r=[t.rgb[0]/255,t.rgb[1]/255,t.rgb[2]/255,1];e.strokeColor=r}}return e((function(e,t){if(1==e.init)return d=new Function("drawer","level",e.styleStr),g=e.tileSize,b=e.return_type,!0;if(1==e.changeStyle){let r=k(new Uint8Array(e.tileData));return F(w(JSON.parse(r),e),t)}var l,n=e.url,o=new r.Resource({url:n});return o.request.throttle=!1,o.request.throttleByServer=!0,o.request.type=1,!(l="stream_snappy"==b?o.fetchArrayBuffer():o.fetchJson())||l.then((function(r){let l=null;if("stream_snappy"==b){r=i(r),t.push(r);let e=new Uint8Array(r);l=e.buffer;let n=k(e);r=JSON.parse(n)}return{tileData:l,buckets:F(w(r,e),t)}}))}))}));
