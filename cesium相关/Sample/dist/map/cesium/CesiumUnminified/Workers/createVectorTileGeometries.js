define(["./BoundingSphere-2b618cd6","./BoxGeometry-e0c09985","./Cartesian2-cce28994","./Color-f5223c05","./CylinderGeometry-d234627c","./defaultValue-81eec7ed","./EllipsoidGeometry-7975174e","./IndexDatatype-2503dc5a","./Matrix4-da4bb68c","./createTaskProcessorWorker","./Check-edea0f91","./GeographicProjection-54ec8d9d","./Math-29cbc3fa","./Rectangle-1bad9972","./GeometryOffsetAttribute-0a70352a","./ComponentDatatype-c1201c79","./WebGLConstants-1c8239cc","./GeometryAttribute-c4e682f4","./Matrix2-c857e514","./Transforms-599d3866","./when-422ea0ae","./Resource-721e53e7","./combine-0897f2e3","./RuntimeError-94b0bf5f","./GeometryAttributes-32b29525","./VertexFormat-aef87cc2","./CylinderGeometryLibrary-36b2fe43"],(function(e,t,n,r,a,i,o,d,s,c,f,l,u,h,b,p,y,g,x,v,C,m,I,k,M,B,w){"use strict";function A(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}var O=new n.Cartesian3,L=s.Matrix4.packedLength+n.Cartesian3.packedLength,E=s.Matrix4.packedLength+2,U=s.Matrix4.packedLength+n.Cartesian3.packedLength,G=n.Cartesian3.packedLength+1,S={modelMatrix:new s.Matrix4,boundingVolume:new e.BoundingSphere};function V(e,t){var r=t*L,a=n.Cartesian3.unpack(e,r,O);r+=n.Cartesian3.packedLength;var i=s.Matrix4.unpack(e,r,S.modelMatrix);s.Matrix4.multiplyByScale(i,a,i);var o=S.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,o.center),o.radius=Math.sqrt(3),S}function R(e,t){var r=t*E,a=e[r++],i=e[r++],o=n.Cartesian3.fromElements(a,a,i,O),d=s.Matrix4.unpack(e,r,S.modelMatrix);s.Matrix4.multiplyByScale(d,o,d);var c=S.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,c.center),c.radius=Math.sqrt(2),S}function T(e,t){var r=t*U,a=n.Cartesian3.unpack(e,r,O);r+=n.Cartesian3.packedLength;var i=s.Matrix4.unpack(e,r,S.modelMatrix);s.Matrix4.multiplyByScale(i,a,i);var o=S.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,o.center),o.radius=1,S}function F(e,t){var r=t*G,a=e[r++],i=n.Cartesian3.unpack(e,r,O),o=s.Matrix4.fromTranslation(i,S.modelMatrix);s.Matrix4.multiplyByUniformScale(o,a,o);var d=S.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,d.center),d.radius=1,S}var P=new n.Cartesian3;function Z(t,a,o,d,c){if(i.defined(a)){for(var f=o.length,l=d.attributes.position.values,u=d.indices,h=t.positions,b=t.vertexBatchIds,p=t.indices,y=t.batchIds,g=t.batchTableColors,x=t.batchedIndices,v=t.indexOffsets,C=t.indexCounts,m=t.boundingVolumes,I=t.modelMatrix,k=t.center,M=t.positionOffset,B=t.batchIdIndex,w=t.indexOffset,O=t.batchedIndicesOffset,L=0;L<f;++L){var E=c(a,L),U=E.modelMatrix;s.Matrix4.multiply(I,U,U);for(var G=o[L],S=l.length,V=0;V<S;V+=3){var R=n.Cartesian3.unpack(l,V,P);s.Matrix4.multiplyByPoint(U,R,R),n.Cartesian3.subtract(R,k,R),n.Cartesian3.pack(R,h,3*M+V),b[B++]=G}for(var T=u.length,F=0;F<T;++F)p[w+F]=u[F]+M;var Z=L+O;x[Z]=new A({offset:w,count:T,color:r.Color.fromRgba(g[G]),batchIds:[G]}),y[Z]=G,v[Z]=w,C[Z]=T,m[Z]=e.BoundingSphere.transform(E.boundingVolume,U),M+=S/3,w+=T}t.positionOffset=M,t.batchIdIndex=B,t.indexOffset=w,t.batchedIndicesOffset+=f}}var D=new n.Cartesian3,q=new s.Matrix4;function W(t,n,a){var i=a.length,o=2+i*e.BoundingSphere.packedLength+1+function(e){for(var t=e.length,n=0,a=0;a<t;++a)n+=r.Color.packedLength+3+e[a].batchIds.length;return n}(n),d=new Float64Array(o),s=0;d[s++]=t,d[s++]=i;for(var c=0;c<i;++c)e.BoundingSphere.pack(a[c],d,s),s+=e.BoundingSphere.packedLength;var f=n.length;d[s++]=f;for(var l=0;l<f;++l){var u=n[l];r.Color.pack(u.color,d,s),s+=r.Color.packedLength,d[s++]=u.offset,d[s++]=u.count;var h=u.batchIds,b=h.length;d[s++]=b;for(var p=0;p<b;++p)d[s++]=h[p]}return d}return c((function(e,r){var c=i.defined(e.boxes)?new Float32Array(e.boxes):void 0,f=i.defined(e.boxBatchIds)?new Uint16Array(e.boxBatchIds):void 0,l=i.defined(e.cylinders)?new Float32Array(e.cylinders):void 0,u=i.defined(e.cylinderBatchIds)?new Uint16Array(e.cylinderBatchIds):void 0,h=i.defined(e.ellipsoids)?new Float32Array(e.ellipsoids):void 0,b=i.defined(e.ellipsoidBatchIds)?new Uint16Array(e.ellipsoidBatchIds):void 0,p=i.defined(e.spheres)?new Float32Array(e.spheres):void 0,y=i.defined(e.sphereBatchIds)?new Uint16Array(e.sphereBatchIds):void 0,g=i.defined(c)?f.length:0,x=i.defined(l)?u.length:0,v=i.defined(h)?b.length:0,C=i.defined(p)?y.length:0,m=t.BoxGeometry.getUnitBox(),I=a.CylinderGeometry.getUnitCylinder(),k=o.EllipsoidGeometry.getUnitEllipsoid(),M=m.attributes.position.values,B=I.attributes.position.values,w=k.attributes.position.values,A=M.length*g;A+=B.length*x,A+=w.length*(v+C);var O=m.indices,L=I.indices,E=k.indices,U=O.length*g;U+=L.length*x,U+=E.length*(v+C);var G=new Float32Array(A),S=new Uint16Array(A/3),P=d.IndexDatatype.createTypedArray(A/3,U),_=g+x+v+C,j=new Uint16Array(_),N=new Array(_),Y=new Uint32Array(_),z=new Uint32Array(_),H=new Array(_);!function(e){var t=new Float64Array(e),r=0;n.Cartesian3.unpack(t,r,D),r+=n.Cartesian3.packedLength,s.Matrix4.unpack(t,r,q)}(e.packedBuffer);var J={batchTableColors:new Uint32Array(e.batchTableColors),positions:G,vertexBatchIds:S,indices:P,batchIds:j,batchedIndices:N,indexOffsets:Y,indexCounts:z,boundingVolumes:H,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:q,center:D};Z(J,c,f,m,V),Z(J,l,u,I,R),Z(J,h,b,k,T),Z(J,p,y,k,F);var K=W(P.BYTES_PER_ELEMENT,N,H);return r.push(G.buffer,S.buffer,P.buffer),r.push(j.buffer,Y.buffer,z.buffer),r.push(K.buffer),{positions:G.buffer,vertexBatchIds:S.buffer,indices:P.buffer,indexOffsets:Y.buffer,indexCounts:z.buffer,batchIds:j.buffer,packedBuffer:K.buffer}}))}));
