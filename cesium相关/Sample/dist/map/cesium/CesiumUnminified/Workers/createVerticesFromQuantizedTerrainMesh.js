define(["./AxisAlignedBoundingBox-a270696e","./Cartesian2-cce28994","./defaultValue-81eec7ed","./TerrainEncoding-c47aab33","./IndexDatatype-2503dc5a","./Math-29cbc3fa","./Matrix4-da4bb68c","./Rectangle-1bad9972","./Check-edea0f91","./Transforms-599d3866","./WebMercatorProjection-0f98790d","./createTaskProcessorWorker","./BoundingSphere-2b618cd6","./GeographicProjection-54ec8d9d","./AttributeCompression-dc008507","./ComponentDatatype-c1201c79","./WebGLConstants-1c8239cc","./Matrix2-c857e514","./RuntimeError-94b0bf5f","./when-422ea0ae","./Resource-721e53e7","./combine-0897f2e3"],(function(e,t,r,i,n,o,a,s,c,d,h,u,I,l,g,m,T,E,f,p,v,y){"use strict";function N(){c.DeveloperError.throwInstantiationError()}Object.defineProperties(N.prototype,{errorEvent:{get:c.DeveloperError.throwInstantiationError},credit:{get:c.DeveloperError.throwInstantiationError},tilingScheme:{get:c.DeveloperError.throwInstantiationError},ready:{get:c.DeveloperError.throwInstantiationError},readyPromise:{get:c.DeveloperError.throwInstantiationError},hasWaterMask:{get:c.DeveloperError.throwInstantiationError},hasVertexNormals:{get:c.DeveloperError.throwInstantiationError},availability:{get:c.DeveloperError.throwInstantiationError}});var w=[];N.getRegularGridIndices=function(e,t){var i=w[e];r.defined(i)||(w[e]=i=[]);var n=i[t];return r.defined(n)||x(e,t,n=e*t<o.CesiumMath.SIXTY_FOUR_KILOBYTES?i[t]=new Uint16Array((e-1)*(t-1)*6):i[t]=new Uint32Array((e-1)*(t-1)*6),0),n};var M=[];N.getRegularGridIndicesAndEdgeIndices=function(e,t){var i=M[e];r.defined(i)||(M[e]=i=[]);var n=i[t];if(!r.defined(n)){var o=N.getRegularGridIndices(e,t),a=b(e,t),s=a.westIndicesSouthToNorth,c=a.southIndicesEastToWest,d=a.eastIndicesNorthToSouth,h=a.northIndicesWestToEast;n=i[t]={indices:o,westIndicesSouthToNorth:s,southIndicesEastToWest:c,eastIndicesNorthToSouth:d,northIndicesWestToEast:h}}return n};var S=[];function b(e,t){var r,i=new Array(t),n=new Array(e),o=new Array(t),a=new Array(e);for(r=0;r<e;++r)a[r]=r,n[r]=e*t-1-r;for(r=0;r<t;++r)o[r]=(r+1)*e-1,i[r]=(t-r-1)*e;return{westIndicesSouthToNorth:i,southIndicesEastToWest:n,eastIndicesNorthToSouth:o,northIndicesWestToEast:a}}function x(e,t,r,i){for(var n=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=n,c=s+e,d=c+1,h=s+1;r[i++]=s,r[i++]=c,r[i++]=h,r[i++]=h,r[i++]=c,r[i++]=d,++n}++n}}function C(e,t,r,i){for(var n=e[0],o=e.length,a=1;a<o;++a){var s=e[a];r[i++]=n,r[i++]=s,r[i++]=t,r[i++]=t,r[i++]=s,r[i++]=t+1,n=s,++t}return i}N.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){var i=S[e];r.defined(i)||(S[e]=i=[]);var o=i[t];if(!r.defined(o)){var a=e*t,s=(e-1)*(t-1)*6,c=2*e+2*t,d=a+c,h=s+6*Math.max(0,c-4),u=b(e,t),I=u.westIndicesSouthToNorth,l=u.southIndicesEastToWest,g=u.eastIndicesNorthToSouth,m=u.northIndicesWestToEast,T=n.IndexDatatype.createTypedArray(d,h);x(e,t,T,0),N.addSkirtIndices(I,l,g,m,a,T,s),o=i[t]={indices:T,westIndicesSouthToNorth:I,southIndicesEastToWest:l,eastIndicesNorthToSouth:g,northIndicesWestToEast:m,indexCountWithoutSkirts:s}}return o},N.addSkirtIndices=function(e,t,r,i,n,o,a){var s=n;a=C(e,s,o,a),a=C(t,s+=e.length,o,a),a=C(r,s+=t.length,o,a),C(i,s+=r.length,o,a)},N.heightmapTerrainQuality=.25,N.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*N.heightmapTerrainQuality/(t*r)},N.prototype.requestTileGeometry=c.DeveloperError.throwInstantiationError,N.prototype.getLevelMaximumGeometricError=c.DeveloperError.throwInstantiationError,N.prototype.getTileDataAvailable=c.DeveloperError.throwInstantiationError,N.prototype.loadTileDataAvailability=c.DeveloperError.throwInstantiationError;var A=32767,W=new t.Cartesian3,P=new t.Cartesian3,D=new t.Cartesian3,k=new t.Cartographic,F=new t.Cartesian2;function G(e,r,i,n,s,c,d,h,u){var I=Number.POSITIVE_INFINITY,l=s.north,g=s.south,m=s.east,T=s.west;m<T&&(m+=o.CesiumMath.TWO_PI);for(var E=e.length,f=0;f<E;++f){var p=e[f],v=i[p],y=n[p];k.longitude=o.CesiumMath.lerp(T,m,y.x),k.latitude=o.CesiumMath.lerp(g,l,y.y),k.height=v-r;var N=c.cartographicToCartesian(k,W);a.Matrix4.multiplyByPoint(d,N,N),t.Cartesian3.minimumByComponent(N,h,h),t.Cartesian3.maximumByComponent(N,u,u),I=Math.min(I,k.height)}return I}function H(e,t,i,n,a,s,c,d,u,I,l,g,m,T){var E=r.defined(c),f=u.north,p=u.south,v=u.east,y=u.west;v<y&&(v+=o.CesiumMath.TWO_PI);for(var N=i.length,w=0;w<N;++w){var M=i[w],S=a[M],b=s[M];k.longitude=o.CesiumMath.lerp(y,v,b.x)+m,k.latitude=o.CesiumMath.lerp(p,f,b.y)+T,k.height=S-I;var x,C,A=d.cartographicToCartesian(k,W);if(E){var P=2*M;F.x=c[P],F.y=c[P+1]}n.hasWebMercatorT&&(x=(h.WebMercatorProjection.geodeticLatitudeToMercatorAngle(k.latitude)-l)*g),n.hasGeodeticSurfaceNormals&&(C=d.geodeticSurfaceNormal(A)),t=n.encode(e,t,A,b,k.height,F,x,C)}}function _(e,t){var i;return"function"==typeof e.slice&&"function"!=typeof(i=e.slice()).sort&&(i=void 0),r.defined(i)||(i=Array.prototype.slice.call(e)),i.sort(t),i}return u((function(c,u){var I,l,g=c.quantizedVertices,m=g.length/3,T=c.octEncodedNormals,E=c.westIndices.length+c.eastIndices.length+c.southIndices.length+c.northIndices.length,f=c.includeWebMercatorT,p=c.exaggeration,v=c.exaggerationRelativeHeight,y=1!==p,w=s.Rectangle.clone(c.rectangle),M=w.west,S=w.south,b=w.east,x=w.north,C=t.Ellipsoid.clone(c.ellipsoid),V=c.minimumHeight,Y=c.maximumHeight,B=c.relativeToCenter,O=d.Transforms.eastNorthUpToFixedFrame(B,C),R=a.Matrix4.inverseTransformation(O,new a.Matrix4);f&&(I=h.WebMercatorProjection.geodeticLatitudeToMercatorAngle(S),l=1/(h.WebMercatorProjection.geodeticLatitudeToMercatorAngle(x)-I));var L=g.subarray(0,m),j=g.subarray(m,2*m),U=g.subarray(2*m,3*m),z=r.defined(T),q=new Array(m),Q=new Array(m),K=new Array(m),X=f?new Array(m):[],Z=y?new Array(m):[],J=P;J.x=Number.POSITIVE_INFINITY,J.y=Number.POSITIVE_INFINITY,J.z=Number.POSITIVE_INFINITY;var $=D;$.x=Number.NEGATIVE_INFINITY,$.y=Number.NEGATIVE_INFINITY,$.z=Number.NEGATIVE_INFINITY;for(var ee=Number.POSITIVE_INFINITY,te=Number.NEGATIVE_INFINITY,re=Number.POSITIVE_INFINITY,ie=Number.NEGATIVE_INFINITY,ne=0;ne<m;++ne){var oe=L[ne],ae=j[ne],se=oe/A,ce=ae/A,de=o.CesiumMath.lerp(V,Y,U[ne]/A);k.longitude=o.CesiumMath.lerp(M,b,se),k.latitude=o.CesiumMath.lerp(S,x,ce),k.height=de,ee=Math.min(k.longitude,ee),te=Math.max(k.longitude,te),re=Math.min(k.latitude,re),ie=Math.max(k.latitude,ie);var he=C.cartographicToCartesian(k);q[ne]=new t.Cartesian2(se,ce),Q[ne]=de,K[ne]=he,f&&(X[ne]=(h.WebMercatorProjection.geodeticLatitudeToMercatorAngle(k.latitude)-I)*l),y&&(Z[ne]=C.geodeticSurfaceNormal(he)),a.Matrix4.multiplyByPoint(R,he,W),t.Cartesian3.minimumByComponent(W,J,J),t.Cartesian3.maximumByComponent(W,$,$)}var ue,Ie=_(c.westIndices,(function(e,t){return q[e].y-q[t].y})),le=_(c.eastIndices,(function(e,t){return q[t].y-q[e].y})),ge=_(c.southIndices,(function(e,t){return q[t].x-q[e].x})),me=_(c.northIndices,(function(e,t){return q[e].x-q[t].x}));V<0&&(ue=new i.EllipsoidalOccluder(C).computeHorizonCullingPointPossiblyUnderEllipsoid(B,K,V));var Te=V;Te=Math.min(Te,G(c.westIndices,c.westSkirtHeight,Q,q,w,C,R,J,$)),Te=Math.min(Te,G(c.southIndices,c.southSkirtHeight,Q,q,w,C,R,J,$)),Te=Math.min(Te,G(c.eastIndices,c.eastSkirtHeight,Q,q,w,C,R,J,$)),Te=Math.min(Te,G(c.northIndices,c.northSkirtHeight,Q,q,w,C,R,J,$));for(var Ee=new e.AxisAlignedBoundingBox(J,$,B),fe=new i.TerrainEncoding(B,Ee,Te,Y,O,z,f,y,p,v),pe=fe.stride,ve=new Float32Array(m*pe+E*pe),ye=0,Ne=0;Ne<m;++Ne){if(z){var we=2*Ne;F.x=T[we],F.y=T[we+1]}ye=fe.encode(ve,ye,K[Ne],q[Ne],Q[Ne],F,X[Ne],Z[Ne])}var Me=Math.max(0,2*(E-4)),Se=c.indices.length+3*Me,be=n.IndexDatatype.createTypedArray(m+E,Se);be.set(c.indices,0);var xe=1e-4,Ce=(te-ee)*xe,Ae=(ie-re)*xe,We=-Ce,Pe=Ce,De=Ae,ke=-Ae,Fe=m*pe;return H(ve,Fe,Ie,fe,Q,q,T,C,w,c.westSkirtHeight,I,l,We,0),H(ve,Fe+=c.westIndices.length*pe,ge,fe,Q,q,T,C,w,c.southSkirtHeight,I,l,0,ke),H(ve,Fe+=c.southIndices.length*pe,le,fe,Q,q,T,C,w,c.eastSkirtHeight,I,l,Pe,0),H(ve,Fe+=c.eastIndices.length*pe,me,fe,Q,q,T,C,w,c.northSkirtHeight,I,l,0,De),N.addSkirtIndices(Ie,ge,le,me,m,be,c.indices.length),u.push(ve.buffer,be.buffer),{vertices:ve.buffer,indices:be.buffer,westIndicesSouthToNorth:Ie,southIndicesEastToWest:ge,eastIndicesNorthToSouth:le,northIndicesWestToEast:me,vertexStride:pe,center:B,minimumHeight:V,maximumHeight:Y,occludeePointInScaledSpace:ue,encoding:fe,indexCountWithoutSkirts:c.indices.length}}))}));
