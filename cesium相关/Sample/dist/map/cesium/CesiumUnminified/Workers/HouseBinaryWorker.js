define(["./createTaskProcessorWorker","./Resource-721e53e7","./Cartesian2-cce28994","./HouseDrawer","./ParseBinaryData","./GetPrimitiveData","./when-422ea0ae","./ScanLine","./ElevationTool","./Cache","./defaultValue-81eec7ed","./Check-edea0f91","./combine-0897f2e3","./Math-29cbc3fa","./RuntimeError-94b0bf5f","./Buffer","./base64","./ieee754","./isArray","./VarintReader","./snappyJs","./CodeTool","./LayerContentModel","./GisTools","./Color-f5223c05","./Transforms-599d3866","./Matrix4-da4bb68c","./ComponentDatatype-c1201c79","./WebGLConstants-1c8239cc","./GeometryInstance-0944d7d9","./PolygonGeometry-19cf3721","./ArcType-98ec98bf","./GeometryOffsetAttribute-0a70352a","./BoundingRectangle-01a4d1a7","./GeographicProjection-54ec8d9d","./BoundingSphere-2b618cd6","./Rectangle-1bad9972","./EllipsoidGeodesic-bc3178c0","./EllipsoidTangentPlane-3ee186ca","./AxisAlignedBoundingBox-a270696e","./IntersectionTests-878c0e54","./Plane-d04f021c","./GeometryAttribute-c4e682f4","./Matrix2-c857e514","./GeometryPipeline-b8be120b","./AttributeCompression-dc008507","./EncodedCartesian3-d8b5d6fd","./IndexDatatype-2503dc5a","./PolygonGeometryLibrary-348aa659","./arrayRemoveDuplicates-9a47c9b6","./EllipsoidRhumbLine-52cdeee5","./GeometryAttributes-32b29525","./PolygonPipeline-8ba20582","./VertexFormat-aef87cc2","./PolygonOutlineGeometry-cd5f1454","./PixelFormat-eb286997","./PrimitivePipeline-86b65bb6","./WebMercatorProjection-0f98790d","./GetRidingLanternGeometry","./LinkedQueue"],(function(e,t,r,n,o,l,i,a,c,s,f,u,d,h,g,y,p,m,b,v,P,x,G,A,w,C,D,M,B,L,R,T,E,F,I,S,V,k,H,N,O,q,z,W,j,J,Q,K,U,X,Y,Z,$,_,ee,te,re,ne,oe,le){"use strict";let ie,ae,ce,se={},fe=512,ue={},de={},he={},ge=new s(1e5);function ye(e,t){if("F"!=e[0])if(Array.isArray(e[0])){let r=e.length;for(let n=0;n<r;n++){ye(e[n],t)}}else t&&function(e){let t=[e[0],e[1]];for(let r=2;r<e.length;r++){let n=t[0]+e[r],o=t[1]+e[r+1];e[r]=n,e[r+1]=o,t=[n,o],r++}}(e);else e[0]=[.05*-fe,.05*-fe,1.05*fe,.05*-fe,1.05*fe,1.05*fe,.05*-fe,1.05*fe]}function pe(e){let t=1e3,r=0;for(let n=0;n<e.length;n++){let o=e[n];for(let e=0;e<o.length-1;e++){let n=Math.round(o[e+1]);n<t&&(t=n),n>r&&(r=n),e++}}return{ymax:r,ymin:t}}function me(e,t){if(Array.isArray(t[0])){let r=t.length;for(let n=0;n<r;n++){me(e,t[n])}}else e.push(t)}function be(e,t){let n=t.rectangle;for(var o=[],l=0;l<e.length;l++){var i=ve(e[l],e[l+1],n),a=r.Cartesian3.fromDegrees(i[0],i[1]);o.push(a),l++}return o}function ve(e,t,r){var n=Pe(r.west+r.width/fe*e),o=Pe(r.north-r.height/fe*t);return[n=Number(n.toFixed(6)),o=Number(o.toFixed(6))]}function Pe(e){return 180*e/Math.PI}return e((function(e,r){if(1==e.init)return function(e){return ce=new Function("render","level",e.styleStr),fe=e.tileSize,ue=e,ie=e.indexDbNames,ae=e.indexDbName,de=e.serverInfo,he=e.layerFieldMap,c.getDBMap(ie,se)}(e);var s=e.url,f=new t.Resource({url:s});f.request.throttle=!1,f.request.throttleByServer=!0,f.request.type=1;var u=f.fetchArrayBuffer();if(!u)return!0;let d=[];d.push(u);let h=ie.slice(0,ie.length-1);d.push(c.getElevation(se,h,e.xyz));let g=i.when.defer();return i.when.all(d,(function(t){let i=t[0];if(!i)return void g.resolve({});let s=function(e,t){if(e){!function(e,t){for(let r in e){let n=e[r].features;n||(n=e[r].datas);for(let e=0;e<n.length;e++)ye(n[e][2],t)}}(e,t.needDecode);let r={},o=new n([e],t.level,r,t.controlVector,t.highLightVector,t.filterLayerId);return ce.call({},o,t.level),function(e){for(let t in e){let r=e[t];for(let e=0;e<r.length;e++){let t=r[e],n=[];me(n,t.data),delete t.data,t.geometrys=n;let o=0;if(ue.hasOwnProperty("heightProperty")){let e=ue.heightProperty;o=t.properties[e],ue.hasOwnProperty("heightScale")&&(o*=parseFloat(ue.heightScale))}t.height=o,t.totalHeight=o}}}(r),r}return{}}(o(i,he,de),e);ue.hasTerrain&&function(e,t){var r=1e3,n=0;for(let o in e){let l=e[o];for(let e=0;e<l.length;e++){let o=l[e],i=-2e4,a=ge.get(o.properties.id);if(a)i=a;else{for(let e=0;e<o.geometrys.length;e++){let l=o.geometrys[e];for(let e=0;e<l.length-1;e++){let o=Math.round(l[e]),a=Math.round(l[e+1]);if(a<r&&(r=a),a>n&&(n=a),e++,o<0||o>fe-1||a<0||a>fe-1)continue;let c=a*fe+o,s=0;for(let e in t){s+=t[e].data[c]}s>i&&(i=s)}}-2e4==i&&(i=0),ge.set(o.properties.id,i)}o.terrainHeight=i,o.totalHeight=i+o.height}}}(s,t[1]);let f=function(e,t){let r=new Int32Array(t*t);for(let n in e){let o=e[n];for(let e=0;e<o.length;e++){let n=o[e],l=pe(n.geometrys);a(r,n,t,l.ymax,l.ymin)}}return r}(s,fe);!function(e,t){for(let r in e){let n=e[r];for(let e=0;e<n.length;e++){let r=n[e];r.polygons=[];for(let e=0;e<r.geometrys.length;e++){let n=be(r.geometrys[e],t);r.polygons.push(n)}delete r.geometrys}}}(s,e);let u=l(s,e.level,ue,r);c.updateElevation(se[ae],ae,e.xyz,f).promise.then((function(e){g.resolve(u)}),(function(e){g.resolve(u)}))})),g.promise}))}));
