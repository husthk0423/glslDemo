define(["exports","./AxisAlignedBoundingBox-a270696e","./Cartesian2-cce28994","./Matrix4-da4bb68c","./Check-edea0f91","./defaultValue-81eec7ed","./IntersectionTests-878c0e54","./Plane-d04f021c","./Transforms-599d3866"],(function(e,t,n,i,r,a,o,s,l){"use strict";var d=new i.Cartesian4;function c(e,t){e=(t=a.defaultValue(t,n.Ellipsoid.WGS84)).scaleToGeodeticSurface(e);var r=l.Transforms.eastNorthUpToFixedFrame(e,t);this._ellipsoid=t,this._origin=e,this._xAxis=n.Cartesian3.fromCartesian4(i.Matrix4.getColumn(r,0,d)),this._yAxis=n.Cartesian3.fromCartesian4(i.Matrix4.getColumn(r,1,d));var o=n.Cartesian3.fromCartesian4(i.Matrix4.getColumn(r,2,d));this._plane=s.Plane.fromPointNormal(e,o)}Object.defineProperties(c.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},origin:{get:function(){return this._origin}},plane:{get:function(){return this._plane}},xAxis:{get:function(){return this._xAxis}},yAxis:{get:function(){return this._yAxis}},zAxis:{get:function(){return this._plane.normal}}});var p=new t.AxisAlignedBoundingBox;c.fromPoints=function(e,n){return new c(t.AxisAlignedBoundingBox.fromPoints(e,p).center,n)};var f=new o.Ray,u=new n.Cartesian3;c.prototype.projectPointOntoPlane=function(e,t){var i=f;i.origin=e,n.Cartesian3.normalize(e,i.direction);var r=o.IntersectionTests.rayPlane(i,this._plane,u);if(a.defined(r)||(n.Cartesian3.negate(i.direction,i.direction),r=o.IntersectionTests.rayPlane(i,this._plane,u)),a.defined(r)){var s=n.Cartesian3.subtract(r,this._origin,r),l=n.Cartesian3.dot(this._xAxis,s),d=n.Cartesian3.dot(this._yAxis,s);return a.defined(t)?(t.x=l,t.y=d,t):new n.Cartesian2(l,d)}},c.prototype.projectPointsOntoPlane=function(e,t){a.defined(t)||(t=[]);for(var n=0,i=e.length,r=0;r<i;r++){var o=this.projectPointOntoPlane(e[r],t[n]);a.defined(o)&&(t[n]=o,n++)}return t.length=n,t},c.prototype.projectPointToNearestOnPlane=function(e,t){a.defined(t)||(t=new n.Cartesian2);var i=f;i.origin=e,n.Cartesian3.clone(this._plane.normal,i.direction);var r=o.IntersectionTests.rayPlane(i,this._plane,u);a.defined(r)||(n.Cartesian3.negate(i.direction,i.direction),r=o.IntersectionTests.rayPlane(i,this._plane,u));var s=n.Cartesian3.subtract(r,this._origin,r),l=n.Cartesian3.dot(this._xAxis,s),d=n.Cartesian3.dot(this._yAxis,s);return t.x=l,t.y=d,t},c.prototype.projectPointsToNearestOnPlane=function(e,t){a.defined(t)||(t=[]);var n=e.length;t.length=n;for(var i=0;i<n;i++)t[i]=this.projectPointToNearestOnPlane(e[i],t[i]);return t};var h=new n.Cartesian3;c.prototype.projectPointOntoEllipsoid=function(e,t){a.defined(t)||(t=new n.Cartesian3);var i=this._ellipsoid,r=this._origin,o=this._xAxis,s=this._yAxis,l=h;return n.Cartesian3.multiplyByScalar(o,e.x,l),t=n.Cartesian3.add(r,l,t),n.Cartesian3.multiplyByScalar(s,e.y,l),n.Cartesian3.add(t,l,t),i.scaleToGeocentricSurface(t,t),t},c.prototype.projectPointsOntoEllipsoid=function(e,t){var n=e.length;a.defined(t)?t.length=n:t=new Array(n);for(var i=0;i<n;++i)t[i]=this.projectPointOntoEllipsoid(e[i],t[i]);return t},e.EllipsoidTangentPlane=c}));
