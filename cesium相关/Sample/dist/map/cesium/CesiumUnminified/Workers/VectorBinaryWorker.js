define(["./createTaskProcessorWorker","./Resource-721e53e7","./VectorDrawer","./point-766425d1","./ColorUtil","./ParseBinaryData","./defaultValue-81eec7ed","./when-422ea0ae","./Check-edea0f91","./combine-0897f2e3","./Math-29cbc3fa","./RuntimeError-94b0bf5f","./Buffer","./base64","./ieee754","./isArray","./VarintReader","./snappyJs","./CodeTool","./LayerContentModel","./GisTools"],(function(e,t,r,l,i,n,o,a,f,u,s,c,y,d,h,p,g,k,b,w,F){"use strict";let C,v=512,z={},B={};function S(e,t){if(!e)return{};e=e.layer?e.layer:e;let l={},i=new r([e],t.level,l,t.controlVector,t.highLightVector,t.filterLayerId);return C.call({},i,t.level),l}function m(e,t){let r=[];for(let i=0;i<e.keyArr.length;i++){let n=e[e.keyArr[i]],o=n.style;if(A(o),n.lineFeatues.length>0){let e=new l.LineBucket({style:o,type:"line",tileSize:v});for(let t of n.lineFeatues){L(t,o);let r=V(t);e.addFeature(r)}e=e.serialize(t),r.push(e)}else if(n.fillFeatures.length>0){let e=new l.FillBucket({style:o,type:"fill",tileSize:v}),i=new l.LineBucket({style:o,type:"line",tileSize:v});for(let t of n.fillFeatures){L(t,o);let r=V(t);e.addFeature(r),o.stroke&&i.addFeature(r)}e=e.serialize(t),r.push(e),o.stroke&&(i=i.serialize(t),r.push(i))}}return r}function L(e,t,r){if(!t.sparsity)return;let i=parseFloat(t.sparsity);for(let t=0;t<e.data.length;t++){let r=e.data[t];null==i&&1==i||(e.data[t]=l.simplify(r,i/4,!0))}}function V(e){let t=256/v*32,r=[];for(let i=0;i<e.data.length;i++){r[i]=[];let n=e.data[i];for(let e=0;e<n.length;e++)if(e%2==0){let o=n[e]*t,a=n[e+1]*t;r[i].push(new l.Point(o,a))}}return r}function A(e){let t=new i;if(e.fillColor){t.fromHex(e.fillColor);let r=[t.rgb[0]/255,t.rgb[1]/255,t.rgb[2]/255,1];e.fillColor=r}if(e.strokeColor){t=new i,t.fromHex(e.strokeColor);let r=[t.rgb[0]/255,t.rgb[1]/255,t.rgb[2]/255,1];e.strokeColor=r}}return e((function(e,r){if(1==e.init)return C=new Function("render","level",e.styleStr),v=e.tileSize,z=e.serverInfo,B=e.layerFieldMap,!0;if(1==e.changeStyle){return m(S(n(e.tileData,B,z),e),r)}var l=e.url,i=new t.Resource({url:l});i.request.throttle=!1,i.request.throttleByServer=!0,i.request.type=1;var o=i.fetchArrayBuffer();return!o||o.then((function(t){return{tileData:t,buckets:m(S(n(t,B,z),e),r)}}))}))}));
