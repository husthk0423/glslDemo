define(["./AttributeCompression-dc008507","./BoundingSphere-2b618cd6","./Cartesian2-cce28994","./defaultValue-81eec7ed","./TerrainEncoding-c47aab33","./IndexDatatype-2503dc5a","./Check-edea0f91","./Math-29cbc3fa","./OrientedBoundingBox-a1d5c596","./Rectangle-1bad9972","./createTaskProcessorWorker","./ComponentDatatype-c1201c79","./WebGLConstants-1c8239cc","./Matrix4-da4bb68c","./RuntimeError-94b0bf5f","./Matrix2-c857e514","./GeographicProjection-54ec8d9d","./EllipsoidTangentPlane-3ee186ca","./AxisAlignedBoundingBox-a270696e","./IntersectionTests-878c0e54","./Plane-d04f021c","./Transforms-599d3866","./when-422ea0ae","./Resource-721e53e7","./combine-0897f2e3"],(function(e,i,t,n,s,r,h,u,o,a,d,p,l,f,c,g,m,x,v,w,C,B,y,I,A){"use strict";var b={clipTriangleAtAxisAlignedThreshold:function(e,i,t,s,r,h){var u,o,a;n.defined(h)?h.length=0:h=[],i?(u=t<e,o=s<e,a=r<e):(u=t>e,o=s>e,a=r>e);var d,p,l,f,c,g,m=u+o+a;return 1===m?u?(d=(e-t)/(s-t),p=(e-t)/(r-t),h.push(1),h.push(2),1!==p&&(h.push(-1),h.push(0),h.push(2),h.push(p)),1!==d&&(h.push(-1),h.push(0),h.push(1),h.push(d))):o?(l=(e-s)/(r-s),f=(e-s)/(t-s),h.push(2),h.push(0),1!==f&&(h.push(-1),h.push(1),h.push(0),h.push(f)),1!==l&&(h.push(-1),h.push(1),h.push(2),h.push(l))):a&&(c=(e-r)/(t-r),g=(e-r)/(s-r),h.push(0),h.push(1),1!==g&&(h.push(-1),h.push(2),h.push(1),h.push(g)),1!==c&&(h.push(-1),h.push(2),h.push(0),h.push(c))):2===m?u||t===e?o||s===e?a||r===e||(p=(e-t)/(r-t),l=(e-s)/(r-s),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(p),h.push(-1),h.push(1),h.push(2),h.push(l)):(g=(e-r)/(s-r),d=(e-t)/(s-t),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(g),h.push(-1),h.push(0),h.push(1),h.push(d)):(f=(e-s)/(t-s),c=(e-r)/(t-r),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(f),h.push(-1),h.push(2),h.push(0),h.push(c)):3!==m&&(h.push(0),h.push(1),h.push(2)),h},computeBarycentricCoordinates:function(e,i,s,r,h,u,o,a,d){var p=s-o,l=o-h,f=u-a,c=r-a,g=1/(f*p+l*c),m=i-a,x=e-o,v=(f*x+l*m)*g,w=(-c*x+p*m)*g,C=1-v-w;return n.defined(d)?(d.x=v,d.y=w,d.z=C,d):new t.Cartesian3(v,w,C)},computeLineSegmentLineSegmentIntersection:function(e,i,s,r,h,u,o,a,d){var p=(a-u)*(s-e)-(o-h)*(r-i);if(0!==p){var l=((o-h)*(i-u)-(a-u)*(e-h))/p,f=((s-e)*(i-u)-(r-i)*(e-h))/p;return l>=0&&l<=1&&f>=0&&f<=1?(n.defined(d)||(d=new t.Cartesian2),d.x=e+l*(s-e),d.y=i+l*(r-i),d):void 0}}},T=32767,M=16383,z=[],V=[],N=[],R=new t.Cartographic,E=new t.Cartesian3,H=[],O=[],S=[],P=[],U=[],F=new t.Cartesian3,k=new i.BoundingSphere,D=new o.OrientedBoundingBox,W=new t.Cartesian2,X=new t.Cartesian3;function K(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}K.prototype.clone=function(e){return n.defined(e)||(e=new K),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},K.prototype.initializeIndexed=function(e,i,t,n,s){this.uBuffer=e,this.vBuffer=i,this.heightBuffer=t,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},K.prototype.initializeFromClipResult=function(e,i,t){var n=i+1;return-1!==e[i]?t[e[i]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=t[e[n]],++n,this.second=t[e[n]],++n,this.ratio=e[n],++n),n},K.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},K.prototype.isIndexed=function(){return n.defined(this.index)},K.prototype.getH=function(){return n.defined(this.index)?this.heightBuffer[this.index]:u.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},K.prototype.getU=function(){return n.defined(this.index)?this.uBuffer[this.index]:u.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},K.prototype.getV=function(){return n.defined(this.index)?this.vBuffer[this.index]:u.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var L=new t.Cartesian2,Y=-1,G=[new t.Cartesian3,new t.Cartesian3],_=[new t.Cartesian3,new t.Cartesian3];function j(i,n){++Y;var s=G[Y],r=_[Y];return s=e.AttributeCompression.octDecode(i.first.getNormalX(),i.first.getNormalY(),s),r=e.AttributeCompression.octDecode(i.second.getNormalX(),i.second.getNormalY(),r),E=t.Cartesian3.lerp(s,r,i.ratio,E),t.Cartesian3.normalize(E,E),e.AttributeCompression.octEncode(E,n),--Y,n}K.prototype.getNormalX=function(){return n.defined(this.index)?this.normalBuffer[2*this.index]:(L=j(this,L)).x},K.prototype.getNormalY=function(){return n.defined(this.index)?this.normalBuffer[2*this.index+1]:(L=j(this,L)).y};var J=[];function Z(e,i,t,s,r,h,u,o,a){if(0!==u.length){for(var d=0,p=0;p<u.length;)p=J[d++].initializeFromClipResult(u,p,o);for(var l=0;l<d;++l){var f=J[l];if(f.isIndexed())f.newIndex=h[f.index],f.uBuffer=e,f.vBuffer=i,f.heightBuffer=t,a&&(f.normalBuffer=s);else{var c=f.getKey();if(n.defined(h[c]))f.newIndex=h[c];else{var g=e.length;e.push(f.getU()),i.push(f.getV()),t.push(f.getH()),a&&(s.push(f.getNormalX()),s.push(f.getNormalY())),f.newIndex=g,h[c]=g}}}3===d?(r.push(J[0].newIndex),r.push(J[1].newIndex),r.push(J[2].newIndex)):4===d&&(r.push(J[0].newIndex),r.push(J[1].newIndex),r.push(J[2].newIndex),r.push(J[0].newIndex),r.push(J[2].newIndex),r.push(J[3].newIndex))}}return J.push(new K),J.push(new K),J.push(new K),J.push(new K),d((function(e,n){var h=e.isEastChild,d=e.isNorthChild,p=h?M:0,l=h?T:M,f=d?M:0,c=d?T:M,g=H,m=O,x=S,v=U;g.length=0,m.length=0,x.length=0,v.length=0;var w=P;w.length=0;var C={},B=e.vertices,y=e.indices;y=y.subarray(0,e.indexCountWithoutSkirts);var I,A,L,Y,G,_=s.TerrainEncoding.clone(e.encoding),j=_.hasVertexNormals,J=0,q=e.vertexCountWithoutSkirts,Q=e.minimumHeight,$=e.maximumHeight,ee=new Array(q),ie=new Array(q),te=new Array(q),ne=j?new Array(2*q):void 0;for(A=0,L=0;A<q;++A,L+=2){var se=_.decodeTextureCoordinates(B,A,W);if(I=_.decodeHeight(B,A),Y=u.CesiumMath.clamp(se.x*T|0,0,T),G=u.CesiumMath.clamp(se.y*T|0,0,T),te[A]=u.CesiumMath.clamp((I-Q)/($-Q)*T|0,0,T),Y<20&&(Y=0),G<20&&(G=0),T-Y<20&&(Y=T),T-G<20&&(G=T),ee[A]=Y,ie[A]=G,j){var re=_.getOctEncodedNormal(B,A,X);ne[L]=re.x,ne[L+1]=re.y}(h&&Y>=M||!h&&Y<=M)&&(d&&G>=M||!d&&G<=M)&&(C[A]=J,g.push(Y),m.push(G),x.push(te[A]),j&&(v.push(ne[L]),v.push(ne[L+1])),++J)}var he=[];he.push(new K),he.push(new K),he.push(new K);var ue,oe=[];for(oe.push(new K),oe.push(new K),oe.push(new K),A=0;A<y.length;A+=3){var ae=y[A],de=y[A+1],pe=y[A+2],le=ee[ae],fe=ee[de],ce=ee[pe];he[0].initializeIndexed(ee,ie,te,ne,ae),he[1].initializeIndexed(ee,ie,te,ne,de),he[2].initializeIndexed(ee,ie,te,ne,pe);var ge=b.clipTriangleAtAxisAlignedThreshold(M,h,le,fe,ce,z);(ue=0)>=ge.length||((ue=oe[0].initializeFromClipResult(ge,ue,he))>=ge.length||(ue=oe[1].initializeFromClipResult(ge,ue,he))>=ge.length||(ue=oe[2].initializeFromClipResult(ge,ue,he),Z(g,m,x,v,w,C,b.clipTriangleAtAxisAlignedThreshold(M,d,oe[0].getV(),oe[1].getV(),oe[2].getV(),V),oe,j),ue<ge.length&&(oe[2].clone(oe[1]),oe[2].initializeFromClipResult(ge,ue,he),Z(g,m,x,v,w,C,b.clipTriangleAtAxisAlignedThreshold(M,d,oe[0].getV(),oe[1].getV(),oe[2].getV(),V),oe,j))))}var me=h?-32767:0,xe=d?-32767:0,ve=[],we=[],Ce=[],Be=[],ye=Number.MAX_VALUE,Ie=-ye,Ae=N;Ae.length=0;var be=t.Ellipsoid.clone(e.ellipsoid),Te=a.Rectangle.clone(e.childRectangle),Me=Te.north,ze=Te.south,Ve=Te.east,Ne=Te.west;for(Ve<Ne&&(Ve+=u.CesiumMath.TWO_PI),A=0;A<g.length;++A)(Y=Math.round(g[A]))<=p?(ve.push(A),Y=0):Y>=l?(Ce.push(A),Y=T):Y=2*Y+me,g[A]=Y,(G=Math.round(m[A]))<=f?(we.push(A),G=0):G>=c?(Be.push(A),G=T):G=2*G+xe,m[A]=G,(I=u.CesiumMath.lerp(Q,$,x[A]/T))<ye&&(ye=I),I>Ie&&(Ie=I),x[A]=I,R.longitude=u.CesiumMath.lerp(Ne,Ve,Y/T),R.latitude=u.CesiumMath.lerp(ze,Me,G/T),R.height=I,be.cartographicToCartesian(R,E),Ae.push(E.x),Ae.push(E.y),Ae.push(E.z);var Re=i.BoundingSphere.fromVertices(Ae,t.Cartesian3.ZERO,3,k),Ee=o.OrientedBoundingBox.fromRectangle(Te,ye,Ie,be,D),He=new s.EllipsoidalOccluder(be).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(Re.center,Ae,3,Re.center,ye,F),Oe=Ie-ye,Se=new Uint16Array(g.length+m.length+x.length);for(A=0;A<g.length;++A)Se[A]=g[A];var Pe=g.length;for(A=0;A<m.length;++A)Se[Pe+A]=m[A];for(Pe+=m.length,A=0;A<x.length;++A)Se[Pe+A]=T*(x[A]-ye)/Oe;var Ue,Fe=r.IndexDatatype.createTypedArray(g.length,w);if(j){var ke=new Uint8Array(v);n.push(Se.buffer,Fe.buffer,ke.buffer),Ue=ke.buffer}else n.push(Se.buffer,Fe.buffer);return{vertices:Se.buffer,encodedNormals:Ue,indices:Fe.buffer,minimumHeight:ye,maximumHeight:Ie,westIndices:ve,southIndices:we,eastIndices:Ce,northIndices:Be,boundingSphere:Re,orientedBoundingBox:Ee,horizonOcclusionPoint:He}}))}));
