define(["exports","./GeometryOffsetAttribute-0a70352a","./BoundingSphere-2b618cd6","./Cartesian2-cce28994","./ComponentDatatype-c1201c79","./defaultValue-81eec7ed","./Check-edea0f91","./EllipseGeometryLibrary-441c5ed7","./GeometryAttribute-c4e682f4","./GeometryAttributes-32b29525","./IndexDatatype-2503dc5a","./Math-29cbc3fa"],(function(e,t,i,r,a,n,o,s,l,u,d,p){"use strict";var c=new r.Cartesian3,f=new r.Cartesian3;var m=new i.BoundingSphere,h=new i.BoundingSphere;function y(e){var t=(e=n.defaultValue(e,n.defaultValue.EMPTY_OBJECT)).center,i=n.defaultValue(e.ellipsoid,r.Ellipsoid.WGS84),a=e.semiMajorAxis,o=e.semiMinorAxis,s=n.defaultValue(e.granularity,p.CesiumMath.RADIANS_PER_DEGREE),l=n.defaultValue(e.height,0),u=n.defaultValue(e.extrudedHeight,l);this._center=r.Cartesian3.clone(t),this._semiMajorAxis=a,this._semiMinorAxis=o,this._ellipsoid=r.Ellipsoid.clone(i),this._rotation=n.defaultValue(e.rotation,0),this._height=Math.max(u,l),this._granularity=s,this._extrudedHeight=Math.min(u,l),this._numberOfVerticalLines=Math.max(n.defaultValue(e.numberOfVerticalLines,16),0),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipseOutlineGeometry"}y.packedLength=r.Cartesian3.packedLength+r.Ellipsoid.packedLength+8,y.pack=function(e,t,i){return i=n.defaultValue(i,0),r.Cartesian3.pack(e._center,t,i),i+=r.Cartesian3.packedLength,r.Ellipsoid.pack(e._ellipsoid,t,i),i+=r.Ellipsoid.packedLength,t[i++]=e._semiMajorAxis,t[i++]=e._semiMinorAxis,t[i++]=e._rotation,t[i++]=e._height,t[i++]=e._granularity,t[i++]=e._extrudedHeight,t[i++]=e._numberOfVerticalLines,t[i]=n.defaultValue(e._offsetAttribute,-1),t};var b=new r.Cartesian3,A=new r.Ellipsoid,_={center:b,ellipsoid:A,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};y.unpack=function(e,t,i){t=n.defaultValue(t,0);var a=r.Cartesian3.unpack(e,t,b);t+=r.Cartesian3.packedLength;var o=r.Ellipsoid.unpack(e,t,A);t+=r.Ellipsoid.packedLength;var s=e[t++],l=e[t++],u=e[t++],d=e[t++],p=e[t++],c=e[t++],f=e[t++],m=e[t];return n.defined(i)?(i._center=r.Cartesian3.clone(a,i._center),i._ellipsoid=r.Ellipsoid.clone(o,i._ellipsoid),i._semiMajorAxis=s,i._semiMinorAxis=l,i._rotation=u,i._height=d,i._granularity=p,i._extrudedHeight=c,i._numberOfVerticalLines=f,i._offsetAttribute=-1===m?void 0:m,i):(_.height=d,_.extrudedHeight=c,_.granularity=p,_.rotation=u,_.semiMajorAxis=s,_.semiMinorAxis=l,_.numberOfVerticalLines=f,_.offsetAttribute=-1===m?void 0:m,new y(_))},y.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var o=e._height,y=e._extrudedHeight,b=!p.CesiumMath.equalsEpsilon(o,y,0,p.CesiumMath.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var A,_={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:o,granularity:e._granularity,numberOfVerticalLines:e._numberOfVerticalLines};if(b)_.extrudedHeight=y,_.offsetAttribute=e._offsetAttribute,A=function(e){var o=e.center,f=e.ellipsoid,y=e.semiMajorAxis,b=r.Cartesian3.multiplyByScalar(f.geodeticSurfaceNormal(o,c),e.height,c);m.center=r.Cartesian3.add(o,b,m.center),m.radius=y,b=r.Cartesian3.multiplyByScalar(f.geodeticSurfaceNormal(o,b),e.extrudedHeight,b),h.center=r.Cartesian3.add(o,b,h.center),h.radius=y;var A=s.EllipseGeometryLibrary.computeEllipsePositions(e,!1,!0).outerPositions,_=new u.GeometryAttributes({position:new l.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:s.EllipseGeometryLibrary.raisePositionsToHeight(A,e,!0)})});A=_.position.values;var g=i.BoundingSphere.union(m,h),v=A.length/3;if(n.defined(e.offsetAttribute)){var x=new Uint8Array(v);if(e.offsetAttribute===t.GeometryOffsetAttribute.TOP)x=t.arrayFill(x,1,0,v/2);else{var E=e.offsetAttribute===t.GeometryOffsetAttribute.NONE?0:1;x=t.arrayFill(x,E)}_.applyOffset=new l.GeometryAttribute({componentDatatype:a.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:x})}var M=n.defaultValue(e.numberOfVerticalLines,16);M=p.CesiumMath.clamp(M,0,v/2);var C=d.IndexDatatype.createTypedArray(v,2*v+2*M);v/=2;var G,L,O=0;for(G=0;G<v;++G)C[O++]=G,C[O++]=(G+1)%v,C[O++]=G+v,C[O++]=(G+1)%v+v;if(M>0){var S=Math.min(M,v);L=Math.round(v/S);var V=Math.min(L*M,v);for(G=0;G<V;G+=L)C[O++]=G,C[O++]=G+v}return{boundingSphere:g,attributes:_,indices:C}}(_);else if(A=function(e){var t=e.center;f=r.Cartesian3.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,f),e.height,f),f=r.Cartesian3.add(t,f,f);for(var n=new i.BoundingSphere(f,e.semiMajorAxis),o=s.EllipseGeometryLibrary.computeEllipsePositions(e,!1,!0).outerPositions,p=new u.GeometryAttributes({position:new l.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:s.EllipseGeometryLibrary.raisePositionsToHeight(o,e,!1)})}),c=o.length/3,m=d.IndexDatatype.createTypedArray(c,2*c),h=0,y=0;y<c;++y)m[h++]=y,m[h++]=(y+1)%c;return{boundingSphere:n,attributes:p,indices:m}}(_),n.defined(e._offsetAttribute)){var g=A.attributes.position.values.length,v=new Uint8Array(g/3),x=e._offsetAttribute===t.GeometryOffsetAttribute.NONE?0:1;t.arrayFill(v,x),A.attributes.applyOffset=new l.GeometryAttribute({componentDatatype:a.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:v})}return new l.Geometry({attributes:A.attributes,indices:A.indices,primitiveType:l.PrimitiveType.LINES,boundingSphere:A.boundingSphere,offsetAttribute:e._offsetAttribute})}},e.EllipseOutlineGeometry=y}));
