define(["exports","./GeometryOffsetAttribute-0a70352a","./BoundingSphere-2b618cd6","./Cartesian2-cce28994","./ComponentDatatype-c1201c79","./defaultValue-81eec7ed","./Check-edea0f91","./GeometryAttribute-c4e682f4","./GeometryAttributes-32b29525","./IndexDatatype-2503dc5a","./Math-29cbc3fa","./VertexFormat-aef87cc2"],(function(t,e,a,i,r,n,o,m,s,u,l,c){"use strict";var f=new i.Cartesian3,d=new i.Cartesian3,C=new i.Cartesian3,p=new i.Cartesian3,y=new i.Cartesian3,_=new i.Cartesian3(1,1,1),v=Math.cos,h=Math.sin;function A(t){t=n.defaultValue(t,n.defaultValue.EMPTY_OBJECT);var e=n.defaultValue(t.radii,_),a=n.defaultValue(t.innerRadii,e),r=n.defaultValue(t.minimumClock,0),o=n.defaultValue(t.maximumClock,l.CesiumMath.TWO_PI),m=n.defaultValue(t.minimumCone,0),s=n.defaultValue(t.maximumCone,l.CesiumMath.PI),u=Math.round(n.defaultValue(t.stackPartitions,64)),f=Math.round(n.defaultValue(t.slicePartitions,64)),d=n.defaultValue(t.vertexFormat,c.VertexFormat.DEFAULT);this._radii=i.Cartesian3.clone(e),this._innerRadii=i.Cartesian3.clone(a),this._minimumClock=r,this._maximumClock=o,this._minimumCone=m,this._maximumCone=s,this._stackPartitions=u,this._slicePartitions=f,this._vertexFormat=c.VertexFormat.clone(d),this._offsetAttribute=t.offsetAttribute,this._workerName="createEllipsoidGeometry"}A.packedLength=2*i.Cartesian3.packedLength+c.VertexFormat.packedLength+7,A.pack=function(t,e,a){return a=n.defaultValue(a,0),i.Cartesian3.pack(t._radii,e,a),a+=i.Cartesian3.packedLength,i.Cartesian3.pack(t._innerRadii,e,a),a+=i.Cartesian3.packedLength,c.VertexFormat.pack(t._vertexFormat,e,a),a+=c.VertexFormat.packedLength,e[a++]=t._minimumClock,e[a++]=t._maximumClock,e[a++]=t._minimumCone,e[a++]=t._maximumCone,e[a++]=t._stackPartitions,e[a++]=t._slicePartitions,e[a]=n.defaultValue(t._offsetAttribute,-1),e};var x,b=new i.Cartesian3,k=new i.Cartesian3,w=new c.VertexFormat,F={radii:b,innerRadii:k,vertexFormat:w,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,offsetAttribute:void 0};A.unpack=function(t,e,a){e=n.defaultValue(e,0);var r=i.Cartesian3.unpack(t,e,b);e+=i.Cartesian3.packedLength;var o=i.Cartesian3.unpack(t,e,k);e+=i.Cartesian3.packedLength;var m=c.VertexFormat.unpack(t,e,w);e+=c.VertexFormat.packedLength;var s=t[e++],u=t[e++],l=t[e++],f=t[e++],d=t[e++],C=t[e++],p=t[e];return n.defined(a)?(a._radii=i.Cartesian3.clone(r,a._radii),a._innerRadii=i.Cartesian3.clone(o,a._innerRadii),a._vertexFormat=c.VertexFormat.clone(m,a._vertexFormat),a._minimumClock=s,a._maximumClock=u,a._minimumCone=l,a._maximumCone=f,a._stackPartitions=d,a._slicePartitions=C,a._offsetAttribute=-1===p?void 0:p,a):(F.minimumClock=s,F.maximumClock=u,F.minimumCone=l,F.maximumCone=f,F.stackPartitions=d,F.slicePartitions=C,F.offsetAttribute=-1===p?void 0:p,new A(F))},A.createGeometry=function(t){var o=t._radii;if(!(o.x<=0||o.y<=0||o.z<=0)){var c=t._innerRadii;if(!(c.x<=0||c.y<=0||c.z<=0)){var _,A,x=t._minimumClock,b=t._maximumClock,k=t._minimumCone,w=t._maximumCone,F=t._vertexFormat,g=t._slicePartitions+1,P=t._stackPartitions+1;(g=Math.round(g*Math.abs(b-x)/l.CesiumMath.TWO_PI))<2&&(g=2),(P=Math.round(P*Math.abs(w-k)/l.CesiumMath.PI))<2&&(P=2);var V=0,M=[k],T=[x];for(_=0;_<P;_++)M.push(k+_*(w-k)/(P-1));for(M.push(w),A=0;A<g;A++)T.push(x+A*(b-x)/(g-1));T.push(b);var D=M.length,G=T.length,L=0,O=1,I=c.x!==o.x||c.y!==o.y||c.z!==o.z,E=!1,z=!1,N=!1;I&&(O=2,k>0&&(E=!0,L+=g-1),w<Math.PI&&(z=!0,L+=g-1),(b-x)%l.CesiumMath.TWO_PI?(N=!0,L+=2*(P-1)+1):L+=1);var R=G*D*O,S=new Float64Array(3*R),U=e.arrayFill(new Array(R),!1),B=e.arrayFill(new Array(R),!1),W=g*P*O,Y=6*(W+L+1-(g+P)*O),J=u.IndexDatatype.createTypedArray(W,Y),X=F.normal?new Float32Array(3*R):void 0,Z=F.tangent?new Float32Array(3*R):void 0,j=F.bitangent?new Float32Array(3*R):void 0,q=F.st?new Float32Array(2*R):void 0,H=new Array(D),K=new Array(D);for(_=0;_<D;_++)H[_]=h(M[_]),K[_]=v(M[_]);var Q=new Array(G),$=new Array(G);for(A=0;A<G;A++)$[A]=v(T[A]),Q[A]=h(T[A]);for(_=0;_<D;_++)for(A=0;A<G;A++)S[V++]=o.x*H[_]*$[A],S[V++]=o.y*H[_]*Q[A],S[V++]=o.z*K[_];var tt,et,at,it,rt=R/2;if(I)for(_=0;_<D;_++)for(A=0;A<G;A++)S[V++]=c.x*H[_]*$[A],S[V++]=c.y*H[_]*Q[A],S[V++]=c.z*K[_],U[rt]=!0,_>0&&_!==D-1&&0!==A&&A!==G-1&&(B[rt]=!0),rt++;for(V=0,_=1;_<D-2;_++)for(tt=_*G,et=(_+1)*G,A=1;A<G-2;A++)J[V++]=et+A,J[V++]=et+A+1,J[V++]=tt+A+1,J[V++]=et+A,J[V++]=tt+A+1,J[V++]=tt+A;if(I){var nt=D*G;for(_=1;_<D-2;_++)for(tt=nt+_*G,et=nt+(_+1)*G,A=1;A<G-2;A++)J[V++]=et+A,J[V++]=tt+A,J[V++]=tt+A+1,J[V++]=et+A,J[V++]=tt+A+1,J[V++]=et+A+1}if(I){if(E)for(it=D*G,_=1;_<G-2;_++)J[V++]=_,J[V++]=_+1,J[V++]=it+_+1,J[V++]=_,J[V++]=it+_+1,J[V++]=it+_;if(z)for(at=D*G-G,it=D*G*O-G,_=1;_<G-2;_++)J[V++]=at+_+1,J[V++]=at+_,J[V++]=it+_,J[V++]=at+_+1,J[V++]=it+_,J[V++]=it+_+1}if(N){for(_=1;_<D-2;_++)it=G*D+G*_,at=G*_,J[V++]=it,J[V++]=at+G,J[V++]=at,J[V++]=it,J[V++]=it+G,J[V++]=at+G;for(_=1;_<D-2;_++)it=G*D+G*(_+1)-1,at=G*(_+1)-1,J[V++]=at+G,J[V++]=it,J[V++]=at,J[V++]=at+G,J[V++]=it+G,J[V++]=it}var ot=new s.GeometryAttributes;F.position&&(ot.position=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:S}));var mt,st=0,ut=0,lt=0,ct=0,ft=R/2,dt=i.Ellipsoid.fromCartesian3(o),Ct=i.Ellipsoid.fromCartesian3(c);if(F.st||F.normal||F.tangent||F.bitangent){for(_=0;_<R;_++){mt=U[_]?Ct:dt;var pt=i.Cartesian3.fromArray(S,3*_,f),yt=mt.geodeticSurfaceNormal(pt,d);if(B[_]&&i.Cartesian3.negate(yt,yt),F.st){var _t=i.Cartesian2.negate(yt,y);q[st++]=Math.atan2(_t.y,_t.x)/l.CesiumMath.TWO_PI+.5,q[st++]=Math.asin(yt.z)/Math.PI+.5}if(F.normal&&(X[ut++]=yt.x,X[ut++]=yt.y,X[ut++]=yt.z),F.tangent||F.bitangent){var vt,ht=C,At=0;if(U[_]&&(At=ft),vt=!E&&_>=At&&_<At+2*G?i.Cartesian3.UNIT_X:i.Cartesian3.UNIT_Z,i.Cartesian3.cross(vt,yt,ht),i.Cartesian3.normalize(ht,ht),F.tangent&&(Z[lt++]=ht.x,Z[lt++]=ht.y,Z[lt++]=ht.z),F.bitangent){var xt=i.Cartesian3.cross(yt,ht,p);i.Cartesian3.normalize(xt,xt),j[ct++]=xt.x,j[ct++]=xt.y,j[ct++]=xt.z}}}F.st&&(ot.st=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:q})),F.normal&&(ot.normal=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:X})),F.tangent&&(ot.tangent=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:Z})),F.bitangent&&(ot.bitangent=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:j}))}if(n.defined(t._offsetAttribute)){var bt=S.length,kt=new Uint8Array(bt/3),wt=t._offsetAttribute===e.GeometryOffsetAttribute.NONE?0:1;e.arrayFill(kt,wt),ot.applyOffset=new m.GeometryAttribute({componentDatatype:r.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:kt})}return new m.Geometry({attributes:ot,indices:J,primitiveType:m.PrimitiveType.TRIANGLES,boundingSphere:a.BoundingSphere.fromEllipsoid(dt),offsetAttribute:t._offsetAttribute})}}},A.getUnitEllipsoid=function(){return n.defined(x)||(x=A.createGeometry(new A({radii:new i.Cartesian3(1,1,1),vertexFormat:c.VertexFormat.POSITION_ONLY}))),x},t.EllipsoidGeometry=A}));
