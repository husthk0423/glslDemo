define(["exports","./ArcType-98ec98bf","./GeometryOffsetAttribute-0a70352a","./BoundingRectangle-01a4d1a7","./BoundingSphere-2b618cd6","./Cartesian2-cce28994","./Check-edea0f91","./ComponentDatatype-c1201c79","./defaultValue-81eec7ed","./EllipsoidGeodesic-bc3178c0","./EllipsoidTangentPlane-3ee186ca","./GeometryAttribute-c4e682f4","./GeometryInstance-0944d7d9","./GeometryPipeline-b8be120b","./IndexDatatype-2503dc5a","./Math-29cbc3fa","./Matrix4-da4bb68c","./PolygonGeometryLibrary-348aa659","./PolygonPipeline-8ba20582","./Transforms-599d3866","./Rectangle-1bad9972","./VertexFormat-aef87cc2"],(function(e,t,a,r,o,i,n,s,l,u,c,p,y,g,m,d,h,f,v,b,_,P){"use strict";var x=new i.Cartographic,w=new i.Cartographic;function C(e,t,a,r){var o=r.cartesianToCartographic(e,x).height,i=r.cartesianToCartographic(t,w);i.height=o,r.cartographicToCartesian(i,t);var n=r.cartesianToCartographic(a,w);n.height=o-100,r.cartographicToCartesian(n,a)}var T=new r.BoundingRectangle,I=new i.Cartesian3,A=new i.Cartesian3,E=new i.Cartesian3,G=new i.Cartesian3,O=new i.Cartesian3,V=new i.Cartesian3,F=new i.Cartesian3,N=new i.Cartesian3,D=new i.Cartesian3,H=new i.Cartesian2,L=new i.Cartesian2,R=new i.Cartesian3,M=new b.Quaternion,S=new h.Matrix3,B=new h.Matrix3;function k(e){var t=e.vertexFormat,r=e.geometry,o=e.shadowVolume,n=r.attributes.position.values,u=n.length,c=e.wall,y=e.top||c,g=e.bottom||c;if(t.st||t.normal||t.tangent||t.bitangent||o){var m=e.boundingRectangle,f=e.tangentPlane,v=e.ellipsoid,_=e.stRotation,P=e.perPositionHeight,x=H;x.x=m.x,x.y=m.y;var w,T=t.st?new Float32Array(u/3*2):void 0;t.normal&&(w=P&&y&&!c?r.attributes.normal.values:new Float32Array(u));var k=t.tangent?new Float32Array(u):void 0,z=t.bitangent?new Float32Array(u):void 0,W=o?new Float32Array(u):void 0,Y=0,U=0,j=A,Q=E,q=G,K=!0,Z=S,J=B;if(0!==_){var X=b.Quaternion.fromAxisAngle(f._plane.normal,_,M);Z=h.Matrix3.fromQuaternion(X,Z),X=b.Quaternion.fromAxisAngle(f._plane.normal,-_,M),J=h.Matrix3.fromQuaternion(X,J)}else Z=h.Matrix3.clone(h.Matrix3.IDENTITY,Z),J=h.Matrix3.clone(h.Matrix3.IDENTITY,J);var $=0,ee=0;y&&g&&($=u/2,ee=u/3,u/=2);for(var te=0;te<u;te+=3){var ae=i.Cartesian3.fromArray(n,te,R);if(t.st){var re=h.Matrix3.multiplyByVector(Z,ae,I);re=v.scaleToGeodeticSurface(re,re);var oe=f.projectPointOntoPlane(re,L);i.Cartesian2.subtract(oe,x,oe);var ie=d.CesiumMath.clamp(oe.x/m.width,0,1),ne=d.CesiumMath.clamp(oe.y/m.height,0,1);g&&(T[Y+ee]=ie,T[Y+1+ee]=ne),y&&(T[Y]=ie,T[Y+1]=ne),Y+=2}if(t.normal||t.tangent||t.bitangent||o){var se=U+1,le=U+2;if(c){if(te+3<u){var ue=i.Cartesian3.fromArray(n,te+3,O);if(K){var ce=i.Cartesian3.fromArray(n,te+u,V);P&&C(ae,ue,ce,v),i.Cartesian3.subtract(ue,ae,ue),i.Cartesian3.subtract(ce,ae,ce),j=i.Cartesian3.normalize(i.Cartesian3.cross(ce,ue,j),j),K=!1}i.Cartesian3.equalsEpsilon(ue,ae,d.CesiumMath.EPSILON10)&&(K=!0)}(t.tangent||t.bitangent)&&(q=v.geodeticSurfaceNormal(ae,q),t.tangent&&(Q=i.Cartesian3.normalize(i.Cartesian3.cross(q,j,Q),Q)))}else j=v.geodeticSurfaceNormal(ae,j),(t.tangent||t.bitangent)&&(P&&(F=i.Cartesian3.fromArray(w,U,F),N=i.Cartesian3.cross(i.Cartesian3.UNIT_Z,F,N),N=i.Cartesian3.normalize(h.Matrix3.multiplyByVector(J,N,N),N),t.bitangent&&(D=i.Cartesian3.normalize(i.Cartesian3.cross(F,N,D),D))),Q=i.Cartesian3.cross(i.Cartesian3.UNIT_Z,j,Q),Q=i.Cartesian3.normalize(h.Matrix3.multiplyByVector(J,Q,Q),Q),t.bitangent&&(q=i.Cartesian3.normalize(i.Cartesian3.cross(j,Q,q),q)));t.normal&&(e.wall?(w[U+$]=j.x,w[se+$]=j.y,w[le+$]=j.z):g&&(w[U+$]=-j.x,w[se+$]=-j.y,w[le+$]=-j.z),(y&&!P||c)&&(w[U]=j.x,w[se]=j.y,w[le]=j.z)),o&&(c&&(j=v.geodeticSurfaceNormal(ae,j)),W[U+$]=-j.x,W[se+$]=-j.y,W[le+$]=-j.z),t.tangent&&(e.wall?(k[U+$]=Q.x,k[se+$]=Q.y,k[le+$]=Q.z):g&&(k[U+$]=-Q.x,k[se+$]=-Q.y,k[le+$]=-Q.z),y&&(P?(k[U]=N.x,k[se]=N.y,k[le]=N.z):(k[U]=Q.x,k[se]=Q.y,k[le]=Q.z))),t.bitangent&&(g&&(z[U+$]=q.x,z[se+$]=q.y,z[le+$]=q.z),y&&(P?(z[U]=D.x,z[se]=D.y,z[le]=D.z):(z[U]=q.x,z[se]=q.y,z[le]=q.z))),U+=3}}t.st&&(r.attributes.st=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:T})),t.normal&&(r.attributes.normal=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:w})),t.tangent&&(r.attributes.tangent=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:k})),t.bitangent&&(r.attributes.bitangent=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z})),o&&(r.attributes.extrudeDirection=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:W}))}if(e.extrude&&l.defined(e.offsetAttribute)){var pe=n.length/3,ye=new Uint8Array(pe);if(e.offsetAttribute===a.GeometryOffsetAttribute.TOP)y&&g||c?ye=a.arrayFill(ye,1,0,pe/2):y&&(ye=a.arrayFill(ye,1));else{var ge=e.offsetAttribute===a.GeometryOffsetAttribute.NONE?0:1;ye=a.arrayFill(ye,ge)}r.attributes.applyOffset=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:ye})}return r}var z=new i.Cartographic,W=new i.Cartographic,Y={westOverIDL:0,eastOverIDL:0},U=new u.EllipsoidGeodesic;function j(e,a,r,o,i){if(i=l.defaultValue(i,new _.Rectangle),!l.defined(e)||e.length<3)return i.west=0,i.north=0,i.south=0,i.east=0,i;if(r===t.ArcType.RHUMB)return _.Rectangle.fromCartesianArray(e,a,i);U.ellipsoid.equals(a)||(U=new u.EllipsoidGeodesic(void 0,void 0,a)),i.west=Number.POSITIVE_INFINITY,i.east=Number.NEGATIVE_INFINITY,i.south=Number.POSITIVE_INFINITY,i.north=Number.NEGATIVE_INFINITY,Y.westOverIDL=Number.POSITIVE_INFINITY,Y.eastOverIDL=Number.NEGATIVE_INFINITY;for(var n,s=1/d.CesiumMath.chordLength(o,a.maximumRadius),c=e.length,p=a.cartesianToCartographic(e[0],W),y=z,g=1;g<c;g++)n=y,y=p,p=a.cartesianToCartographic(e[g],n),U.setEndPoints(y,p),q(U,s,i,Y);return n=y,y=p,p=a.cartesianToCartographic(e[0],n),U.setEndPoints(y,p),q(U,s,i,Y),i.east-i.west>Y.eastOverIDL-Y.westOverIDL&&(i.west=Y.westOverIDL,i.east=Y.eastOverIDL,i.east>d.CesiumMath.PI&&(i.east=i.east-d.CesiumMath.TWO_PI),i.west>d.CesiumMath.PI&&(i.west=i.west-d.CesiumMath.TWO_PI)),i}var Q=new i.Cartographic;function q(e,t,a,r){for(var o=e.surfaceDistance,i=Math.ceil(o*t),n=i>0?o/(i-1):Number.POSITIVE_INFINITY,s=0,l=0;l<i;l++){var u=e.interpolateUsingSurfaceDistance(s,Q);s+=n;var c=u.longitude,p=u.latitude;a.west=Math.min(a.west,c),a.east=Math.max(a.east,c),a.south=Math.min(a.south,p),a.north=Math.max(a.north,p);var y=c>=0?c:c+d.CesiumMath.TWO_PI;r.westOverIDL=Math.min(r.westOverIDL,y),r.eastOverIDL=Math.max(r.eastOverIDL,y)}}var K=[];function Z(e,t,a,r,o,i,n,s,l){var u,p={walls:[]};if(i||n){var g,d,h=f.PolygonGeometryLibrary.createGeometryFromPositions(e,t,a,o,s,l),b=h.attributes.position.values,_=h.indices;if(i&&n){var P=b.concat(b);g=P.length/3,(d=m.IndexDatatype.createTypedArray(g,2*_.length)).set(_);var x=_.length,w=g/2;for(u=0;u<x;u+=3){var C=d[u]+w,T=d[u+1]+w,I=d[u+2]+w;d[u+x]=I,d[u+1+x]=T,d[u+2+x]=C}if(h.attributes.position.values=P,o&&s.normal){var A=h.attributes.normal.values;h.attributes.normal.values=new Float32Array(P.length),h.attributes.normal.values.set(A)}h.indices=d}else if(n){for(g=b.length/3,d=m.IndexDatatype.createTypedArray(g,_.length),u=0;u<_.length;u+=3)d[u]=_[u+2],d[u+1]=_[u+1],d[u+2]=_[u];h.indices=d}p.topAndBottom=new y.GeometryInstance({geometry:h})}var E=r.outerRing,G=c.EllipsoidTangentPlane.fromPoints(E,e),O=G.projectPointsOntoPlane(E,K),V=v.PolygonPipeline.computeWindingOrder2D(O);V===v.WindingOrder.CLOCKWISE&&(E=E.slice().reverse());var F=f.PolygonGeometryLibrary.computeWallGeometry(E,e,a,o,l);p.walls.push(new y.GeometryInstance({geometry:F}));var N=r.holes;for(u=0;u<N.length;u++){var D=N[u];O=(G=c.EllipsoidTangentPlane.fromPoints(D,e)).projectPointsOntoPlane(D,K),(V=v.PolygonPipeline.computeWindingOrder2D(O))===v.WindingOrder.COUNTER_CLOCKWISE&&(D=D.slice().reverse()),F=f.PolygonGeometryLibrary.computeWallGeometry(D,e,a,o,l),p.walls.push(new y.GeometryInstance({geometry:F}))}return p}function J(e){var a=e.polygonHierarchy,r=l.defaultValue(e.vertexFormat,P.VertexFormat.DEFAULT),o=l.defaultValue(e.ellipsoid,i.Ellipsoid.WGS84),n=l.defaultValue(e.granularity,d.CesiumMath.RADIANS_PER_DEGREE),s=l.defaultValue(e.stRotation,0),u=l.defaultValue(e.perPositionHeight,!1),c=u&&l.defined(e.extrudedHeight),p=l.defaultValue(e.height,0),y=l.defaultValue(e.extrudedHeight,p);if(!c){var g=Math.max(p,y);y=Math.min(p,y),p=g}this._vertexFormat=P.VertexFormat.clone(r),this._ellipsoid=i.Ellipsoid.clone(o),this._granularity=n,this._stRotation=s,this._height=p,this._extrudedHeight=y,this._closeTop=l.defaultValue(e.closeTop,!0),this._closeBottom=l.defaultValue(e.closeBottom,!0),this._polygonHierarchy=a,this._perPositionHeight=u,this._perPositionHeightExtrude=c,this._shadowVolume=l.defaultValue(e.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=e.offsetAttribute,this._arcType=l.defaultValue(e.arcType,t.ArcType.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=f.PolygonGeometryLibrary.computeHierarchyPackedLength(a)+i.Ellipsoid.packedLength+P.VertexFormat.packedLength+12}J.fromPositions=function(e){return new J({polygonHierarchy:{positions:(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType})},J.pack=function(e,t,a){return a=l.defaultValue(a,0),a=f.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,a),i.Ellipsoid.pack(e._ellipsoid,t,a),a+=i.Ellipsoid.packedLength,P.VertexFormat.pack(e._vertexFormat,t,a),a+=P.VertexFormat.packedLength,t[a++]=e._height,t[a++]=e._extrudedHeight,t[a++]=e._granularity,t[a++]=e._stRotation,t[a++]=e._perPositionHeightExtrude?1:0,t[a++]=e._perPositionHeight?1:0,t[a++]=e._closeTop?1:0,t[a++]=e._closeBottom?1:0,t[a++]=e._shadowVolume?1:0,t[a++]=l.defaultValue(e._offsetAttribute,-1),t[a++]=e._arcType,t[a]=e.packedLength,t};var X=i.Ellipsoid.clone(i.Ellipsoid.UNIT_SPHERE),$=new P.VertexFormat,ee={polygonHierarchy:{}};J.unpack=function(e,t,a){t=l.defaultValue(t,0);var r=f.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=r.startingIndex,delete r.startingIndex;var o=i.Ellipsoid.unpack(e,t,X);t+=i.Ellipsoid.packedLength;var n=P.VertexFormat.unpack(e,t,$);t+=P.VertexFormat.packedLength;var s=e[t++],u=e[t++],c=e[t++],p=e[t++],y=1===e[t++],g=1===e[t++],m=1===e[t++],d=1===e[t++],h=1===e[t++],v=e[t++],b=e[t++],_=e[t];return l.defined(a)||(a=new J(ee)),a._polygonHierarchy=r,a._ellipsoid=i.Ellipsoid.clone(o,a._ellipsoid),a._vertexFormat=P.VertexFormat.clone(n,a._vertexFormat),a._height=s,a._extrudedHeight=u,a._granularity=c,a._stRotation=p,a._perPositionHeightExtrude=y,a._perPositionHeight=g,a._closeTop=m,a._closeBottom=d,a._shadowVolume=h,a._offsetAttribute=-1===v?void 0:v,a._arcType=b,a.packedLength=_,a},J.computeRectangle=function(e,a){var r=l.defaultValue(e.granularity,d.CesiumMath.RADIANS_PER_DEGREE),o=l.defaultValue(e.arcType,t.ArcType.GEODESIC),n=e.polygonHierarchy,s=l.defaultValue(e.ellipsoid,i.Ellipsoid.WGS84);return j(n.positions,s,o,r,a)},J.createGeometry=function(e){var t=e._vertexFormat,r=e._ellipsoid,i=e._granularity,n=e._stRotation,u=e._polygonHierarchy,h=e._perPositionHeight,b=e._closeTop,_=e._closeBottom,P=e._arcType,x=u.positions;if(!(x.length<3)){var w=c.EllipsoidTangentPlane.fromPoints(x,r),C=f.PolygonGeometryLibrary.polygonsFromHierarchy(u,w.projectPointsOntoPlane.bind(w),!h,r),I=C.hierarchy,A=C.polygons;if(0!==I.length){x=I[0].outerRing;var E,G=f.PolygonGeometryLibrary.computeBoundingRectangle(w.plane.normal,w.projectPointOntoPlane.bind(w),x,n,T),O=[],V=e._height,F=e._extrudedHeight,N={perPositionHeight:h,vertexFormat:t,geometry:void 0,tangentPlane:w,boundingRectangle:G,ellipsoid:r,stRotation:n,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:P};if(e._perPositionHeightExtrude||!d.CesiumMath.equalsEpsilon(V,F,0,d.CesiumMath.EPSILON2))for(N.extrude=!0,N.top=b,N.bottom=_,N.shadowVolume=e._shadowVolume,N.offsetAttribute=e._offsetAttribute,E=0;E<A.length;E++){var D,H=Z(r,A[E],i,I[E],h,b,_,t,P);b&&_?(D=H.topAndBottom,N.geometry=f.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(D.geometry,V,F,r,h)):b?((D=H.topAndBottom).geometry.attributes.position.values=v.PolygonPipeline.scaleToGeodeticHeight(D.geometry.attributes.position.values,V,r,!h),N.geometry=D.geometry):_&&((D=H.topAndBottom).geometry.attributes.position.values=v.PolygonPipeline.scaleToGeodeticHeight(D.geometry.attributes.position.values,F,r,!0),N.geometry=D.geometry),(b||_)&&(N.wall=!1,D.geometry=k(N),O.push(D));var L=H.walls;N.wall=!0;for(var R=0;R<L.length;R++){var M=L[R];N.geometry=f.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(M.geometry,V,F,r,h),M.geometry=k(N),O.push(M)}}else for(E=0;E<A.length;E++){var S=new y.GeometryInstance({geometry:f.PolygonGeometryLibrary.createGeometryFromPositions(r,A[E],i,h,t,P)});if(S.geometry.attributes.position.values=v.PolygonPipeline.scaleToGeodeticHeight(S.geometry.attributes.position.values,V,r,!h),N.geometry=S.geometry,S.geometry=k(N),l.defined(e._offsetAttribute)){var B=S.geometry.attributes.position.values.length,z=new Uint8Array(B/3),W=e._offsetAttribute===a.GeometryOffsetAttribute.NONE?0:1;a.arrayFill(z,W),S.geometry.attributes.applyOffset=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:z})}O.push(S)}var Y=g.GeometryPipeline.combineInstances(O)[0];Y.attributes.position.values=new Float64Array(Y.attributes.position.values),Y.indices=m.IndexDatatype.createTypedArray(Y.attributes.position.values.length/3,Y.indices);var U=Y.attributes,j=o.BoundingSphere.fromVertices(U.position.values);return t.position||delete U.position,new p.Geometry({attributes:U,indices:Y.indices,primitiveType:Y.primitiveType,boundingSphere:j,offsetAttribute:e._offsetAttribute})}}},J.createShadowVolume=function(e,t,a){var r=e._granularity,o=e._ellipsoid,i=t(r,o),n=a(r,o);return new J({polygonHierarchy:e._polygonHierarchy,ellipsoid:o,stRotation:e._stRotation,granularity:r,perPositionHeight:!1,extrudedHeight:i,height:n,vertexFormat:P.VertexFormat.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object.defineProperties(J.prototype,{rectangle:{get:function(){if(!l.defined(this._rectangle)){var e=this._polygonHierarchy.positions;this._rectangle=j(e,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return l.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];var a=e._ellipsoid,r=e._polygonHierarchy.positions,o=e.rectangle;return p.Geometry._textureCoordinateRotationPoints(r,t,a,o)}(this)),this._textureCoordinateRotationPoints}}}),e.PolygonGeometry=J}));
