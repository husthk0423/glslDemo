define(["./defaultValue-81eec7ed","./Cartesian2-cce28994","./Rectangle-1bad9972","./GeometryOffsetAttribute-0a70352a","./BoundingSphere-2b618cd6","./Check-edea0f91","./ComponentDatatype-c1201c79","./GeometryAttribute-c4e682f4","./GeometryAttributes-32b29525","./GeometryInstance-0944d7d9","./GeometryPipeline-b8be120b","./IndexDatatype-2503dc5a","./Math-29cbc3fa","./Matrix2-c857e514","./Matrix4-da4bb68c","./PolygonPipeline-8ba20582","./Transforms-599d3866","./RectangleGeometryLibrary-56fdcfae","./VertexFormat-aef87cc2","./GeographicProjection-54ec8d9d","./WebGLConstants-1c8239cc","./AttributeCompression-dc008507","./EncodedCartesian3-d8b5d6fd","./IntersectionTests-878c0e54","./Plane-d04f021c","./RuntimeError-94b0bf5f","./EllipsoidRhumbLine-52cdeee5","./when-422ea0ae","./Resource-721e53e7","./combine-0897f2e3"],(function(t,e,a,r,n,i,o,s,l,u,c,m,d,p,g,y,f,h,v,b,_,A,x,w,C,R,E,F,G,P){"use strict";var V=new e.Cartesian3,L=new e.Cartesian3,D=new e.Cartesian3,M=new e.Cartesian3,T=new a.Rectangle,O=new e.Cartesian2,N=new n.BoundingSphere,S=new n.BoundingSphere;function I(t,e){var a=new s.Geometry({attributes:new l.GeometryAttributes,primitiveType:s.PrimitiveType.TRIANGLES});return a.attributes.position=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e.positions}),t.normal&&(a.attributes.normal=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.normals})),t.tangent&&(a.attributes.tangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.tangents})),t.bitangent&&(a.attributes.bitangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.bitangents})),a}var k=new e.Cartesian3,H=new e.Cartesian3;function z(t,a){var r=t._vertexFormat,n=t._ellipsoid,i=a.height,l=a.width,u=a.northCap,c=a.southCap,d=0,p=i,y=i,f=0;u&&(d=1,y-=1,f+=1),c&&(p-=1,y-=1,f+=1),f+=l*y;for(var v=r.position?new Float64Array(3*f):void 0,b=r.st?new Float32Array(2*f):void 0,_=0,A=0,x=V,w=O,C=Number.MAX_VALUE,R=Number.MAX_VALUE,E=-Number.MAX_VALUE,F=-Number.MAX_VALUE,G=d;G<p;++G)for(var P=0;P<l;++P)h.RectangleGeometryLibrary.computePosition(a,n,r.st,G,P,x,w),v[_++]=x.x,v[_++]=x.y,v[_++]=x.z,r.st&&(b[A++]=w.x,b[A++]=w.y,C=Math.min(C,w.x),R=Math.min(R,w.y),E=Math.max(E,w.x),F=Math.max(F,w.y));if(u&&(h.RectangleGeometryLibrary.computePosition(a,n,r.st,0,0,x,w),v[_++]=x.x,v[_++]=x.y,v[_++]=x.z,r.st&&(b[A++]=w.x,b[A++]=w.y,C=w.x,R=w.y,E=w.x,F=w.y)),c&&(h.RectangleGeometryLibrary.computePosition(a,n,r.st,i-1,0,x,w),v[_++]=x.x,v[_++]=x.y,v[_]=x.z,r.st&&(b[A++]=w.x,b[A]=w.y,C=Math.min(C,w.x),R=Math.min(R,w.y),E=Math.max(E,w.x),F=Math.max(F,w.y))),r.st&&(C<0||R<0||E>1||F>1))for(var T=0;T<b.length;T+=2)b[T]=(b[T]-C)/(E-C),b[T+1]=(b[T+1]-R)/(F-R);var N=function(t,a,r,n){var i=t.length,o=a.normal?new Float32Array(i):void 0,s=a.tangent?new Float32Array(i):void 0,l=a.bitangent?new Float32Array(i):void 0,u=0,c=M,m=D,d=L;if(a.normal||a.tangent||a.bitangent)for(var p=0;p<i;p+=3){var y=e.Cartesian3.fromArray(t,p,V),f=u+1,h=u+2;d=r.geodeticSurfaceNormal(y,d),(a.tangent||a.bitangent)&&(e.Cartesian3.cross(e.Cartesian3.UNIT_Z,d,m),g.Matrix3.multiplyByVector(n,m,m),e.Cartesian3.normalize(m,m),a.bitangent&&e.Cartesian3.normalize(e.Cartesian3.cross(d,m,c),c)),a.normal&&(o[u]=d.x,o[f]=d.y,o[h]=d.z),a.tangent&&(s[u]=m.x,s[f]=m.y,s[h]=m.z),a.bitangent&&(l[u]=c.x,l[f]=c.y,l[h]=c.z),u+=3}return I(a,{positions:t,normals:o,tangents:s,bitangents:l})}(v,r,n,a.tangentRotationMatrix),S=6*(l-1)*(y-1);u&&(S+=3*(l-1)),c&&(S+=3*(l-1));var k,H=m.IndexDatatype.createTypedArray(f,S),z=0,B=0;for(k=0;k<y-1;++k){for(var U=0;U<l-1;++U){var Y=z,q=Y+l,X=q+1,Q=Y+1;H[B++]=Y,H[B++]=q,H[B++]=Q,H[B++]=Q,H[B++]=q,H[B++]=X,++z}++z}if(u||c){var W,j,J=f-1,Z=f-1;if(u&&c&&(J=f-2),z=0,u)for(k=0;k<l-1;k++)j=(W=z)+1,H[B++]=J,H[B++]=W,H[B++]=j,++z;if(c)for(z=(y-1)*l,k=0;k<l-1;k++)j=(W=z)+1,H[B++]=W,H[B++]=Z,H[B++]=j,++z}return N.indices=H,r.st&&(N.attributes.st=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:b})),N}function B(t,e,a,r,n){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a+2],t[e++]=n[a],t[e++]=n[a+1],t[e]=n[a+2],t}function U(t,e,a,r){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a],t[e]=r[a+1],t}var Y=new v.VertexFormat;function q(a,n){var i,l=a._shadowVolume,p=a._offsetAttribute,g=a._vertexFormat,f=a._extrudedHeight,h=a._surfaceHeight,b=a._ellipsoid,_=n.height,A=n.width;if(l){var x=v.VertexFormat.clone(g,Y);x.normal=!0,a._vertexFormat=x}var w=z(a,n);l&&(a._vertexFormat=g);var C=y.PolygonPipeline.scaleToGeodeticHeight(w.attributes.position.values,h,b,!1),R=(C=new Float64Array(C)).length,E=2*R,F=new Float64Array(E);F.set(C);var G=y.PolygonPipeline.scaleToGeodeticHeight(w.attributes.position.values,f,b);F.set(G,R),w.attributes.position.values=F;var P,T,O,N=g.normal?new Float32Array(E):void 0,S=g.tangent?new Float32Array(E):void 0,q=g.bitangent?new Float32Array(E):void 0,X=g.st?new Float32Array(E/3*2):void 0;if(g.normal){for(T=w.attributes.normal.values,N.set(T),i=0;i<R;i++)T[i]=-T[i];N.set(T,R),w.attributes.normal.values=N}if(l){T=w.attributes.normal.values,g.normal||(w.attributes.normal=void 0);var Q=new Float32Array(E);for(i=0;i<R;i++)T[i]=-T[i];Q.set(T,R),w.attributes.extrudeDirection=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:Q})}var W=t.defined(p);if(W){var j=R/3*2,J=new Uint8Array(j);p===r.GeometryOffsetAttribute.TOP?J=r.arrayFill(J,1,0,j/2):(O=p===r.GeometryOffsetAttribute.NONE?0:1,J=r.arrayFill(J,O)),w.attributes.applyOffset=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:J})}if(g.tangent){var Z=w.attributes.tangent.values;for(S.set(Z),i=0;i<R;i++)Z[i]=-Z[i];S.set(Z,R),w.attributes.tangent.values=S}if(g.bitangent){var K=w.attributes.bitangent.values;q.set(K),q.set(K,R),w.attributes.bitangent.values=q}g.st&&(P=w.attributes.st.values,X.set(P),X.set(P,R/3*2),w.attributes.st.values=X);var $=w.indices,tt=$.length,et=R/3,at=m.IndexDatatype.createTypedArray(E/3,2*tt);for(at.set($),i=0;i<tt;i+=3)at[i+tt]=$[i+2]+et,at[i+1+tt]=$[i+1]+et,at[i+2+tt]=$[i]+et;w.indices=at;var rt=n.northCap,nt=n.southCap,it=_,ot=2,st=0,lt=4,ut=4;rt&&(ot-=1,it-=1,st+=1,lt-=2,ut-=1),nt&&(ot-=1,it-=1,st+=1,lt-=2,ut-=1);var ct=2*((st+=ot*A+2*it-lt)+ut),mt=new Float64Array(3*ct),dt=l?new Float32Array(3*ct):void 0,pt=W?new Uint8Array(ct):void 0,gt=g.st?new Float32Array(2*ct):void 0,yt=p===r.GeometryOffsetAttribute.TOP;W&&!yt&&(O=p===r.GeometryOffsetAttribute.ALL?1:0,pt=r.arrayFill(pt,O));var ft,ht=0,vt=0,bt=0,_t=0,At=A*it;for(i=0;i<At;i+=A)mt=B(mt,ht,ft=3*i,C,G),ht+=6,g.st&&(gt=U(gt,vt,2*i,P),vt+=4),l&&(bt+=3,dt[bt++]=T[ft],dt[bt++]=T[ft+1],dt[bt++]=T[ft+2]),yt&&(pt[_t++]=1,_t+=1);if(nt){var xt=rt?At+1:At;for(ft=3*xt,i=0;i<2;i++)mt=B(mt,ht,ft,C,G),ht+=6,g.st&&(gt=U(gt,vt,2*xt,P),vt+=4),l&&(bt+=3,dt[bt++]=T[ft],dt[bt++]=T[ft+1],dt[bt++]=T[ft+2]),yt&&(pt[_t++]=1,_t+=1)}else for(i=At-A;i<At;i++)mt=B(mt,ht,ft=3*i,C,G),ht+=6,g.st&&(gt=U(gt,vt,2*i,P),vt+=4),l&&(bt+=3,dt[bt++]=T[ft],dt[bt++]=T[ft+1],dt[bt++]=T[ft+2]),yt&&(pt[_t++]=1,_t+=1);for(i=At-1;i>0;i-=A)mt=B(mt,ht,ft=3*i,C,G),ht+=6,g.st&&(gt=U(gt,vt,2*i,P),vt+=4),l&&(bt+=3,dt[bt++]=T[ft],dt[bt++]=T[ft+1],dt[bt++]=T[ft+2]),yt&&(pt[_t++]=1,_t+=1);if(rt){var wt=At;for(ft=3*wt,i=0;i<2;i++)mt=B(mt,ht,ft,C,G),ht+=6,g.st&&(gt=U(gt,vt,2*wt,P),vt+=4),l&&(bt+=3,dt[bt++]=T[ft],dt[bt++]=T[ft+1],dt[bt++]=T[ft+2]),yt&&(pt[_t++]=1,_t+=1)}else for(i=A-1;i>=0;i--)mt=B(mt,ht,ft=3*i,C,G),ht+=6,g.st&&(gt=U(gt,vt,2*i,P),vt+=4),l&&(bt+=3,dt[bt++]=T[ft],dt[bt++]=T[ft+1],dt[bt++]=T[ft+2]),yt&&(pt[_t++]=1,_t+=1);var Ct=function(t,a,r){var n=t.length,i=a.normal?new Float32Array(n):void 0,o=a.tangent?new Float32Array(n):void 0,s=a.bitangent?new Float32Array(n):void 0,l=0,u=0,c=0,m=!0,p=M,g=D,y=L;if(a.normal||a.tangent||a.bitangent)for(var f=0;f<n;f+=6){var h=e.Cartesian3.fromArray(t,f,V),v=e.Cartesian3.fromArray(t,(f+6)%n,k);if(m){var b=e.Cartesian3.fromArray(t,(f+3)%n,H);e.Cartesian3.subtract(v,h,v),e.Cartesian3.subtract(b,h,b),y=e.Cartesian3.normalize(e.Cartesian3.cross(b,v,y),y),m=!1}e.Cartesian3.equalsEpsilon(v,h,d.CesiumMath.EPSILON10)&&(m=!0),(a.tangent||a.bitangent)&&(p=r.geodeticSurfaceNormal(h,p),a.tangent&&(g=e.Cartesian3.normalize(e.Cartesian3.cross(p,y,g),g))),a.normal&&(i[l++]=y.x,i[l++]=y.y,i[l++]=y.z,i[l++]=y.x,i[l++]=y.y,i[l++]=y.z),a.tangent&&(o[u++]=g.x,o[u++]=g.y,o[u++]=g.z,o[u++]=g.x,o[u++]=g.y,o[u++]=g.z),a.bitangent&&(s[c++]=p.x,s[c++]=p.y,s[c++]=p.z,s[c++]=p.x,s[c++]=p.y,s[c++]=p.z)}return I(a,{positions:t,normals:i,tangents:o,bitangents:s})}(mt,g,b);g.st&&(Ct.attributes.st=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:gt})),l&&(Ct.attributes.extrudeDirection=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:dt})),W&&(Ct.attributes.applyOffset=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:pt}));var Rt,Et,Ft,Gt,Pt=m.IndexDatatype.createTypedArray(ct,6*st);R=mt.length/3;var Vt=0;for(i=0;i<R-1;i+=2){Gt=((Rt=i)+2)%R;var Lt=e.Cartesian3.fromArray(mt,3*Rt,k),Dt=e.Cartesian3.fromArray(mt,3*Gt,H);e.Cartesian3.equalsEpsilon(Lt,Dt,d.CesiumMath.EPSILON10)||(Ft=((Et=(Rt+1)%R)+2)%R,Pt[Vt++]=Rt,Pt[Vt++]=Et,Pt[Vt++]=Gt,Pt[Vt++]=Gt,Pt[Vt++]=Et,Pt[Vt++]=Ft)}return Ct.indices=Pt,(Ct=c.GeometryPipeline.combineInstances([new u.GeometryInstance({geometry:w}),new u.GeometryInstance({geometry:Ct})]))[0]}var X=[new e.Cartesian3,new e.Cartesian3,new e.Cartesian3,new e.Cartesian3],Q=new e.Cartographic,W=new e.Cartographic;function j(t,e,r,n,i){if(0===r)return a.Rectangle.clone(t,i);var o=h.RectangleGeometryLibrary.computeOptions(t,e,r,0,T,Q),s=o.height,l=o.width,u=X;return h.RectangleGeometryLibrary.computePosition(o,n,!1,0,0,u[0]),h.RectangleGeometryLibrary.computePosition(o,n,!1,0,l-1,u[1]),h.RectangleGeometryLibrary.computePosition(o,n,!1,s-1,0,u[2]),h.RectangleGeometryLibrary.computePosition(o,n,!1,s-1,l-1,u[3]),a.Rectangle.fromCartesianArray(u,n,i)}function J(r){var n=(r=t.defaultValue(r,t.defaultValue.EMPTY_OBJECT)).rectangle,i=t.defaultValue(r.height,0),o=t.defaultValue(r.extrudedHeight,i);this._rectangle=a.Rectangle.clone(n),this._granularity=t.defaultValue(r.granularity,d.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=e.Ellipsoid.clone(t.defaultValue(r.ellipsoid,e.Ellipsoid.WGS84)),this._surfaceHeight=Math.max(i,o),this._rotation=t.defaultValue(r.rotation,0),this._stRotation=t.defaultValue(r.stRotation,0),this._vertexFormat=v.VertexFormat.clone(t.defaultValue(r.vertexFormat,v.VertexFormat.DEFAULT)),this._extrudedHeight=Math.min(i,o),this._shadowVolume=t.defaultValue(r.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=r.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}J.packedLength=a.Rectangle.packedLength+e.Ellipsoid.packedLength+v.VertexFormat.packedLength+7,J.pack=function(r,n,i){return i=t.defaultValue(i,0),a.Rectangle.pack(r._rectangle,n,i),i+=a.Rectangle.packedLength,e.Ellipsoid.pack(r._ellipsoid,n,i),i+=e.Ellipsoid.packedLength,v.VertexFormat.pack(r._vertexFormat,n,i),i+=v.VertexFormat.packedLength,n[i++]=r._granularity,n[i++]=r._surfaceHeight,n[i++]=r._rotation,n[i++]=r._stRotation,n[i++]=r._extrudedHeight,n[i++]=r._shadowVolume?1:0,n[i]=t.defaultValue(r._offsetAttribute,-1),n};var Z=new a.Rectangle,K=e.Ellipsoid.clone(e.Ellipsoid.UNIT_SPHERE),$={rectangle:Z,ellipsoid:K,vertexFormat:Y,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};J.unpack=function(r,n,i){n=t.defaultValue(n,0);var o=a.Rectangle.unpack(r,n,Z);n+=a.Rectangle.packedLength;var s=e.Ellipsoid.unpack(r,n,K);n+=e.Ellipsoid.packedLength;var l=v.VertexFormat.unpack(r,n,Y);n+=v.VertexFormat.packedLength;var u=r[n++],c=r[n++],m=r[n++],d=r[n++],p=r[n++],g=1===r[n++],y=r[n];return t.defined(i)?(i._rectangle=a.Rectangle.clone(o,i._rectangle),i._ellipsoid=e.Ellipsoid.clone(s,i._ellipsoid),i._vertexFormat=v.VertexFormat.clone(l,i._vertexFormat),i._granularity=u,i._surfaceHeight=c,i._rotation=m,i._stRotation=d,i._extrudedHeight=p,i._shadowVolume=g,i._offsetAttribute=-1===y?void 0:y,i):($.granularity=u,$.height=c,$.rotation=m,$.stRotation=d,$.extrudedHeight=p,$.shadowVolume=g,$.offsetAttribute=-1===y?void 0:y,new J($))},J.computeRectangle=function(a,r){var n=(a=t.defaultValue(a,t.defaultValue.EMPTY_OBJECT)).rectangle,i=t.defaultValue(a.granularity,d.CesiumMath.RADIANS_PER_DEGREE),o=t.defaultValue(a.ellipsoid,e.Ellipsoid.WGS84);return j(n,i,t.defaultValue(a.rotation,0),o,r)};var tt=new g.Matrix3,et=new f.Quaternion,at=new e.Cartographic;J.createGeometry=function(e){if(!d.CesiumMath.equalsEpsilon(e._rectangle.north,e._rectangle.south,d.CesiumMath.EPSILON10)&&!d.CesiumMath.equalsEpsilon(e._rectangle.east,e._rectangle.west,d.CesiumMath.EPSILON10)){var i=e._rectangle,l=e._ellipsoid,u=e._rotation,c=e._stRotation,m=e._vertexFormat,p=h.RectangleGeometryLibrary.computeOptions(i,e._granularity,u,c,T,Q,W),v=tt;if(0!==c||0!==u){var b=a.Rectangle.center(i,at),_=l.geodeticSurfaceNormalCartographic(b,k);f.Quaternion.fromAxisAngle(_,-c,et),g.Matrix3.fromQuaternion(et,v)}else g.Matrix3.clone(g.Matrix3.IDENTITY,v);var A,x,w=e._surfaceHeight,C=e._extrudedHeight,R=!d.CesiumMath.equalsEpsilon(w,C,0,d.CesiumMath.EPSILON2);if(p.lonScalar=1/e._rectangle.width,p.latScalar=1/e._rectangle.height,p.tangentRotationMatrix=v,i=e._rectangle,R){A=q(e,p);var E=n.BoundingSphere.fromRectangle3D(i,l,w,S),F=n.BoundingSphere.fromRectangle3D(i,l,C,N);x=n.BoundingSphere.union(E,F)}else{if((A=z(e,p)).attributes.position.values=y.PolygonPipeline.scaleToGeodeticHeight(A.attributes.position.values,w,l,!1),t.defined(e._offsetAttribute)){var G=A.attributes.position.values.length,P=new Uint8Array(G/3),V=e._offsetAttribute===r.GeometryOffsetAttribute.NONE?0:1;r.arrayFill(P,V),A.attributes.applyOffset=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:P})}x=n.BoundingSphere.fromRectangle3D(i,l,w)}return m.position||delete A.attributes.position,new s.Geometry({attributes:A.attributes,indices:A.indices,primitiveType:A.primitiveType,boundingSphere:x,offsetAttribute:e._offsetAttribute})}},J.createShadowVolume=function(t,e,a){var r=t._granularity,n=t._ellipsoid,i=e(r,n),o=a(r,n);return new J({rectangle:t._rectangle,rotation:t._rotation,ellipsoid:n,stRotation:t._stRotation,granularity:r,extrudedHeight:o,height:i,vertexFormat:v.VertexFormat.POSITION_ONLY,shadowVolume:!0})};var rt=new a.Rectangle,nt=[new e.Cartesian2,new e.Cartesian2,new e.Cartesian2],it=new p.Matrix2,ot=new e.Cartographic;return Object.defineProperties(J.prototype,{rectangle:{get:function(){return t.defined(this._rotatedRectangle)||(this._rotatedRectangle=j(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return t.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){if(0===t._stRotation)return[0,0,0,1,1,0];var r=a.Rectangle.clone(t._rectangle,rt),n=t._granularity,i=t._ellipsoid,o=j(r,n,t._rotation-t._stRotation,i,rt),s=nt;s[0].x=o.west,s[0].y=o.south,s[1].x=o.west,s[1].y=o.north,s[2].x=o.east,s[2].y=o.south;for(var l=t.rectangle,u=p.Matrix2.fromRotation(t._stRotation,it),c=a.Rectangle.center(l,ot),m=0;m<3;++m){var d=s[m];d.x-=c.longitude,d.y-=c.latitude,p.Matrix2.multiplyByVector(u,d,d),d.x+=c.longitude,d.y+=c.latitude,d.x=(d.x-l.west)/l.width,d.y=(d.y-l.south)/l.height}var g=s[0],y=s[1],f=s[2],h=new Array(6);return e.Cartesian2.pack(g,h),e.Cartesian2.pack(y,h,2),e.Cartesian2.pack(f,h,4),h}(this)),this._textureCoordinateRotationPoints}}}),function(r,n){return t.defined(n)&&(r=J.unpack(r,n)),r._ellipsoid=e.Ellipsoid.clone(r._ellipsoid),r._rectangle=a.Rectangle.clone(r._rectangle),J.createGeometry(r)}}));
