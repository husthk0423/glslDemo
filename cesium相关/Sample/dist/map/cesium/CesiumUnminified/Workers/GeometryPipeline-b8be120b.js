define(["exports","./AttributeCompression-dc008507","./Cartesian2-cce28994","./Check-edea0f91","./defaultValue-81eec7ed","./Math-29cbc3fa","./BoundingSphere-2b618cd6","./Matrix4-da4bb68c","./ComponentDatatype-c1201c79","./EncodedCartesian3-d8b5d6fd","./GeographicProjection-54ec8d9d","./GeometryAttribute-c4e682f4","./IndexDatatype-2503dc5a","./IntersectionTests-878c0e54","./Plane-d04f021c"],(function(e,t,r,a,i,n,s,o,u,p,d,l,v,y,f){"use strict";var c=new r.Cartesian3,m=new r.Cartesian3,C=new r.Cartesian3;var h={calculateACMR:function(e){var t=(e=i.defaultValue(e,i.defaultValue.EMPTY_OBJECT)).indices,r=e.maximumIndex,a=i.defaultValue(e.cacheSize,24),n=t.length;if(!i.defined(r)){r=0;for(var s=0,o=t[s];s<n;)o>r&&(r=o),o=t[++s]}for(var u=[],p=0;p<r+1;p++)u[p]=0;for(var d=a+1,l=0;l<n;++l)d-u[t[l]]>a&&(u[t[l]]=d,++d);return(d-a+1)/(n/3)}};h.tipsify=function(e){var t,r=(e=i.defaultValue(e,i.defaultValue.EMPTY_OBJECT)).indices,a=e.maximumIndex,n=i.defaultValue(e.cacheSize,24);function s(e,r,a,i,n,s,o){for(var u,p=-1,d=-1,l=0;l<a.length;){var v=a[l];i[v].numLiveTriangles&&(u=0,n-i[v].timeStamp+2*i[v].numLiveTriangles<=r&&(u=n-i[v].timeStamp),(u>d||-1===d)&&(d=u,p=v)),++l}return-1===p?function(e,r,a,i){for(;r.length>=1;){var n=r[r.length-1];if(r.splice(r.length-1,1),e[n].numLiveTriangles>0)return n}for(;t<i;){if(e[t].numLiveTriangles>0)return++t-1;++t}return-1}(i,s,0,o):p}var o=r.length,u=0,p=0,d=r[p],l=o;if(i.defined(a))u=a+1;else{for(;p<l;)d>u&&(u=d),d=r[++p];if(-1===u)return 0;++u}var v,y=[];for(v=0;v<u;v++)y[v]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};p=0;for(var f=0;p<l;)y[r[p]].vertexTriangles.push(f),++y[r[p]].numLiveTriangles,y[r[p+1]].vertexTriangles.push(f),++y[r[p+1]].numLiveTriangles,y[r[p+2]].vertexTriangles.push(f),++y[r[p+2]].numLiveTriangles,++f,p+=3;var c=0,m=n+1;t=1;var C,h,b,g,A=[],T=[],x=0,P=[],w=o/3,S=[];for(v=0;v<w;v++)S[v]=!1;for(;-1!==c;){A=[],g=(h=y[c]).vertexTriangles.length;for(var I=0;I<g;++I)if(!S[f=h.vertexTriangles[I]]){S[f]=!0,p=f+f+f;for(var O=0;O<3;++O)b=r[p],A.push(b),T.push(b),P[x]=b,++x,--(C=y[b]).numLiveTriangles,m-C.timeStamp>n&&(C.timeStamp=m,++m),++p}c=s(0,n,A,y,m,T,u)}return P};var b={};function g(e,t,r,a,i){e[t++]=r,e[t++]=a,e[t++]=a,e[t++]=i,e[t++]=i,e[t]=r}function A(e){var t={};for(var r in e)if(e.hasOwnProperty(r)&&i.defined(e[r])&&i.defined(e[r].values)){var a=e[r];t[r]=new l.GeometryAttribute({componentDatatype:a.componentDatatype,componentsPerAttribute:a.componentsPerAttribute,normalize:a.normalize,values:[]})}return t}function T(e,t,r){for(var a in t)if(t.hasOwnProperty(a)&&i.defined(t[a])&&i.defined(t[a].values))for(var n=t[a],s=0;s<n.componentsPerAttribute;++s)e[a].values.push(n.values[r*n.componentsPerAttribute+s])}b.toWireframe=function(e){var t=e.indices;if(i.defined(t)){switch(e.primitiveType){case l.PrimitiveType.TRIANGLES:e.indices=function(e){for(var t=e.length,r=t/3*6,a=v.IndexDatatype.createTypedArray(t,r),i=0,n=0;n<t;n+=3,i+=6)g(a,i,e[n],e[n+1],e[n+2]);return a}(t);break;case l.PrimitiveType.TRIANGLE_STRIP:e.indices=function(e){var t=e.length;if(t>=3){var r=6*(t-2),a=v.IndexDatatype.createTypedArray(t,r);g(a,0,e[0],e[1],e[2]);for(var i=6,n=3;n<t;++n,i+=6)g(a,i,e[n-1],e[n],e[n-2]);return a}return new Uint16Array}(t);break;case l.PrimitiveType.TRIANGLE_FAN:e.indices=function(e){if(e.length>0){for(var t=e.length-1,r=6*(t-1),a=v.IndexDatatype.createTypedArray(t,r),i=e[0],n=0,s=1;s<t;++s,n+=6)g(a,n,i,e[s],e[s+1]);return a}return new Uint16Array}(t)}e.primitiveType=l.PrimitiveType.LINES}return e},b.createLineSegmentsForVectors=function(e,t,r){t=i.defaultValue(t,"normal"),r=i.defaultValue(r,1e4);for(var a,n=e.attributes.position.values,o=e.attributes[t].values,p=n.length,d=new Float64Array(2*p),v=0,y=0;y<p;y+=3)d[v++]=n[y],d[v++]=n[y+1],d[v++]=n[y+2],d[v++]=n[y]+o[y]*r,d[v++]=n[y+1]+o[y+1]*r,d[v++]=n[y+2]+o[y+2]*r;var f=e.boundingSphere;return i.defined(f)&&(a=new s.BoundingSphere(f.center,f.radius+r)),new l.Geometry({attributes:{position:new l.GeometryAttribute({componentDatatype:u.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d})},primitiveType:l.PrimitiveType.LINES,boundingSphere:a})},b.createAttributeLocations=function(e){var t,r=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],a=e.attributes,n={},s=0,o=r.length;for(t=0;t<o;++t){var u=r[t];i.defined(a[u])&&(n[u]=s++)}for(var p in a)a.hasOwnProperty(p)&&!i.defined(n[p])&&(n[p]=s++);return n},b.reorderForPreVertexCache=function(e){var t=l.Geometry.computeNumberOfVertices(e),r=e.indices;if(i.defined(r)){for(var a=new Int32Array(t),n=0;n<t;n++)a[n]=-1;for(var s,o=r,p=o.length,d=v.IndexDatatype.createTypedArray(t,p),y=0,f=0,c=0;y<p;)-1!==(s=a[o[y]])?d[f]=s:(a[s=o[y]]=c,d[f]=c,++c),++y,++f;e.indices=d;var m=e.attributes;for(var C in m)if(m.hasOwnProperty(C)&&i.defined(m[C])&&i.defined(m[C].values)){for(var h=m[C],b=h.values,g=0,A=h.componentsPerAttribute,T=u.ComponentDatatype.createTypedArray(h.componentDatatype,c*A);g<t;){var x=a[g];if(-1!==x)for(var P=0;P<A;P++)T[A*x+P]=b[A*g+P];++g}h.values=T}}return e},b.reorderForPostVertexCache=function(e,t){var r=e.indices;if(e.primitiveType===l.PrimitiveType.TRIANGLES&&i.defined(r)){for(var a=r.length,n=0,s=0;s<a;s++)r[s]>n&&(n=r[s]);e.indices=h.tipsify({indices:r,maximumIndex:n,cacheSize:t})}return e},b.fitToUnsignedShortIndices=function(e){var t=[],r=l.Geometry.computeNumberOfVertices(e);if(i.defined(e.indices)&&r>=n.CesiumMath.SIXTY_FOUR_KILOBYTES){var a,s=[],o=[],u=0,p=A(e.attributes),d=e.indices,v=d.length;e.primitiveType===l.PrimitiveType.TRIANGLES?a=3:e.primitiveType===l.PrimitiveType.LINES?a=2:e.primitiveType===l.PrimitiveType.POINTS&&(a=1);for(var y=0;y<v;y+=a){for(var f=0;f<a;++f){var c=d[y+f],m=s[c];i.defined(m)||(m=u++,s[c]=m,T(p,e.attributes,c)),o.push(m)}u+a>=n.CesiumMath.SIXTY_FOUR_KILOBYTES&&(t.push(new l.Geometry({attributes:p,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),s=[],o=[],u=0,p=A(e.attributes))}0!==o.length&&t.push(new l.Geometry({attributes:p,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else t.push(e);return t};var x=new r.Cartesian3,P=new r.Cartographic;b.projectTo2D=function(e,t,a,n,s){for(var o=e.attributes[t],p=(s=i.defined(s)?s:new d.GeographicProjection).ellipsoid,v=o.values,y=new Float64Array(v.length),f=0,c=0;c<v.length;c+=3){var m=r.Cartesian3.fromArray(v,c,x),C=p.cartesianToCartographic(m,P),h=s.project(C,x);y[f++]=h.x,y[f++]=h.y,y[f++]=h.z}return e.attributes[a]=o,e.attributes[n]=new l.GeometryAttribute({componentDatatype:u.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:y}),delete e.attributes[t],e};var w={high:0,low:0};b.encodeAttribute=function(e,t,r,a){for(var i=e.attributes[t],n=i.values,s=n.length,o=new Float32Array(s),d=new Float32Array(s),v=0;v<s;++v)p.EncodedCartesian3.encode(n[v],w),o[v]=w.high,d[v]=w.low;var y=i.componentsPerAttribute;return e.attributes[r]=new l.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:y,values:o}),e.attributes[a]=new l.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:y,values:d}),delete e.attributes[t],e};var S=new r.Cartesian3;function I(e,t){if(i.defined(t))for(var a=t.values,n=a.length,s=0;s<n;s+=3)r.Cartesian3.unpack(a,s,S),o.Matrix4.multiplyByPoint(e,S,S),r.Cartesian3.pack(S,a,s)}function O(e,t){if(i.defined(t))for(var a=t.values,n=a.length,s=0;s<n;s+=3)r.Cartesian3.unpack(a,s,S),o.Matrix3.multiplyByVector(e,S,S),S=r.Cartesian3.normalize(S,S),r.Cartesian3.pack(S,a,s)}var E=new o.Matrix4,N=new o.Matrix3;b.transformToWorldCoordinates=function(e){var t=e.modelMatrix;if(o.Matrix4.equals(t,o.Matrix4.IDENTITY))return e;var r=e.geometry.attributes;I(t,r.position),I(t,r.prevPosition),I(t,r.nextPosition),(i.defined(r.normal)||i.defined(r.tangent)||i.defined(r.bitangent))&&(o.Matrix4.inverse(t,E),o.Matrix4.transpose(E,E),o.Matrix4.getMatrix3(E,N),O(N,r.normal),O(N,r.tangent),O(N,r.bitangent));var a=e.geometry.boundingSphere;return i.defined(a)&&(e.geometry.boundingSphere=s.BoundingSphere.transform(a,t,a)),e.modelMatrix=o.Matrix4.clone(o.Matrix4.IDENTITY),e};var L=new r.Cartesian3;function z(e,t){var a,n,o,p,d=e.length;e[0].modelMatrix;var y,f,c,m,C=i.defined(e[0][t].indices),h=e[0][t].primitiveType,b=function(e,t){var r,a=e.length,n={},s=e[0][t].attributes;for(r in s)if(s.hasOwnProperty(r)&&i.defined(s[r])&&i.defined(s[r].values)){for(var o=s[r],p=o.values.length,d=!0,v=1;v<a;++v){var y=e[v][t].attributes[r];if(!i.defined(y)||o.componentDatatype!==y.componentDatatype||o.componentsPerAttribute!==y.componentsPerAttribute||o.normalize!==y.normalize){d=!1;break}p+=y.values.length}d&&(n[r]=new l.GeometryAttribute({componentDatatype:o.componentDatatype,componentsPerAttribute:o.componentsPerAttribute,normalize:o.normalize,values:u.ComponentDatatype.createTypedArray(o.componentDatatype,p)}))}return n}(e,t);for(a in b)if(b.hasOwnProperty(a))for(y=b[a].values,p=0,n=0;n<d;++n)for(c=(f=e[n][t].attributes[a].values).length,o=0;o<c;++o)y[p++]=f[o];if(C){var g=0;for(n=0;n<d;++n)g+=e[n][t].indices.length;var A=l.Geometry.computeNumberOfVertices(new l.Geometry({attributes:b,primitiveType:l.PrimitiveType.POINTS})),T=v.IndexDatatype.createTypedArray(A,g),x=0,P=0;for(n=0;n<d;++n){var w=e[n][t].indices,S=w.length;for(p=0;p<S;++p)T[x++]=P+w[p];P+=l.Geometry.computeNumberOfVertices(e[n][t])}m=T}var I,O=new r.Cartesian3,E=0;for(n=0;n<d;++n){if(I=e[n][t].boundingSphere,!i.defined(I)){O=void 0;break}r.Cartesian3.add(I.center,O,O)}if(i.defined(O))for(r.Cartesian3.divideByScalar(O,d,O),n=0;n<d;++n){I=e[n][t].boundingSphere;var N=r.Cartesian3.magnitude(r.Cartesian3.subtract(I.center,O,L))+I.radius;N>E&&(E=N)}return new l.Geometry({attributes:b,indices:m,primitiveType:h,boundingSphere:i.defined(O)?new s.BoundingSphere(O,E):void 0})}b.combineInstances=function(e){for(var t=[],r=[],a=e.length,n=0;n<a;++n){var s=e[n];i.defined(s.geometry)?t.push(s):i.defined(s.westHemisphereGeometry)&&i.defined(s.eastHemisphereGeometry)&&r.push(s)}var o=[];return t.length>0&&o.push(z(t,"geometry")),r.length>0&&(o.push(z(r,"westHemisphereGeometry")),o.push(z(r,"eastHemisphereGeometry"))),o};var D=new r.Cartesian3,M=new r.Cartesian3,G=new r.Cartesian3,V=new r.Cartesian3;b.computeNormal=function(e){var t,a=e.indices,i=e.attributes,s=i.position.values,o=i.position.values.length/3,p=a.length,d=new Array(o),v=new Array(p/3),y=new Array(p);for(t=0;t<o;t++)d[t]={indexOffset:0,count:0,currentCount:0};var f=0;for(t=0;t<p;t+=3){var c=a[t],m=a[t+1],C=a[t+2],h=3*c,b=3*m,g=3*C;M.x=s[h],M.y=s[h+1],M.z=s[h+2],G.x=s[b],G.y=s[b+1],G.z=s[b+2],V.x=s[g],V.y=s[g+1],V.z=s[g+2],d[c].count++,d[m].count++,d[C].count++,r.Cartesian3.subtract(G,M,G),r.Cartesian3.subtract(V,M,V),v[f]=r.Cartesian3.cross(G,V,new r.Cartesian3),f++}var A,T=0;for(t=0;t<o;t++)d[t].indexOffset+=T,T+=d[t].count;for(f=0,t=0;t<p;t+=3){var x=(A=d[a[t]]).indexOffset+A.currentCount;y[x]=f,A.currentCount++,y[x=(A=d[a[t+1]]).indexOffset+A.currentCount]=f,A.currentCount++,y[x=(A=d[a[t+2]]).indexOffset+A.currentCount]=f,A.currentCount++,f++}var P=new Float32Array(3*o);for(t=0;t<o;t++){var w=3*t;if(A=d[t],r.Cartesian3.clone(r.Cartesian3.ZERO,D),A.count>0){for(f=0;f<A.count;f++)r.Cartesian3.add(D,v[y[A.indexOffset+f]],D);r.Cartesian3.equalsEpsilon(r.Cartesian3.ZERO,D,n.CesiumMath.EPSILON10)&&r.Cartesian3.clone(v[y[A.indexOffset]],D)}r.Cartesian3.equalsEpsilon(r.Cartesian3.ZERO,D,n.CesiumMath.EPSILON10)&&(D.z=1),r.Cartesian3.normalize(D,D),P[w]=D.x,P[w+1]=D.y,P[w+2]=D.z}return e.attributes.normal=new l.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P}),e};var R=new r.Cartesian3,B=new r.Cartesian3,F=new r.Cartesian3;b.computeTangentAndBitangent=function(e){e.attributes;var t,a,i,n,s=e.indices,o=e.attributes.position.values,p=e.attributes.normal.values,d=e.attributes.st.values,v=e.attributes.position.values.length/3,y=s.length,f=new Array(3*v);for(t=0;t<f.length;t++)f[t]=0;for(t=0;t<y;t+=3){var c=s[t],m=s[t+1],C=s[t+2];i=3*m,n=3*C;var h=2*c,b=2*m,g=2*C,A=o[a=3*c],T=o[a+1],x=o[a+2],P=d[h],w=d[h+1],S=d[b+1]-w,I=d[g+1]-w,O=1/((d[b]-P)*I-(d[g]-P)*S),E=(I*(o[i]-A)-S*(o[n]-A))*O,N=(I*(o[i+1]-T)-S*(o[n+1]-T))*O,L=(I*(o[i+2]-x)-S*(o[n+2]-x))*O;f[a]+=E,f[a+1]+=N,f[a+2]+=L,f[i]+=E,f[i+1]+=N,f[i+2]+=L,f[n]+=E,f[n+1]+=N,f[n+2]+=L}var z=new Float32Array(3*v),D=new Float32Array(3*v);for(t=0;t<v;t++){i=(a=3*t)+1,n=a+2;var M=r.Cartesian3.fromArray(p,a,R),G=r.Cartesian3.fromArray(f,a,F),V=r.Cartesian3.dot(M,G);r.Cartesian3.multiplyByScalar(M,V,B),r.Cartesian3.normalize(r.Cartesian3.subtract(G,B,G),G),z[a]=G.x,z[i]=G.y,z[n]=G.z,r.Cartesian3.normalize(r.Cartesian3.cross(M,G,G),G),D[a]=G.x,D[i]=G.y,D[n]=G.z}return e.attributes.tangent=new l.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z}),e.attributes.bitangent=new l.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:D}),e};var k=new r.Cartesian2,_=new r.Cartesian3,q=new r.Cartesian3,U=new r.Cartesian3,Y=new r.Cartesian2;function Z(e){switch(e.primitiveType){case l.PrimitiveType.TRIANGLE_FAN:return function(e){var t=l.Geometry.computeNumberOfVertices(e),r=v.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=1,r[1]=0,r[2]=2;for(var a=3,i=3;i<t;++i)r[a++]=i-1,r[a++]=0,r[a++]=i;return e.indices=r,e.primitiveType=l.PrimitiveType.TRIANGLES,e}(e);case l.PrimitiveType.TRIANGLE_STRIP:return function(e){var t=l.Geometry.computeNumberOfVertices(e),r=v.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=0,r[1]=1,r[2]=2,t>3&&(r[3]=0,r[4]=2,r[5]=3);for(var a=6,i=3;i<t-1;i+=2)r[a++]=i,r[a++]=i-1,r[a++]=i+1,i+2<t&&(r[a++]=i,r[a++]=i+1,r[a++]=i+2);return e.indices=r,e.primitiveType=l.PrimitiveType.TRIANGLES,e}(e);case l.PrimitiveType.TRIANGLES:return function(e){if(i.defined(e.indices))return e;for(var t=l.Geometry.computeNumberOfVertices(e),r=v.IndexDatatype.createTypedArray(t,t),a=0;a<t;++a)r[a]=a;return e.indices=r,e}(e);case l.PrimitiveType.LINE_STRIP:return function(e){var t=l.Geometry.computeNumberOfVertices(e),r=v.IndexDatatype.createTypedArray(t,2*(t-1));r[0]=0,r[1]=1;for(var a=2,i=2;i<t;++i)r[a++]=i-1,r[a++]=i;return e.indices=r,e.primitiveType=l.PrimitiveType.LINES,e}(e);case l.PrimitiveType.LINE_LOOP:return function(e){var t=l.Geometry.computeNumberOfVertices(e),r=v.IndexDatatype.createTypedArray(t,2*t);r[0]=0,r[1]=1;for(var a=2,i=2;i<t;++i)r[a++]=i-1,r[a++]=i;return r[a++]=t-1,r[a]=0,e.indices=r,e.primitiveType=l.PrimitiveType.LINES,e}(e);case l.PrimitiveType.LINES:return function(e){if(i.defined(e.indices))return e;for(var t=l.Geometry.computeNumberOfVertices(e),r=v.IndexDatatype.createTypedArray(t,t),a=0;a<t;++a)r[a]=a;return e.indices=r,e}(e)}return e}function H(e,t){Math.abs(e.y)<n.CesiumMath.EPSILON6&&(e.y=t?-n.CesiumMath.EPSILON6:n.CesiumMath.EPSILON6)}b.compressVertices=function(e){var a,n,s=e.attributes.extrudeDirection;if(i.defined(s)){var o=s.values;n=o.length/3;var p=new Float32Array(2*n),d=0;for(a=0;a<n;++a)r.Cartesian3.fromArray(o,3*a,_),r.Cartesian3.equals(_,r.Cartesian3.ZERO)?d+=2:(Y=t.AttributeCompression.octEncodeInRange(_,65535,Y),p[d++]=Y.x,p[d++]=Y.y);return e.attributes.compressedAttributes=new l.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:p}),delete e.attributes.extrudeDirection,e}var v=e.attributes.normal,y=e.attributes.st,f=i.defined(v),c=i.defined(y);if(!f&&!c)return e;var m,C,h,b,g=e.attributes.tangent,A=e.attributes.bitangent,T=i.defined(g),x=i.defined(A);f&&(m=v.values),c&&(C=y.values),T&&(h=g.values),x&&(b=A.values);var P=n=(f?m.length:C.length)/(f?3:2),w=c&&f?2:1;w+=T||x?1:0;var S=new Float32Array(P*=w),I=0;for(a=0;a<n;++a){c&&(r.Cartesian2.fromArray(C,2*a,k),S[I++]=t.AttributeCompression.compressTextureCoordinates(k));var O=3*a;f&&i.defined(h)&&i.defined(b)?(r.Cartesian3.fromArray(m,O,_),r.Cartesian3.fromArray(h,O,q),r.Cartesian3.fromArray(b,O,U),t.AttributeCompression.octPack(_,q,U,k),S[I++]=k.x,S[I++]=k.y):(f&&(r.Cartesian3.fromArray(m,O,_),S[I++]=t.AttributeCompression.octEncodeFloat(_)),T&&(r.Cartesian3.fromArray(h,O,_),S[I++]=t.AttributeCompression.octEncodeFloat(_)),x&&(r.Cartesian3.fromArray(b,O,_),S[I++]=t.AttributeCompression.octEncodeFloat(_)))}return e.attributes.compressedAttributes=new l.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:w,values:S}),f&&delete e.attributes.normal,c&&delete e.attributes.st,x&&delete e.attributes.bitangent,T&&delete e.attributes.tangent,e};var W=new r.Cartesian3;function X(e,t,a,i){r.Cartesian3.add(e,r.Cartesian3.multiplyByScalar(r.Cartesian3.subtract(t,e,W),e.y/(e.y-t.y),W),a),r.Cartesian3.clone(a,i),H(a,!0),H(i,!1)}var j=new r.Cartesian3,J=new r.Cartesian3,K=new r.Cartesian3,Q=new r.Cartesian3,$={positions:new Array(7),indices:new Array(9)};function ee(e,t,r){if(!(e.x>=0||t.x>=0||r.x>=0)){!function(e,t,r){if(0!==e.y&&0!==t.y&&0!==r.y)return H(e,e.y<0),H(t,t.y<0),void H(r,r.y<0);var a=Math.abs(e.y),i=Math.abs(t.y),s=Math.abs(r.y),o=(a>i?a>s?n.CesiumMath.sign(e.y):n.CesiumMath.sign(r.y):i>s?n.CesiumMath.sign(t.y):n.CesiumMath.sign(r.y))<0;H(e,o),H(t,o),H(r,o)}(e,t,r);var a=e.y<0,i=t.y<0,s=r.y<0,o=0;o+=a?1:0,o+=i?1:0;var u=$.indices;1===(o+=s?1:0)?(u[1]=3,u[2]=4,u[5]=6,u[7]=6,u[8]=5,a?(X(e,t,j,K),X(e,r,J,Q),u[0]=0,u[3]=1,u[4]=2,u[6]=1):i?(X(t,r,j,K),X(t,e,J,Q),u[0]=1,u[3]=2,u[4]=0,u[6]=2):s&&(X(r,e,j,K),X(r,t,J,Q),u[0]=2,u[3]=0,u[4]=1,u[6]=0)):2===o&&(u[2]=4,u[4]=4,u[5]=3,u[7]=5,u[8]=6,a?i?s||(X(r,e,j,K),X(r,t,J,Q),u[0]=0,u[1]=1,u[3]=0,u[6]=2):(X(t,r,j,K),X(t,e,J,Q),u[0]=2,u[1]=0,u[3]=2,u[6]=1):(X(e,t,j,K),X(e,r,J,Q),u[0]=1,u[1]=2,u[3]=1,u[6]=0));var p=$.positions;return p[0]=e,p[1]=t,p[2]=r,p.length=3,1!==o&&2!==o||(p[3]=j,p[4]=J,p[5]=K,p[6]=Q,p.length=7),$}}function te(e,t){var r=e.attributes;if(0!==r.position.values.length){for(var a in r)if(r.hasOwnProperty(a)&&i.defined(r[a])&&i.defined(r[a].values)){var n=r[a];n.values=u.ComponentDatatype.createTypedArray(n.componentDatatype,n.values)}var o=l.Geometry.computeNumberOfVertices(e);return e.indices=v.IndexDatatype.createTypedArray(o,e.indices),t&&(e.boundingSphere=s.BoundingSphere.fromVertices(r.position.values)),e}}function re(e){var t=e.attributes,r={};for(var a in t)if(t.hasOwnProperty(a)&&i.defined(t[a])&&i.defined(t[a].values)){var n=t[a];r[a]=new l.GeometryAttribute({componentDatatype:n.componentDatatype,componentsPerAttribute:n.componentsPerAttribute,normalize:n.normalize,values:[]})}return new l.Geometry({attributes:r,indices:[],primitiveType:e.primitiveType})}function ae(e,t,r){var a=i.defined(e.geometry.boundingSphere);t=te(t,a),r=te(r,a),i.defined(r)&&!i.defined(t)?e.geometry=r:!i.defined(r)&&i.defined(t)?e.geometry=t:(e.westHemisphereGeometry=t,e.eastHemisphereGeometry=r,e.geometry=void 0)}function ie(e,t){var r=new e,a=new e,i=new e;return function(n,s,o,u,p,d,l,v){var y=e.fromArray(p,n*t,r),f=e.fromArray(p,s*t,a),c=e.fromArray(p,o*t,i);e.multiplyByScalar(y,u.x,y),e.multiplyByScalar(f,u.y,f),e.multiplyByScalar(c,u.z,c);var m=e.add(y,f,y);e.add(m,c,m),v&&e.normalize(m,m),e.pack(m,d,l*t)}}var ne=ie(o.Cartesian4,4),se=ie(r.Cartesian3,3),oe=ie(r.Cartesian2,2),ue=new r.Cartesian3,pe=new r.Cartesian3,de=new r.Cartesian3,le=new r.Cartesian3;function ve(e,t,a,s,o,u,p,d,l,v,y,f,h,b,g,A){if(i.defined(u)||i.defined(p)||i.defined(d)||i.defined(l)||i.defined(v)||0!==b){var T=function(e,t,a,s,o){var u,p,d,l,v,y,f,h;if(i.defined(o)||(o=new r.Cartesian3),i.defined(t.z)){if(r.Cartesian3.equalsEpsilon(e,t,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_X,o);if(r.Cartesian3.equalsEpsilon(e,a,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Y,o);if(r.Cartesian3.equalsEpsilon(e,s,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Z,o);u=r.Cartesian3.subtract(a,t,c),p=r.Cartesian3.subtract(s,t,m),d=r.Cartesian3.subtract(e,t,C),l=r.Cartesian3.dot(u,u),v=r.Cartesian3.dot(u,p),y=r.Cartesian3.dot(u,d),f=r.Cartesian3.dot(p,p),h=r.Cartesian3.dot(p,d)}else{if(r.Cartesian2.equalsEpsilon(e,t,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_X,o);if(r.Cartesian2.equalsEpsilon(e,a,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Y,o);if(r.Cartesian2.equalsEpsilon(e,s,n.CesiumMath.EPSILON14))return r.Cartesian3.clone(r.Cartesian3.UNIT_Z,o);u=r.Cartesian2.subtract(a,t,c),p=r.Cartesian2.subtract(s,t,m),d=r.Cartesian2.subtract(e,t,C),l=r.Cartesian2.dot(u,u),v=r.Cartesian2.dot(u,p),y=r.Cartesian2.dot(u,d),f=r.Cartesian2.dot(p,p),h=r.Cartesian2.dot(p,d)}o.y=f*y-v*h,o.z=l*h-v*y;var b=l*f-v*v;return 0!==o.y&&(o.y/=b),0!==o.z&&(o.z/=b),o.x=1-o.y-o.z,o}(s,r.Cartesian3.fromArray(o,3*e,ue),r.Cartesian3.fromArray(o,3*t,pe),r.Cartesian3.fromArray(o,3*a,de),le);if(i.defined(u)&&se(e,t,a,T,u,f.normal.values,A,!0),i.defined(v)){var x,P=r.Cartesian3.fromArray(v,3*e,ue),w=r.Cartesian3.fromArray(v,3*t,pe),S=r.Cartesian3.fromArray(v,3*a,de);r.Cartesian3.multiplyByScalar(P,T.x,P),r.Cartesian3.multiplyByScalar(w,T.y,w),r.Cartesian3.multiplyByScalar(S,T.z,S),r.Cartesian3.equals(P,r.Cartesian3.ZERO)&&r.Cartesian3.equals(w,r.Cartesian3.ZERO)&&r.Cartesian3.equals(S,r.Cartesian3.ZERO)?((x=ue).x=0,x.y=0,x.z=0):(x=r.Cartesian3.add(P,w,P),r.Cartesian3.add(x,S,x),r.Cartesian3.normalize(x,x)),r.Cartesian3.pack(x,f.extrudeDirection.values,3*A)}if(i.defined(y)&&function(e,t,r,a,i,s,o){var u=i[e]*a.x,p=i[t]*a.y,d=i[r]*a.z;s[o]=u+p+d>n.CesiumMath.EPSILON6?1:0}(e,t,a,T,y,f.applyOffset.values,A),i.defined(p)&&se(e,t,a,T,p,f.tangent.values,A,!0),i.defined(d)&&se(e,t,a,T,d,f.bitangent.values,A,!0),i.defined(l)&&oe(e,t,a,T,l,f.st.values,A),b>0)for(var I=0;I<b;I++){var O=h[I];ye(e,t,a,T,A,g[O],f[O])}}}function ye(e,t,r,a,i,n,s){var o=n.componentsPerAttribute,u=n.values,p=s.values;switch(o){case 4:ne(e,t,r,a,u,p,i,!1);break;case 3:se(e,t,r,a,u,p,i,!1);break;case 2:oe(e,t,r,a,u,p,i,!1);break;default:p[i]=u[e]*a.x+u[t]*a.y+u[r]*a.z}}function fe(e,t,r,a,i,n){var s=e.position.values.length/3;if(-1!==i){var o=a[i],u=r[o];return-1===u?(r[o]=s,e.position.values.push(n.x,n.y,n.z),t.push(s),s):(t.push(u),u)}return e.position.values.push(n.x,n.y,n.z),t.push(s),s}var ce={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function me(e){var t=e.geometry,a=t.attributes,n=a.position.values,s=i.defined(a.normal)?a.normal.values:void 0,o=i.defined(a.bitangent)?a.bitangent.values:void 0,u=i.defined(a.tangent)?a.tangent.values:void 0,p=i.defined(a.st)?a.st.values:void 0,d=i.defined(a.extrudeDirection)?a.extrudeDirection.values:void 0,l=i.defined(a.applyOffset)?a.applyOffset.values:void 0,v=t.indices,y=[];for(var f in a)a.hasOwnProperty(f)&&!ce[f]&&i.defined(a[f])&&y.push(f);var c,m,C,h,b=y.length,g=re(t),A=re(t),T=[];T.length=n.length/3;var x=[];for(x.length=n.length/3,h=0;h<T.length;++h)T[h]=-1,x[h]=-1;var P=v.length;for(h=0;h<P;h+=3){var w=v[h],S=v[h+1],I=v[h+2],O=r.Cartesian3.fromArray(n,3*w),E=r.Cartesian3.fromArray(n,3*S),N=r.Cartesian3.fromArray(n,3*I),L=ee(O,E,N);if(i.defined(L)&&L.positions.length>3)for(var z=L.positions,D=L.indices,M=D.length,G=0;G<M;++G){var V=D[G],R=z[V];R.y<0?(c=A.attributes,m=A.indices,C=T):(c=g.attributes,m=g.indices,C=x),ve(w,S,I,R,n,s,u,o,p,d,l,c,y,b,a,fe(c,m,C,v,V<3?h+V:-1,R))}else i.defined(L)&&(O=L.positions[0],E=L.positions[1],N=L.positions[2]),O.y<0?(c=A.attributes,m=A.indices,C=T):(c=g.attributes,m=g.indices,C=x),ve(w,S,I,O,n,s,u,o,p,d,l,c,y,b,a,fe(c,m,C,v,h,O)),ve(w,S,I,E,n,s,u,o,p,d,l,c,y,b,a,fe(c,m,C,v,h+1,E)),ve(w,S,I,N,n,s,u,o,p,d,l,c,y,b,a,fe(c,m,C,v,h+2,N))}ae(e,A,g)}var Ce=f.Plane.fromPointNormal(r.Cartesian3.ZERO,r.Cartesian3.UNIT_Y),he=new r.Cartesian3,be=new r.Cartesian3;function ge(e,t,a,s,o,u,p){if(i.defined(p)){var d=r.Cartesian3.fromArray(s,3*e,ue);r.Cartesian3.equalsEpsilon(d,a,n.CesiumMath.EPSILON10)?u.applyOffset.values[o]=p[e]:u.applyOffset.values[o]=p[t]}}function Ae(e){var t,a=e.geometry,s=a.attributes,o=s.position.values,u=i.defined(s.applyOffset)?s.applyOffset.values:void 0,p=a.indices,d=re(a),l=re(a),v=p.length,f=[];f.length=o.length/3;var c=[];for(c.length=o.length/3,t=0;t<f.length;++t)f[t]=-1,c[t]=-1;for(t=0;t<v;t+=2){var m=p[t],C=p[t+1],h=r.Cartesian3.fromArray(o,3*m,ue),b=r.Cartesian3.fromArray(o,3*C,pe);Math.abs(h.y)<n.CesiumMath.EPSILON6&&(h.y<0?h.y=-n.CesiumMath.EPSILON6:h.y=n.CesiumMath.EPSILON6),Math.abs(b.y)<n.CesiumMath.EPSILON6&&(b.y<0?b.y=-n.CesiumMath.EPSILON6:b.y=n.CesiumMath.EPSILON6);var g=d.attributes,A=d.indices,T=c,x=l.attributes,P=l.indices,w=f,S=y.IntersectionTests.lineSegmentPlane(h,b,Ce,de);if(i.defined(S)){var I=r.Cartesian3.multiplyByScalar(r.Cartesian3.UNIT_Y,5*n.CesiumMath.EPSILON9,he);h.y<0&&(r.Cartesian3.negate(I,I),g=l.attributes,A=l.indices,T=f,x=d.attributes,P=d.indices,w=c);var O=r.Cartesian3.add(S,I,be);ge(m,C,h,o,fe(g,A,T,p,t,h),g,u),ge(m,C,O,o,fe(g,A,T,p,-1,O),g,u),r.Cartesian3.negate(I,I),r.Cartesian3.add(S,I,O),ge(m,C,O,o,fe(x,P,w,p,-1,O),x,u),ge(m,C,b,o,fe(x,P,w,p,t+1,b),x,u)}else{var E,N,L;h.y<0?(E=l.attributes,N=l.indices,L=f):(E=d.attributes,N=d.indices,L=c),ge(m,C,h,o,fe(E,N,L,p,t,h),E,u),ge(m,C,b,o,fe(E,N,L,p,t+1,b),E,u)}}ae(e,l,d)}var Te=new r.Cartesian2,xe=new r.Cartesian2,Pe=new r.Cartesian3,we=new r.Cartesian3,Se=new r.Cartesian3,Ie=new r.Cartesian3,Oe=new r.Cartesian3,Ee=new r.Cartesian3,Ne=new o.Cartesian4;function Le(e){for(var t=e.attributes,a=t.position.values,i=t.prevPosition.values,n=t.nextPosition.values,s=a.length,o=0;o<s;o+=3){var u=r.Cartesian3.unpack(a,o,Pe);if(!(u.x>0)){var p=r.Cartesian3.unpack(i,o,we);(u.y<0&&p.y>0||u.y>0&&p.y<0)&&(o-3>0?(i[o]=a[o-3],i[o+1]=a[o-2],i[o+2]=a[o-1]):r.Cartesian3.pack(u,i,o));var d=r.Cartesian3.unpack(n,o,Se);(u.y<0&&d.y>0||u.y>0&&d.y<0)&&(o+3<s?(n[o]=a[o+3],n[o+1]=a[o+4],n[o+2]=a[o+5]):r.Cartesian3.pack(u,n,o))}}}var ze=5*n.CesiumMath.EPSILON9,De=n.CesiumMath.EPSILON6;b.splitLongitude=function(e){var t=e.geometry,a=t.boundingSphere;if(i.defined(a)&&(a.center.x-a.radius>0||s.BoundingSphere.intersectPlane(a,f.Plane.ORIGIN_ZX_PLANE)!==s.Intersect.INTERSECTING))return e;if(t.geometryType!==l.GeometryType.NONE)switch(t.geometryType){case l.GeometryType.POLYLINES:!function(e){var t,a,s,u=e.geometry,p=u.attributes,d=p.position.values,l=p.prevPosition.values,v=p.nextPosition.values,f=p.expandAndWidth.values,c=i.defined(p.st)?p.st.values:void 0,m=i.defined(p.color)?p.color.values:void 0,C=re(u),h=re(u),b=!1,g=d.length/3;for(t=0;t<g;t+=4){var A=t,T=t+2,x=r.Cartesian3.fromArray(d,3*A,Pe),P=r.Cartesian3.fromArray(d,3*T,we);if(Math.abs(x.y)<De)for(x.y=De*(P.y<0?-1:1),d[3*t+1]=x.y,d[3*(t+1)+1]=x.y,a=3*A;a<3*A+12;a+=3)l[a]=d[3*t],l[a+1]=d[3*t+1],l[a+2]=d[3*t+2];if(Math.abs(P.y)<De)for(P.y=De*(x.y<0?-1:1),d[3*(t+2)+1]=P.y,d[3*(t+3)+1]=P.y,a=3*A;a<3*A+12;a+=3)v[a]=d[3*(t+2)],v[a+1]=d[3*(t+2)+1],v[a+2]=d[3*(t+2)+2];var w=C.attributes,S=C.indices,I=h.attributes,O=h.indices,E=y.IntersectionTests.lineSegmentPlane(x,P,Ce,Ie);if(i.defined(E)){b=!0;var N=r.Cartesian3.multiplyByScalar(r.Cartesian3.UNIT_Y,ze,Oe);x.y<0&&(r.Cartesian3.negate(N,N),w=h.attributes,S=h.indices,I=C.attributes,O=C.indices);var L=r.Cartesian3.add(E,N,Ee);w.position.values.push(x.x,x.y,x.z,x.x,x.y,x.z),w.position.values.push(L.x,L.y,L.z),w.position.values.push(L.x,L.y,L.z),w.prevPosition.values.push(l[3*A],l[3*A+1],l[3*A+2]),w.prevPosition.values.push(l[3*A+3],l[3*A+4],l[3*A+5]),w.prevPosition.values.push(x.x,x.y,x.z,x.x,x.y,x.z),w.nextPosition.values.push(L.x,L.y,L.z),w.nextPosition.values.push(L.x,L.y,L.z),w.nextPosition.values.push(L.x,L.y,L.z),w.nextPosition.values.push(L.x,L.y,L.z),r.Cartesian3.negate(N,N),r.Cartesian3.add(E,N,L),I.position.values.push(L.x,L.y,L.z),I.position.values.push(L.x,L.y,L.z),I.position.values.push(P.x,P.y,P.z,P.x,P.y,P.z),I.prevPosition.values.push(L.x,L.y,L.z),I.prevPosition.values.push(L.x,L.y,L.z),I.prevPosition.values.push(L.x,L.y,L.z),I.prevPosition.values.push(L.x,L.y,L.z),I.nextPosition.values.push(P.x,P.y,P.z,P.x,P.y,P.z),I.nextPosition.values.push(v[3*T],v[3*T+1],v[3*T+2]),I.nextPosition.values.push(v[3*T+3],v[3*T+4],v[3*T+5]);var z=r.Cartesian2.fromArray(f,2*A,Te),D=Math.abs(z.y);w.expandAndWidth.values.push(-1,D,1,D),w.expandAndWidth.values.push(-1,-D,1,-D),I.expandAndWidth.values.push(-1,D,1,D),I.expandAndWidth.values.push(-1,-D,1,-D);var M=r.Cartesian3.magnitudeSquared(r.Cartesian3.subtract(E,x,Se));if(M/=r.Cartesian3.magnitudeSquared(r.Cartesian3.subtract(P,x,Se)),i.defined(m)){var G=o.Cartesian4.fromArray(m,4*A,Ne),V=o.Cartesian4.fromArray(m,4*T,Ne),R=n.CesiumMath.lerp(G.x,V.x,M),B=n.CesiumMath.lerp(G.y,V.y,M),F=n.CesiumMath.lerp(G.z,V.z,M),k=n.CesiumMath.lerp(G.w,V.w,M);for(a=4*A;a<4*A+8;++a)w.color.values.push(m[a]);for(w.color.values.push(R,B,F,k),w.color.values.push(R,B,F,k),I.color.values.push(R,B,F,k),I.color.values.push(R,B,F,k),a=4*T;a<4*T+8;++a)I.color.values.push(m[a])}if(i.defined(c)){var _=r.Cartesian2.fromArray(c,2*A,Te),q=r.Cartesian2.fromArray(c,2*(t+3),xe),U=n.CesiumMath.lerp(_.x,q.x,M);for(a=2*A;a<2*A+4;++a)w.st.values.push(c[a]);for(w.st.values.push(U,_.y),w.st.values.push(U,q.y),I.st.values.push(U,_.y),I.st.values.push(U,q.y),a=2*T;a<2*T+4;++a)I.st.values.push(c[a])}s=w.position.values.length/3-4,S.push(s,s+2,s+1),S.push(s+1,s+2,s+3),s=I.position.values.length/3-4,O.push(s,s+2,s+1),O.push(s+1,s+2,s+3)}else{var Y,Z;for(x.y<0?(Y=h.attributes,Z=h.indices):(Y=C.attributes,Z=C.indices),Y.position.values.push(x.x,x.y,x.z),Y.position.values.push(x.x,x.y,x.z),Y.position.values.push(P.x,P.y,P.z),Y.position.values.push(P.x,P.y,P.z),a=3*t;a<3*t+12;++a)Y.prevPosition.values.push(l[a]),Y.nextPosition.values.push(v[a]);for(a=2*t;a<2*t+8;++a)Y.expandAndWidth.values.push(f[a]),i.defined(c)&&Y.st.values.push(c[a]);if(i.defined(m))for(a=4*t;a<4*t+16;++a)Y.color.values.push(m[a]);s=Y.position.values.length/3-4,Z.push(s,s+2,s+1),Z.push(s+1,s+2,s+3)}}b&&(Le(h),Le(C)),ae(e,h,C)}(e);break;case l.GeometryType.TRIANGLES:me(e);break;case l.GeometryType.LINES:Ae(e)}else Z(t),t.primitiveType===l.PrimitiveType.TRIANGLES?me(e):t.primitiveType===l.PrimitiveType.LINES&&Ae(e);return e},e.GeometryPipeline=b}));
