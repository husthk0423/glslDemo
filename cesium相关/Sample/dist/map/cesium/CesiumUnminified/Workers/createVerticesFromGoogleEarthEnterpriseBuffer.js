define(["./AxisAlignedBoundingBox-a270696e","./BoundingSphere-2b618cd6","./Cartesian2-cce28994","./defaultValue-81eec7ed","./TerrainEncoding-c47aab33","./Math-29cbc3fa","./Matrix4-da4bb68c","./OrientedBoundingBox-a1d5c596","./Rectangle-1bad9972","./RuntimeError-94b0bf5f","./Transforms-599d3866","./WebMercatorProjection-0f98790d","./createTaskProcessorWorker","./Check-edea0f91","./GeographicProjection-54ec8d9d","./AttributeCompression-dc008507","./ComponentDatatype-c1201c79","./WebGLConstants-1c8239cc","./Matrix2-c857e514","./EllipsoidTangentPlane-3ee186ca","./IntersectionTests-878c0e54","./Plane-d04f021c","./when-422ea0ae","./Resource-721e53e7","./combine-0897f2e3"],(function(e,t,i,a,n,r,o,s,u,c,h,d,g,l,m,p,v,I,f,E,T,C,M,x,N){"use strict";var b=Uint16Array.BYTES_PER_ELEMENT,S=Int32Array.BYTES_PER_ELEMENT,w=Uint32Array.BYTES_PER_ELEMENT,B=Float32Array.BYTES_PER_ELEMENT,P=Float64Array.BYTES_PER_ELEMENT;function A(e,t,i){i=a.defaultValue(i,r.CesiumMath);for(var n=e.length,o=0;o<n;++o)if(i.equalsEpsilon(e[o],t,r.CesiumMath.EPSILON12))return o;return-1}var R=new i.Cartographic,y=new i.Cartesian3,_=new i.Cartesian3,W=new i.Cartesian3,F=new o.Matrix4;function O(e,t,n,s,u,c,h,d,g,l,m){for(var p=d.length,v=0;v<p;++v){var I=d[v],f=I.cartographic,E=I.index,T=e.length,C=f.longitude,M=f.latitude;M=r.CesiumMath.clamp(M,-r.CesiumMath.PI_OVER_TWO,r.CesiumMath.PI_OVER_TWO);var x=f.height-h.skirtHeight;h.hMin=Math.min(h.hMin,x),i.Cartographic.fromRadians(C,M,x,R),l&&(R.longitude+=g),l?v===p-1?R.latitude+=m:0===v&&(R.latitude-=m):R.latitude+=g;var N=h.ellipsoid.cartographicToCartesian(R);e.push(N),t.push(x),n.push(i.Cartesian2.clone(n[E])),s.length>0&&s.push(s[E]),u.length>0&&u.push(u[E]),o.Matrix4.multiplyByPoint(h.toENU,N,y);var b=h.minimum,S=h.maximum;i.Cartesian3.minimumByComponent(y,b,b),i.Cartesian3.maximumByComponent(y,S,S);var w=h.lastBorderPoint;if(a.defined(w)){var B=w.index;c.push(B,T-1,T,T,E,B)}h.lastBorderPoint=I}}return g((function(g,l){g.ellipsoid=i.Ellipsoid.clone(g.ellipsoid),g.rectangle=u.Rectangle.clone(g.rectangle);var m=function(u,g,l,m,p,v,I,f,E,T,C){var M,x,N,V,Y,k;a.defined(m)?(M=m.west,x=m.south,N=m.east,V=m.north,Y=m.width,k=m.height):(M=r.CesiumMath.toRadians(p.west),x=r.CesiumMath.toRadians(p.south),N=r.CesiumMath.toRadians(p.east),V=r.CesiumMath.toRadians(p.north),Y=r.CesiumMath.toRadians(m.width),k=r.CesiumMath.toRadians(m.height));var U,H,L=[x,V],G=[M,N],j=h.Transforms.eastNorthUpToFixedFrame(g,l),D=o.Matrix4.inverseTransformation(j,F);E&&(U=d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(x),H=1/(d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(V)-U));var z=1!==v,q=new DataView(u),J=Number.POSITIVE_INFINITY,K=Number.NEGATIVE_INFINITY,Q=_;Q.x=Number.POSITIVE_INFINITY,Q.y=Number.POSITIVE_INFINITY,Q.z=Number.POSITIVE_INFINITY;var X=W;X.x=Number.NEGATIVE_INFINITY,X.y=Number.NEGATIVE_INFINITY,X.z=Number.NEGATIVE_INFINITY;var Z,$,ee=0,te=0,ie=0;for($=0;$<4;++$){var ae=ee;Z=q.getUint32(ae,!0),ae+=w;var ne=r.CesiumMath.toRadians(180*q.getFloat64(ae,!0));ae+=P,-1===A(G,ne)&&G.push(ne);var re=r.CesiumMath.toRadians(180*q.getFloat64(ae,!0));ae+=P,-1===A(L,re)&&L.push(re),ae+=2*P;var oe=q.getInt32(ae,!0);ae+=S,te+=oe,ie+=3*(oe=q.getInt32(ae,!0)),ee+=Z+w}var se=[],ue=[],ce=new Array(te),he=new Array(te),de=new Array(te),ge=E?new Array(te):[],le=z?new Array(te):[],me=new Array(ie),pe=[],ve=[],Ie=[],fe=[],Ee=0,Te=0;for(ee=0,$=0;$<4;++$){Z=q.getUint32(ee,!0);var Ce=ee+=w,Me=r.CesiumMath.toRadians(180*q.getFloat64(ee,!0));ee+=P;var xe=r.CesiumMath.toRadians(180*q.getFloat64(ee,!0));ee+=P;var Ne=r.CesiumMath.toRadians(180*q.getFloat64(ee,!0)),be=.5*Ne;ee+=P;var Se=r.CesiumMath.toRadians(180*q.getFloat64(ee,!0)),we=.5*Se;ee+=P;var Be=q.getInt32(ee,!0);ee+=S;var Pe=q.getInt32(ee,!0);ee+=S,ee+=S;for(var Ae=new Array(Be),Re=0;Re<Be;++Re){var ye=Me+q.getUint8(ee++)*Ne;R.longitude=ye;var _e=xe+q.getUint8(ee++)*Se;R.latitude=_e;var We=q.getFloat32(ee,!0);if(ee+=B,0!==We&&We<C&&(We*=-Math.pow(2,T)),We*=6371010,R.height=We,-1!==A(G,ye)||-1!==A(L,_e)){var Fe=A(se,R,i.Cartographic);if(-1!==Fe){Ae[Re]=ue[Fe];continue}se.push(i.Cartographic.clone(R)),ue.push(Ee)}Ae[Re]=Ee,Math.abs(ye-M)<be?pe.push({index:Ee,cartographic:i.Cartographic.clone(R)}):Math.abs(ye-N)<be?Ie.push({index:Ee,cartographic:i.Cartographic.clone(R)}):Math.abs(_e-x)<we?ve.push({index:Ee,cartographic:i.Cartographic.clone(R)}):Math.abs(_e-V)<we&&fe.push({index:Ee,cartographic:i.Cartographic.clone(R)}),J=Math.min(We,J),K=Math.max(We,K),de[Ee]=We;var Oe=l.cartographicToCartesian(R);if(ce[Ee]=Oe,E&&(ge[Ee]=(d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(_e)-U)*H),z){var Ve=l.geodeticSurfaceNormal(Oe);le[Ee]=Ve}o.Matrix4.multiplyByPoint(D,Oe,y),i.Cartesian3.minimumByComponent(y,Q,Q),i.Cartesian3.maximumByComponent(y,X,X);var Ye=(ye-M)/(N-M);Ye=r.CesiumMath.clamp(Ye,0,1);var ke=(_e-x)/(V-x);ke=r.CesiumMath.clamp(ke,0,1),he[Ee]=new i.Cartesian2(Ye,ke),++Ee}for(var Ue=3*Pe,He=0;He<Ue;++He,++Te)me[Te]=Ae[q.getUint16(ee,!0)],ee+=b;if(Z!==ee-Ce)throw new c.RuntimeError("Invalid terrain tile.")}ce.length=Ee,he.length=Ee,de.length=Ee,E&&(ge.length=Ee);z&&(le.length=Ee);var Le=Ee,Ge=Te,je={hMin:J,lastBorderPoint:void 0,skirtHeight:f,toENU:D,ellipsoid:l,minimum:Q,maximum:X};pe.sort((function(e,t){return t.cartographic.latitude-e.cartographic.latitude})),ve.sort((function(e,t){return e.cartographic.longitude-t.cartographic.longitude})),Ie.sort((function(e,t){return e.cartographic.latitude-t.cartographic.latitude})),fe.sort((function(e,t){return t.cartographic.longitude-e.cartographic.longitude}));var De=1e-5;if(O(ce,de,he,ge,le,me,je,pe,-De*Y,!0,-De*k),O(ce,de,he,ge,le,me,je,ve,-De*k,!1),O(ce,de,he,ge,le,me,je,Ie,De*Y,!0,De*k),O(ce,de,he,ge,le,me,je,fe,De*k,!1),pe.length>0&&fe.length>0){var ze=pe[0].index,qe=Le,Je=fe[fe.length-1].index,Ke=ce.length-1;me.push(Je,Ke,qe,qe,ze,Je)}te=ce.length;var Qe,Xe=t.BoundingSphere.fromPoints(ce);a.defined(m)&&(Qe=s.OrientedBoundingBox.fromRectangle(m,J,K,l));for(var Ze=new n.EllipsoidalOccluder(l).computeHorizonCullingPointPossiblyUnderEllipsoid(g,ce,J),$e=new e.AxisAlignedBoundingBox(Q,X,g),et=new n.TerrainEncoding(g,$e,je.hMin,K,j,!1,E,z,v,I),tt=new Float32Array(te*et.stride),it=0,at=0;at<te;++at)it=et.encode(tt,it,ce[at],he[at],de[at],void 0,ge[at],le[at]);var nt=pe.map((function(e){return e.index})).reverse(),rt=ve.map((function(e){return e.index})).reverse(),ot=Ie.map((function(e){return e.index})).reverse(),st=fe.map((function(e){return e.index})).reverse();return rt.unshift(ot[ot.length-1]),rt.push(nt[0]),st.unshift(nt[nt.length-1]),st.push(ot[0]),{vertices:tt,indices:new Uint16Array(me),maximumHeight:K,minimumHeight:J,encoding:et,boundingSphere3D:Xe,orientedBoundingBox:Qe,occludeePointInScaledSpace:Ze,vertexCountWithoutSkirts:Le,indexCountWithoutSkirts:Ge,westIndicesSouthToNorth:nt,southIndicesEastToWest:rt,eastIndicesNorthToSouth:ot,northIndicesWestToEast:st}}(g.buffer,g.relativeToCenter,g.ellipsoid,g.rectangle,g.nativeRectangle,g.exaggeration,g.exaggerationRelativeHeight,g.skirtHeight,g.includeWebMercatorT,g.negativeAltitudeExponentBias,g.negativeElevationThreshold),p=m.vertices;l.push(p.buffer);var v=m.indices;return l.push(v.buffer),{vertices:p.buffer,indices:v.buffer,numberOfAttributes:m.encoding.stride,minimumHeight:m.minimumHeight,maximumHeight:m.maximumHeight,boundingSphere3D:m.boundingSphere3D,orientedBoundingBox:m.orientedBoundingBox,occludeePointInScaledSpace:m.occludeePointInScaledSpace,encoding:m.encoding,vertexCountWithoutSkirts:m.vertexCountWithoutSkirts,indexCountWithoutSkirts:m.indexCountWithoutSkirts,westIndicesSouthToNorth:m.westIndicesSouthToNorth,southIndicesEastToWest:m.southIndicesEastToWest,eastIndicesNorthToSouth:m.eastIndicesNorthToSouth,northIndicesWestToEast:m.northIndicesWestToEast}}))}));
