define(["./arrayRemoveDuplicates-9a47c9b6","./BoundingRectangle-01a4d1a7","./BoundingSphere-2b618cd6","./Cartesian2-cce28994","./Check-edea0f91","./ComponentDatatype-c1201c79","./CoplanarPolygonGeometryLibrary-6412f7ee","./defaultValue-81eec7ed","./GeometryAttribute-c4e682f4","./GeometryAttributes-32b29525","./GeometryInstance-0944d7d9","./GeometryPipeline-b8be120b","./IndexDatatype-2503dc5a","./Math-29cbc3fa","./Matrix4-da4bb68c","./PolygonGeometryLibrary-348aa659","./PolygonPipeline-8ba20582","./Transforms-599d3866","./VertexFormat-aef87cc2","./GeographicProjection-54ec8d9d","./Rectangle-1bad9972","./WebGLConstants-1c8239cc","./OrientedBoundingBox-a1d5c596","./EllipsoidTangentPlane-3ee186ca","./AxisAlignedBoundingBox-a270696e","./IntersectionTests-878c0e54","./Plane-d04f021c","./Matrix2-c857e514","./AttributeCompression-dc008507","./EncodedCartesian3-d8b5d6fd","./RuntimeError-94b0bf5f","./ArcType-98ec98bf","./EllipsoidRhumbLine-52cdeee5","./when-422ea0ae","./Resource-721e53e7","./combine-0897f2e3"],(function(e,t,a,n,r,o,i,l,s,c,p,y,u,m,d,g,b,h,v,f,x,C,P,A,w,F,G,L,E,T,D,V,_,k,R,M){"use strict";var B=new n.Cartesian3,I=new t.BoundingRectangle,H=new n.Cartesian2,O=new n.Cartesian2,S=new n.Cartesian3,z=new n.Cartesian3,N=new n.Cartesian3,Q=new n.Cartesian3,j=new n.Cartesian3,U=new n.Cartesian3,Y=new h.Quaternion,q=new d.Matrix3,J=new d.Matrix3,W=new n.Cartesian3;function Z(e,t,a,r,i,l,p,y){var g=e.positions,v=b.PolygonPipeline.triangulate(e.positions2D,e.holes);v.length<3&&(v=[0,1,2]);var f=u.IndexDatatype.createTypedArray(g.length,v.length);f.set(v);var x=q;if(0!==r){var C=h.Quaternion.fromAxisAngle(l,r,Y);if(x=d.Matrix3.fromQuaternion(C,x),t.tangent||t.bitangent){C=h.Quaternion.fromAxisAngle(l,-r,Y);var P=d.Matrix3.fromQuaternion(C,J);p=n.Cartesian3.normalize(d.Matrix3.multiplyByVector(P,p,p),p),t.bitangent&&(y=n.Cartesian3.normalize(n.Cartesian3.cross(l,p,y),y))}}else x=d.Matrix3.clone(d.Matrix3.IDENTITY,x);var A=O;t.st&&(A.x=a.x,A.y=a.y);for(var w=g.length,F=3*w,G=new Float64Array(F),L=t.normal?new Float32Array(F):void 0,E=t.tangent?new Float32Array(F):void 0,T=t.bitangent?new Float32Array(F):void 0,D=t.st?new Float32Array(2*w):void 0,V=0,_=0,k=0,R=0,M=0,I=0;I<w;I++){var S=g[I];if(G[V++]=S.x,G[V++]=S.y,G[V++]=S.z,t.st){var z=i(d.Matrix3.multiplyByVector(x,S,B),H);n.Cartesian2.subtract(z,A,z);var N=m.CesiumMath.clamp(z.x/a.width,0,1),Q=m.CesiumMath.clamp(z.y/a.height,0,1);D[M++]=N,D[M++]=Q}t.normal&&(L[_++]=l.x,L[_++]=l.y,L[_++]=l.z),t.tangent&&(E[R++]=p.x,E[R++]=p.y,E[R++]=p.z),t.bitangent&&(T[k++]=y.x,T[k++]=y.y,T[k++]=y.z)}var j=new c.GeometryAttributes;return t.position&&(j.position=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:G})),t.normal&&(j.normal=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:L})),t.tangent&&(j.tangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:E})),t.bitangent&&(j.bitangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:T})),t.st&&(j.st=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:D})),new s.Geometry({attributes:j,indices:f,primitiveType:s.PrimitiveType.TRIANGLES})}function K(e){var t=(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).polygonHierarchy,a=l.defaultValue(e.vertexFormat,v.VertexFormat.DEFAULT);this._vertexFormat=v.VertexFormat.clone(a),this._polygonHierarchy=t,this._stRotation=l.defaultValue(e.stRotation,0),this._ellipsoid=n.Ellipsoid.clone(l.defaultValue(e.ellipsoid,n.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=g.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+v.VertexFormat.packedLength+n.Ellipsoid.packedLength+2}K.fromPositions=function(e){return new K({polygonHierarchy:{positions:(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},K.pack=function(e,t,a){return a=l.defaultValue(a,0),a=g.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,a),n.Ellipsoid.pack(e._ellipsoid,t,a),a+=n.Ellipsoid.packedLength,v.VertexFormat.pack(e._vertexFormat,t,a),a+=v.VertexFormat.packedLength,t[a++]=e._stRotation,t[a]=e.packedLength,t};var X=n.Ellipsoid.clone(n.Ellipsoid.UNIT_SPHERE),$=new v.VertexFormat,ee={polygonHierarchy:{}};return K.unpack=function(e,t,a){t=l.defaultValue(t,0);var r=g.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=r.startingIndex,delete r.startingIndex;var o=n.Ellipsoid.unpack(e,t,X);t+=n.Ellipsoid.packedLength;var i=v.VertexFormat.unpack(e,t,$);t+=v.VertexFormat.packedLength;var s=e[t++],c=e[t];return l.defined(a)||(a=new K(ee)),a._polygonHierarchy=r,a._ellipsoid=n.Ellipsoid.clone(o,a._ellipsoid),a._vertexFormat=v.VertexFormat.clone(i,a._vertexFormat),a._stRotation=s,a.packedLength=c,a},K.createGeometry=function(t){var r=t._vertexFormat,o=t._polygonHierarchy,l=t._stRotation,c=o.positions;if(!((c=e.arrayRemoveDuplicates(c,n.Cartesian3.equalsEpsilon,!0)).length<3)){var d=S,b=z,h=N,v=j,f=U;if(i.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(c,Q,v,f)){if(d=n.Cartesian3.cross(v,f,d),d=n.Cartesian3.normalize(d,d),!n.Cartesian3.equalsEpsilon(Q,n.Cartesian3.ZERO,m.CesiumMath.EPSILON6)){var x=t._ellipsoid.geodeticSurfaceNormal(Q,W);n.Cartesian3.dot(d,x)<0&&(d=n.Cartesian3.negate(d,d),v=n.Cartesian3.negate(v,v))}var C=i.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(Q,v,f),P=i.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(Q,v,f);r.tangent&&(b=n.Cartesian3.clone(v,b)),r.bitangent&&(h=n.Cartesian3.clone(f,h));var A=g.PolygonGeometryLibrary.polygonsFromHierarchy(o,C,!1),w=A.hierarchy,F=A.polygons;if(0!==w.length){c=w[0].outerRing;for(var G=a.BoundingSphere.fromPoints(c),L=g.PolygonGeometryLibrary.computeBoundingRectangle(d,P,c,l,I),E=[],T=0;T<F.length;T++){var D=new p.GeometryInstance({geometry:Z(F[T],r,L,l,P,d,b,h)});E.push(D)}var V=y.GeometryPipeline.combineInstances(E)[0];V.attributes.position.values=new Float64Array(V.attributes.position.values),V.indices=u.IndexDatatype.createTypedArray(V.attributes.position.values.length/3,V.indices);var _=V.attributes;return r.position||delete _.position,new s.Geometry({attributes:_,indices:V.indices,primitiveType:V.primitiveType,boundingSphere:G})}}}},function(e,t){return l.defined(t)&&(e=K.unpack(e,t)),K.createGeometry(e)}}));
