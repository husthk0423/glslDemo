define(["exports","./Cartesian2-cce28994","./defaultValue-81eec7ed","./Check-edea0f91","./EllipsoidGeodesic-bc3178c0","./EllipsoidRhumbLine-52cdeee5","./IntersectionTests-878c0e54","./Math-29cbc3fa","./Matrix4-da4bb68c","./Plane-d04f021c"],(function(a,e,r,t,i,n,o,s,c,l){"use strict";var u={numberOfPoints:function(a,r,t){var i=e.Cartesian3.distance(a,r);return Math.ceil(i/t)},numberOfPointsRhumbLine:function(a,e,r){var t=Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2);return Math.max(1,Math.ceil(Math.sqrt(t/(r*r))))}},h=new e.Cartographic;u.extractHeights=function(a,e){for(var r=a.length,t=new Array(r),i=0;i<r;i++){var n=a[i];t[i]=e.cartesianToCartographic(n,h).height}return t};var f=new c.Matrix4,g=new e.Cartesian3,C=new e.Cartesian3,d=new l.Plane(e.Cartesian3.UNIT_X,0),p=new e.Cartesian3,v=new l.Plane(e.Cartesian3.UNIT_X,0),m=new e.Cartesian3,w=new e.Cartesian3,P=[];function T(a,e,r){var t,i=P;if(i.length=a,e===r){for(t=0;t<a;t++)i[t]=e;return i}var n=(r-e)/a;for(t=0;t<a;t++){var o=e+t*n;i[t]=o}return i}var y=new e.Cartographic,A=new e.Cartographic,b=new e.Cartesian3,E=new e.Cartesian3,M=new e.Cartesian3,R=new i.EllipsoidGeodesic,S=new n.EllipsoidRhumbLine;function x(a,r,t,i,n,o,s,c){var l=i.scaleToGeodeticSurface(a,E),h=i.scaleToGeodeticSurface(r,M),f=u.numberOfPoints(a,r,t),g=i.cartesianToCartographic(l,y),C=i.cartesianToCartographic(h,A),d=T(f,n,o);R.setEndPoints(g,C);var p=R.surfaceDistance/f,v=c;g.height=n;var m=i.cartographicToCartesian(g,b);e.Cartesian3.pack(m,s,v),v+=3;for(var w=1;w<f;w++){var P=R.interpolateUsingSurfaceDistance(w*p,A);P.height=d[w],m=i.cartographicToCartesian(P,b),e.Cartesian3.pack(m,s,v),v+=3}return v}function D(a,r,t,i,o,s,c,l){var h=i.cartesianToCartographic(a,y),f=i.cartesianToCartographic(r,A),g=u.numberOfPointsRhumbLine(h,f,t);h.height=0,f.height=0;var C=T(g,o,s);S.ellipsoid.equals(i)||(S=new n.EllipsoidRhumbLine(void 0,void 0,i)),S.setEndPoints(h,f);var d=S.surfaceDistance/g,p=l;h.height=o;var v=i.cartographicToCartesian(h,b);e.Cartesian3.pack(v,c,p),p+=3;for(var m=1;m<g;m++){var w=S.interpolateUsingSurfaceDistance(m*d,A);w.height=C[m],v=i.cartographicToCartesian(w,b),e.Cartesian3.pack(v,c,p),p+=3}return p}u.wrapLongitude=function(a,t){var i=[],n=[];if(r.defined(a)&&a.length>0){t=r.defaultValue(t,c.Matrix4.IDENTITY);var s=c.Matrix4.inverseTransformation(t,f),u=c.Matrix4.multiplyByPoint(s,e.Cartesian3.ZERO,g),h=e.Cartesian3.normalize(c.Matrix4.multiplyByPointAsVector(s,e.Cartesian3.UNIT_Y,C),C),P=l.Plane.fromPointNormal(u,h,d),T=e.Cartesian3.normalize(c.Matrix4.multiplyByPointAsVector(s,e.Cartesian3.UNIT_X,p),p),y=l.Plane.fromPointNormal(u,T,v),A=1;i.push(e.Cartesian3.clone(a[0]));for(var b=i[0],E=a.length,M=1;M<E;++M){var R=a[M];if(l.Plane.getPointDistance(y,b)<0||l.Plane.getPointDistance(y,R)<0){var S=o.IntersectionTests.lineSegmentPlane(b,R,P,m);if(r.defined(S)){var x=e.Cartesian3.multiplyByScalar(h,5e-9,w);l.Plane.getPointDistance(P,b)<0&&e.Cartesian3.negate(x,x),i.push(e.Cartesian3.add(S,x,new e.Cartesian3)),n.push(A+1),e.Cartesian3.negate(x,x),i.push(e.Cartesian3.add(S,x,new e.Cartesian3)),A=1}}i.push(e.Cartesian3.clone(a[M])),A++,b=R}n.push(A)}return{positions:i,lengths:n}},u.generateArc=function(a){r.defined(a)||(a={});var t=a.positions,i=t.length,n=r.defaultValue(a.ellipsoid,e.Ellipsoid.WGS84),o=r.defaultValue(a.height,0),c=Array.isArray(o);if(i<1)return[];if(1===i){var l=n.scaleToGeodeticSurface(t[0],E);if(0!==(o=c?o[0]:o)){var h=n.geodeticSurfaceNormal(l,b);e.Cartesian3.multiplyByScalar(h,o,h),e.Cartesian3.add(l,h,l)}return[l.x,l.y,l.z]}var f=a.minDistance;if(!r.defined(f)){var g=r.defaultValue(a.granularity,s.CesiumMath.RADIANS_PER_DEGREE);f=s.CesiumMath.chordLength(g,n.maximumRadius)}var C,d=0;for(C=0;C<i-1;C++)d+=u.numberOfPoints(t[C],t[C+1],f);var p=3*(d+1),v=new Array(p),m=0;for(C=0;C<i-1;C++){m=x(t[C],t[C+1],f,n,c?o[C]:o,c?o[C+1]:o,v,m)}P.length=0;var w=t[i-1],T=n.cartesianToCartographic(w,y);T.height=c?o[i-1]:o;var A=n.cartographicToCartesian(T,b);return e.Cartesian3.pack(A,v,p-3),v};var N=new e.Cartographic,G=new e.Cartographic;u.generateRhumbArc=function(a){r.defined(a)||(a={});var t=a.positions,i=t.length,n=r.defaultValue(a.ellipsoid,e.Ellipsoid.WGS84),o=r.defaultValue(a.height,0),c=Array.isArray(o);if(i<1)return[];if(1===i){var l=n.scaleToGeodeticSurface(t[0],E);if(0!==(o=c?o[0]:o)){var h=n.geodeticSurfaceNormal(l,b);e.Cartesian3.multiplyByScalar(h,o,h),e.Cartesian3.add(l,h,l)}return[l.x,l.y,l.z]}var f,g,C=r.defaultValue(a.granularity,s.CesiumMath.RADIANS_PER_DEGREE),d=0,p=n.cartesianToCartographic(t[0],N);for(f=0;f<i-1;f++)g=n.cartesianToCartographic(t[f+1],G),d+=u.numberOfPointsRhumbLine(p,g,C),p=e.Cartographic.clone(g,N);var v=3*(d+1),m=new Array(v),w=0;for(f=0;f<i-1;f++){w=D(t[f],t[f+1],C,n,c?o[f]:o,c?o[f+1]:o,m,w)}P.length=0;var T=t[i-1],A=n.cartesianToCartographic(T,y);A.height=c?o[i-1]:o;var M=n.cartographicToCartesian(A,b);return e.Cartesian3.pack(M,m,v-3),m},u.generateCartesianArc=function(a){for(var r=u.generateArc(a),t=r.length/3,i=new Array(t),n=0;n<t;n++)i[n]=e.Cartesian3.unpack(r,3*n);return i},u.generateCartesianRhumbArc=function(a){for(var r=u.generateRhumbArc(a),t=r.length/3,i=new Array(t),n=0;n<t;n++)i[n]=e.Cartesian3.unpack(r,3*n);return i},a.PolylinePipeline=u}));
