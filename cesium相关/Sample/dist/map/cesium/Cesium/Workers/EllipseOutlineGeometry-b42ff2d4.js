define(["exports","./when-c2e8ef35","./Check-c4f3a3fc","./Math-d30358ed","./Cartesian2-f9492f23","./BoundingSphere-dcb1d5fc","./ComponentDatatype-5d3f6452","./GeometryAttribute-a5c051b9","./GeometryAttributes-57608efc","./IndexDatatype-e3260434","./GeometryOffsetAttribute-e6e9672c","./EllipseGeometryLibrary-7d36bb50"],(function(e,t,i,r,a,n,o,s,l,u,d,p){"use strict";var f=new a.Cartesian3,c=new a.Cartesian3;var m=new n.BoundingSphere,h=new n.BoundingSphere;function y(e){var i=(e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT)).center,n=t.defaultValue(e.ellipsoid,a.Ellipsoid.WGS84),o=e.semiMajorAxis,s=e.semiMinorAxis,l=t.defaultValue(e.granularity,r.CesiumMath.RADIANS_PER_DEGREE),u=t.defaultValue(e.height,0),d=t.defaultValue(e.extrudedHeight,u);this._center=a.Cartesian3.clone(i),this._semiMajorAxis=o,this._semiMinorAxis=s,this._ellipsoid=a.Ellipsoid.clone(n),this._rotation=t.defaultValue(e.rotation,0),this._height=Math.max(d,u),this._granularity=l,this._extrudedHeight=Math.min(d,u),this._numberOfVerticalLines=Math.max(t.defaultValue(e.numberOfVerticalLines,16),0),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipseOutlineGeometry"}y.packedLength=a.Cartesian3.packedLength+a.Ellipsoid.packedLength+8,y.pack=function(e,i,r){return r=t.defaultValue(r,0),a.Cartesian3.pack(e._center,i,r),r+=a.Cartesian3.packedLength,a.Ellipsoid.pack(e._ellipsoid,i,r),r+=a.Ellipsoid.packedLength,i[r++]=e._semiMajorAxis,i[r++]=e._semiMinorAxis,i[r++]=e._rotation,i[r++]=e._height,i[r++]=e._granularity,i[r++]=e._extrudedHeight,i[r++]=e._numberOfVerticalLines,i[r]=t.defaultValue(e._offsetAttribute,-1),i};var b=new a.Cartesian3,A=new a.Ellipsoid,_={center:b,ellipsoid:A,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};y.unpack=function(e,i,r){i=t.defaultValue(i,0);var n=a.Cartesian3.unpack(e,i,b);i+=a.Cartesian3.packedLength;var o=a.Ellipsoid.unpack(e,i,A);i+=a.Ellipsoid.packedLength;var s=e[i++],l=e[i++],u=e[i++],d=e[i++],p=e[i++],f=e[i++],c=e[i++],m=e[i];return t.defined(r)?(r._center=a.Cartesian3.clone(n,r._center),r._ellipsoid=a.Ellipsoid.clone(o,r._ellipsoid),r._semiMajorAxis=s,r._semiMinorAxis=l,r._rotation=u,r._height=d,r._granularity=p,r._extrudedHeight=f,r._numberOfVerticalLines=c,r._offsetAttribute=-1===m?void 0:m,r):(_.height=d,_.extrudedHeight=f,_.granularity=p,_.rotation=u,_.semiMajorAxis=s,_.semiMinorAxis=l,_.numberOfVerticalLines=c,_.offsetAttribute=-1===m?void 0:m,new y(_))},y.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var i=e._height,y=e._extrudedHeight,b=!r.CesiumMath.equalsEpsilon(i,y,0,r.CesiumMath.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var A,_={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:i,granularity:e._granularity,numberOfVerticalLines:e._numberOfVerticalLines};if(b)_.extrudedHeight=y,_.offsetAttribute=e._offsetAttribute,A=function(e){var i=e.center,c=e.ellipsoid,y=e.semiMajorAxis,b=a.Cartesian3.multiplyByScalar(c.geodeticSurfaceNormal(i,f),e.height,f);m.center=a.Cartesian3.add(i,b,m.center),m.radius=y,b=a.Cartesian3.multiplyByScalar(c.geodeticSurfaceNormal(i,b),e.extrudedHeight,b),h.center=a.Cartesian3.add(i,b,h.center),h.radius=y;var A=p.EllipseGeometryLibrary.computeEllipsePositions(e,!1,!0).outerPositions,_=new l.GeometryAttributes({position:new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:p.EllipseGeometryLibrary.raisePositionsToHeight(A,e,!0)})});A=_.position.values;var g=n.BoundingSphere.union(m,h),v=A.length/3;if(t.defined(e.offsetAttribute)){var x=new Uint8Array(v);if(e.offsetAttribute===d.GeometryOffsetAttribute.TOP)x=d.arrayFill(x,1,0,v/2);else{var E=e.offsetAttribute===d.GeometryOffsetAttribute.NONE?0:1;x=d.arrayFill(x,E)}_.applyOffset=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:x})}var M=t.defaultValue(e.numberOfVerticalLines,16);M=r.CesiumMath.clamp(M,0,v/2);var C=u.IndexDatatype.createTypedArray(v,2*v+2*M);v/=2;var G,L,O=0;for(G=0;G<v;++G)C[O++]=G,C[O++]=(G+1)%v,C[O++]=G+v,C[O++]=(G+1)%v+v;if(M>0){var S=Math.min(M,v);L=Math.round(v/S);var V=Math.min(L*M,v);for(G=0;G<V;G+=L)C[O++]=G,C[O++]=G+v}return{boundingSphere:g,attributes:_,indices:C}}(_);else if(A=function(e){var t=e.center;c=a.Cartesian3.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,c),e.height,c),c=a.Cartesian3.add(t,c,c);for(var i=new n.BoundingSphere(c,e.semiMajorAxis),r=p.EllipseGeometryLibrary.computeEllipsePositions(e,!1,!0).outerPositions,d=new l.GeometryAttributes({position:new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:p.EllipseGeometryLibrary.raisePositionsToHeight(r,e,!1)})}),f=r.length/3,m=u.IndexDatatype.createTypedArray(f,2*f),h=0,y=0;y<f;++y)m[h++]=y,m[h++]=(y+1)%f;return{boundingSphere:i,attributes:d,indices:m}}(_),t.defined(e._offsetAttribute)){var g=A.attributes.position.values.length,v=new Uint8Array(g/3),x=e._offsetAttribute===d.GeometryOffsetAttribute.NONE?0:1;d.arrayFill(v,x),A.attributes.applyOffset=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:v})}return new s.Geometry({attributes:A.attributes,indices:A.indices,primitiveType:s.PrimitiveType.LINES,boundingSphere:A.boundingSphere,offsetAttribute:e._offsetAttribute})}},e.EllipseOutlineGeometry=y}));
