define(["./when-c2e8ef35","./Check-c4f3a3fc","./Math-d30358ed","./Cartesian2-f9492f23","./BoundingSphere-dcb1d5fc","./Transforms-8b7e0d39","./RuntimeError-6122571f","./Rectangle-3285eeb3","./WebGLConstants-4ae0db90","./ComponentDatatype-5d3f6452","./GeometryAttribute-a5c051b9","./GeometryAttributes-57608efc","./AttributeCompression-72a6590f","./GeometryPipeline-01c9df66","./EncodedCartesian3-4f87492e","./IndexDatatype-e3260434","./IntersectionTests-525ff5aa","./Plane-dbdf17bf","./GeometryOffsetAttribute-e6e9672c","./VertexFormat-ad523db1","./GeometryInstance-b1e4a9ef","./EllipsoidRhumbLine-01c8204c","./PolygonPipeline-db004fe0","./RectangleGeometryLibrary-d813e8ff"],(function(t,e,a,r,n,i,o,s,l,u,c,m,d,p,g,y,f,h,v,b,_,A,x,w){"use strict";var C=new r.Cartesian3,R=new r.Cartesian3,E=new r.Cartesian3,F=new r.Cartesian3,G=new s.Rectangle,P=new r.Cartesian2,V=new n.BoundingSphere,L=new n.BoundingSphere;function D(t,e){var a=new c.Geometry({attributes:new m.GeometryAttributes,primitiveType:c.PrimitiveType.TRIANGLES});return a.attributes.position=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e.positions}),t.normal&&(a.attributes.normal=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.normals})),t.tangent&&(a.attributes.tangent=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.tangents})),t.bitangent&&(a.attributes.bitangent=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.bitangents})),a}var M=new r.Cartesian3,T=new r.Cartesian3;function O(t,e){var a=t._vertexFormat,n=t._ellipsoid,o=e.height,s=e.width,l=e.northCap,m=e.southCap,d=0,p=o,g=o,f=0;l&&(d=1,g-=1,f+=1),m&&(p-=1,g-=1,f+=1),f+=s*g;for(var h=a.position?new Float64Array(3*f):void 0,v=a.st?new Float32Array(2*f):void 0,b=0,_=0,A=C,x=P,G=Number.MAX_VALUE,V=Number.MAX_VALUE,L=-Number.MAX_VALUE,M=-Number.MAX_VALUE,T=d;T<p;++T)for(var O=0;O<s;++O)w.RectangleGeometryLibrary.computePosition(e,n,a.st,T,O,A,x),h[b++]=A.x,h[b++]=A.y,h[b++]=A.z,a.st&&(v[_++]=x.x,v[_++]=x.y,G=Math.min(G,x.x),V=Math.min(V,x.y),L=Math.max(L,x.x),M=Math.max(M,x.y));if(l&&(w.RectangleGeometryLibrary.computePosition(e,n,a.st,0,0,A,x),h[b++]=A.x,h[b++]=A.y,h[b++]=A.z,a.st&&(v[_++]=x.x,v[_++]=x.y,G=x.x,V=x.y,L=x.x,M=x.y)),m&&(w.RectangleGeometryLibrary.computePosition(e,n,a.st,o-1,0,A,x),h[b++]=A.x,h[b++]=A.y,h[b]=A.z,a.st&&(v[_++]=x.x,v[_]=x.y,G=Math.min(G,x.x),V=Math.min(V,x.y),L=Math.max(L,x.x),M=Math.max(M,x.y))),a.st&&(G<0||V<0||L>1||M>1))for(var N=0;N<v.length;N+=2)v[N]=(v[N]-G)/(L-G),v[N+1]=(v[N+1]-V)/(M-V);var S=function(t,e,a,n){var o=t.length,s=e.normal?new Float32Array(o):void 0,l=e.tangent?new Float32Array(o):void 0,u=e.bitangent?new Float32Array(o):void 0,c=0,m=F,d=E,p=R;if(e.normal||e.tangent||e.bitangent)for(var g=0;g<o;g+=3){var y=r.Cartesian3.fromArray(t,g,C),f=c+1,h=c+2;p=a.geodeticSurfaceNormal(y,p),(e.tangent||e.bitangent)&&(r.Cartesian3.cross(r.Cartesian3.UNIT_Z,p,d),i.Matrix3.multiplyByVector(n,d,d),r.Cartesian3.normalize(d,d),e.bitangent&&r.Cartesian3.normalize(r.Cartesian3.cross(p,d,m),m)),e.normal&&(s[c]=p.x,s[f]=p.y,s[h]=p.z),e.tangent&&(l[c]=d.x,l[f]=d.y,l[h]=d.z),e.bitangent&&(u[c]=m.x,u[f]=m.y,u[h]=m.z),c+=3}return D(e,{positions:t,normals:s,tangents:l,bitangents:u})}(h,a,n,e.tangentRotationMatrix),I=6*(s-1)*(g-1);l&&(I+=3*(s-1)),m&&(I+=3*(s-1));var k,H=y.IndexDatatype.createTypedArray(f,I),z=0,B=0;for(k=0;k<g-1;++k){for(var U=0;U<s-1;++U){var Y=z,q=Y+s,X=q+1,Q=Y+1;H[B++]=Y,H[B++]=q,H[B++]=Q,H[B++]=Q,H[B++]=q,H[B++]=X,++z}++z}if(l||m){var W,J,j=f-1,Z=f-1;if(l&&m&&(j=f-2),z=0,l)for(k=0;k<s-1;k++)J=(W=z)+1,H[B++]=j,H[B++]=W,H[B++]=J,++z;if(m)for(z=(g-1)*s,k=0;k<s-1;k++)J=(W=z)+1,H[B++]=W,H[B++]=Z,H[B++]=J,++z}return S.indices=H,a.st&&(S.attributes.st=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:v})),S}function N(t,e,a,r,n){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a+2],t[e++]=n[a],t[e++]=n[a+1],t[e]=n[a+2],t}function S(t,e,a,r){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a],t[e]=r[a+1],t}var I=new b.VertexFormat;function k(e,n){var i,o=e._shadowVolume,s=e._offsetAttribute,l=e._vertexFormat,m=e._extrudedHeight,d=e._surfaceHeight,g=e._ellipsoid,f=n.height,h=n.width;if(o){var A=b.VertexFormat.clone(l,I);A.normal=!0,e._vertexFormat=A}var w=O(e,n);o&&(e._vertexFormat=l);var G=x.PolygonPipeline.scaleToGeodeticHeight(w.attributes.position.values,d,g,!1),P=(G=new Float64Array(G)).length,V=2*P,L=new Float64Array(V);L.set(G);var k=x.PolygonPipeline.scaleToGeodeticHeight(w.attributes.position.values,m,g);L.set(k,P),w.attributes.position.values=L;var H,z,B,U=l.normal?new Float32Array(V):void 0,Y=l.tangent?new Float32Array(V):void 0,q=l.bitangent?new Float32Array(V):void 0,X=l.st?new Float32Array(V/3*2):void 0;if(l.normal){for(z=w.attributes.normal.values,U.set(z),i=0;i<P;i++)z[i]=-z[i];U.set(z,P),w.attributes.normal.values=U}if(o){z=w.attributes.normal.values,l.normal||(w.attributes.normal=void 0);var Q=new Float32Array(V);for(i=0;i<P;i++)z[i]=-z[i];Q.set(z,P),w.attributes.extrudeDirection=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:Q})}var W=t.defined(s);if(W){var J=P/3*2,j=new Uint8Array(J);s===v.GeometryOffsetAttribute.TOP?j=v.arrayFill(j,1,0,J/2):(B=s===v.GeometryOffsetAttribute.NONE?0:1,j=v.arrayFill(j,B)),w.attributes.applyOffset=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:j})}if(l.tangent){var Z=w.attributes.tangent.values;for(Y.set(Z),i=0;i<P;i++)Z[i]=-Z[i];Y.set(Z,P),w.attributes.tangent.values=Y}if(l.bitangent){var K=w.attributes.bitangent.values;q.set(K),q.set(K,P),w.attributes.bitangent.values=q}l.st&&(H=w.attributes.st.values,X.set(H),X.set(H,P/3*2),w.attributes.st.values=X);var $=w.indices,tt=$.length,et=P/3,at=y.IndexDatatype.createTypedArray(V/3,2*tt);for(at.set($),i=0;i<tt;i+=3)at[i+tt]=$[i+2]+et,at[i+1+tt]=$[i+1]+et,at[i+2+tt]=$[i]+et;w.indices=at;var rt=n.northCap,nt=n.southCap,it=f,ot=2,st=0,lt=4,ut=4;rt&&(ot-=1,it-=1,st+=1,lt-=2,ut-=1),nt&&(ot-=1,it-=1,st+=1,lt-=2,ut-=1);var ct=2*((st+=ot*h+2*it-lt)+ut),mt=new Float64Array(3*ct),dt=o?new Float32Array(3*ct):void 0,pt=W?new Uint8Array(ct):void 0,gt=l.st?new Float32Array(2*ct):void 0,yt=s===v.GeometryOffsetAttribute.TOP;W&&!yt&&(B=s===v.GeometryOffsetAttribute.ALL?1:0,pt=v.arrayFill(pt,B));var ft,ht=0,vt=0,bt=0,_t=0,At=h*it;for(i=0;i<At;i+=h)mt=N(mt,ht,ft=3*i,G,k),ht+=6,l.st&&(gt=S(gt,vt,2*i,H),vt+=4),o&&(bt+=3,dt[bt++]=z[ft],dt[bt++]=z[ft+1],dt[bt++]=z[ft+2]),yt&&(pt[_t++]=1,_t+=1);if(nt){var xt=rt?At+1:At;for(ft=3*xt,i=0;i<2;i++)mt=N(mt,ht,ft,G,k),ht+=6,l.st&&(gt=S(gt,vt,2*xt,H),vt+=4),o&&(bt+=3,dt[bt++]=z[ft],dt[bt++]=z[ft+1],dt[bt++]=z[ft+2]),yt&&(pt[_t++]=1,_t+=1)}else for(i=At-h;i<At;i++)mt=N(mt,ht,ft=3*i,G,k),ht+=6,l.st&&(gt=S(gt,vt,2*i,H),vt+=4),o&&(bt+=3,dt[bt++]=z[ft],dt[bt++]=z[ft+1],dt[bt++]=z[ft+2]),yt&&(pt[_t++]=1,_t+=1);for(i=At-1;i>0;i-=h)mt=N(mt,ht,ft=3*i,G,k),ht+=6,l.st&&(gt=S(gt,vt,2*i,H),vt+=4),o&&(bt+=3,dt[bt++]=z[ft],dt[bt++]=z[ft+1],dt[bt++]=z[ft+2]),yt&&(pt[_t++]=1,_t+=1);if(rt){var wt=At;for(ft=3*wt,i=0;i<2;i++)mt=N(mt,ht,ft,G,k),ht+=6,l.st&&(gt=S(gt,vt,2*wt,H),vt+=4),o&&(bt+=3,dt[bt++]=z[ft],dt[bt++]=z[ft+1],dt[bt++]=z[ft+2]),yt&&(pt[_t++]=1,_t+=1)}else for(i=h-1;i>=0;i--)mt=N(mt,ht,ft=3*i,G,k),ht+=6,l.st&&(gt=S(gt,vt,2*i,H),vt+=4),o&&(bt+=3,dt[bt++]=z[ft],dt[bt++]=z[ft+1],dt[bt++]=z[ft+2]),yt&&(pt[_t++]=1,_t+=1);var Ct=function(t,e,n){var i=t.length,o=e.normal?new Float32Array(i):void 0,s=e.tangent?new Float32Array(i):void 0,l=e.bitangent?new Float32Array(i):void 0,u=0,c=0,m=0,d=!0,p=F,g=E,y=R;if(e.normal||e.tangent||e.bitangent)for(var f=0;f<i;f+=6){var h=r.Cartesian3.fromArray(t,f,C),v=r.Cartesian3.fromArray(t,(f+6)%i,M);if(d){var b=r.Cartesian3.fromArray(t,(f+3)%i,T);r.Cartesian3.subtract(v,h,v),r.Cartesian3.subtract(b,h,b),y=r.Cartesian3.normalize(r.Cartesian3.cross(b,v,y),y),d=!1}r.Cartesian3.equalsEpsilon(v,h,a.CesiumMath.EPSILON10)&&(d=!0),(e.tangent||e.bitangent)&&(p=n.geodeticSurfaceNormal(h,p),e.tangent&&(g=r.Cartesian3.normalize(r.Cartesian3.cross(p,y,g),g))),e.normal&&(o[u++]=y.x,o[u++]=y.y,o[u++]=y.z,o[u++]=y.x,o[u++]=y.y,o[u++]=y.z),e.tangent&&(s[c++]=g.x,s[c++]=g.y,s[c++]=g.z,s[c++]=g.x,s[c++]=g.y,s[c++]=g.z),e.bitangent&&(l[m++]=p.x,l[m++]=p.y,l[m++]=p.z,l[m++]=p.x,l[m++]=p.y,l[m++]=p.z)}return D(e,{positions:t,normals:o,tangents:s,bitangents:l})}(mt,l,g);l.st&&(Ct.attributes.st=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:gt})),o&&(Ct.attributes.extrudeDirection=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:dt})),W&&(Ct.attributes.applyOffset=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:pt}));var Rt,Et,Ft,Gt,Pt=y.IndexDatatype.createTypedArray(ct,6*st);P=mt.length/3;var Vt=0;for(i=0;i<P-1;i+=2){Gt=((Rt=i)+2)%P;var Lt=r.Cartesian3.fromArray(mt,3*Rt,M),Dt=r.Cartesian3.fromArray(mt,3*Gt,T);r.Cartesian3.equalsEpsilon(Lt,Dt,a.CesiumMath.EPSILON10)||(Ft=((Et=(Rt+1)%P)+2)%P,Pt[Vt++]=Rt,Pt[Vt++]=Et,Pt[Vt++]=Gt,Pt[Vt++]=Gt,Pt[Vt++]=Et,Pt[Vt++]=Ft)}return Ct.indices=Pt,(Ct=p.GeometryPipeline.combineInstances([new _.GeometryInstance({geometry:w}),new _.GeometryInstance({geometry:Ct})]))[0]}var H=[new r.Cartesian3,new r.Cartesian3,new r.Cartesian3,new r.Cartesian3],z=new r.Cartographic,B=new r.Cartographic;function U(t,e,a,r,n){if(0===a)return s.Rectangle.clone(t,n);var i=w.RectangleGeometryLibrary.computeOptions(t,e,a,0,G,z),o=i.height,l=i.width,u=H;return w.RectangleGeometryLibrary.computePosition(i,r,!1,0,0,u[0]),w.RectangleGeometryLibrary.computePosition(i,r,!1,0,l-1,u[1]),w.RectangleGeometryLibrary.computePosition(i,r,!1,o-1,0,u[2]),w.RectangleGeometryLibrary.computePosition(i,r,!1,o-1,l-1,u[3]),s.Rectangle.fromCartesianArray(u,r,n)}function Y(e){var n=(e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT)).rectangle,i=t.defaultValue(e.height,0),o=t.defaultValue(e.extrudedHeight,i);this._rectangle=s.Rectangle.clone(n),this._granularity=t.defaultValue(e.granularity,a.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=r.Ellipsoid.clone(t.defaultValue(e.ellipsoid,r.Ellipsoid.WGS84)),this._surfaceHeight=Math.max(i,o),this._rotation=t.defaultValue(e.rotation,0),this._stRotation=t.defaultValue(e.stRotation,0),this._vertexFormat=b.VertexFormat.clone(t.defaultValue(e.vertexFormat,b.VertexFormat.DEFAULT)),this._extrudedHeight=Math.min(i,o),this._shadowVolume=t.defaultValue(e.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=e.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}Y.packedLength=s.Rectangle.packedLength+r.Ellipsoid.packedLength+b.VertexFormat.packedLength+7,Y.pack=function(e,a,n){return n=t.defaultValue(n,0),s.Rectangle.pack(e._rectangle,a,n),n+=s.Rectangle.packedLength,r.Ellipsoid.pack(e._ellipsoid,a,n),n+=r.Ellipsoid.packedLength,b.VertexFormat.pack(e._vertexFormat,a,n),n+=b.VertexFormat.packedLength,a[n++]=e._granularity,a[n++]=e._surfaceHeight,a[n++]=e._rotation,a[n++]=e._stRotation,a[n++]=e._extrudedHeight,a[n++]=e._shadowVolume?1:0,a[n]=t.defaultValue(e._offsetAttribute,-1),a};var q=new s.Rectangle,X=r.Ellipsoid.clone(r.Ellipsoid.UNIT_SPHERE),Q={rectangle:q,ellipsoid:X,vertexFormat:I,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};Y.unpack=function(e,a,n){a=t.defaultValue(a,0);var i=s.Rectangle.unpack(e,a,q);a+=s.Rectangle.packedLength;var o=r.Ellipsoid.unpack(e,a,X);a+=r.Ellipsoid.packedLength;var l=b.VertexFormat.unpack(e,a,I);a+=b.VertexFormat.packedLength;var u=e[a++],c=e[a++],m=e[a++],d=e[a++],p=e[a++],g=1===e[a++],y=e[a];return t.defined(n)?(n._rectangle=s.Rectangle.clone(i,n._rectangle),n._ellipsoid=r.Ellipsoid.clone(o,n._ellipsoid),n._vertexFormat=b.VertexFormat.clone(l,n._vertexFormat),n._granularity=u,n._surfaceHeight=c,n._rotation=m,n._stRotation=d,n._extrudedHeight=p,n._shadowVolume=g,n._offsetAttribute=-1===y?void 0:y,n):(Q.granularity=u,Q.height=c,Q.rotation=m,Q.stRotation=d,Q.extrudedHeight=p,Q.shadowVolume=g,Q.offsetAttribute=-1===y?void 0:y,new Y(Q))},Y.computeRectangle=function(e,n){var i=(e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT)).rectangle,o=t.defaultValue(e.granularity,a.CesiumMath.RADIANS_PER_DEGREE),s=t.defaultValue(e.ellipsoid,r.Ellipsoid.WGS84);return U(i,o,t.defaultValue(e.rotation,0),s,n)};var W=new i.Matrix3,J=new i.Quaternion,j=new r.Cartographic;Y.createGeometry=function(e){if(!a.CesiumMath.equalsEpsilon(e._rectangle.north,e._rectangle.south,a.CesiumMath.EPSILON10)&&!a.CesiumMath.equalsEpsilon(e._rectangle.east,e._rectangle.west,a.CesiumMath.EPSILON10)){var r=e._rectangle,o=e._ellipsoid,l=e._rotation,m=e._stRotation,d=e._vertexFormat,p=w.RectangleGeometryLibrary.computeOptions(r,e._granularity,l,m,G,z,B),g=W;if(0!==m||0!==l){var y=s.Rectangle.center(r,j),f=o.geodeticSurfaceNormalCartographic(y,M);i.Quaternion.fromAxisAngle(f,-m,J),i.Matrix3.fromQuaternion(J,g)}else i.Matrix3.clone(i.Matrix3.IDENTITY,g);var h,b,_=e._surfaceHeight,A=e._extrudedHeight,C=!a.CesiumMath.equalsEpsilon(_,A,0,a.CesiumMath.EPSILON2);if(p.lonScalar=1/e._rectangle.width,p.latScalar=1/e._rectangle.height,p.tangentRotationMatrix=g,r=e._rectangle,C){h=k(e,p);var R=n.BoundingSphere.fromRectangle3D(r,o,_,L),E=n.BoundingSphere.fromRectangle3D(r,o,A,V);b=n.BoundingSphere.union(R,E)}else{if((h=O(e,p)).attributes.position.values=x.PolygonPipeline.scaleToGeodeticHeight(h.attributes.position.values,_,o,!1),t.defined(e._offsetAttribute)){var F=h.attributes.position.values.length,P=new Uint8Array(F/3),D=e._offsetAttribute===v.GeometryOffsetAttribute.NONE?0:1;v.arrayFill(P,D),h.attributes.applyOffset=new c.GeometryAttribute({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:P})}b=n.BoundingSphere.fromRectangle3D(r,o,_)}return d.position||delete h.attributes.position,new c.Geometry({attributes:h.attributes,indices:h.indices,primitiveType:h.primitiveType,boundingSphere:b,offsetAttribute:e._offsetAttribute})}},Y.createShadowVolume=function(t,e,a){var r=t._granularity,n=t._ellipsoid,i=e(r,n),o=a(r,n);return new Y({rectangle:t._rectangle,rotation:t._rotation,ellipsoid:n,stRotation:t._stRotation,granularity:r,extrudedHeight:o,height:i,vertexFormat:b.VertexFormat.POSITION_ONLY,shadowVolume:!0})};var Z=new s.Rectangle,K=[new r.Cartesian2,new r.Cartesian2,new r.Cartesian2],$=new c.Matrix2,tt=new r.Cartographic;return Object.defineProperties(Y.prototype,{rectangle:{get:function(){return t.defined(this._rotatedRectangle)||(this._rotatedRectangle=U(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return t.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){if(0===t._stRotation)return[0,0,0,1,1,0];var e=s.Rectangle.clone(t._rectangle,Z),a=t._granularity,n=t._ellipsoid,i=U(e,a,t._rotation-t._stRotation,n,Z),o=K;o[0].x=i.west,o[0].y=i.south,o[1].x=i.west,o[1].y=i.north,o[2].x=i.east,o[2].y=i.south;for(var l=t.rectangle,u=c.Matrix2.fromRotation(t._stRotation,$),m=s.Rectangle.center(l,tt),d=0;d<3;++d){var p=o[d];p.x-=m.longitude,p.y-=m.latitude,c.Matrix2.multiplyByVector(u,p,p),p.x+=m.longitude,p.y+=m.latitude,p.x=(p.x-l.west)/l.width,p.y=(p.y-l.south)/l.height}var g=o[0],y=o[1],f=o[2],h=new Array(6);return r.Cartesian2.pack(g,h),r.Cartesian2.pack(y,h,2),r.Cartesian2.pack(f,h,4),h}(this)),this._textureCoordinateRotationPoints}}}),function(e,a){return t.defined(a)&&(e=Y.unpack(e,a)),e._ellipsoid=r.Ellipsoid.clone(e._ellipsoid),e._rectangle=s.Rectangle.clone(e._rectangle),Y.createGeometry(e)}}));
