define(["exports","./when-c2e8ef35","./Check-c4f3a3fc","./Math-d30358ed","./Cartesian2-f9492f23","./BoundingSphere-dcb1d5fc","./ComponentDatatype-5d3f6452","./GeometryAttribute-a5c051b9","./GeometryAttributes-57608efc","./IndexDatatype-e3260434","./GeometryOffsetAttribute-e6e9672c","./VertexFormat-ad523db1"],(function(t,e,a,i,r,n,o,m,s,u,l,f){"use strict";var c=new r.Cartesian3,d=new r.Cartesian3,C=new r.Cartesian3,p=new r.Cartesian3,y=new r.Cartesian3,_=new r.Cartesian3(1,1,1),v=Math.cos,h=Math.sin;function A(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT);var a=e.defaultValue(t.radii,_),n=e.defaultValue(t.innerRadii,a),o=e.defaultValue(t.minimumClock,0),m=e.defaultValue(t.maximumClock,i.CesiumMath.TWO_PI),s=e.defaultValue(t.minimumCone,0),u=e.defaultValue(t.maximumCone,i.CesiumMath.PI),l=Math.round(e.defaultValue(t.stackPartitions,64)),c=Math.round(e.defaultValue(t.slicePartitions,64)),d=e.defaultValue(t.vertexFormat,f.VertexFormat.DEFAULT);this._radii=r.Cartesian3.clone(a),this._innerRadii=r.Cartesian3.clone(n),this._minimumClock=o,this._maximumClock=m,this._minimumCone=s,this._maximumCone=u,this._stackPartitions=l,this._slicePartitions=c,this._vertexFormat=f.VertexFormat.clone(d),this._offsetAttribute=t.offsetAttribute,this._workerName="createEllipsoidGeometry"}A.packedLength=2*r.Cartesian3.packedLength+f.VertexFormat.packedLength+7,A.pack=function(t,a,i){return i=e.defaultValue(i,0),r.Cartesian3.pack(t._radii,a,i),i+=r.Cartesian3.packedLength,r.Cartesian3.pack(t._innerRadii,a,i),i+=r.Cartesian3.packedLength,f.VertexFormat.pack(t._vertexFormat,a,i),i+=f.VertexFormat.packedLength,a[i++]=t._minimumClock,a[i++]=t._maximumClock,a[i++]=t._minimumCone,a[i++]=t._maximumCone,a[i++]=t._stackPartitions,a[i++]=t._slicePartitions,a[i]=e.defaultValue(t._offsetAttribute,-1),a};var x,b=new r.Cartesian3,k=new r.Cartesian3,w=new f.VertexFormat,F={radii:b,innerRadii:k,vertexFormat:w,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,offsetAttribute:void 0};A.unpack=function(t,a,i){a=e.defaultValue(a,0);var n=r.Cartesian3.unpack(t,a,b);a+=r.Cartesian3.packedLength;var o=r.Cartesian3.unpack(t,a,k);a+=r.Cartesian3.packedLength;var m=f.VertexFormat.unpack(t,a,w);a+=f.VertexFormat.packedLength;var s=t[a++],u=t[a++],l=t[a++],c=t[a++],d=t[a++],C=t[a++],p=t[a];return e.defined(i)?(i._radii=r.Cartesian3.clone(n,i._radii),i._innerRadii=r.Cartesian3.clone(o,i._innerRadii),i._vertexFormat=f.VertexFormat.clone(m,i._vertexFormat),i._minimumClock=s,i._maximumClock=u,i._minimumCone=l,i._maximumCone=c,i._stackPartitions=d,i._slicePartitions=C,i._offsetAttribute=-1===p?void 0:p,i):(F.minimumClock=s,F.maximumClock=u,F.minimumCone=l,F.maximumCone=c,F.stackPartitions=d,F.slicePartitions=C,F.offsetAttribute=-1===p?void 0:p,new A(F))},A.createGeometry=function(t){var a=t._radii;if(!(a.x<=0||a.y<=0||a.z<=0)){var f=t._innerRadii;if(!(f.x<=0||f.y<=0||f.z<=0)){var _,A,x=t._minimumClock,b=t._maximumClock,k=t._minimumCone,w=t._maximumCone,F=t._vertexFormat,g=t._slicePartitions+1,P=t._stackPartitions+1;(g=Math.round(g*Math.abs(b-x)/i.CesiumMath.TWO_PI))<2&&(g=2),(P=Math.round(P*Math.abs(w-k)/i.CesiumMath.PI))<2&&(P=2);var V=0,M=[k],T=[x];for(_=0;_<P;_++)M.push(k+_*(w-k)/(P-1));for(M.push(w),A=0;A<g;A++)T.push(x+A*(b-x)/(g-1));T.push(b);var D=M.length,G=T.length,L=0,O=1,I=f.x!==a.x||f.y!==a.y||f.z!==a.z,E=!1,z=!1,N=!1;I&&(O=2,k>0&&(E=!0,L+=g-1),w<Math.PI&&(z=!0,L+=g-1),(b-x)%i.CesiumMath.TWO_PI?(N=!0,L+=2*(P-1)+1):L+=1);var R=G*D*O,S=new Float64Array(3*R),U=l.arrayFill(new Array(R),!1),B=l.arrayFill(new Array(R),!1),W=g*P*O,Y=6*(W+L+1-(g+P)*O),J=u.IndexDatatype.createTypedArray(W,Y),X=F.normal?new Float32Array(3*R):void 0,Z=F.tangent?new Float32Array(3*R):void 0,j=F.bitangent?new Float32Array(3*R):void 0,q=F.st?new Float32Array(2*R):void 0,H=new Array(D),K=new Array(D);for(_=0;_<D;_++)H[_]=h(M[_]),K[_]=v(M[_]);var Q=new Array(G),$=new Array(G);for(A=0;A<G;A++)$[A]=v(T[A]),Q[A]=h(T[A]);for(_=0;_<D;_++)for(A=0;A<G;A++)S[V++]=a.x*H[_]*$[A],S[V++]=a.y*H[_]*Q[A],S[V++]=a.z*K[_];var tt,et,at,it,rt=R/2;if(I)for(_=0;_<D;_++)for(A=0;A<G;A++)S[V++]=f.x*H[_]*$[A],S[V++]=f.y*H[_]*Q[A],S[V++]=f.z*K[_],U[rt]=!0,_>0&&_!==D-1&&0!==A&&A!==G-1&&(B[rt]=!0),rt++;for(V=0,_=1;_<D-2;_++)for(tt=_*G,et=(_+1)*G,A=1;A<G-2;A++)J[V++]=et+A,J[V++]=et+A+1,J[V++]=tt+A+1,J[V++]=et+A,J[V++]=tt+A+1,J[V++]=tt+A;if(I){var nt=D*G;for(_=1;_<D-2;_++)for(tt=nt+_*G,et=nt+(_+1)*G,A=1;A<G-2;A++)J[V++]=et+A,J[V++]=tt+A,J[V++]=tt+A+1,J[V++]=et+A,J[V++]=tt+A+1,J[V++]=et+A+1}if(I){if(E)for(it=D*G,_=1;_<G-2;_++)J[V++]=_,J[V++]=_+1,J[V++]=it+_+1,J[V++]=_,J[V++]=it+_+1,J[V++]=it+_;if(z)for(at=D*G-G,it=D*G*O-G,_=1;_<G-2;_++)J[V++]=at+_+1,J[V++]=at+_,J[V++]=it+_,J[V++]=at+_+1,J[V++]=it+_,J[V++]=it+_+1}if(N){for(_=1;_<D-2;_++)it=G*D+G*_,at=G*_,J[V++]=it,J[V++]=at+G,J[V++]=at,J[V++]=it,J[V++]=it+G,J[V++]=at+G;for(_=1;_<D-2;_++)it=G*D+G*(_+1)-1,at=G*(_+1)-1,J[V++]=at+G,J[V++]=it,J[V++]=at,J[V++]=at+G,J[V++]=it+G,J[V++]=it}var ot=new s.GeometryAttributes;F.position&&(ot.position=new m.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:S}));var mt,st=0,ut=0,lt=0,ft=0,ct=R/2,dt=r.Ellipsoid.fromCartesian3(a),Ct=r.Ellipsoid.fromCartesian3(f);if(F.st||F.normal||F.tangent||F.bitangent){for(_=0;_<R;_++){mt=U[_]?Ct:dt;var pt=r.Cartesian3.fromArray(S,3*_,c),yt=mt.geodeticSurfaceNormal(pt,d);if(B[_]&&r.Cartesian3.negate(yt,yt),F.st){var _t=r.Cartesian2.negate(yt,y);q[st++]=Math.atan2(_t.y,_t.x)/i.CesiumMath.TWO_PI+.5,q[st++]=Math.asin(yt.z)/Math.PI+.5}if(F.normal&&(X[ut++]=yt.x,X[ut++]=yt.y,X[ut++]=yt.z),F.tangent||F.bitangent){var vt,ht=C,At=0;if(U[_]&&(At=ct),vt=!E&&_>=At&&_<At+2*G?r.Cartesian3.UNIT_X:r.Cartesian3.UNIT_Z,r.Cartesian3.cross(vt,yt,ht),r.Cartesian3.normalize(ht,ht),F.tangent&&(Z[lt++]=ht.x,Z[lt++]=ht.y,Z[lt++]=ht.z),F.bitangent){var xt=r.Cartesian3.cross(yt,ht,p);r.Cartesian3.normalize(xt,xt),j[ft++]=xt.x,j[ft++]=xt.y,j[ft++]=xt.z}}}F.st&&(ot.st=new m.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:q})),F.normal&&(ot.normal=new m.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:X})),F.tangent&&(ot.tangent=new m.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:Z})),F.bitangent&&(ot.bitangent=new m.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:j}))}if(e.defined(t._offsetAttribute)){var bt=S.length,kt=new Uint8Array(bt/3),wt=t._offsetAttribute===l.GeometryOffsetAttribute.NONE?0:1;l.arrayFill(kt,wt),ot.applyOffset=new m.GeometryAttribute({componentDatatype:o.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:kt})}return new m.Geometry({attributes:ot,indices:J,primitiveType:m.PrimitiveType.TRIANGLES,boundingSphere:n.BoundingSphere.fromEllipsoid(dt),offsetAttribute:t._offsetAttribute})}}},A.getUnitEllipsoid=function(){return e.defined(x)||(x=A.createGeometry(new A({radii:new r.Cartesian3(1,1,1),vertexFormat:f.VertexFormat.POSITION_ONLY}))),x},t.EllipsoidGeometry=A}));
