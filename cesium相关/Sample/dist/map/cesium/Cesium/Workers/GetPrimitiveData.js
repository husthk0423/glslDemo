define(["./when-c2e8ef35","./Check-c4f3a3fc","./Math-d30358ed","./Cartesian2-f9492f23","./BoundingSphere-dcb1d5fc","./Transforms-8b7e0d39","./RuntimeError-6122571f","./Rectangle-3285eeb3","./WebGLConstants-4ae0db90","./ComponentDatatype-5d3f6452","./GeometryAttribute-a5c051b9","./GeometryAttributes-57608efc","./AttributeCompression-72a6590f","./GeometryPipeline-01c9df66","./EncodedCartesian3-4f87492e","./IndexDatatype-e3260434","./IntersectionTests-525ff5aa","./Plane-dbdf17bf","./PrimitivePipeline-918bdc06","./WebMercatorProjection-6d7fb40a","./GeometryOffsetAttribute-e6e9672c","./VertexFormat-ad523db1","./GeometryInstance-b1e4a9ef","./arrayRemoveDuplicates-a580a060","./BoundingRectangle-f5c8097c","./EllipsoidTangentPlane-98a8a37e","./ArcType-29cf2197","./EllipsoidRhumbLine-01c8204c","./PolygonPipeline-db004fe0","./PolygonGeometryLibrary-d78156f9","./EllipsoidGeodesic-c0017f17","./PolygonGeometry-3b595c9f","./PolygonOutlineGeometry-8930b722","./Color-73b261ab","./PixelFormat-84ff236c","./GetRidingLanternGeometry"],(function(e,t,a,r,n,i,o,l,s,u,m,c,f,p,d,_,h,g,v,T,x,y,E,C,b,A,P,I,S,w,M,R,D,L,N,F){"use strict";function z(t,a,r,n){t=e.defaultValue(t,1),a=e.defaultValue(a,1),r=e.defaultValue(r,1),n=e.defaultValue(n,1),this.value=new Uint8Array([L.Color.floatToByte(t),L.Color.floatToByte(a),L.Color.floatToByte(r),L.Color.floatToByte(n)])}Object.defineProperties(z.prototype,{componentDatatype:{get:function(){return u.ComponentDatatype.UNSIGNED_BYTE}},componentsPerAttribute:{get:function(){return 4}},normalize:{get:function(){return!0}}}),z.fromColor=function(e){return new z(e.red,e.green,e.blue,e.alpha)},z.toValue=function(t,a){return e.defined(a)?t.toBytes(a):new Uint8Array(t.toBytes())},z.equals=function(t,a){return t===a||e.defined(t)&&e.defined(a)&&t.value[0]===a.value[0]&&t.value[1]===a.value[1]&&t.value[2]===a.value[2]&&t.value[3]===a.value[3]};var O={ADD:s.WebGLConstants.FUNC_ADD,SUBTRACT:s.WebGLConstants.FUNC_SUBTRACT,REVERSE_SUBTRACT:s.WebGLConstants.FUNC_REVERSE_SUBTRACT,MIN:s.WebGLConstants.MIN,MAX:s.WebGLConstants.MAX},U=Object.freeze(O),B={ZERO:s.WebGLConstants.ZERO,ONE:s.WebGLConstants.ONE,SOURCE_COLOR:s.WebGLConstants.SRC_COLOR,ONE_MINUS_SOURCE_COLOR:s.WebGLConstants.ONE_MINUS_SRC_COLOR,DESTINATION_COLOR:s.WebGLConstants.DST_COLOR,ONE_MINUS_DESTINATION_COLOR:s.WebGLConstants.ONE_MINUS_DST_COLOR,SOURCE_ALPHA:s.WebGLConstants.SRC_ALPHA,ONE_MINUS_SOURCE_ALPHA:s.WebGLConstants.ONE_MINUS_SRC_ALPHA,DESTINATION_ALPHA:s.WebGLConstants.DST_ALPHA,ONE_MINUS_DESTINATION_ALPHA:s.WebGLConstants.ONE_MINUS_DST_ALPHA,CONSTANT_COLOR:s.WebGLConstants.CONSTANT_COLOR,ONE_MINUS_CONSTANT_COLOR:s.WebGLConstants.ONE_MINUS_CONSTANT_COLOR,CONSTANT_ALPHA:s.WebGLConstants.CONSTANT_ALPHA,ONE_MINUS_CONSTANT_ALPHA:s.WebGLConstants.ONE_MINUS_CONSTANT_ALPHA,SOURCE_ALPHA_SATURATE:s.WebGLConstants.SRC_ALPHA_SATURATE},V=Object.freeze(B),G={DISABLED:Object.freeze({enabled:!1}),ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:U.ADD,equationAlpha:U.ADD,functionSourceRgb:V.SOURCE_ALPHA,functionSourceAlpha:V.ONE,functionDestinationRgb:V.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:V.ONE_MINUS_SOURCE_ALPHA}),PRE_MULTIPLIED_ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:U.ADD,equationAlpha:U.ADD,functionSourceRgb:V.ONE,functionSourceAlpha:V.ONE,functionDestinationRgb:V.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:V.ONE_MINUS_SOURCE_ALPHA}),ADDITIVE_BLEND:Object.freeze({enabled:!0,equationRgb:U.ADD,equationAlpha:U.ADD,functionSourceRgb:V.SOURCE_ALPHA,functionSourceAlpha:V.ONE,functionDestinationRgb:V.ONE,functionDestinationAlpha:V.ONE})},W=Object.freeze(G),k={FRONT:s.WebGLConstants.FRONT,BACK:s.WebGLConstants.BACK,FRONT_AND_BACK:s.WebGLConstants.FRONT_AND_BACK},Y=Object.freeze(k);function H(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.material=t.material,this.translucent=e.defaultValue(t.translucent,!0),this._vertexShaderSource=t.vertexShaderSource,this._fragmentShaderSource=t.fragmentShaderSource,this._renderState=t.renderState,this._closed=e.defaultValue(t.closed,!1)}function X(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function j(){return!0}function K(e,t){function a(){}for(var r in e)"function"==typeof e[r]&&(e[r]=a);e.isDestroyed=j}function Z(){if(!e.defined(te._canTransferArrayBuffer)){var t=new Worker(Q("Workers/transferTypedArrayTest.js"));t.postMessage=e.defaultValue(t.webkitPostMessage,t.postMessage);var a=new Int8Array([99]);try{t.postMessage({array:a},[a.buffer])}catch(e){return te._canTransferArrayBuffer=!1,te._canTransferArrayBuffer}var r=e.when.defer();t.onmessage=function(a){var n=a.data.array,i=e.defined(n)&&99===n[0];r.resolve(i),t.terminate(),te._canTransferArrayBuffer=i},te._canTransferArrayBuffer=r.promise}return te._canTransferArrayBuffer}Object.defineProperties(H.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}}}),H.prototype.getFragmentShaderSource=function(){var t=[];return t.push("varying vec4 v_endPlaneNormalEcAndBatchId;"),this.flat&&t.push("#define FLAT"),this.faceForward&&t.push("#define FACE_FORWARD"),e.defined(this.material)&&t.push(this.material.shaderSource),t.push(this.fragmentShaderSource),t.join("\n")},H.prototype.isTranslucent=function(){return e.defined(this.material)&&this.material.isTranslucent()||!e.defined(this.material)&&this.translucent},H.prototype.getRenderState=function(){var e=this.isTranslucent(),t=i.clone(this.renderState,!1);return e?(t.depthMask=!1,t.blending=W.ALPHA_BLEND):t.depthMask=!0,t},H.getDefaultRenderState=function(t,a,r){var n={depthTest:{enabled:!0}};return t&&(n.depthMask=!1,n.blending=W.ALPHA_BLEND),a&&(n.cull={enabled:!0,face:Y.BACK}),e.defined(r)&&(n=i.combine(r,n,!0)),n};var q,J=new i.Event;function $(a,r){--a._activeTasks;var n=r.id;if(e.defined(n)){var i=a._deferreds,l=i[n];if(e.defined(r.error)){var s=r.error;"RuntimeError"===s.name?(s=new o.RuntimeError(r.error.message)).stack=r.error.stack:"DeveloperError"===s.name&&((s=new t.DeveloperError(r.error.message)).stack=r.error.stack),J.raiseEvent(s),l.reject(s)}else J.raiseEvent(),l.resolve(r.result);delete i[n]}}function Q(e){var t=i.buildModuleUrl(e);if(i.isCrossOriginUrl(t)){var a,r='importScripts("'+t+'");';try{a=new Blob([r],{type:"application/javascript"})}catch(e){var n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);n.append(r),a=n.getBlob("application/javascript")}t=(window.URL||window.webkitURL).createObjectURL(a)}return t}function ee(t){var a=new Worker((e.defined(q)||(q=Q("Workers/cesiumWorkerBootstrapper.js")),q));a.postMessage=e.defaultValue(a.webkitPostMessage,a.postMessage);var r={loaderConfig:{paths:{Workers:i.buildModuleUrl("Workers")},baseUrl:i.buildModuleUrl.getCesiumBaseUrl().url},workerModule:te._workerModulePrefix+t._workerName};return a.postMessage(r),a.onmessage=function(e){$(t,e.data)},a}function te(t,a){this._workerName=t,this._maximumActiveTasks=e.defaultValue(a,5),this._activeTasks=0,this._deferreds={},this._nextID=0}var ae=[];te.prototype.scheduleTask=function(t,a){if(e.defined(this._worker)||(this._worker=ee(this)),!(this._activeTasks>=this._maximumActiveTasks)){++this._activeTasks;var r=this;return e.when(Z(),(function(n){e.defined(a)?n||(a.length=0):a=ae;var i=r._nextID++,o=e.when.defer();return r._deferreds[i]=o,r._worker.postMessage({id:i,parameters:t,canTransferArrayBuffer:n},a),o.promise}))}},te.prototype.initWebAssemblyModule=function(t){e.defined(this._worker)||(this._worker=ee(this));var a=e.when.defer(),r=this,n=this._worker;return function(t,a){var r={modulePath:void 0,wasmBinaryFile:void 0,wasmBinary:void 0};if(!i.FeatureDetection.supportsWebAssembly()){if(!e.defined(a.fallbackModulePath))throw new o.RuntimeError("This browser does not support Web Assembly, and no backup module was provided for "+t._workerName);return r.modulePath=i.buildModuleUrl(a.fallbackModulePath),e.when.resolve(r)}return r.modulePath=i.buildModuleUrl(a.modulePath),r.wasmBinaryFile=i.buildModuleUrl(a.wasmBinaryFile),i.Resource.fetchArrayBuffer({url:r.wasmBinaryFile}).then((function(e){return r.wasmBinary=e,r}))}(this,t).then((function(t){return e.when(Z(),(function(i){var o,l=t.wasmBinary;e.defined(l)&&i&&(o=[l]),n.onmessage=function(e){n.onmessage=function(e){$(r,e.data)},a.resolve(e.data)},n.postMessage({webAssemblyConfig:t},o)}))})),a},te.prototype.isDestroyed=function(){return!1},te.prototype.destroy=function(){return e.defined(this._worker)&&this._worker.terminate(),K(this)},te.taskCompletedEvent=J,te._defaultWorkerModulePrefix="Workers/",te._workerModulePrefix=te._defaultWorkerModulePrefix,te._canTransferArrayBuffer=void 0;var re=new te("transcodeCRNToDXT",Number.POSITIVE_INFINITY);function ne(t){var a;t instanceof ArrayBuffer||ArrayBuffer.isView(t)?a=e.when.resolve(t):a=i.Resource.createIfNeeded(t).fetchArrayBuffer();if(e.defined(a))return a.then((function(t){if(e.defined(t))return function(t){var a,r,n,i=new Uint8Array(t),l=!0;for(a=0;a<ie.length;++a)if(ie[a]!==i[a]){l=!1;break}if(!l)throw new o.RuntimeError("Invalid KTX file.");e.defined(t.buffer)?(r=new DataView(t.buffer),n=t.byteOffset):(r=new DataView(t),n=0);n+=12;var u=r.getUint32(n,!0);if(n+=4,u!==oe)throw new o.RuntimeError("File is the wrong endianness.");var m=r.getUint32(n,!0);n+=4;var c=r.getUint32(n,!0);n+=4;var f=r.getUint32(n,!0);n+=4;var p=r.getUint32(n,!0);n+=4;var d=r.getUint32(n,!0);n+=4;var _=r.getUint32(n,!0);n+=4;var h=r.getUint32(n,!0);n+=4;var g=r.getUint32(n,!0);n+=4;var v=r.getUint32(n,!0);n+=4;var T=r.getUint32(n,!0);n+=4;var x=r.getUint32(n,!0);n+=4;var y=r.getUint32(n,!0);n+=4,n+=y;var E,C=r.getUint32(n,!0);n+=4,E=e.defined(t.buffer)?new Uint8Array(t.buffer,n,C):new Uint8Array(t,n,C);p===s.WebGLConstants.RGB8?p=N.PixelFormat.RGB:p===s.WebGLConstants.RGBA8&&(p=N.PixelFormat.RGBA);if(!N.PixelFormat.validate(p))throw new o.RuntimeError("glInternalFormat is not a valid format.");if(N.PixelFormat.isCompressedFormat(p)){if(0!==m)throw new o.RuntimeError("glType must be zero when the texture is compressed.");if(1!==c)throw new o.RuntimeError("The type size for compressed textures must be 1.");if(0!==f)throw new o.RuntimeError("glFormat must be zero when the texture is compressed.")}else{if(m!==s.WebGLConstants.UNSIGNED_BYTE)throw new o.RuntimeError("Only unsigned byte buffers are supported.");if(d!==f)throw new o.RuntimeError("The base internal format must be the same as the format for uncompressed textures.")}if(0!==g)throw new o.RuntimeError("3D textures are unsupported.");if(0!==v)throw new o.RuntimeError("Texture arrays are unsupported.");var b=E.byteOffset,A=new Array(x);for(a=0;a<x;++a){for(var P=A[a]={},I=0;I<T;++I){var S=_>>a,w=h>>a,M=N.PixelFormat.isCompressedFormat(p)?N.PixelFormat.compressedTextureSizeInBytes(p,S,w):N.PixelFormat.textureSizeInBytes(p,m,S,w),R=new Uint8Array(E.buffer,b,M);P[le[I]]=new N.CompressedTextureBuffer(p,S,w,R),b+=M}b+=3-(b+3)%4+4}var D=A;if(1===T)for(a=0;a<x;++a)D[a]=D[a][le[0]];1===x&&(D=D[0]);return D}(t)}))}var ie=[171,75,84,88,32,49,49,187,13,10,26,10],oe=67305985,le=["positiveX","negativeX","positiveY","negativeY","positiveZ","negativeZ"];var se={_maximumCombinedTextureImageUnits:0,_maximumCubeMapSize:0,_maximumFragmentUniformVectors:0,_maximumTextureImageUnits:0,_maximumRenderbufferSize:0,_maximumTextureSize:0,_maximumVaryingVectors:0,_maximumVertexAttributes:0,_maximumVertexTextureImageUnits:0,_maximumVertexUniformVectors:0,_minimumAliasedLineWidth:0,_maximumAliasedLineWidth:0,_minimumAliasedPointSize:0,_maximumAliasedPointSize:0,_maximumViewportWidth:0,_maximumViewportHeight:0,_maximumTextureFilterAnisotropy:0,_maximumDrawBuffers:0,_maximumColorAttachments:0,_highpFloatSupported:!1,_highpIntSupported:!1};function ue(e,t,a,r,n,i,o,l,s,u){this._gl=e,this._texture=t,this._textureTarget=a,this._targetFace=r,this._pixelFormat=n,this._pixelDatatype=i,this._size=o,this._preMultiplyAlpha=l,this._flipY=s,this._initialized=u}Object.defineProperties(se,{maximumCombinedTextureImageUnits:{get:function(){return se._maximumCombinedTextureImageUnits}},maximumCubeMapSize:{get:function(){return se._maximumCubeMapSize}},maximumFragmentUniformVectors:{get:function(){return se._maximumFragmentUniformVectors}},maximumTextureImageUnits:{get:function(){return se._maximumTextureImageUnits}},maximumRenderbufferSize:{get:function(){return se._maximumRenderbufferSize}},maximumTextureSize:{get:function(){return se._maximumTextureSize}},maximumVaryingVectors:{get:function(){return se._maximumVaryingVectors}},maximumVertexAttributes:{get:function(){return se._maximumVertexAttributes}},maximumVertexTextureImageUnits:{get:function(){return se._maximumVertexTextureImageUnits}},maximumVertexUniformVectors:{get:function(){return se._maximumVertexUniformVectors}},minimumAliasedLineWidth:{get:function(){return se._minimumAliasedLineWidth}},maximumAliasedLineWidth:{get:function(){return se._maximumAliasedLineWidth}},minimumAliasedPointSize:{get:function(){return se._minimumAliasedPointSize}},maximumAliasedPointSize:{get:function(){return se._maximumAliasedPointSize}},maximumViewportWidth:{get:function(){return se._maximumViewportWidth}},maximumViewportHeight:{get:function(){return se._maximumViewportHeight}},maximumTextureFilterAnisotropy:{get:function(){return se._maximumTextureFilterAnisotropy}},maximumDrawBuffers:{get:function(){return se._maximumDrawBuffers}},maximumColorAttachments:{get:function(){return se._maximumColorAttachments}},highpFloatSupported:{get:function(){return se._highpFloatSupported}},highpIntSupported:{get:function(){return se._highpIntSupported}}}),Object.defineProperties(ue.prototype,{pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},_target:{get:function(){return this._targetFace}}}),ue.prototype.copyFrom=function(t,a,r){a=e.defaultValue(a,0),r=e.defaultValue(r,0);var n=this._gl,i=this._textureTarget,o=this._targetFace;n.activeTexture(n.TEXTURE0),n.bindTexture(i,this._texture);var l=t.width,s=t.height,u=t.arrayBufferView,m=this._size,c=this._pixelFormat,f=this._pixelDatatype,p=this._preMultiplyAlpha,d=this._flipY,_=4;e.defined(u)&&(_=N.PixelFormat.alignmentInBytes(c,f,l)),n.pixelStorei(n.UNPACK_ALIGNMENT,_);var h=!1;if(!this._initialized){if(0===a&&0===r&&l===m&&s===m)e.defined(u)?(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),d&&(u=N.PixelFormat.flipY(u,c,f,m,m)),n.texImage2D(o,0,c,m,m,0,c,f,u)):(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,d),n.texImage2D(o,0,c,c,f,t)),h=!0;else{n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);var g=N.PixelFormat.createTypedArray(c,f,m,m);n.texImage2D(o,0,c,m,m,0,c,f,g)}this._initialized=!0}h||(e.defined(u)?(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),d&&(u=N.PixelFormat.flipY(u,c,f,l,s)),n.texSubImage2D(o,0,a,r,l,s,c,f,u)):(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,d),n.texSubImage2D(o,0,a,r,c,f,t))),n.bindTexture(i,null)},ue.prototype.copyFromFramebuffer=function(t,a,r,n,i,o){t=e.defaultValue(t,0),a=e.defaultValue(a,0),r=e.defaultValue(r,0),n=e.defaultValue(n,0),i=e.defaultValue(i,this._size),o=e.defaultValue(o,this._size);var l=this._gl,s=this._textureTarget;l.activeTexture(l.TEXTURE0),l.bindTexture(s,this._texture),l.copyTexSubImage2D(this._targetFace,0,t,a,r,n,i,o),l.bindTexture(s,null),this._initialized=!0};var me={DONT_CARE:s.WebGLConstants.DONT_CARE,FASTEST:s.WebGLConstants.FASTEST,NICEST:s.WebGLConstants.NICEST,validate:function(e){return e===me.DONT_CARE||e===me.FASTEST||e===me.NICEST}},ce=Object.freeze(me),fe={NEAREST:s.WebGLConstants.NEAREST,LINEAR:s.WebGLConstants.LINEAR,validate:function(e){return e===fe.NEAREST||e===fe.LINEAR}},pe=Object.freeze(fe),de={NEAREST:s.WebGLConstants.NEAREST,LINEAR:s.WebGLConstants.LINEAR,NEAREST_MIPMAP_NEAREST:s.WebGLConstants.NEAREST_MIPMAP_NEAREST,LINEAR_MIPMAP_NEAREST:s.WebGLConstants.LINEAR_MIPMAP_NEAREST,NEAREST_MIPMAP_LINEAR:s.WebGLConstants.NEAREST_MIPMAP_LINEAR,LINEAR_MIPMAP_LINEAR:s.WebGLConstants.LINEAR_MIPMAP_LINEAR,validate:function(e){return e===de.NEAREST||e===de.LINEAR||e===de.NEAREST_MIPMAP_NEAREST||e===de.LINEAR_MIPMAP_NEAREST||e===de.NEAREST_MIPMAP_LINEAR||e===de.LINEAR_MIPMAP_LINEAR}},_e=Object.freeze(de),he={CLAMP_TO_EDGE:s.WebGLConstants.CLAMP_TO_EDGE,REPEAT:s.WebGLConstants.REPEAT,MIRRORED_REPEAT:s.WebGLConstants.MIRRORED_REPEAT,validate:function(e){return e===he.CLAMP_TO_EDGE||e===he.REPEAT||e===he.MIRRORED_REPEAT}},ge=Object.freeze(he);function ve(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT);var a=e.defaultValue(t.wrapS,ge.CLAMP_TO_EDGE),r=e.defaultValue(t.wrapT,ge.CLAMP_TO_EDGE),n=e.defaultValue(t.minificationFilter,_e.LINEAR),i=e.defaultValue(t.magnificationFilter,pe.LINEAR),o=e.defined(t.maximumAnisotropy)?t.maximumAnisotropy:1;this._wrapS=a,this._wrapT=r,this._minificationFilter=n,this._magnificationFilter=i,this._maximumAnisotropy=o}function Te(t){var a,r=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).context,n=t.source;if(e.defined(n)){var i=[n.positiveX,n.negativeX,n.positiveY,n.negativeY,n.positiveZ,n.negativeZ];a=i[0].width,i[0].height}else a=t.width,t.height;var o=a,l=e.defaultValue(t.pixelFormat,N.PixelFormat.RGBA),s=e.defaultValue(t.pixelDatatype,N.PixelDatatype.UNSIGNED_BYTE),u=6*N.PixelFormat.textureSizeInBytes(l,s,o,o),m=t.preMultiplyAlpha||l===N.PixelFormat.RGB||l===N.PixelFormat.LUMINANCE,c=e.defaultValue(t.flipY,!0),f=r._gl,p=f.TEXTURE_CUBE_MAP,d=f.createTexture();function _(t,r,n,i){var u=r.arrayBufferView;e.defined(u)||(u=r.bufferView);var m=4;e.defined(u)&&(m=N.PixelFormat.alignmentInBytes(l,s,a)),f.pixelStorei(f.UNPACK_ALIGNMENT,m),e.defined(u)?(f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1),i&&(u=N.PixelFormat.flipY(u,l,s,o,o)),f.texImage2D(t,0,l,o,o,0,l,s,u)):(f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,i),f.texImage2D(t,0,l,l,s,r))}f.activeTexture(f.TEXTURE0),f.bindTexture(p,d),e.defined(n)?(_(f.TEXTURE_CUBE_MAP_POSITIVE_X,n.positiveX,m,c),_(f.TEXTURE_CUBE_MAP_NEGATIVE_X,n.negativeX,m,c),_(f.TEXTURE_CUBE_MAP_POSITIVE_Y,n.positiveY,m,c),_(f.TEXTURE_CUBE_MAP_NEGATIVE_Y,n.negativeY,m,c),_(f.TEXTURE_CUBE_MAP_POSITIVE_Z,n.positiveZ,m,c),_(f.TEXTURE_CUBE_MAP_NEGATIVE_Z,n.negativeZ,m,c)):(f.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X,0,l,o,o,0,l,s,null),f.texImage2D(f.TEXTURE_CUBE_MAP_NEGATIVE_X,0,l,o,o,0,l,s,null),f.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_Y,0,l,o,o,0,l,s,null),f.texImage2D(f.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,l,o,o,0,l,s,null),f.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_Z,0,l,o,o,0,l,s,null),f.texImage2D(f.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,l,o,o,0,l,s,null)),f.bindTexture(p,null),this._context=r,this._textureFilterAnisotropic=r._textureFilterAnisotropic,this._textureTarget=p,this._texture=d,this._pixelFormat=l,this._pixelDatatype=s,this._size=o,this._hasMipmap=!1,this._sizeInBytes=u,this._preMultiplyAlpha=m,this._flipY=c,this._sampler=void 0;var h=e.defined(n);this._positiveX=new ue(f,d,p,f.TEXTURE_CUBE_MAP_POSITIVE_X,l,s,o,m,c,h),this._negativeX=new ue(f,d,p,f.TEXTURE_CUBE_MAP_NEGATIVE_X,l,s,o,m,c,h),this._positiveY=new ue(f,d,p,f.TEXTURE_CUBE_MAP_POSITIVE_Y,l,s,o,m,c,h),this._negativeY=new ue(f,d,p,f.TEXTURE_CUBE_MAP_NEGATIVE_Y,l,s,o,m,c,h),this._positiveZ=new ue(f,d,p,f.TEXTURE_CUBE_MAP_POSITIVE_Z,l,s,o,m,c,h),this._negativeZ=new ue(f,d,p,f.TEXTURE_CUBE_MAP_NEGATIVE_Z,l,s,o,m,c,h),this.sampler=e.defined(t.sampler)?t.sampler:new ve}function xe(t){var a=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).context,n=t.width,i=t.height,o=t.source;e.defined(o)&&(e.defined(n)||(n=e.defaultValue(o.videoWidth,o.width)),e.defined(i)||(i=e.defaultValue(o.videoHeight,o.height)));var l=e.defaultValue(t.pixelFormat,N.PixelFormat.RGBA),u=e.defaultValue(t.pixelDatatype,N.PixelDatatype.UNSIGNED_BYTE),m=l,c=N.PixelFormat.isCompressedFormat(m);if(a.webgl2)if(l===N.PixelFormat.DEPTH_STENCIL?m=s.WebGLConstants.DEPTH24_STENCIL8:l===N.PixelFormat.DEPTH_COMPONENT&&(u===N.PixelDatatype.UNSIGNED_SHORT?m=s.WebGLConstants.DEPTH_COMPONENT16:u===N.PixelDatatype.UNSIGNED_INT&&(m=s.WebGLConstants.DEPTH_COMPONENT24)),u===N.PixelDatatype.FLOAT)switch(l){case N.PixelFormat.RGBA:m=s.WebGLConstants.RGBA32F;break;case N.PixelFormat.RGB:m=s.WebGLConstants.RGB32F;break;case N.PixelFormat.RG:m=s.WebGLConstants.RG32F;break;case N.PixelFormat.R:m=s.WebGLConstants.R32F}else if(u===N.PixelDatatype.HALF_FLOAT)switch(l){case N.PixelFormat.RGBA:m=s.WebGLConstants.RGBA16F;break;case N.PixelFormat.RGB:m=s.WebGLConstants.RGB16F;break;case N.PixelFormat.RG:m=s.WebGLConstants.RG16F;break;case N.PixelFormat.R:m=s.WebGLConstants.R16F}var f=t.preMultiplyAlpha||l===N.PixelFormat.RGB||l===N.PixelFormat.LUMINANCE,p=e.defaultValue(t.flipY,!0),d=!0,_=a._gl,h=_.TEXTURE_2D,g=_.createTexture();_.activeTexture(_.TEXTURE0),_.bindTexture(h,g);var v,T=4;if(e.defined(o)&&e.defined(o.arrayBufferView)&&!c&&(T=N.PixelFormat.alignmentInBytes(l,u,n)),_.pixelStorei(_.UNPACK_ALIGNMENT,T),e.defined(o))if(e.defined(o.arrayBufferView)){_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,!1);var x=o.arrayBufferView;c?_.compressedTexImage2D(h,0,m,n,i,0,x):(p&&(x=N.PixelFormat.flipY(x,l,u,n,i)),_.texImage2D(h,0,m,n,i,0,l,u,x))}else e.defined(o.framebuffer)?(_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,!1),o.framebuffer!==a.defaultFramebuffer&&o.framebuffer._bind(),_.copyTexImage2D(h,0,m,o.xOffset,o.yOffset,n,i,0),o.framebuffer!==a.defaultFramebuffer&&o.framebuffer._unBind()):(_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,p),_.texImage2D(h,0,m,l,u,o));else _.texImage2D(h,0,m,n,i,0,l,u,null),d=!1;_.bindTexture(h,null),v=c?N.PixelFormat.compressedTextureSizeInBytes(l,n,i):N.PixelFormat.textureSizeInBytes(l,u,n,i),this._id=X(),this._context=a,this._textureFilterAnisotropic=a._textureFilterAnisotropic,this._textureTarget=h,this._texture=g,this._pixelFormat=l,this._pixelDatatype=u,this._width=n,this._height=i,this._dimensions=new r.Cartesian2(n,i),this._hasMipmap=!1,this._sizeInBytes=v,this._preMultiplyAlpha=f,this._flipY=p,this._initialized=d,this._sampler=void 0,this.sampler=e.defined(t.sampler)?t.sampler:new ve}Object.defineProperties(ve.prototype,{wrapS:{get:function(){return this._wrapS}},wrapT:{get:function(){return this._wrapT}},minificationFilter:{get:function(){return this._minificationFilter}},magnificationFilter:{get:function(){return this._magnificationFilter}},maximumAnisotropy:{get:function(){return this._maximumAnisotropy}}}),ve.equals=function(t,a){return t===a||e.defined(t)&&e.defined(a)&&t._wrapS===a._wrapS&&t._wrapT===a._wrapT&&t._minificationFilter===a._minificationFilter&&t._magnificationFilter===a._magnificationFilter&&t._maximumAnisotropy===a._maximumAnisotropy},ve.NEAREST=Object.freeze(new ve({wrapS:ge.CLAMP_TO_EDGE,wrapT:ge.CLAMP_TO_EDGE,minificationFilter:_e.NEAREST,magnificationFilter:pe.NEAREST})),Object.defineProperties(Te.prototype,{positiveX:{get:function(){return this._positiveX}},negativeX:{get:function(){return this._negativeX}},positiveY:{get:function(){return this._positiveY}},negativeY:{get:function(){return this._negativeY}},positiveZ:{get:function(){return this._positiveZ}},negativeZ:{get:function(){return this._negativeZ}},sampler:{get:function(){return this._sampler},set:function(t){var a=t.minificationFilter,r=t.magnificationFilter,n=a===_e.NEAREST_MIPMAP_NEAREST||a===_e.NEAREST_MIPMAP_LINEAR||a===_e.LINEAR_MIPMAP_NEAREST||a===_e.LINEAR_MIPMAP_LINEAR,i=this._context,o=this._pixelDatatype;(o===N.PixelDatatype.FLOAT&&!i.textureFloatLinear||o===N.PixelDatatype.HALF_FLOAT&&!i.textureHalfFloatLinear)&&(a=n?_e.NEAREST_MIPMAP_NEAREST:_e.NEAREST,r=pe.NEAREST);var l=i._gl,s=this._textureTarget;l.activeTexture(l.TEXTURE0),l.bindTexture(s,this._texture),l.texParameteri(s,l.TEXTURE_MIN_FILTER,a),l.texParameteri(s,l.TEXTURE_MAG_FILTER,r),l.texParameteri(s,l.TEXTURE_WRAP_S,t.wrapS),l.texParameteri(s,l.TEXTURE_WRAP_T,t.wrapT),e.defined(this._textureFilterAnisotropic)&&l.texParameteri(s,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.maximumAnisotropy),l.bindTexture(s,null),this._sampler=t}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},width:{get:function(){return this._size}},height:{get:function(){return this._size}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},_target:{get:function(){return this._textureTarget}}}),Te.prototype.generateMipmap=function(t){t=e.defaultValue(t,ce.DONT_CARE),this._hasMipmap=!0;var a=this._context._gl,r=this._textureTarget;a.hint(a.GENERATE_MIPMAP_HINT,t),a.activeTexture(a.TEXTURE0),a.bindTexture(r,this._texture),a.generateMipmap(r),a.bindTexture(r,null)},Te.prototype.isDestroyed=function(){return!1},Te.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),this._positiveX=K(this._positiveX),this._negativeX=K(this._negativeX),this._positiveY=K(this._positiveY),this._negativeY=K(this._negativeY),this._positiveZ=K(this._positiveZ),this._negativeZ=K(this._negativeZ),K(this)},xe.create=function(e){return new xe(e)},xe.fromFramebuffer=function(t){var a=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).context,r=a._gl,n=e.defaultValue(t.pixelFormat,N.PixelFormat.RGB),i=e.defaultValue(t.framebufferXOffset,0),o=e.defaultValue(t.framebufferYOffset,0),l=e.defaultValue(t.width,r.drawingBufferWidth),s=e.defaultValue(t.height,r.drawingBufferHeight),u=t.framebuffer;return new xe({context:a,width:l,height:s,pixelFormat:n,source:{framebuffer:e.defined(u)?u:a.defaultFramebuffer,xOffset:i,yOffset:o,width:l,height:s}})},Object.defineProperties(xe.prototype,{id:{get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(t){var a=t.minificationFilter,r=t.magnificationFilter,n=a===_e.NEAREST_MIPMAP_NEAREST||a===_e.NEAREST_MIPMAP_LINEAR||a===_e.LINEAR_MIPMAP_NEAREST||a===_e.LINEAR_MIPMAP_LINEAR,i=this._context,o=this._pixelDatatype;(o===N.PixelDatatype.FLOAT&&!i.textureFloatLinear||o===N.PixelDatatype.HALF_FLOAT&&!i.textureHalfFloatLinear)&&(a=n?_e.NEAREST_MIPMAP_NEAREST:_e.NEAREST,r=pe.NEAREST);var l=i._gl,s=this._textureTarget;l.activeTexture(l.TEXTURE0),l.bindTexture(s,this._texture),l.texParameteri(s,l.TEXTURE_MIN_FILTER,a),l.texParameteri(s,l.TEXTURE_MAG_FILTER,r),l.texParameteri(s,l.TEXTURE_WRAP_S,t.wrapS),l.texParameteri(s,l.TEXTURE_WRAP_T,t.wrapT),e.defined(this._textureFilterAnisotropic)&&l.texParameteri(s,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.maximumAnisotropy),l.bindTexture(s,null),this._sampler=t}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}}}),xe.prototype.copyFrom=function(t,a,r){a=e.defaultValue(a,0),r=e.defaultValue(r,0);var n=this._context._gl,i=this._textureTarget;n.activeTexture(n.TEXTURE0),n.bindTexture(i,this._texture);var o=t.width,l=t.height,s=t.arrayBufferView,u=this._width,m=this._height,c=this._pixelFormat,f=this._pixelDatatype,p=this._preMultiplyAlpha,d=this._flipY,_=4;e.defined(s)&&(_=N.PixelFormat.alignmentInBytes(c,f,o)),n.pixelStorei(n.UNPACK_ALIGNMENT,_);var h=!1;if(!this._initialized){if(0===a&&0===r&&o===u&&l===m)e.defined(s)?(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),d&&(s=N.PixelFormat.flipY(s,c,f,u,m)),n.texImage2D(i,0,c,u,m,0,c,f,s)):(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,d),n.texImage2D(i,0,c,c,f,t)),h=!0;else{n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);var g=N.PixelFormat.createTypedArray(c,f,u,m);n.texImage2D(i,0,c,u,m,0,c,f,g)}this._initialized=!0}h||(e.defined(s)?(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),d&&(s=N.PixelFormat.flipY(s,c,f,o,l)),n.texSubImage2D(i,0,a,r,o,l,c,f,s)):(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,d),n.texSubImage2D(i,0,a,r,c,f,t))),n.bindTexture(i,null)},xe.prototype.copyFromFramebuffer=function(t,a,r,n,i,o){t=e.defaultValue(t,0),a=e.defaultValue(a,0),r=e.defaultValue(r,0),n=e.defaultValue(n,0),i=e.defaultValue(i,this._width),o=e.defaultValue(o,this._height);var l=this._context._gl,s=this._textureTarget;l.activeTexture(l.TEXTURE0),l.bindTexture(s,this._texture),l.copyTexSubImage2D(s,0,t,a,r,n,i,o),l.bindTexture(s,null),this._initialized=!0},xe.prototype.generateMipmap=function(t){t=e.defaultValue(t,ce.DONT_CARE),this._hasMipmap=!0;var a=this._context._gl,r=this._textureTarget;a.hint(a.GENERATE_MIPMAP_HINT,t),a.activeTexture(a.TEXTURE0),a.bindTexture(r,this._texture),a.generateMipmap(r),a.bindTexture(r,null)},xe.prototype.isDestroyed=function(){return!1},xe.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),K(this)};function ye(t){this.type=void 0,this.shaderSource=void 0,this.materials=void 0,this.uniforms=void 0,this._uniforms=void 0,this.translucent=void 0,this._minificationFilter=e.defaultValue(t.minificationFilter,_e.LINEAR),this._magnificationFilter=e.defaultValue(t.magnificationFilter,pe.LINEAR),this._strict=void 0,this._template=void 0,this._count=void 0,this._texturePaths={},this._loadedImages=[],this._loadedCubeMaps=[],this._textures={},this._updateFunctions=[],this._defaultTexture=void 0,function(t,a){var r;t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),a._strict=e.defaultValue(t.strict,!1),a._count=e.defaultValue(t.count,0),a._template=i.clone(e.defaultValue(t.fabric,e.defaultValue.EMPTY_OBJECT)),a._template.uniforms=i.clone(e.defaultValue(a._template.uniforms,e.defaultValue.EMPTY_OBJECT)),a._template.materials=i.clone(e.defaultValue(a._template.materials,e.defaultValue.EMPTY_OBJECT)),a.type=e.defined(a._template.type)?a._template.type:X(),a.shaderSource="",a.materials={},a.uniforms={},a._uniforms={},a._translucentFunctions=[];var n=ye._materialCache.getMaterial(a.type);if(e.defined(n)){var o=i.clone(n.fabric,!0);a._template=i.combine(a._template,o,!0),r=n.translucent}(function(e){var t=e._template,a=t.uniforms,r=t.materials,n=t.components;Ee(t,Ae,Ce,!0),Ee(n,Pe,Ce,!0);var i=[];for(var o in r)r.hasOwnProperty(o)&&i.push(o);Ee(a,i,be,!1)})(a),e.defined(n)||ye._materialCache.addMaterial(a.type,a);(function(t){var a=t._template.components,r=t._template.source;if(e.defined(r))t.shaderSource+=r+"\n";else{if(t.shaderSource+="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n",t.shaderSource+="czm_material material = czm_getDefaultMaterial(materialInput);\n",e.defined(a)){var n=Object.keys(t._template.materials).length>0;for(var i in a)if(a.hasOwnProperty(i))if("diffuse"===i||"emission"===i){var o=n&&Ie(a[i],t)?a[i]:"czm_gammaCorrect("+a[i]+")";t.shaderSource+="material."+i+" = "+o+"; \n"}else t.shaderSource+="alpha"===i?"material.alpha = "+a.alpha+"; \n":"material."+i+" = "+a[i]+";\n"}t.shaderSource+="return material;\n}\n"}})(a),function(e){var t=e._template.uniforms;for(var a in t)t.hasOwnProperty(a)&&De(e,a)}(a),function(e){var t=e._strict,a=e._template.materials;for(var r in a)if(a.hasOwnProperty(r)){var n=new ye({strict:t,fabric:a[r],count:e._count});e._count=n._count,e._uniforms=i.combine(e._uniforms,n._uniforms,!0),e.materials[r]=n,e._translucentFunctions=e._translucentFunctions.concat(n._translucentFunctions);var o="czm_getMaterial",l=o+"_"+e._count++;Le(n,o,l),e.shaderSource=n.shaderSource+e.shaderSource;Le(e,r,l+"(materialInput)")}}(a);var l=0===a._translucentFunctions.length||void 0;if(r=e.defaultValue(r,l),r=e.defaultValue(t.translucent,r),e.defined(r))if("function"==typeof r){var s=function(){return r(a)};a._translucentFunctions.push(s)}else a._translucentFunctions.push(r)}(t,this),Object.defineProperties(this,{type:{value:this.type,writable:!1}}),e.defined(ye._uniformList[this.type])||(ye._uniformList[this.type]=Object.keys(this._uniforms))}function Ee(t,a,r,n){if(e.defined(t))for(var i in t)if(t.hasOwnProperty(i)){var o=-1!==a.indexOf(i);(n&&!o||!n&&o)&&r(i,a)}}function Ce(e,t){}function be(e,t){}ye._uniformList={},ye.fromType=function(t,a){var r=new ye({fabric:{type:t}});if(e.defined(a))for(var n in a)a.hasOwnProperty(n)&&(r.uniforms[n]=a[n]);return r},ye.prototype.isTranslucent=function(){if(e.defined(this.translucent))return"function"==typeof this.translucent?this.translucent():this.translucent;for(var t=!0,a=this._translucentFunctions,r=a.length,n=0;n<r;++n){var i=a[n];if(!(t="function"==typeof i?t&&i():t&&i))break}return t},ye.prototype.update=function(t){var a,r,n=this._loadedImages,i=n.length;for(a=0;a<i;++a){var o=n[a];r=o.id;var l,s=o.image,u=new ve({minificationFilter:this._minificationFilter,magnificationFilter:this._magnificationFilter});l=e.defined(s.internalFormat)?new xe({context:t,pixelFormat:s.internalFormat,width:s.width,height:s.height,source:{arrayBufferView:s.bufferView},sampler:u}):new xe({context:t,source:s,sampler:u}),this._textures[r]=l;var m=r+"Dimensions";if(this.uniforms.hasOwnProperty(m)){var c=this.uniforms[m];c.x=l._width,c.y=l._height}}n.length=0;var f=this._loadedCubeMaps;for(i=f.length,a=0;a<i;++a){var p=f[a];r=p.id;var d=p.images,_=new Te({context:t,source:{positiveX:d[0],negativeX:d[1],positiveY:d[2],negativeY:d[3],positiveZ:d[4],negativeZ:d[5]},sampler:new ve({minificationFilter:this._minificationFilter,magnificationFilter:this._magnificationFilter})});this._textures[r]=_}f.length=0;var h=this._updateFunctions;for(i=h.length,a=0;a<i;++a)h[a](this,t);var g=this.materials;for(var v in g)g.hasOwnProperty(v)&&g[v].update(t)},ye.prototype.isDestroyed=function(){return!1},ye.prototype.destroy=function(){var e=this._textures;for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];a!==this._defaultTexture&&a.destroy()}var r=this.materials;for(var n in r)r.hasOwnProperty(n)&&r[n].destroy();return K(this)};var Ae=["type","materials","uniforms","components","source"],Pe=["diffuse","specular","shininess","normal","emission","alpha"];function Ie(e,t){var a=t._template.materials;for(var r in a)if(a.hasOwnProperty(r)&&e.indexOf(r)>-1)return!0;return!1}var Se={mat2:m.Matrix2,mat3:i.Matrix3,mat4:i.Matrix4},we=/\.ktx$/i,Me=/\.crn$/i;function Re(t){var a;return function(r,n){var o=r.uniforms,l=o[t],s=a!==l;a=l;var u,m,c=r._textures[t];if(l instanceof HTMLVideoElement)if(l.readyState>=2){if(s&&e.defined(c)&&(c!==n.defaultTexture&&c.destroy(),c=void 0),!e.defined(c)||c===n.defaultTexture)return c=new xe({context:n,source:l,sampler:new ve({minificationFilter:r._minificationFilter,magnificationFilter:r._magnificationFilter})}),void(r._textures[t]=c);c.copyFrom(l)}else e.defined(c)||(r._textures[t]=n.defaultTexture);else{if(l instanceof xe&&l!==c){r._texturePaths[t]=void 0;var f=r._textures[t];return f!==r._defaultTexture&&f.destroy(),r._textures[t]=l,u=t+"Dimensions",void(o.hasOwnProperty(u)&&((m=o[u]).x=l._width,m.y=l._height))}if(e.defined(c)||(r._texturePaths[t]=void 0,e.defined(r._defaultTexture)||(r._defaultTexture=n.defaultTexture),c=r._textures[t]=r._defaultTexture,u=t+"Dimensions",o.hasOwnProperty(u)&&((m=o[u]).x=c._width,m.y=c._height)),l!==ye.DefaultImageId){var p=l instanceof i.Resource;if(!e.defined(r._texturePaths[t])||p&&l.url!==r._texturePaths[t].url||!p&&l!==r._texturePaths[t]){if("string"==typeof l||p){var d,_=p?l:i.Resource.createIfNeeded(l);d=we.test(_.url)?ne(_):Me.test(_.url)?function(t){var a;if(a=t instanceof ArrayBuffer||ArrayBuffer.isView(t)?e.when.resolve(t):i.Resource.createIfNeeded(t).fetchArrayBuffer(),e.defined(a))return a.then((function(t){if(e.defined(t)){var a=[];return t instanceof ArrayBuffer?a.push(t):(0===t.byteOffset&&t.byteLength===t.buffer.byteLength||(t=t.slice(0,t.length)),a.push(t.buffer)),re.scheduleTask(t,a)}})).then((function(e){return N.CompressedTextureBuffer.clone(e)}))}(_):_.fetchImage(),e.when(d,(function(e){r._loadedImages.push({id:t,image:e})}))}else(l instanceof HTMLCanvasElement||l instanceof HTMLImageElement)&&r._loadedImages.push({id:t,image:l});r._texturePaths[t]=l}}}}}function De(t,a){t._strict;var r=t._template.uniforms,n=r[a],o=function(t){var a=t.type;if(!e.defined(a)){var r=typeof t;if("number"===r)a="float";else if("boolean"===r)a="bool";else if("string"===r||t instanceof i.Resource||t instanceof HTMLCanvasElement||t instanceof HTMLImageElement)a=/^([rgba]){1,4}$/i.test(t)?"channels":t===ye.DefaultCubeMapId?"samplerCube":"sampler2D";else if("object"===r)if(Array.isArray(t))4!==t.length&&9!==t.length&&16!==t.length||(a="mat"+Math.sqrt(t.length));else{var n=0;for(var o in t)t.hasOwnProperty(o)&&(n+=1);n>=2&&n<=4?a="vec"+n:6===n&&(a="samplerCube")}}return a}(n);if("channels"===o)Le(t,a,n,!1);else{if("sampler2D"===o){var l=a+"Dimensions";(function(e,t,a){return Le(e,t,t,a)})(t,l)>0&&(r[l]={type:"ivec3",x:1,y:1},De(t,l))}if(!new RegExp("uniform\\s+"+o+"\\s+"+a+"\\s*;").test(t.shaderSource)){var s="uniform "+o+" "+a+";";t.shaderSource=s+t.shaderSource}var u=a+"_"+t._count++;if(Le(t,a,u),t.uniforms[a]=n,"sampler2D"===o)t._uniforms[u]=function(){return t._textures[a]},t._updateFunctions.push(Re(a));else if("samplerCube"===o)t._uniforms[u]=function(){return t._textures[a]},t._updateFunctions.push(function(t){return function(a,r){var n=a.uniforms[t];if(n instanceof Te){var o=a._textures[t];return o!==a._defaultTexture&&o.destroy(),a._texturePaths[t]=void 0,void(a._textures[t]=n)}if(e.defined(a._textures[t])||(a._texturePaths[t]=void 0,a._textures[t]=r.defaultCubeMap),n!==ye.DefaultCubeMapId){var l=n.positiveX+n.negativeX+n.positiveY+n.negativeY+n.positiveZ+n.negativeZ;if(l!==a._texturePaths[t]){var s=[i.Resource.createIfNeeded(n.positiveX).fetchImage(),i.Resource.createIfNeeded(n.negativeX).fetchImage(),i.Resource.createIfNeeded(n.positiveY).fetchImage(),i.Resource.createIfNeeded(n.negativeY).fetchImage(),i.Resource.createIfNeeded(n.positiveZ).fetchImage(),i.Resource.createIfNeeded(n.negativeZ).fetchImage()];e.when.all(s).then((function(e){a._loadedCubeMaps.push({id:t,images:e})})),a._texturePaths[t]=l}}}}(a));else if(-1!==o.indexOf("mat")){var m=new Se[o];t._uniforms[u]=function(){return Se[o].fromColumnMajorArray(t.uniforms[a],m)}}else t._uniforms[u]=function(){return t.uniforms[a]}}}function Le(t,a,r,n){n=e.defaultValue(n,!0);var i=0,o=new RegExp("([\\w"+(n?".":"")+"])?"+a+"([\\w])?","g");return t.shaderSource=t.shaderSource.replace(o,(function(e,t,a){return t||a?e:(i+=1,r)})),i}function Ne(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT);var a=e.defaultValue(t.translucent,!0),r=e.defaultValue(t.aboveGround,!1);this.material=e.defined(t.material)?t.material:ye.fromType(ye.ColorType),this.translucent=e.defaultValue(t.translucent,!0),this._vertexShaderSource=e.defaultValue(t.vertexShaderSource,"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec2 st;\nattribute float batchId;\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_st;\nvoid main()\n{\nvec4 p = czm_computePosition();\nv_positionMC = position3DHigh + position3DLow;\nv_positionEC = (czm_modelViewRelativeToEye * p).xyz;\nv_st = st;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n"),this._fragmentShaderSource=e.defaultValue(t.fragmentShaderSource,"varying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_st;\nvoid main()\n{\nczm_materialInput materialInput;\nvec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n#ifdef FACE_FORWARD\nnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nmaterialInput.s = v_st.s;\nmaterialInput.st = v_st;\nmaterialInput.str = vec3(v_st, 0.0);\nmaterialInput.normalEC = normalEC;\nmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\nvec3 positionToEyeEC = -v_positionEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nczm_material material = czm_getMaterial(materialInput);\n#ifdef FLAT\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\ngl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"),this._renderState=H.getDefaultRenderState(a,!r,t.renderState),this._closed=!1,this._flat=e.defaultValue(t.flat,!1),this._faceForward=e.defaultValue(t.faceForward,r),this._aboveGround=r}ye._materialCache={_materials:{},addMaterial:function(e,t){this._materials[e]=t},getMaterial:function(e){return this._materials[e]}},ye.DefaultImageId="czm_defaultImage",ye.DefaultCubeMapId="czm_defaultCubeMap",ye.ColorType="Color",ye._materialCache.addMaterial(ye.ColorType,{fabric:{type:ye.ColorType,uniforms:{color:new L.Color(1,0,0,.5)},components:{diffuse:"color.rgb",alpha:"color.a"}},translucent:function(e){return e.uniforms.color.alpha<1}}),ye.ImageType="Image",ye._materialCache.addMaterial(ye.ImageType,{fabric:{type:ye.ImageType,uniforms:{image:ye.DefaultImageId,repeat:new r.Cartesian2(1,1),color:new L.Color(1,1,1,1)},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st)).rgb * color.rgb",alpha:"texture2D(image, fract(repeat * materialInput.st)).a * color.a"}},translucent:function(e){return e.uniforms.color.alpha<1}}),ye.DiffuseMapType="DiffuseMap",ye._materialCache.addMaterial(ye.DiffuseMapType,{fabric:{type:ye.DiffuseMapType,uniforms:{image:ye.DefaultImageId,channels:"rgb",repeat:new r.Cartesian2(1,1)},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st)).channels"}},translucent:!1}),ye.AlphaMapType="AlphaMap",ye._materialCache.addMaterial(ye.AlphaMapType,{fabric:{type:ye.AlphaMapType,uniforms:{image:ye.DefaultImageId,channel:"a",repeat:new r.Cartesian2(1,1)},components:{alpha:"texture2D(image, fract(repeat * materialInput.st)).channel"}},translucent:!0}),ye.SpecularMapType="SpecularMap",ye._materialCache.addMaterial(ye.SpecularMapType,{fabric:{type:ye.SpecularMapType,uniforms:{image:ye.DefaultImageId,channel:"r",repeat:new r.Cartesian2(1,1)},components:{specular:"texture2D(image, fract(repeat * materialInput.st)).channel"}},translucent:!1}),ye.EmissionMapType="EmissionMap",ye._materialCache.addMaterial(ye.EmissionMapType,{fabric:{type:ye.EmissionMapType,uniforms:{image:ye.DefaultImageId,channels:"rgb",repeat:new r.Cartesian2(1,1)},components:{emission:"texture2D(image, fract(repeat * materialInput.st)).channels"}},translucent:!1}),ye.BumpMapType="BumpMap",ye._materialCache.addMaterial(ye.BumpMapType,{fabric:{type:ye.BumpMapType,uniforms:{image:ye.DefaultImageId,channel:"r",strength:.8,repeat:new r.Cartesian2(1,1)},source:"uniform sampler2D image;\nuniform float strength;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nvec2 centerPixel = fract(repeat * st);\nfloat centerBump = texture2D(image, centerPixel).channel;\nfloat imageWidth = float(imageDimensions.x);\nvec2 rightPixel = fract(repeat * (st + vec2(1.0 / imageWidth, 0.0)));\nfloat rightBump = texture2D(image, rightPixel).channel;\nfloat imageHeight = float(imageDimensions.y);\nvec2 leftPixel = fract(repeat * (st + vec2(0.0, 1.0 / imageHeight)));\nfloat topBump = texture2D(image, leftPixel).channel;\nvec3 normalTangentSpace = normalize(vec3(centerBump - rightBump, centerBump - topBump, clamp(1.0 - strength, 0.1, 1.0)));\nvec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;\nmaterial.normal = normalEC;\nmaterial.diffuse = vec3(0.01);\nreturn material;\n}\n"},translucent:!1}),ye.NormalMapType="NormalMap",ye._materialCache.addMaterial(ye.NormalMapType,{fabric:{type:ye.NormalMapType,uniforms:{image:ye.DefaultImageId,channels:"rgb",strength:.8,repeat:new r.Cartesian2(1,1)},source:"uniform sampler2D image;\nuniform float strength;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec4 textureValue = texture2D(image, fract(repeat * materialInput.st));\nvec3 normalTangentSpace = textureValue.channels;\nnormalTangentSpace.xy = normalTangentSpace.xy * 2.0 - 1.0;\nnormalTangentSpace.z = clamp(1.0 - strength, 0.1, 1.0);\nnormalTangentSpace = normalize(normalTangentSpace);\nvec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;\nmaterial.normal = normalEC;\nreturn material;\n}\n"},translucent:!1}),ye.GridType="Grid",ye._materialCache.addMaterial(ye.GridType,{fabric:{type:ye.GridType,uniforms:{color:new L.Color(0,1,0,1),cellAlpha:.1,lineCount:new r.Cartesian2(8,8),lineThickness:new r.Cartesian2(1,1),lineOffset:new r.Cartesian2(0,0)},source:"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform vec4 color;\nuniform float cellAlpha;\nuniform vec2 lineCount;\nuniform vec2 lineThickness;\nuniform vec2 lineOffset;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat scaledWidth = fract(lineCount.s * st.s - lineOffset.s);\nscaledWidth = abs(scaledWidth - floor(scaledWidth + 0.5));\nfloat scaledHeight = fract(lineCount.t * st.t - lineOffset.t);\nscaledHeight = abs(scaledHeight - floor(scaledHeight + 0.5));\nfloat value;\n#ifdef GL_OES_standard_derivatives\nconst float fuzz = 1.2;\nvec2 thickness = (lineThickness * czm_pixelRatio) - 1.0;\nvec2 dx = abs(dFdx(st));\nvec2 dy = abs(dFdy(st));\nvec2 dF = vec2(max(dx.s, dy.s), max(dx.t, dy.t)) * lineCount;\nvalue = min(\nsmoothstep(dF.s * thickness.s, dF.s * (fuzz + thickness.s), scaledWidth),\nsmoothstep(dF.t * thickness.t, dF.t * (fuzz + thickness.t), scaledHeight));\n#else\nconst float fuzz = 0.05;\nvec2 range = 0.5 - (lineThickness * 0.05);\nvalue = min(\n1.0 - smoothstep(range.s, range.s + fuzz, scaledWidth),\n1.0 - smoothstep(range.t, range.t + fuzz, scaledHeight));\n#endif\nfloat dRim = 1.0 - abs(dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC)));\nfloat sRim = smoothstep(0.8, 1.0, dRim);\nvalue *= (1.0 - sRim);\nvec4 halfColor;\nhalfColor.rgb = color.rgb * 0.5;\nhalfColor.a = color.a * (1.0 - ((1.0 - cellAlpha) * value));\nhalfColor = czm_gammaCorrect(halfColor);\nmaterial.diffuse = halfColor.rgb;\nmaterial.emission = halfColor.rgb;\nmaterial.alpha = halfColor.a;\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.color.alpha<1||t.cellAlpha<1}}),ye.StripeType="Stripe",ye._materialCache.addMaterial(ye.StripeType,{fabric:{type:ye.StripeType,uniforms:{horizontal:!0,evenColor:new L.Color(1,1,1,.5),oddColor:new L.Color(0,0,1,.5),offset:0,repeat:5},source:"uniform vec4 evenColor;\nuniform vec4 oddColor;\nuniform float offset;\nuniform float repeat;\nuniform bool horizontal;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat coord = mix(materialInput.st.s, materialInput.st.t, float(horizontal));\nfloat value = fract((coord - offset) * (repeat * 0.5));\nfloat dist = min(value, min(abs(value - 0.5), 1.0 - value));\nvec4 currentColor = mix(evenColor, oddColor, step(0.5, value));\nvec4 color = czm_antialias(evenColor, oddColor, currentColor, dist);\ncolor = czm_gammaCorrect(color);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.evenColor.alpha<1||t.oddColor.alpha<1}}),ye.CheckerboardType="Checkerboard",ye._materialCache.addMaterial(ye.CheckerboardType,{fabric:{type:ye.CheckerboardType,uniforms:{lightColor:new L.Color(1,1,1,.5),darkColor:new L.Color(0,0,0,.5),repeat:new r.Cartesian2(5,5)},source:"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat b = mod(floor(repeat.s * st.s) + floor(repeat.t * st.t), 2.0);\nfloat scaledWidth = fract(repeat.s * st.s);\nscaledWidth = abs(scaledWidth - floor(scaledWidth + 0.5));\nfloat scaledHeight = fract(repeat.t * st.t);\nscaledHeight = abs(scaledHeight - floor(scaledHeight + 0.5));\nfloat value = min(scaledWidth, scaledHeight);\nvec4 currentColor = mix(lightColor, darkColor, b);\nvec4 color = czm_antialias(lightColor, darkColor, currentColor, value, 0.03);\ncolor = czm_gammaCorrect(color);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.lightColor.alpha<1||t.darkColor.alpha<1}}),ye.DotType="Dot",ye._materialCache.addMaterial(ye.DotType,{fabric:{type:ye.DotType,uniforms:{lightColor:new L.Color(1,1,0,.75),darkColor:new L.Color(0,1,1,.75),repeat:new r.Cartesian2(5,5)},source:"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat b = smoothstep(0.3, 0.32, length(fract(repeat * materialInput.st) - 0.5));\nvec4 color = mix(lightColor, darkColor, b);\ncolor = czm_gammaCorrect(color);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.lightColor.alpha<1||t.darkColor.alpha<1}}),ye.WaterType="Water",ye._materialCache.addMaterial(ye.WaterType,{fabric:{type:ye.WaterType,uniforms:{baseWaterColor:new L.Color(.2,.3,.6,1),blendColor:new L.Color(0,1,.699,1),specularMap:ye.DefaultImageId,normalMap:ye.DefaultImageId,frequency:10,animationSpeed:.01,amplitude:1,specularIntensity:.5,fadeFactor:1},source:"uniform sampler2D specularMap;\nuniform sampler2D normalMap;\nuniform vec4 baseWaterColor;\nuniform vec4 blendColor;\nuniform float frequency;\nuniform float animationSpeed;\nuniform float amplitude;\nuniform float specularIntensity;\nuniform float fadeFactor;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat time = czm_frameNumber * animationSpeed;\nfloat fade = max(1.0, (length(materialInput.positionToEyeEC) / 10000000000.0) * frequency * fadeFactor);\nfloat specularMapValue = texture2D(specularMap, materialInput.st).r;\nvec4 noise = czm_getWaterNoise(normalMap, materialInput.st * frequency, time, 0.0);\nvec3 normalTangentSpace = noise.xyz * vec3(1.0, 1.0, (1.0 / amplitude));\nnormalTangentSpace.xy /= fade;\nnormalTangentSpace = mix(vec3(0.0, 0.0, 50.0), normalTangentSpace, specularMapValue);\nnormalTangentSpace = normalize(normalTangentSpace);\nfloat tsPerturbationRatio = clamp(dot(normalTangentSpace, vec3(0.0, 0.0, 1.0)), 0.0, 1.0);\nmaterial.alpha = mix(blendColor.a, baseWaterColor.a, specularMapValue) * specularMapValue;\nmaterial.diffuse = mix(blendColor.rgb, baseWaterColor.rgb, specularMapValue);\nmaterial.diffuse += (0.1 * tsPerturbationRatio);\nmaterial.diffuse = material.diffuse;\nmaterial.normal = normalize(materialInput.tangentToEyeMatrix * normalTangentSpace);\nmaterial.specular = specularIntensity;\nmaterial.shininess = 10.0;\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.baseWaterColor.alpha<1||t.blendColor.alpha<1}}),ye.RimLightingType="RimLighting",ye._materialCache.addMaterial(ye.RimLightingType,{fabric:{type:ye.RimLightingType,uniforms:{color:new L.Color(1,0,0,.7),rimColor:new L.Color(1,1,1,.4),width:.3},source:"uniform vec4 color;\nuniform vec4 rimColor;\nuniform float width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat d = 1.0 - dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC));\nfloat s = smoothstep(1.0 - width, 1.0, d);\nvec4 outColor = czm_gammaCorrect(color);\nvec4 outRimColor = czm_gammaCorrect(rimColor);\nmaterial.diffuse = outColor.rgb;\nmaterial.emission = outRimColor.rgb * s;\nmaterial.alpha = mix(outColor.a, outRimColor.a, s);\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.color.alpha<1||t.rimColor.alpha<1}}),ye.FadeType="Fade",ye._materialCache.addMaterial(ye.FadeType,{fabric:{type:ye.FadeType,uniforms:{fadeInColor:new L.Color(1,0,0,1),fadeOutColor:new L.Color(0,0,0,0),maximumDistance:.5,repeat:!0,fadeDirection:{x:!0,y:!0},time:new r.Cartesian2(.5,.5)},source:"uniform vec4 fadeInColor;\nuniform vec4 fadeOutColor;\nuniform float maximumDistance;\nuniform bool repeat;\nuniform vec2 fadeDirection;\nuniform vec2 time;\nfloat getTime(float t, float coord)\n{\nfloat scalar = 1.0 / maximumDistance;\nfloat q  = distance(t, coord) * scalar;\nif (repeat)\n{\nfloat r = distance(t, coord + 1.0) * scalar;\nfloat s = distance(t, coord - 1.0) * scalar;\nq = min(min(r, s), q);\n}\nreturn clamp(q, 0.0, 1.0);\n}\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat s = getTime(time.x, st.s) * fadeDirection.s;\nfloat t = getTime(time.y, st.t) * fadeDirection.t;\nfloat u = length(vec2(s, t));\nvec4 color = mix(fadeInColor, fadeOutColor, u);\ncolor = czm_gammaCorrect(color);\nmaterial.emission = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.fadeInColor.alpha<1||t.fadeOutColor.alpha<1}}),ye.PolylineArrowType="PolylineArrow",ye._materialCache.addMaterial(ye.PolylineArrowType,{fabric:{type:ye.PolylineArrowType,uniforms:{color:new L.Color(1,1,1,1)},source:"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform vec4 color;\nvarying float v_width;\nfloat getPointOnLine(vec2 p0, vec2 p1, float x)\n{\nfloat slope = (p0.y - p1.y) / (p0.x - p1.x);\nreturn slope * (x - p0.x) + p0.y;\n}\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\n#ifdef GL_OES_standard_derivatives\nfloat base = 1.0 - abs(fwidth(st.s)) * 10.0 * czm_pixelRatio;\n#else\nfloat base = 0.975;\n#endif\nvec2 center = vec2(1.0, 0.5);\nfloat ptOnUpperLine = getPointOnLine(vec2(base, 1.0), center, st.s);\nfloat ptOnLowerLine = getPointOnLine(vec2(base, 0.0), center, st.s);\nfloat halfWidth = 0.15;\nfloat s = step(0.5 - halfWidth, st.t);\ns *= 1.0 - step(0.5 + halfWidth, st.t);\ns *= 1.0 - step(base, st.s);\nfloat t = step(base, materialInput.st.s);\nt *= 1.0 - step(ptOnUpperLine, st.t);\nt *= step(ptOnLowerLine, st.t);\nfloat dist;\nif (st.s < base)\n{\nfloat d1 = abs(st.t - (0.5 - halfWidth));\nfloat d2 = abs(st.t - (0.5 + halfWidth));\ndist = min(d1, d2);\n}\nelse\n{\nfloat d1 = czm_infinity;\nif (st.t < 0.5 - halfWidth && st.t > 0.5 + halfWidth)\n{\nd1 = abs(st.s - base);\n}\nfloat d2 = abs(st.t - ptOnUpperLine);\nfloat d3 = abs(st.t - ptOnLowerLine);\ndist = min(min(d1, d2), d3);\n}\nvec4 outsideColor = vec4(0.0);\nvec4 currentColor = mix(outsideColor, color, clamp(s + t, 0.0, 1.0));\nvec4 outColor = czm_antialias(outsideColor, color, currentColor, dist);\noutColor = czm_gammaCorrect(outColor);\nmaterial.diffuse = outColor.rgb;\nmaterial.alpha = outColor.a;\nreturn material;\n}\n"},translucent:!0}),ye.PolylineDashType="PolylineDash",ye._materialCache.addMaterial(ye.PolylineDashType,{fabric:{type:ye.PolylineDashType,uniforms:{color:new L.Color(1,0,1,1),gapColor:new L.Color(0,0,0,0),dashLength:16,dashPattern:255},source:"uniform vec4 color;\nuniform vec4 gapColor;\nuniform float dashLength;\nuniform float dashPattern;\nvarying float v_polylineAngle;\nconst float maskLength = 16.0;\nmat2 rotate(float rad) {\nfloat c = cos(rad);\nfloat s = sin(rad);\nreturn mat2(\nc, s,\n-s, c\n);\n}\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 pos = rotate(v_polylineAngle) * gl_FragCoord.xy;\nfloat dashPosition = fract(pos.x / (dashLength * czm_pixelRatio));\nfloat maskIndex = floor(dashPosition * maskLength);\nfloat maskTest = floor(dashPattern / pow(2.0, maskIndex));\nvec4 fragColor = (mod(maskTest, 2.0) < 1.0) ? gapColor : color;\nif (fragColor.a < 0.005) {\ndiscard;\n}\nfragColor = czm_gammaCorrect(fragColor);\nmaterial.emission = fragColor.rgb;\nmaterial.alpha = fragColor.a;\nreturn material;\n}\n"},translucent:!0}),ye.PolylineGlowType="PolylineGlow",ye._materialCache.addMaterial(ye.PolylineGlowType,{fabric:{type:ye.PolylineGlowType,uniforms:{color:new L.Color(0,.5,1,1),glowPower:.25,taperPower:1},source:"uniform vec4 color;\nuniform float glowPower;\nuniform float taperPower;\nvarying float v_width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat glow = glowPower / abs(st.t - 0.5) - (glowPower / 0.5);\nif (taperPower <= 0.99999) {\nglow *= min(1.0, taperPower / (0.5 - st.s * 0.5) - (taperPower / 0.5));\n}\nvec4 fragColor;\nfragColor.rgb = max(vec3(glow - 1.0 + color.rgb), color.rgb);\nfragColor.a = clamp(0.0, 1.0, glow) * color.a;\nfragColor = czm_gammaCorrect(fragColor);\nmaterial.emission = fragColor.rgb;\nmaterial.alpha = fragColor.a;\nreturn material;\n}\n"},translucent:!0}),ye.PolylineOutlineType="PolylineOutline",ye._materialCache.addMaterial(ye.PolylineOutlineType,{fabric:{type:ye.PolylineOutlineType,uniforms:{color:new L.Color(1,1,1,1),outlineColor:new L.Color(1,0,0,1),outlineWidth:1},source:"uniform vec4 color;\nuniform vec4 outlineColor;\nuniform float outlineWidth;\nvarying float v_width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat halfInteriorWidth =  0.5 * (v_width - outlineWidth) / v_width;\nfloat b = step(0.5 - halfInteriorWidth, st.t);\nb *= 1.0 - step(0.5 + halfInteriorWidth, st.t);\nfloat d1 = abs(st.t - (0.5 - halfInteriorWidth));\nfloat d2 = abs(st.t - (0.5 + halfInteriorWidth));\nfloat dist = min(d1, d2);\nvec4 currentColor = mix(outlineColor, color, b);\nvec4 outColor = czm_antialias(outlineColor, color, currentColor, dist);\noutColor = czm_gammaCorrect(outColor);\nmaterial.diffuse = outColor.rgb;\nmaterial.alpha = outColor.a;\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.color.alpha<1||t.outlineColor.alpha<1}}),ye.ElevationContourType="ElevationContour",ye._materialCache.addMaterial(ye.ElevationContourType,{fabric:{type:ye.ElevationContourType,uniforms:{spacing:100,color:new L.Color(1,0,0,1),width:1},source:"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform vec4 color;\nuniform float spacing;\nuniform float width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat distanceToContour = mod(materialInput.height, spacing);\n#ifdef GL_OES_standard_derivatives\nfloat dxc = abs(dFdx(materialInput.height));\nfloat dyc = abs(dFdy(materialInput.height));\nfloat dF = max(dxc, dyc) * czm_pixelRatio * width;\nfloat alpha = (distanceToContour < dF) ? 1.0 : 0.0;\n#else\nfloat alpha = (distanceToContour < (czm_pixelRatio * width)) ? 1.0 : 0.0;\n#endif\nvec4 outColor = czm_gammaCorrect(vec4(color.rgb, alpha));\nmaterial.diffuse = outColor.rgb;\nmaterial.alpha = outColor.a;\nreturn material;\n}\n"},translucent:!1}),ye.ElevationRampType="ElevationRamp",ye._materialCache.addMaterial(ye.ElevationRampType,{fabric:{type:ye.ElevationRampType,uniforms:{image:ye.DefaultImageId,minimumHeight:0,maximumHeight:1e4},source:"uniform sampler2D image;\nuniform float minimumHeight;\nuniform float maximumHeight;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat scaledHeight = clamp((materialInput.height - minimumHeight) / (maximumHeight - minimumHeight), 0.0, 1.0);\nvec4 rampColor = texture2D(image, vec2(scaledHeight, 0.5));\nrampColor = czm_gammaCorrect(rampColor);\nmaterial.diffuse = rampColor.rgb;\nmaterial.alpha = rampColor.a;\nreturn material;\n}\n"},translucent:!1}),ye.SlopeRampMaterialType="SlopeRamp",ye._materialCache.addMaterial(ye.SlopeRampMaterialType,{fabric:{type:ye.SlopeRampMaterialType,uniforms:{image:ye.DefaultImageId},source:"uniform sampler2D image;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec4 rampColor = texture2D(image, vec2(materialInput.slope / (czm_pi / 2.0), 0.5));\nrampColor = czm_gammaCorrect(rampColor);\nmaterial.diffuse = rampColor.rgb;\nmaterial.alpha = rampColor.a;\nreturn material;\n}\n"},translucent:!1}),ye.AspectRampMaterialType="AspectRamp",ye._materialCache.addMaterial(ye.AspectRampMaterialType,{fabric:{type:ye.AspectRampMaterialType,uniforms:{image:ye.DefaultImageId},source:"uniform sampler2D image;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec4 rampColor = texture2D(image, vec2(materialInput.aspect / (2.0 * czm_pi), 0.5));\nrampColor = czm_gammaCorrect(rampColor);\nmaterial.diffuse = rampColor.rgb;\nmaterial.alpha = rampColor.a;\nreturn material;\n}\n"},translucent:!1}),Object.defineProperties(Ne.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return Ne.VERTEX_FORMAT}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}},aboveGround:{get:function(){return this._aboveGround}}}),Ne.VERTEX_FORMAT=y.VertexFormat.POSITION_AND_ST,Ne.prototype.getFragmentShaderSource=H.prototype.getFragmentShaderSource,Ne.prototype.isTranslucent=H.prototype.isTranslucent,Ne.prototype.getRenderState=H.prototype.getRenderState;function Fe(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT);var a=e.defaultValue(t.translucent,!0),r=e.defaultValue(t.closed,!1),n=e.defaultValue(t.flat,!1),i=n?"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec4 color;\nattribute float batchId;\nvarying vec4 v_color;\nvoid main()\n{\nvec4 p = czm_computePosition();\nv_color = color;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n":"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec4 color;\nattribute float batchId;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec4 v_color;\nvoid main()\n{\nvec4 p = czm_computePosition();\nv_positionEC = (czm_modelViewRelativeToEye * p).xyz;\nv_normalEC = czm_normal * normal;\nv_color = color;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",o=n?"varying vec4 v_color;\nvoid main()\n{\ngl_FragColor = czm_gammaCorrect(v_color);\n}\n":"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec4 v_color;\nvoid main()\n{\nvec3 positionToEyeEC = -v_positionEC;\nvec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\nnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nvec4 color = czm_gammaCorrect(v_color);\nczm_materialInput materialInput;\nmaterialInput.normalEC = normalEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nczm_material material = czm_getDefaultMaterial(materialInput);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\ngl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n}\n",l=n?Fe.FLAT_VERTEX_FORMAT:Fe.VERTEX_FORMAT;this.material=void 0,this.translucent=a,this._vertexShaderSource=e.defaultValue(t.vertexShaderSource,i),this._fragmentShaderSource=e.defaultValue(t.fragmentShaderSource,o),this._renderState=H.getDefaultRenderState(a,r,t.renderState),this._closed=r,this._vertexFormat=l,this._flat=n,this._faceForward=e.defaultValue(t.faceForward,!r)}function ze(e,t,a){if(this._attributes=t,this._numberOfInstances=a,0!==t.length){var n=function(e){for(var t=!1,a=e.length,r=0;r<a;++r)if(e[r].componentDatatype!==u.ComponentDatatype.UNSIGNED_BYTE){t=!0;break}return t?N.PixelDatatype.FLOAT:N.PixelDatatype.UNSIGNED_BYTE}(t),o=e.floatingPointTexture,l=n===N.PixelDatatype.FLOAT&&!o,s=function(e,t){for(var a=new Array(e.length),r=0,n=e.length,i=0;i<n;++i){var o=e[i].componentDatatype;a[i]=r,o!==u.ComponentDatatype.UNSIGNED_BYTE&&t?r+=4:++r}return a}(t,l),m=function(e,t,a){var r=e.length,n=e[r-1];if(t[r-1].componentDatatype!==u.ComponentDatatype.UNSIGNED_BYTE&&a)return n+4;return n+1}(s,t,l),c=Math.floor(se.maximumTextureSize/m),f=Math.min(a,c),p=m*f,d=Math.ceil(a/f),_=1/p,h=.5*_,g=1/d,v=.5*g;this._textureDimensions=new r.Cartesian2(p,d),this._textureStep=new i.Cartesian4(_,h,g,v),this._pixelDatatype=l?N.PixelDatatype.UNSIGNED_BYTE:n,this._packFloats=l,this._offsets=s,this._stride=m,this._texture=void 0;var T=4*p*d;this._batchValues=n!==N.PixelDatatype.FLOAT||l?new Uint8Array(T):new Float32Array(T),this._batchValuesDirty=!1}}function Oe(e,t){var a=e[t].componentsPerAttribute;return 2===a?r.Cartesian2:3===a?r.Cartesian3:4===a?i.Cartesian4:Number}Object.defineProperties(Fe.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}}),Fe.VERTEX_FORMAT=y.VertexFormat.POSITION_AND_NORMAL,Fe.FLAT_VERTEX_FORMAT=y.VertexFormat.POSITION_ONLY,Fe.prototype.getFragmentShaderSource=H.prototype.getFragmentShaderSource,Fe.prototype.isTranslucent=H.prototype.isTranslucent,Fe.prototype.getRenderState=H.prototype.getRenderState,Object.defineProperties(ze.prototype,{attributes:{get:function(){return this._attributes}},numberOfInstances:{get:function(){return this._numberOfInstances}}});var Ue=new i.Cartesian4;var Be=new i.Cartesian4;ze.prototype.getBatchedAttribute=function(t,a,r){var n,o=this._attributes,l=this._offsets[a],s=4*this._stride*t+4*l;n=this._packFloats&&o[a].componentDatatype!==N.PixelDatatype.UNSIGNED_BYTE?function(e,t,a){var r=i.Cartesian4.unpack(e,t,Ue),n=i.Cartesian4.unpackFloat(r);r=i.Cartesian4.unpack(e,t+4,Ue);var o=i.Cartesian4.unpackFloat(r);r=i.Cartesian4.unpack(e,t+8,Ue);var l=i.Cartesian4.unpackFloat(r);r=i.Cartesian4.unpack(e,t+12,Ue);var s=i.Cartesian4.unpackFloat(r);return i.Cartesian4.fromElements(n,o,l,s,a)}(this._batchValues,s,Be):i.Cartesian4.unpack(this._batchValues,s,Be);var u=Oe(o,a);return e.defined(u.fromCartesian4)?u.fromCartesian4(n,r):e.defined(u.clone)?u.clone(n,r):n.x};var Ve=[void 0,void 0,new r.Cartesian2,new r.Cartesian3,new i.Cartesian4],Ge=new i.Cartesian4;function We(e){return 1===e?"float":"vec"+e}function ke(e,t){var a=e._attributes[t],r=a.componentsPerAttribute,n=a.functionName,i=We(r),o=function(e){return 1===e?".x":2===e?".xy":3===e?".xyz":""}(r),l="v_"+n,s=i+" "+n+"(float batchId) \n{ \n    vec2 st = computeSt(batchId); \n    st.x += batchTextureStep.x * float("+e._offsets[t]+"); \n";return e._packFloats&&a.componentDatatype!==N.PixelDatatype.UNSIGNED_BYTE?s+="vec4 textureValue; \ntextureValue.x = czm_unpackFloat(texture2D(batchTexture, st)); \ntextureValue.y = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x, 0.0))); \ntextureValue.z = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 2.0, 0.0))); \ntextureValue.w = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 3.0, 0.0))); \n":s+="    vec4 textureValue = texture2D(batchTexture, st); \n",s+="    "+i+" value = textureValue"+o+"; \n",e._pixelDatatype!==N.PixelDatatype.UNSIGNED_BYTE||a.componentDatatype!==u.ComponentDatatype.UNSIGNED_BYTE||a.normalize?e._pixelDatatype===N.PixelDatatype.FLOAT&&a.componentDatatype===u.ComponentDatatype.UNSIGNED_BYTE&&a.normalize&&(s+="value /= 255.0; \n"):s+="value *= 255.0; \n","varying "+i+" "+l+";\n"+(s+="    return value; \n} \n")}function Ye(e,t){var a=e._attributes[t].functionName;return-1!=e.NOTGlslAutoAttributeArray().indexOf(a)?"":"    "+("v_"+a)+" = "+a+"(batchId);\n"}ze.prototype.setBatchedAttribute=function(t,a,r){var n=this._attributes,o=Ve[n[a].componentsPerAttribute],l=this.getBatchedAttribute(t,a,o),s=Oe(this._attributes,a);if(!(e.defined(s.equals)?s.equals(l,r):l===r)){var u=Ge;u.x=e.defined(r.x)?r.x:r,u.y=e.defined(r.y)?r.y:0,u.z=e.defined(r.z)?r.z:0,u.w=e.defined(r.w)?r.w:0;var m=this._offsets[a],c=4*this._stride*t+4*m;this._packFloats&&n[a].componentDatatype!==N.PixelDatatype.UNSIGNED_BYTE?function(e,t,a){var r=i.Cartesian4.packFloat(e.x,Ue);i.Cartesian4.pack(r,t,a),r=i.Cartesian4.packFloat(e.y,r),i.Cartesian4.pack(r,t,a+4),r=i.Cartesian4.packFloat(e.z,r),i.Cartesian4.pack(r,t,a+8),r=i.Cartesian4.packFloat(e.w,r),i.Cartesian4.pack(r,t,a+12)}(u,this._batchValues,c):i.Cartesian4.pack(u,this._batchValues,c),this._batchValuesDirty=!0}},ze.prototype.update=function(t){var a,r,n;e.defined(this._texture)&&!this._batchValuesDirty||0===this._attributes.length||(this._batchValuesDirty=!1,e.defined(this._texture)||(a=this,r=t.context,n=a._textureDimensions,a._texture=new xe({context:r,pixelFormat:N.PixelFormat.RGBA,pixelDatatype:a._pixelDatatype,width:n.x,height:n.y,sampler:ve.NEAREST,flipY:!1})),function(e){var t=e._textureDimensions;e._texture.copyFrom({width:t.x,height:t.y,arrayBufferView:e._batchValues})}(this))},ze.prototype.getUniformMapCallback=function(){var e=this;return function(t){if(0===e._attributes.length)return t;var a={batchTexture:function(){return e._texture},batchTextureDimensions:function(){return e._textureDimensions},batchTextureStep:function(){return e._textureStep}};return i.combine(t,a)}},ze.prototype.getVertexShaderCallback=function(){var e=this._attributes;if(0===e.length)return function(e){return e};var t,a,r="uniform sampler2D batchTexture; \n";r+=(a=(t=this)._stride,(1===t._textureDimensions.y?"uniform vec4 batchTextureStep; \nvec2 computeSt(float batchId) \n{ \n    float stepX = batchTextureStep.x; \n    float centerX = batchTextureStep.y; \n    float numberOfAttributes = float("+a+"); \n    return vec2(centerX + (batchId * numberOfAttributes * stepX), 0.5); \n} \n":"uniform vec4 batchTextureStep; \nuniform vec2 batchTextureDimensions; \nvec2 computeSt(float batchId) \n{ \n    float stepX = batchTextureStep.x; \n    float centerX = batchTextureStep.y; \n    float stepY = batchTextureStep.z; \n    float centerY = batchTextureStep.w; \n    float numberOfAttributes = float("+a+"); \n    float xId = mod(batchId * numberOfAttributes, batchTextureDimensions.x); \n    float yId = floor(batchId * numberOfAttributes / batchTextureDimensions.x); \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \n} \n")+"\n");for(var n=[],i=e.length,o=0;o<i;++o)r+=ke(this,o),n.push(Ye(this,o));return n=n.join(""),function(e){var t=e.indexOf("void main"),a=e.substring(0,t),i=e.substring(t),o=i.indexOf("}"),l=i.substr(0,o)+n+i.substr(o);return a+"\n"+r+"\n"+l}},ze.prototype.NOTGlslAutoAttributeArray=function(){return["czm_batchTable_color","czm_batchTable_pickColor","czm_batchTable_show","czm_batchTable_distanceDisplayCondition","czm_batchTable_width","czm_batchTable_boundingSphereCenter3DHigh","czm_batchTable_boundingSphereCenter3DLow","czm_batchTable_boundingSphereCenter2DHigh","czm_batchTable_boundingSphereCenter2DLow","czm_batchTable_boundingSphereRadius"]},ze.prototype.setFSAttributesHeader=function(e){var t=this._attributes;if(0===t.length)return e;for(var a=[],r=0;r<t.length;++r){var n=this._attributes[r],i=n.functionName,o=We(n.componentsPerAttribute);if(-1==this.NOTGlslAutoAttributeArray().indexOf(i)){var l="varying "+o+" "+("v_"+i)+";";a.push(l)}}return a.join("\n")+"\n"+e},ze.prototype.isDestroyed=function(){return!1},ze.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),K(this)};let He={MultiPolygon:function(e){rt(e)},Polygon:rt},Xe=new function(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.componentDatatype=t.componentDatatype,this.componentsPerAttribute=t.componentsPerAttribute,this.normalize=e.defaultValue(t.normalize,!1),this.value=t.value}({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:1,normalize:!0,value:new Float32Array([1])}),je=[],Ke=[],Ze=[],qe=[],Je=0,$e={},Qe=2e9;function et(e){let t=[];for(let a=0;a<e.length;a++){let r=e[a];t=t.concat(r.polygons)}if(0==t.length)return;let a=new F({positions:t,height:200,speed:100,type:1,direction:1,color:new L.Color(.3,.5,.8,2),translucent:!0});qe=a.createGeometryInstances()}function tt(e){if(e.length>0){let t=e[0];(0,He[t.type])(e)}}function at(e){for(let t=0;t<e.length;t++){let a=e[t];for(let e=0;e<a.polygons.length;e++){let t=a.polygons[e],r=nt(a.id,a.properties,t);Ke.push(r)}}}function rt(e){let t=100;for(let a=0;a<e.length;a++){let r,n,i=e[a],o=i.style,l=it(o,"fillColor","fillOpacity"),s={color:z.fromColor(l),display:Xe};o.stroke&&(r=it(o,"strokeColor","strokeOpacity"),n={color:z.fromColor(r),display:Xe});for(let e=0;e<i.polygons.length;e++){let a=i.polygons[e];if($e.hasOwnProperty("heightProperty")){let e=$e.heightProperty;t=i.properties[e],$e.hasOwnProperty("heightScale")&&(t*=parseFloat($e.heightScale))}if("E1"==i.properties.yddm){let e=nt(i.id,i.properties,a);Ke.push(e)}else if(t>=0){let e=ot(i.id,i.properties,a,0,t,s);if(je.push(e),o.stroke){let e=lt(i.id,i.properties,a,0,t,n);Ze.push(e)}}}}}function nt(e,t,a){return e=e+"_"+Je+"_water",new E.GeometryInstance({id:e,geometry:R.PolygonGeometry.fromPositions({height:0,positions:a,vertexFormat:Ne.VERTEX_FORMAT}),attributes:{display:Xe},properties:t})}function it(t,a,r){let n,i=t[a];$e.hasOwnProperty("fillColor")&&(i=$e.fillColor),e.defined(i)&&(n=L.Color.fromCssColorString(i),e.defined(n)||(n=L.Color.fromCssColorString("#ffffff")),n.alpha=1);let o=t[r];return $e.hasOwnProperty("opacity")&&(o=$e.opacity),e.defined(o)&&1!==o&&(n.alpha=o),n}function ot(e,t,a,r,n,i){return e=e+"_"+Je+"_polygon",$e.translucentMaterial?new E.GeometryInstance({id:e,geometry:R.PolygonGeometry.fromPositions({height:r,extrudedHeight:n,positions:a}),attributes:i,properties:t}):new E.GeometryInstance({id:e,geometry:R.PolygonGeometry.fromPositions({height:r,extrudedHeight:n,positions:a,vertexFormat:Fe.VERTEX_FORMAT}),attributes:i,properties:t})}function lt(e,t,a,r,n,i){return e=e+"_"+Je+"_polygonOutLine",new E.GeometryInstance({id:e,geometry:D.PolygonOutlineGeometry.fromPositions({height:r,extrudedHeight:n,positions:a,vertexFormat:Fe.VERTEX_FORMAT}),attributes:i,properties:t})}function st(t,a){let o=t.length;if(0==o)return null;var l,s,u=new Array(o),m=[],c=0;for(s=0;s<o;s++){var f,p=(l=t[s]).geometry;f=e.defined(p.attributes)&&e.defined(p.primitiveType)?ct(p):p.constructor.createGeometry(p),u[c++]=ut(l,f),m.push(l.id)}u.length=c;var d=r.Ellipsoid.WGS84,_=new n.GeographicProjection(d),h=v.PrimitivePipeline.combineGeometry({instances:u,ellipsoid:_.ellipsoid,projection:_,elementIndexUintSupported:!0,scene3DOnly:!1,vertexCacheOptimize:!1,compressVertices:!0,modelMatrix:i.Matrix4.IDENTITY,createPickOffsets:void 0});return v.PrimitivePipeline.packCombineGeometryResults(h,a)}function ut(e,t){return{geometry:t,attributes:e.attributes,modelMatrix:i.Matrix4.clone(e.modelMatrix),pickPrimitive:e.pickPrimitive,id:e.id}}function mt(e,t){t.attributes=e.attributes,t.attributeIndices=e.attributeIndices,t.batchValues=e.batchValues,t.propertiesMapBuffer=e.propertiesMapBuffer,t.pickId=e.pickId,t.ids=e.ids}function ct(t){var a,r=t.attributes,i=new c.GeometryAttributes;for(var o in r)r.hasOwnProperty(o)&&e.defined(r[o])&&(i[o]=ft(r[o]));if(e.defined(t.indices)){var l=t.indices;a=Array.isArray(l)?l.slice(0):new l.constructor(l)}return new m.Geometry({attributes:i,indices:a,primitiveType:t.primitiveType,boundingSphere:n.BoundingSphere.clone(t.boundingSphere)})}function ft(e){var t;return t=Array.isArray(e.values)?e.values.slice(0):new e.values.constructor(e.values),new m.GeometryAttribute({componentDatatype:e.componentDatatype,componentsPerAttribute:e.componentsPerAttribute,normalize:e.normalize,values:t})}function pt(t,a){var n,o,l,s=new r.Cartesian2,m=new r.Cartesian3,c=new i.Cartesian4,f=t.length,p=function(t){var a,r=t.length,n=[],i=t[0].attributes;for(a in i)if(i.hasOwnProperty(a)&&e.defined(i[a])){for(var o=i[a],l=!0,s=1;s<r;++s){var u=t[s].attributes[a];if(!e.defined(u)||o.componentDatatype!==u.componentDatatype||o.componentsPerAttribute!==u.componentsPerAttribute||o.normalize!==u.normalize){l=!1;break}}l&&n.push(a)}return n}(t),d=p.length,_=[],h=[],g={},v=t[0].attributes;for(n=0;n<d;++n)l=v[o=p[n]],g[o]=n,h.push({functionName:"czm_batchTable_"+o,componentDatatype:l.componentDatatype,componentsPerAttribute:l.componentsPerAttribute,normalize:l.normalize});-1!==p.indexOf("distanceDisplayCondition")&&h.push({functionName:"czm_batchTable_boundingSphereCenter3DHigh",componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter3DLow",componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DHigh",componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DLow",componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereRadius",componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:1}),-1!==p.indexOf("offset")&&h.push({functionName:"czm_batchTable_offset2D",componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3}),h.push({functionName:"czm_batchTable_pickColor",componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0});var T=h.length,x=new ze({floatingPointTexture:!0},h,f);let y=Qe,E={},C=!1;for(n=0;n<f;++n){var b=t[n];b.properties&&(E[b.id]=b.properties,C=!0),v=b.attributes;for(var A=0;A<d;++A){var P=dt((l=v[o=p[A]]).value,s,m,c),I=g[o];x.setBatchedAttribute(n,I,P)}_.push(b.id),Qe++;var S=L.Color.fromRgba(Qe),w=c;w.x=L.Color.floatToByte(S.red),w.y=L.Color.floatToByte(S.green),w.z=L.Color.floatToByte(S.blue),w.w=L.Color.floatToByte(S.alpha),x.setBatchedAttribute(n,T-1,w)}var M,R=x._batchValues;(a.push(R.buffer),C)?M=function(e){for(var t=new ArrayBuffer(2*e.length),a=new Uint16Array(t),r=0,n=e.length;r<n;r++)a[r]=e.charCodeAt(r);return t}(JSON.stringify(E)):M=new ArrayBuffer(0);return a.push(M),{attributes:h,attributeIndices:g,batchValues:R,propertiesMapBuffer:M,ids:_,pickId:y}}function dt(e,t,a,n){var o=e.length;return 1===o?e[0]:2===o?r.Cartesian2.unpack(e,0,t):3===o?r.Cartesian3.unpack(e,0,a):4===o?i.Cartesian4.unpack(e,0,n):void 0}return se._maximumTextureSize=16384,function(e,t,a,r){return je=[],Ke=[],Ze=[],Je=t,$e=a,function(e){for(let t in e)if(""==t){et(e[t])}else if("cl_"==t){at(e[t])}else{tt(e[t])}}(e),function(e){var t=st(je,e),a=st(Ke,e),r=st(Ze,e),n=st(qe,e);let i={};if(t){mt(pt(je,e),t),i.polygon=t}if(a){mt(pt(Ke,e),a),i.water=a}if(r){mt(pt(Ze,e),r),i.outline=r}if(n){mt(pt(qe,e),n),i.ridingLantern=n}return i}(r)}}));
