define(["exports","./Math-d30358ed","./Cartesian2-f9492f23","./Transforms-8b7e0d39","./EllipsoidTangentPlane-98a8a37e","./PolylinePipeline-b34abe5b"],(function(a,e,r,n,t,i){"use strict";var s=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),o=[new r.Cartesian3,new r.Cartesian3],l=new r.Cartesian3,C=new r.Cartesian3,c=new r.Cartesian3,u=new r.Cartesian3,y=new r.Cartesian3,d=new r.Cartesian3,m=new r.Cartesian3,f=new r.Cartesian3,p=new r.Cartesian3,g=new r.Cartesian3,w=new r.Cartesian3,h={},v=new r.Cartographic;function x(a,e,n,t){var i,s=a[0],o=a[1],l=r.Cartesian3.angleBetween(s,o),C=Math.ceil(l/t),c=new Array(C);if(e===n){for(i=0;i<C;i++)c[i]=e;return c.push(n),c}var u=(n-e)/C;for(i=1;i<C;i++){var y=e+i*u;c[i]=y}return c[0]=e,c.push(n),c}var P=new r.Cartesian3,E=new r.Cartesian3;var M=new r.Cartesian3(-1,0,0),T=new n.Matrix4,B=new n.Matrix4,b=new n.Matrix3,z=n.Matrix3.IDENTITY.clone(),S=new r.Cartesian3,A=new n.Cartesian4,D=new r.Cartesian3;function O(a,e,i,s,o,l,C,c){var u=S,y=A;T=n.Transforms.eastNorthUpToFixedFrame(a,o,T),u=n.Matrix4.multiplyByPointAsVector(T,M,u);var d=function(a,e,n,i){var s=new t.EllipsoidTangentPlane(n,i),o=s.projectPointOntoPlane(r.Cartesian3.add(n,a,P),P),l=s.projectPointOntoPlane(r.Cartesian3.add(n,e,E),E),C=r.Cartesian2.angleBetween(o,l);return l.x*o.y-l.y*o.x>=0?-C:C}(u=r.Cartesian3.normalize(u,u),e,a,o);b=n.Matrix3.fromRotationZ(d,b),D.z=l,T=n.Matrix4.multiplyTransformation(T,n.Matrix4.fromRotationTranslation(b,D,B),T);var m=z;m[0]=C;for(var f=0;f<c;f++)for(var p=0;p<i.length;p+=3)y=r.Cartesian3.fromArray(i,p,y),y=n.Matrix3.multiplyByVector(m,y,y),y=n.Matrix4.multiplyByPoint(T,y,y),s.push(y.x,y.y,y.z);return s}var N=new r.Cartesian3;function V(a,e,n,t,i,s,o){for(var l=0;l<a.length;l+=3){t=O(r.Cartesian3.fromArray(a,l,N),e,n,t,i,s[l/3],o,1)}return t}function G(a,e){for(var r=a.length,n=new Array(3*r),t=0,i=e.x+e.width/2,s=e.y+e.height/2,o=0;o<r;o++)n[t++]=a[o].x-i,n[t++]=0,n[t++]=a[o].y-s;return n}var R=new n.Quaternion,I=new r.Cartesian3,L=new n.Matrix3;function j(a,t,i,o,l,C,c,u,y,d){var m,f,p=r.Cartesian3.angleBetween(r.Cartesian3.subtract(t,a,g),r.Cartesian3.subtract(i,a,w)),h=o===s.BEVELED?0:Math.ceil(p/e.CesiumMath.toRadians(5));if(m=l?n.Matrix3.fromQuaternion(n.Quaternion.fromAxisAngle(r.Cartesian3.negate(a,g),p/(h+1),R),L):n.Matrix3.fromQuaternion(n.Quaternion.fromAxisAngle(a,p/(h+1),R),L),t=r.Cartesian3.clone(t,I),h>0)for(var v=d?2:1,x=0;x<h;x++)t=n.Matrix3.multiplyByVector(m,t,t),f=r.Cartesian3.subtract(t,a,g),f=r.Cartesian3.normalize(f,f),l||(f=r.Cartesian3.negate(f,f)),c=O(C.scaleToGeodeticSurface(t,w),f,u,c,C,y,1,v);else f=r.Cartesian3.subtract(t,a,g),f=r.Cartesian3.normalize(f,f),l||(f=r.Cartesian3.negate(f,f)),c=O(C.scaleToGeodeticSurface(t,w),f,u,c,C,y,1,1),i=r.Cartesian3.clone(i,I),f=r.Cartesian3.subtract(i,a,g),f=r.Cartesian3.normalize(f,f),l||(f=r.Cartesian3.negate(f,f)),c=O(C.scaleToGeodeticSurface(i,w),f,u,c,C,y,1,1);return c}h.removeDuplicatesFromShape=function(a){for(var e=a.length,n=[],t=e-1,i=0;i<e;t=i++){var s=a[t],o=a[i];r.Cartesian2.equals(s,o)||n.push(o)}return n},h.angleIsGreaterThanPi=function(a,e,n,i){var s=new t.EllipsoidTangentPlane(n,i),o=s.projectPointOntoPlane(r.Cartesian3.add(n,a,P),P),l=s.projectPointOntoPlane(r.Cartesian3.add(n,e,E),E);return l.x*o.y-l.y*o.x>=0};var Q=new r.Cartesian3,F=new r.Cartesian3;h.computePositions=function(a,n,t,w,P){var E=w._ellipsoid,M=function(a,e){for(var r=new Array(a.length),n=0;n<a.length;n++){var t=a[n];v=e.cartesianToCartographic(t,v),r[n]=v.height,a[n]=e.scaleToGeodeticSurface(t,t)}return r}(a,E),T=w._granularity,B=w._cornerType,b=P?function(a,e){var r=a.length,n=new Array(6*r),t=0,i=e.x+e.width/2,s=e.y+e.height/2,o=a[0];n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s;for(var l=1;l<r;l++){var C=(o=a[l]).x-i,c=o.y-s;n[t++]=C,n[t++]=0,n[t++]=c,n[t++]=C,n[t++]=0,n[t++]=c}return o=a[0],n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s,n}(n,t):G(n,t),z=P?G(n,t):void 0,S=t.height/2,A=t.width/2,D=a.length,N=[],R=P?[]:void 0,I=l,L=C,U=c,_=u,q=y,Y=d,Z=m,k=f,H=p,J=a[0],K=a[1];_=E.geodeticSurfaceNormal(J,_),I=r.Cartesian3.subtract(K,J,I),I=r.Cartesian3.normalize(I,I),k=r.Cartesian3.cross(_,I,k),k=r.Cartesian3.normalize(k,k);var W,X=M[0],$=M[1];P&&(R=O(J,k,z,R,E,X+S,1,1)),H=r.Cartesian3.clone(J,H),J=K,L=r.Cartesian3.negate(I,L);for(var aa=1;aa<D-1;aa++){var ea=P?2:1;K=a[aa+1],I=r.Cartesian3.subtract(K,J,I),I=r.Cartesian3.normalize(I,I),U=r.Cartesian3.add(I,L,U),U=r.Cartesian3.normalize(U,U),_=E.geodeticSurfaceNormal(J,_);var ra=r.Cartesian3.multiplyByScalar(_,r.Cartesian3.dot(I,_),Q);r.Cartesian3.subtract(I,ra,ra),r.Cartesian3.normalize(ra,ra);var na=r.Cartesian3.multiplyByScalar(_,r.Cartesian3.dot(L,_),F);if(r.Cartesian3.subtract(L,na,na),r.Cartesian3.normalize(na,na),!e.CesiumMath.equalsEpsilon(Math.abs(r.Cartesian3.dot(ra,na)),1,e.CesiumMath.EPSILON7)){U=r.Cartesian3.cross(U,_,U),U=r.Cartesian3.cross(_,U,U),U=r.Cartesian3.normalize(U,U);var ta=1/Math.max(.25,r.Cartesian3.magnitude(r.Cartesian3.cross(U,L,g))),ia=h.angleIsGreaterThanPi(I,L,J,E);ia?(q=r.Cartesian3.add(J,r.Cartesian3.multiplyByScalar(U,ta*A,U),q),Y=r.Cartesian3.add(q,r.Cartesian3.multiplyByScalar(k,A,Y),Y),o[0]=r.Cartesian3.clone(H,o[0]),o[1]=r.Cartesian3.clone(Y,o[1]),W=x(o,X+S,$+S,T),N=V(i.PolylinePipeline.generateArc({positions:o,granularity:T,ellipsoid:E}),k,b,N,E,W,1),k=r.Cartesian3.cross(_,I,k),k=r.Cartesian3.normalize(k,k),Z=r.Cartesian3.add(q,r.Cartesian3.multiplyByScalar(k,A,Z),Z),B===s.ROUNDED||B===s.BEVELED?j(q,Y,Z,B,ia,E,N,b,$+S,P):N=O(J,U=r.Cartesian3.negate(U,U),b,N,E,$+S,ta,ea),H=r.Cartesian3.clone(Z,H)):(q=r.Cartesian3.add(J,r.Cartesian3.multiplyByScalar(U,ta*A,U),q),Y=r.Cartesian3.add(q,r.Cartesian3.multiplyByScalar(k,-A,Y),Y),o[0]=r.Cartesian3.clone(H,o[0]),o[1]=r.Cartesian3.clone(Y,o[1]),W=x(o,X+S,$+S,T),N=V(i.PolylinePipeline.generateArc({positions:o,granularity:T,ellipsoid:E}),k,b,N,E,W,1),k=r.Cartesian3.cross(_,I,k),k=r.Cartesian3.normalize(k,k),Z=r.Cartesian3.add(q,r.Cartesian3.multiplyByScalar(k,-A,Z),Z),B===s.ROUNDED||B===s.BEVELED?j(q,Y,Z,B,ia,E,N,b,$+S,P):N=O(J,U,b,N,E,$+S,ta,ea),H=r.Cartesian3.clone(Z,H)),L=r.Cartesian3.negate(I,L)}else N=O(H,k,b,N,E,X+S,1,1),H=J;X=$,$=M[aa+1],J=K}o[0]=r.Cartesian3.clone(H,o[0]),o[1]=r.Cartesian3.clone(J,o[1]),W=x(o,X+S,$+S,T),N=V(i.PolylinePipeline.generateArc({positions:o,granularity:T,ellipsoid:E}),k,b,N,E,W,1),P&&(R=O(J,k,z,R,E,$+S,1,1)),D=N.length;var sa=P?D+R.length:D,oa=new Float64Array(sa);return oa.set(N),P&&oa.set(R,D),oa},a.CornerType=s,a.PolylineVolumeGeometryLibrary=h}));
