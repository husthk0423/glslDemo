define(["./when-c2e8ef35","./Check-c4f3a3fc","./Math-d30358ed","./Cartesian2-f9492f23","./BoundingSphere-dcb1d5fc","./Transforms-8b7e0d39","./RuntimeError-6122571f","./Rectangle-3285eeb3","./WebGLConstants-4ae0db90","./ComponentDatatype-5d3f6452","./GeometryAttribute-a5c051b9","./GeometryAttributes-57608efc","./IndexDatatype-e3260434","./createTaskProcessorWorker","./GeometryOffsetAttribute-e6e9672c","./VertexFormat-ad523db1","./BoxGeometry-70842c05","./CylinderGeometryLibrary-95411284","./CylinderGeometry-65f24f52","./EllipsoidGeometry-a7c1586c","./Color-73b261ab"],(function(e,t,n,r,a,i,o,d,s,c,f,l,u,h,p,b,y,g,x,v,C){"use strict";function m(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}var I=new r.Cartesian3,k=i.Matrix4.packedLength+r.Cartesian3.packedLength,B=i.Matrix4.packedLength+2,M=i.Matrix4.packedLength+r.Cartesian3.packedLength,w=r.Cartesian3.packedLength+1,A={modelMatrix:new i.Matrix4,boundingVolume:new a.BoundingSphere};function O(e,t){var n=t*k,a=r.Cartesian3.unpack(e,n,I);n+=r.Cartesian3.packedLength;var o=i.Matrix4.unpack(e,n,A.modelMatrix);i.Matrix4.multiplyByScale(o,a,o);var d=A.boundingVolume;return r.Cartesian3.clone(r.Cartesian3.ZERO,d.center),d.radius=Math.sqrt(3),A}function L(e,t){var n=t*B,a=e[n++],o=e[n++],d=r.Cartesian3.fromElements(a,a,o,I),s=i.Matrix4.unpack(e,n,A.modelMatrix);i.Matrix4.multiplyByScale(s,d,s);var c=A.boundingVolume;return r.Cartesian3.clone(r.Cartesian3.ZERO,c.center),c.radius=Math.sqrt(2),A}function E(e,t){var n=t*M,a=r.Cartesian3.unpack(e,n,I);n+=r.Cartesian3.packedLength;var o=i.Matrix4.unpack(e,n,A.modelMatrix);i.Matrix4.multiplyByScale(o,a,o);var d=A.boundingVolume;return r.Cartesian3.clone(r.Cartesian3.ZERO,d.center),d.radius=1,A}function U(e,t){var n=t*w,a=e[n++],o=r.Cartesian3.unpack(e,n,I),d=i.Matrix4.fromTranslation(o,A.modelMatrix);i.Matrix4.multiplyByUniformScale(d,a,d);var s=A.boundingVolume;return r.Cartesian3.clone(r.Cartesian3.ZERO,s.center),s.radius=1,A}var G=new r.Cartesian3;function S(t,n,o,d,s){if(e.defined(n)){for(var c=o.length,f=d.attributes.position.values,l=d.indices,u=t.positions,h=t.vertexBatchIds,p=t.indices,b=t.batchIds,y=t.batchTableColors,g=t.batchedIndices,x=t.indexOffsets,v=t.indexCounts,I=t.boundingVolumes,k=t.modelMatrix,B=t.center,M=t.positionOffset,w=t.batchIdIndex,A=t.indexOffset,O=t.batchedIndicesOffset,L=0;L<c;++L){var E=s(n,L),U=E.modelMatrix;i.Matrix4.multiply(k,U,U);for(var S=o[L],T=f.length,V=0;V<T;V+=3){var F=r.Cartesian3.unpack(f,V,G);i.Matrix4.multiplyByPoint(U,F,F),r.Cartesian3.subtract(F,B,F),r.Cartesian3.pack(F,u,3*M+V),h[w++]=S}for(var R=l.length,Z=0;Z<R;++Z)p[A+Z]=l[Z]+M;var D=L+O;g[D]=new m({offset:A,count:R,color:C.Color.fromRgba(y[S]),batchIds:[S]}),b[D]=S,x[D]=A,v[D]=R,I[D]=a.BoundingSphere.transform(E.boundingVolume,U),M+=T/3,A+=R}t.positionOffset=M,t.batchIdIndex=w,t.indexOffset=A,t.batchedIndicesOffset+=c}}var T=new r.Cartesian3,V=new i.Matrix4;function F(e,t,n){var r=n.length,i=2+r*a.BoundingSphere.packedLength+1+function(e){for(var t=e.length,n=0,r=0;r<t;++r)n+=C.Color.packedLength+3+e[r].batchIds.length;return n}(t),o=new Float64Array(i),d=0;o[d++]=e,o[d++]=r;for(var s=0;s<r;++s)a.BoundingSphere.pack(n[s],o,d),d+=a.BoundingSphere.packedLength;var c=t.length;o[d++]=c;for(var f=0;f<c;++f){var l=t[f];C.Color.pack(l.color,o,d),d+=C.Color.packedLength,o[d++]=l.offset,o[d++]=l.count;var u=l.batchIds,h=u.length;o[d++]=h;for(var p=0;p<h;++p)o[d++]=u[p]}return o}return h((function(t,n){var a=e.defined(t.boxes)?new Float32Array(t.boxes):void 0,o=e.defined(t.boxBatchIds)?new Uint16Array(t.boxBatchIds):void 0,d=e.defined(t.cylinders)?new Float32Array(t.cylinders):void 0,s=e.defined(t.cylinderBatchIds)?new Uint16Array(t.cylinderBatchIds):void 0,c=e.defined(t.ellipsoids)?new Float32Array(t.ellipsoids):void 0,f=e.defined(t.ellipsoidBatchIds)?new Uint16Array(t.ellipsoidBatchIds):void 0,l=e.defined(t.spheres)?new Float32Array(t.spheres):void 0,h=e.defined(t.sphereBatchIds)?new Uint16Array(t.sphereBatchIds):void 0,p=e.defined(a)?o.length:0,b=e.defined(d)?s.length:0,g=e.defined(c)?f.length:0,C=e.defined(l)?h.length:0,m=y.BoxGeometry.getUnitBox(),I=x.CylinderGeometry.getUnitCylinder(),k=v.EllipsoidGeometry.getUnitEllipsoid(),B=m.attributes.position.values,M=I.attributes.position.values,w=k.attributes.position.values,A=B.length*p;A+=M.length*b,A+=w.length*(g+C);var G=m.indices,R=I.indices,Z=k.indices,D=G.length*p;D+=R.length*b,D+=Z.length*(g+C);var P=new Float32Array(A),q=new Uint16Array(A/3),W=u.IndexDatatype.createTypedArray(A/3,D),_=p+b+g+C,N=new Uint16Array(_),Y=new Array(_),j=new Uint32Array(_),z=new Uint32Array(_),H=new Array(_);!function(e){var t=new Float64Array(e),n=0;r.Cartesian3.unpack(t,n,T),n+=r.Cartesian3.packedLength,i.Matrix4.unpack(t,n,V)}(t.packedBuffer);var J={batchTableColors:new Uint32Array(t.batchTableColors),positions:P,vertexBatchIds:q,indices:W,batchIds:N,batchedIndices:Y,indexOffsets:j,indexCounts:z,boundingVolumes:H,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:V,center:T};S(J,a,o,m,O),S(J,d,s,I,L),S(J,c,f,k,E),S(J,l,h,k,U);var K=F(W.BYTES_PER_ELEMENT,Y,H);return n.push(P.buffer,q.buffer,W.buffer),n.push(N.buffer,j.buffer,z.buffer),n.push(K.buffer),{positions:P.buffer,vertexBatchIds:q.buffer,indices:W.buffer,indexOffsets:j.buffer,indexCounts:z.buffer,batchIds:N.buffer,packedBuffer:K.buffer}}))}));
