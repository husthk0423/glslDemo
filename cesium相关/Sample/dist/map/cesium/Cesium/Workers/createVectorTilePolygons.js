define(["./when-c2e8ef35","./Check-c4f3a3fc","./Math-d30358ed","./Cartesian2-f9492f23","./BoundingSphere-dcb1d5fc","./Transforms-8b7e0d39","./RuntimeError-6122571f","./Rectangle-3285eeb3","./WebGLConstants-4ae0db90","./AttributeCompression-72a6590f","./IndexDatatype-e3260434","./IntersectionTests-525ff5aa","./Plane-dbdf17bf","./createTaskProcessorWorker","./EllipsoidTangentPlane-98a8a37e","./OrientedBoundingBox-fd425b2c","./Color-73b261ab"],(function(e,a,n,r,t,i,o,s,f,d,c,u,h,l,g,p,b){"use strict";var C=new r.Cartesian3,v=new r.Ellipsoid,y=new s.Rectangle,I={min:void 0,max:void 0,indexBytesPerElement:void 0};function m(e,a,n){var r=a.length,t=2+r*p.OrientedBoundingBox.packedLength+1+function(e){for(var a=e.length,n=0,r=0;r<a;++r)n+=b.Color.packedLength+3+e[r].batchIds.length;return n}(n),i=new Float64Array(t),o=0;i[o++]=e,i[o++]=r;for(var s=0;s<r;++s)p.OrientedBoundingBox.pack(a[s],i,o),o+=p.OrientedBoundingBox.packedLength;var f=n.length;i[o++]=f;for(var d=0;d<f;++d){var c=n[d];b.Color.pack(c.color,i,o),o+=b.Color.packedLength,i[o++]=c.offset,i[o++]=c.count;var u=c.batchIds,h=u.length;i[o++]=h;for(var l=0;l<h;++l)i[o++]=u[l]}return i}var w=new r.Cartesian3,x=new r.Cartesian3,A=new r.Cartesian3,E=new r.Cartesian3,N=new r.Cartesian3,T=new r.Cartographic,k=new s.Rectangle;return l((function(a,t){var i;!function(e){var a=new Float64Array(e),n=0;I.indexBytesPerElement=a[n++],I.min=a[n++],I.max=a[n++],r.Cartesian3.unpack(a,n,C),n+=r.Cartesian3.packedLength,r.Ellipsoid.unpack(a,n,v),n+=r.Ellipsoid.packedLength,s.Rectangle.unpack(a,n,y)}(a.packedBuffer),i=2===I.indexBytesPerElement?new Uint16Array(a.indices):new Uint32Array(a.indices);var o,f,u,h=new Uint16Array(a.positions),l=new Uint32Array(a.counts),g=new Uint32Array(a.indexCounts),B=new Uint32Array(a.batchIds),L=new Uint32Array(a.batchTableColors),O=new Array(l.length),U=C,P=v,S=y,F=I.min,R=I.max,D=a.minimumHeights,M=a.maximumHeights;e.defined(D)&&e.defined(M)&&(D=new Float32Array(D),M=new Float32Array(M));var _=h.length/2,G=h.subarray(0,_),Y=h.subarray(_,2*_);d.AttributeCompression.zigZagDeltaDecode(G,Y);var V=new Float64Array(3*_);for(o=0;o<_;++o){var H=G[o],W=Y[o],z=n.CesiumMath.lerp(S.west,S.east,H/32767),Z=n.CesiumMath.lerp(S.south,S.north,W/32767),j=r.Cartographic.fromRadians(z,Z,0,T),q=P.cartographicToCartesian(j,w);r.Cartesian3.pack(q,V,3*o)}var J=l.length,K=new Array(J),Q=new Array(J),X=0,$=0;for(o=0;o<J;++o)K[o]=X,Q[o]=$,X+=l[o],$+=g[o];var ee,ae=new Float32Array(3*_*2),ne=new Uint16Array(2*_),re=new Uint32Array(Q.length),te=new Uint32Array(g.length),ie=[],oe={};for(o=0;o<J;++o)u=L[o],e.defined(oe[u])?(oe[u].positionLength+=l[o],oe[u].indexLength+=g[o],oe[u].batchIds.push(o)):oe[u]={positionLength:l[o],indexLength:g[o],offset:0,indexOffset:0,batchIds:[o]};var se=0,fe=0;for(u in oe)if(oe.hasOwnProperty(u)){(ee=oe[u]).offset=se,ee.indexOffset=fe;var de=2*ee.positionLength,ce=2*ee.indexLength+6*ee.positionLength;se+=de,fe+=ce,ee.indexLength=ce}var ue=[];for(u in oe)oe.hasOwnProperty(u)&&(ee=oe[u],ue.push({color:b.Color.fromRgba(parseInt(u)),offset:ee.indexOffset,count:ee.indexLength,batchIds:ee.batchIds}));for(o=0;o<J;++o){var he=(ee=oe[u=L[o]]).offset,le=3*he,ge=he,pe=K[o],be=l[o],Ce=B[o],ve=F,ye=R;e.defined(D)&&e.defined(M)&&(ve=D[o],ye=M[o]);var Ie=Number.POSITIVE_INFINITY,me=Number.NEGATIVE_INFINITY,we=Number.POSITIVE_INFINITY,xe=Number.NEGATIVE_INFINITY;for(f=0;f<be;++f){var Ae=r.Cartesian3.unpack(V,3*pe+3*f,w);P.scaleToGeodeticSurface(Ae,Ae);var Ee=P.cartesianToCartographic(Ae,T),Ne=Ee.latitude,Te=Ee.longitude;Ie=Math.min(Ne,Ie),me=Math.max(Ne,me),we=Math.min(Te,we),xe=Math.max(Te,xe);var ke=P.geodeticSurfaceNormal(Ae,x),Be=r.Cartesian3.multiplyByScalar(ke,ve,A),Le=r.Cartesian3.add(Ae,Be,E);Be=r.Cartesian3.multiplyByScalar(ke,ye,Be);var Oe=r.Cartesian3.add(Ae,Be,N);r.Cartesian3.subtract(Oe,U,Oe),r.Cartesian3.subtract(Le,U,Le),r.Cartesian3.pack(Oe,ae,le),r.Cartesian3.pack(Le,ae,le+3),ne[ge]=Ce,ne[ge+1]=Ce,le+=6,ge+=2}(S=k).west=we,S.east=xe,S.south=Ie,S.north=me,O[o]=p.OrientedBoundingBox.fromRectangle(S,F,R,P);var Ue=ee.indexOffset,Pe=Q[o],Se=g[o];for(re[o]=Ue,f=0;f<Se;f+=3){var Fe=i[Pe+f]-pe,Re=i[Pe+f+1]-pe,De=i[Pe+f+2]-pe;ie[Ue++]=2*Fe+he,ie[Ue++]=2*Re+he,ie[Ue++]=2*De+he,ie[Ue++]=2*De+1+he,ie[Ue++]=2*Re+1+he,ie[Ue++]=2*Fe+1+he}for(f=0;f<be;++f){var Me=f,_e=(f+1)%be;ie[Ue++]=2*Me+1+he,ie[Ue++]=2*_e+he,ie[Ue++]=2*Me+he,ie[Ue++]=2*Me+1+he,ie[Ue++]=2*_e+1+he,ie[Ue++]=2*_e+he}ee.offset+=2*be,ee.indexOffset=Ue,te[o]=Ue-re[o]}ie=c.IndexDatatype.createTypedArray(ae.length/3,ie);for(var Ge=ue.length,Ye=0;Ye<Ge;++Ye){for(var Ve=ue[Ye].batchIds,He=0,We=Ve.length,ze=0;ze<We;++ze)He+=te[Ve[ze]];ue[Ye].count=He}var Ze=m(2===ie.BYTES_PER_ELEMENT?c.IndexDatatype.UNSIGNED_SHORT:c.IndexDatatype.UNSIGNED_INT,O,ue);return t.push(ae.buffer,ie.buffer,re.buffer,te.buffer,ne.buffer,Ze.buffer),{positions:ae.buffer,indices:ie.buffer,indexOffsets:re.buffer,indexCounts:te.buffer,batchIds:ne.buffer,packedBuffer:Ze.buffer}}))}));
