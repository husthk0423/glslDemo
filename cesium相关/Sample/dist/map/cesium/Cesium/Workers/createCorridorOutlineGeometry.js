define(["./when-c2e8ef35","./Check-c4f3a3fc","./Math-d30358ed","./Cartesian2-f9492f23","./BoundingSphere-dcb1d5fc","./Transforms-8b7e0d39","./RuntimeError-6122571f","./Rectangle-3285eeb3","./WebGLConstants-4ae0db90","./ComponentDatatype-5d3f6452","./GeometryAttribute-a5c051b9","./GeometryAttributes-57608efc","./IndexDatatype-e3260434","./IntersectionTests-525ff5aa","./Plane-dbdf17bf","./GeometryOffsetAttribute-e6e9672c","./arrayRemoveDuplicates-a580a060","./EllipsoidTangentPlane-98a8a37e","./EllipsoidRhumbLine-01c8204c","./PolygonPipeline-db004fe0","./PolylineVolumeGeometryLibrary-f67be923","./EllipsoidGeodesic-c0017f17","./PolylinePipeline-b34abe5b","./CorridorGeometryLibrary-ce215348"],(function(e,t,i,r,o,a,n,s,l,d,u,p,f,h,y,c,g,b,m,v,A,_,E,C){"use strict";var G=new r.Cartesian3,T=new r.Cartesian3,P=new r.Cartesian3;function w(t,i){var o,a,n,s=[],l=t.positions,h=t.corners,y=t.endPositions,c=new p.GeometryAttributes,g=0,b=0,m=0;for(a=0;a<l.length;a+=2)g+=n=l[a].length-3,m+=n/3*4,b+=l[a+1].length-3;for(g+=3,b+=3,a=0;a<h.length;a++){o=h[a];var v=h[a].leftPositions;e.defined(v)?(g+=n=v.length,m+=n/3*2):(b+=n=h[a].rightPositions.length,m+=n/3*2)}var _,E=e.defined(y);E&&(g+=_=y[0].length-3,b+=_,m+=4*(_/=3));var w,L,D,k,N,O,V=g+b,x=new Float64Array(V),H=0,I=V-1,S=_/2,R=f.IndexDatatype.createTypedArray(V/3,m+4),M=0;if(R[M++]=H/3,R[M++]=(I-2)/3,E){s.push(H/3),O=G,N=T;var B=y[0];for(a=0;a<S;a++)O=r.Cartesian3.fromArray(B,3*(S-1-a),O),N=r.Cartesian3.fromArray(B,3*(S+a),N),C.CorridorGeometryLibrary.addAttribute(x,N,H),C.CorridorGeometryLibrary.addAttribute(x,O,void 0,I),k=(L=H/3)+1,D=(w=(I-2)/3)-1,R[M++]=w,R[M++]=D,R[M++]=L,R[M++]=k,H+=3,I-=3}var U=0,F=l[U++],Y=l[U++];for(x.set(F,H),x.set(Y,I-Y.length+1),n=Y.length-3,s.push(H/3,(I-2)/3),a=0;a<n;a+=3)k=(L=H/3)+1,D=(w=(I-2)/3)-1,R[M++]=w,R[M++]=D,R[M++]=L,R[M++]=k,H+=3,I-=3;for(a=0;a<h.length;a++){var q,W,J=(o=h[a]).leftPositions,j=o.rightPositions,z=P;if(e.defined(J)){for(I-=3,W=D,s.push(k),q=0;q<J.length/3;q++)z=r.Cartesian3.fromArray(J,3*q,z),R[M++]=W-q-1,R[M++]=W-q,C.CorridorGeometryLibrary.addAttribute(x,z,void 0,I),I-=3;s.push(W-Math.floor(J.length/6)),i===A.CornerType.BEVELED&&s.push((I-2)/3+1),H+=3}else{for(H+=3,W=k,s.push(D),q=0;q<j.length/3;q++)z=r.Cartesian3.fromArray(j,3*q,z),R[M++]=W+q,R[M++]=W+q+1,C.CorridorGeometryLibrary.addAttribute(x,z,H),H+=3;s.push(W+Math.floor(j.length/6)),i===A.CornerType.BEVELED&&s.push(H/3-1),I-=3}for(F=l[U++],Y=l[U++],F.splice(0,3),Y.splice(Y.length-3,3),x.set(F,H),x.set(Y,I-Y.length+1),n=Y.length-3,q=0;q<Y.length;q+=3)L=(k=H/3)-1,w=(D=(I-2)/3)+1,R[M++]=w,R[M++]=D,R[M++]=L,R[M++]=k,H+=3,I-=3;H-=3,I+=3,s.push(H/3,(I-2)/3)}if(E){H+=3,I-=3,O=G,N=T;var K=y[1];for(a=0;a<S;a++)O=r.Cartesian3.fromArray(K,3*(_-a-1),O),N=r.Cartesian3.fromArray(K,3*a,N),C.CorridorGeometryLibrary.addAttribute(x,O,void 0,I),C.CorridorGeometryLibrary.addAttribute(x,N,H),L=(k=H/3)-1,w=(D=(I-2)/3)+1,R[M++]=w,R[M++]=D,R[M++]=L,R[M++]=k,H+=3,I-=3;s.push(H/3)}else s.push(H/3,(I-2)/3);return R[M++]=H/3,R[M++]=(I-2)/3,c.position=new u.GeometryAttribute({componentDatatype:d.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:x}),{attributes:c,indices:R,wallIndices:s}}function L(t){var o=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).positions,a=t.width,n=e.defaultValue(t.height,0),s=e.defaultValue(t.extrudedHeight,n);this._positions=o,this._ellipsoid=r.Ellipsoid.clone(e.defaultValue(t.ellipsoid,r.Ellipsoid.WGS84)),this._width=a,this._height=Math.max(n,s),this._extrudedHeight=Math.min(n,s),this._cornerType=e.defaultValue(t.cornerType,A.CornerType.ROUNDED),this._granularity=e.defaultValue(t.granularity,i.CesiumMath.RADIANS_PER_DEGREE),this._offsetAttribute=t.offsetAttribute,this._workerName="createCorridorOutlineGeometry",this.packedLength=1+o.length*r.Cartesian3.packedLength+r.Ellipsoid.packedLength+6}L.pack=function(t,i,o){o=e.defaultValue(o,0);var a=t._positions,n=a.length;i[o++]=n;for(var s=0;s<n;++s,o+=r.Cartesian3.packedLength)r.Cartesian3.pack(a[s],i,o);return r.Ellipsoid.pack(t._ellipsoid,i,o),o+=r.Ellipsoid.packedLength,i[o++]=t._width,i[o++]=t._height,i[o++]=t._extrudedHeight,i[o++]=t._cornerType,i[o++]=t._granularity,i[o]=e.defaultValue(t._offsetAttribute,-1),i};var D=r.Ellipsoid.clone(r.Ellipsoid.UNIT_SPHERE),k={positions:void 0,ellipsoid:D,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,offsetAttribute:void 0};return L.unpack=function(t,i,o){i=e.defaultValue(i,0);for(var a=t[i++],n=new Array(a),s=0;s<a;++s,i+=r.Cartesian3.packedLength)n[s]=r.Cartesian3.unpack(t,i);var l=r.Ellipsoid.unpack(t,i,D);i+=r.Ellipsoid.packedLength;var d=t[i++],u=t[i++],p=t[i++],f=t[i++],h=t[i++],y=t[i];return e.defined(o)?(o._positions=n,o._ellipsoid=r.Ellipsoid.clone(l,o._ellipsoid),o._width=d,o._height=u,o._extrudedHeight=p,o._cornerType=f,o._granularity=h,o._offsetAttribute=-1===y?void 0:y,o):(k.positions=n,k.width=d,k.height=u,k.extrudedHeight=p,k.cornerType=f,k.granularity=h,k.offsetAttribute=-1===y?void 0:y,new L(k))},L.createGeometry=function(t){var a=t._positions,n=t._width,s=t._ellipsoid;a=function(e,t){for(var i=0;i<e.length;i++)e[i]=t.scaleToGeodeticSurface(e[i],e[i]);return e}(a,s);var l=g.arrayRemoveDuplicates(a,r.Cartesian3.equalsEpsilon);if(!(l.length<2||n<=0)){var p,h=t._height,y=t._extrudedHeight,b=!i.CesiumMath.equalsEpsilon(h,y,0,i.CesiumMath.EPSILON2),m={ellipsoid:s,positions:l,width:n,cornerType:t._cornerType,granularity:t._granularity,saveAttributes:!1};if(b)m.height=h,m.extrudedHeight=y,m.offsetAttribute=t._offsetAttribute,p=function(t){var i=t.ellipsoid,r=w(C.CorridorGeometryLibrary.computePositions(t),t.cornerType),o=r.wallIndices,a=t.height,n=t.extrudedHeight,s=r.attributes,l=r.indices,p=s.position.values,h=p.length,y=new Float64Array(h);y.set(p);var g,b=new Float64Array(2*h);if(p=v.PolygonPipeline.scaleToGeodeticHeight(p,a,i),y=v.PolygonPipeline.scaleToGeodeticHeight(y,n,i),b.set(p),b.set(y,h),s.position.values=b,h/=3,e.defined(t.offsetAttribute)){var m=new Uint8Array(2*h);if(t.offsetAttribute===c.GeometryOffsetAttribute.TOP)m=c.arrayFill(m,1,0,h);else{var A=t.offsetAttribute===c.GeometryOffsetAttribute.NONE?0:1;m=c.arrayFill(m,A)}s.applyOffset=new u.GeometryAttribute({componentDatatype:d.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:m})}var _=l.length,E=f.IndexDatatype.createTypedArray(b.length/3,2*(_+o.length));E.set(l);var G,T,P=_;for(g=0;g<_;g+=2){var L=l[g],D=l[g+1];E[P++]=L+h,E[P++]=D+h}for(g=0;g<o.length;g++)T=(G=o[g])+h,E[P++]=G,E[P++]=T;return{attributes:s,indices:E}}(m);else if((p=w(C.CorridorGeometryLibrary.computePositions(m),m.cornerType)).attributes.position.values=v.PolygonPipeline.scaleToGeodeticHeight(p.attributes.position.values,h,s),e.defined(t._offsetAttribute)){var A=p.attributes.position.values.length,_=new Uint8Array(A/3),E=t._offsetAttribute===c.GeometryOffsetAttribute.NONE?0:1;c.arrayFill(_,E),p.attributes.applyOffset=new u.GeometryAttribute({componentDatatype:d.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:_})}var G=p.attributes,T=o.BoundingSphere.fromVertices(G.position.values,void 0,3);return new u.Geometry({attributes:G,indices:p.indices,primitiveType:u.PrimitiveType.LINES,boundingSphere:T,offsetAttribute:t._offsetAttribute})}},function(t,i){return e.defined(i)&&(t=L.unpack(t,i)),t._ellipsoid=r.Ellipsoid.clone(t._ellipsoid),L.createGeometry(t)}}));
