define(["exports","./when-c2e8ef35","./Check-c4f3a3fc","./Math-d30358ed","./Cartesian2-f9492f23","./BoundingSphere-dcb1d5fc","./Transforms-8b7e0d39","./ComponentDatatype-5d3f6452","./GeometryAttribute-a5c051b9","./AttributeCompression-72a6590f","./EncodedCartesian3-4f87492e","./IndexDatatype-e3260434","./IntersectionTests-525ff5aa","./Plane-dbdf17bf"],(function(e,t,r,a,i,n,s,o,u,p,d,l,f,v){"use strict";var y=new i.Cartesian3,c=new i.Cartesian3,m=new i.Cartesian3;var C={calculateACMR:function(e){var r=(e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT)).indices,a=e.maximumIndex,i=t.defaultValue(e.cacheSize,24),n=r.length;if(!t.defined(a)){a=0;for(var s=0,o=r[s];s<n;)o>a&&(a=o),o=r[++s]}for(var u=[],p=0;p<a+1;p++)u[p]=0;for(var d=i+1,l=0;l<n;++l)d-u[r[l]]>i&&(u[r[l]]=d,++d);return(d-i+1)/(n/3)}};C.tipsify=function(e){var r,a=(e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT)).indices,i=e.maximumIndex,n=t.defaultValue(e.cacheSize,24);function s(e,t,a,i,n,s,o){for(var u,p=-1,d=-1,l=0;l<a.length;){var f=a[l];i[f].numLiveTriangles&&(u=0,n-i[f].timeStamp+2*i[f].numLiveTriangles<=t&&(u=n-i[f].timeStamp),(u>d||-1===d)&&(d=u,p=f)),++l}return-1===p?function(e,t,a,i){for(;t.length>=1;){var n=t[t.length-1];if(t.splice(t.length-1,1),e[n].numLiveTriangles>0)return n}for(;r<i;){if(e[r].numLiveTriangles>0)return++r-1;++r}return-1}(i,s,0,o):p}var o=a.length,u=0,p=0,d=a[p],l=o;if(t.defined(i))u=i+1;else{for(;p<l;)d>u&&(u=d),d=a[++p];if(-1===u)return 0;++u}var f,v=[];for(f=0;f<u;f++)v[f]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};p=0;for(var y=0;p<l;)v[a[p]].vertexTriangles.push(y),++v[a[p]].numLiveTriangles,v[a[p+1]].vertexTriangles.push(y),++v[a[p+1]].numLiveTriangles,v[a[p+2]].vertexTriangles.push(y),++v[a[p+2]].numLiveTriangles,++y,p+=3;var c=0,m=n+1;r=1;var C,h,b,g,A=[],T=[],x=0,P=[],w=o/3,S=[];for(f=0;f<w;f++)S[f]=!1;for(;-1!==c;){A=[],g=(h=v[c]).vertexTriangles.length;for(var I=0;I<g;++I)if(!S[y=h.vertexTriangles[I]]){S[y]=!0,p=y+y+y;for(var O=0;O<3;++O)b=a[p],A.push(b),T.push(b),P[x]=b,++x,--(C=v[b]).numLiveTriangles,m-C.timeStamp>n&&(C.timeStamp=m,++m),++p}c=s(0,n,A,v,m,T,u)}return P};var h={};function b(e,t,r,a,i){e[t++]=r,e[t++]=a,e[t++]=a,e[t++]=i,e[t++]=i,e[t]=r}function g(e){var r={};for(var a in e)if(e.hasOwnProperty(a)&&t.defined(e[a])&&t.defined(e[a].values)){var i=e[a];r[a]=new u.GeometryAttribute({componentDatatype:i.componentDatatype,componentsPerAttribute:i.componentsPerAttribute,normalize:i.normalize,values:[]})}return r}function A(e,r,a){for(var i in r)if(r.hasOwnProperty(i)&&t.defined(r[i])&&t.defined(r[i].values))for(var n=r[i],s=0;s<n.componentsPerAttribute;++s)e[i].values.push(n.values[a*n.componentsPerAttribute+s])}h.toWireframe=function(e){var r=e.indices;if(t.defined(r)){switch(e.primitiveType){case u.PrimitiveType.TRIANGLES:e.indices=function(e){for(var t=e.length,r=t/3*6,a=l.IndexDatatype.createTypedArray(t,r),i=0,n=0;n<t;n+=3,i+=6)b(a,i,e[n],e[n+1],e[n+2]);return a}(r);break;case u.PrimitiveType.TRIANGLE_STRIP:e.indices=function(e){var t=e.length;if(t>=3){var r=6*(t-2),a=l.IndexDatatype.createTypedArray(t,r);b(a,0,e[0],e[1],e[2]);for(var i=6,n=3;n<t;++n,i+=6)b(a,i,e[n-1],e[n],e[n-2]);return a}return new Uint16Array}(r);break;case u.PrimitiveType.TRIANGLE_FAN:e.indices=function(e){if(e.length>0){for(var t=e.length-1,r=6*(t-1),a=l.IndexDatatype.createTypedArray(t,r),i=e[0],n=0,s=1;s<t;++s,n+=6)b(a,n,i,e[s],e[s+1]);return a}return new Uint16Array}(r)}e.primitiveType=u.PrimitiveType.LINES}return e},h.createLineSegmentsForVectors=function(e,r,a){r=t.defaultValue(r,"normal"),a=t.defaultValue(a,1e4);for(var i,s=e.attributes.position.values,p=e.attributes[r].values,d=s.length,l=new Float64Array(2*d),f=0,v=0;v<d;v+=3)l[f++]=s[v],l[f++]=s[v+1],l[f++]=s[v+2],l[f++]=s[v]+p[v]*a,l[f++]=s[v+1]+p[v+1]*a,l[f++]=s[v+2]+p[v+2]*a;var y=e.boundingSphere;return t.defined(y)&&(i=new n.BoundingSphere(y.center,y.radius+a)),new u.Geometry({attributes:{position:new u.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:l})},primitiveType:u.PrimitiveType.LINES,boundingSphere:i})},h.createAttributeLocations=function(e){var r,a=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],i=e.attributes,n={},s=0,o=a.length;for(r=0;r<o;++r){var u=a[r];t.defined(i[u])&&(n[u]=s++)}for(var p in i)i.hasOwnProperty(p)&&!t.defined(n[p])&&(n[p]=s++);return n},h.reorderForPreVertexCache=function(e){var r=u.Geometry.computeNumberOfVertices(e),a=e.indices;if(t.defined(a)){for(var i=new Int32Array(r),n=0;n<r;n++)i[n]=-1;for(var s,p=a,d=p.length,f=l.IndexDatatype.createTypedArray(r,d),v=0,y=0,c=0;v<d;)-1!==(s=i[p[v]])?f[y]=s:(i[s=p[v]]=c,f[y]=c,++c),++v,++y;e.indices=f;var m=e.attributes;for(var C in m)if(m.hasOwnProperty(C)&&t.defined(m[C])&&t.defined(m[C].values)){for(var h=m[C],b=h.values,g=0,A=h.componentsPerAttribute,T=o.ComponentDatatype.createTypedArray(h.componentDatatype,c*A);g<r;){var x=i[g];if(-1!==x)for(var P=0;P<A;P++)T[A*x+P]=b[A*g+P];++g}h.values=T}}return e},h.reorderForPostVertexCache=function(e,r){var a=e.indices;if(e.primitiveType===u.PrimitiveType.TRIANGLES&&t.defined(a)){for(var i=a.length,n=0,s=0;s<i;s++)a[s]>n&&(n=a[s]);e.indices=C.tipsify({indices:a,maximumIndex:n,cacheSize:r})}return e},h.fitToUnsignedShortIndices=function(e){var r=[],i=u.Geometry.computeNumberOfVertices(e);if(t.defined(e.indices)&&i>=a.CesiumMath.SIXTY_FOUR_KILOBYTES){var n,s=[],o=[],p=0,d=g(e.attributes),l=e.indices,f=l.length;e.primitiveType===u.PrimitiveType.TRIANGLES?n=3:e.primitiveType===u.PrimitiveType.LINES?n=2:e.primitiveType===u.PrimitiveType.POINTS&&(n=1);for(var v=0;v<f;v+=n){for(var y=0;y<n;++y){var c=l[v+y],m=s[c];t.defined(m)||(m=p++,s[c]=m,A(d,e.attributes,c)),o.push(m)}p+n>=a.CesiumMath.SIXTY_FOUR_KILOBYTES&&(r.push(new u.Geometry({attributes:d,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),s=[],o=[],p=0,d=g(e.attributes))}0!==o.length&&r.push(new u.Geometry({attributes:d,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else r.push(e);return r};var T=new i.Cartesian3,x=new i.Cartographic;h.projectTo2D=function(e,r,a,s,p){for(var d=e.attributes[r],l=(p=t.defined(p)?p:new n.GeographicProjection).ellipsoid,f=d.values,v=new Float64Array(f.length),y=0,c=0;c<f.length;c+=3){var m=i.Cartesian3.fromArray(f,c,T),C=l.cartesianToCartographic(m,x),h=p.project(C,T);v[y++]=h.x,v[y++]=h.y,v[y++]=h.z}return e.attributes[a]=d,e.attributes[s]=new u.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:v}),delete e.attributes[r],e};var P={high:0,low:0};h.encodeAttribute=function(e,t,r,a){for(var i=e.attributes[t],n=i.values,s=n.length,p=new Float32Array(s),l=new Float32Array(s),f=0;f<s;++f)d.EncodedCartesian3.encode(n[f],P),p[f]=P.high,l[f]=P.low;var v=i.componentsPerAttribute;return e.attributes[r]=new u.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:v,values:p}),e.attributes[a]=new u.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:v,values:l}),delete e.attributes[t],e};var w=new i.Cartesian3;function S(e,r){if(t.defined(r))for(var a=r.values,n=a.length,o=0;o<n;o+=3)i.Cartesian3.unpack(a,o,w),s.Matrix4.multiplyByPoint(e,w,w),i.Cartesian3.pack(w,a,o)}function I(e,r){if(t.defined(r))for(var a=r.values,n=a.length,o=0;o<n;o+=3)i.Cartesian3.unpack(a,o,w),s.Matrix3.multiplyByVector(e,w,w),w=i.Cartesian3.normalize(w,w),i.Cartesian3.pack(w,a,o)}var O=new s.Matrix4,E=new s.Matrix3;h.transformToWorldCoordinates=function(e){var r=e.modelMatrix;if(s.Matrix4.equals(r,s.Matrix4.IDENTITY))return e;var a=e.geometry.attributes;S(r,a.position),S(r,a.prevPosition),S(r,a.nextPosition),(t.defined(a.normal)||t.defined(a.tangent)||t.defined(a.bitangent))&&(s.Matrix4.inverse(r,O),s.Matrix4.transpose(O,O),s.Matrix4.getMatrix3(O,E),I(E,a.normal),I(E,a.tangent),I(E,a.bitangent));var i=e.geometry.boundingSphere;return t.defined(i)&&(e.geometry.boundingSphere=n.BoundingSphere.transform(i,r,i)),e.modelMatrix=s.Matrix4.clone(s.Matrix4.IDENTITY),e};var N=new i.Cartesian3;function L(e,r){var a,s,p,d,f,v,y,c,m=e.length,C=(e[0].modelMatrix,t.defined(e[0][r].indices)),h=e[0][r].primitiveType,b=function(e,r){var a,i=e.length,n={},s=e[0][r].attributes;for(a in s)if(s.hasOwnProperty(a)&&t.defined(s[a])&&t.defined(s[a].values)){for(var p=s[a],d=p.values.length,l=!0,f=1;f<i;++f){var v=e[f][r].attributes[a];if(!t.defined(v)||p.componentDatatype!==v.componentDatatype||p.componentsPerAttribute!==v.componentsPerAttribute||p.normalize!==v.normalize){l=!1;break}d+=v.values.length}l&&(n[a]=new u.GeometryAttribute({componentDatatype:p.componentDatatype,componentsPerAttribute:p.componentsPerAttribute,normalize:p.normalize,values:o.ComponentDatatype.createTypedArray(p.componentDatatype,d)}))}return n}(e,r);for(a in b)if(b.hasOwnProperty(a))for(f=b[a].values,d=0,s=0;s<m;++s)for(y=(v=e[s][r].attributes[a].values).length,p=0;p<y;++p)f[d++]=v[p];if(C){var g=0;for(s=0;s<m;++s)g+=e[s][r].indices.length;var A=u.Geometry.computeNumberOfVertices(new u.Geometry({attributes:b,primitiveType:u.PrimitiveType.POINTS})),T=l.IndexDatatype.createTypedArray(A,g),x=0,P=0;for(s=0;s<m;++s){var w=e[s][r].indices,S=w.length;for(d=0;d<S;++d)T[x++]=P+w[d];P+=u.Geometry.computeNumberOfVertices(e[s][r])}c=T}var I,O=new i.Cartesian3,E=0;for(s=0;s<m;++s){if(I=e[s][r].boundingSphere,!t.defined(I)){O=void 0;break}i.Cartesian3.add(I.center,O,O)}if(t.defined(O))for(i.Cartesian3.divideByScalar(O,m,O),s=0;s<m;++s){I=e[s][r].boundingSphere;var L=i.Cartesian3.magnitude(i.Cartesian3.subtract(I.center,O,N))+I.radius;L>E&&(E=L)}return new u.Geometry({attributes:b,indices:c,primitiveType:h,boundingSphere:t.defined(O)?new n.BoundingSphere(O,E):void 0})}h.combineInstances=function(e){for(var r=[],a=[],i=e.length,n=0;n<i;++n){var s=e[n];t.defined(s.geometry)?r.push(s):t.defined(s.westHemisphereGeometry)&&t.defined(s.eastHemisphereGeometry)&&a.push(s)}var o=[];return r.length>0&&o.push(L(r,"geometry")),a.length>0&&(o.push(L(a,"westHemisphereGeometry")),o.push(L(a,"eastHemisphereGeometry"))),o};var z=new i.Cartesian3,D=new i.Cartesian3,M=new i.Cartesian3,G=new i.Cartesian3;h.computeNormal=function(e){var t,r=e.indices,n=e.attributes,s=n.position.values,p=n.position.values.length/3,d=r.length,l=new Array(p),f=new Array(d/3),v=new Array(d);for(t=0;t<p;t++)l[t]={indexOffset:0,count:0,currentCount:0};var y=0;for(t=0;t<d;t+=3){var c=r[t],m=r[t+1],C=r[t+2],h=3*c,b=3*m,g=3*C;D.x=s[h],D.y=s[h+1],D.z=s[h+2],M.x=s[b],M.y=s[b+1],M.z=s[b+2],G.x=s[g],G.y=s[g+1],G.z=s[g+2],l[c].count++,l[m].count++,l[C].count++,i.Cartesian3.subtract(M,D,M),i.Cartesian3.subtract(G,D,G),f[y]=i.Cartesian3.cross(M,G,new i.Cartesian3),y++}var A,T=0;for(t=0;t<p;t++)l[t].indexOffset+=T,T+=l[t].count;for(y=0,t=0;t<d;t+=3){var x=(A=l[r[t]]).indexOffset+A.currentCount;v[x]=y,A.currentCount++,v[x=(A=l[r[t+1]]).indexOffset+A.currentCount]=y,A.currentCount++,v[x=(A=l[r[t+2]]).indexOffset+A.currentCount]=y,A.currentCount++,y++}var P=new Float32Array(3*p);for(t=0;t<p;t++){var w=3*t;if(A=l[t],i.Cartesian3.clone(i.Cartesian3.ZERO,z),A.count>0){for(y=0;y<A.count;y++)i.Cartesian3.add(z,f[v[A.indexOffset+y]],z);i.Cartesian3.equalsEpsilon(i.Cartesian3.ZERO,z,a.CesiumMath.EPSILON10)&&i.Cartesian3.clone(f[v[A.indexOffset]],z)}i.Cartesian3.equalsEpsilon(i.Cartesian3.ZERO,z,a.CesiumMath.EPSILON10)&&(z.z=1),i.Cartesian3.normalize(z,z),P[w]=z.x,P[w+1]=z.y,P[w+2]=z.z}return e.attributes.normal=new u.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P}),e};var R=new i.Cartesian3,V=new i.Cartesian3,B=new i.Cartesian3;h.computeTangentAndBitangent=function(e){e.attributes;var t,r,a,n,s=e.indices,p=e.attributes.position.values,d=e.attributes.normal.values,l=e.attributes.st.values,f=e.attributes.position.values.length/3,v=s.length,y=new Array(3*f);for(t=0;t<y.length;t++)y[t]=0;for(t=0;t<v;t+=3){var c=s[t],m=s[t+1],C=s[t+2];a=3*m,n=3*C;var h=2*c,b=2*m,g=2*C,A=p[r=3*c],T=p[r+1],x=p[r+2],P=l[h],w=l[h+1],S=l[b+1]-w,I=l[g+1]-w,O=1/((l[b]-P)*I-(l[g]-P)*S),E=(I*(p[a]-A)-S*(p[n]-A))*O,N=(I*(p[a+1]-T)-S*(p[n+1]-T))*O,L=(I*(p[a+2]-x)-S*(p[n+2]-x))*O;y[r]+=E,y[r+1]+=N,y[r+2]+=L,y[a]+=E,y[a+1]+=N,y[a+2]+=L,y[n]+=E,y[n+1]+=N,y[n+2]+=L}var z=new Float32Array(3*f),D=new Float32Array(3*f);for(t=0;t<f;t++){a=(r=3*t)+1,n=r+2;var M=i.Cartesian3.fromArray(d,r,R),G=i.Cartesian3.fromArray(y,r,B),F=i.Cartesian3.dot(M,G);i.Cartesian3.multiplyByScalar(M,F,V),i.Cartesian3.normalize(i.Cartesian3.subtract(G,V,G),G),z[r]=G.x,z[a]=G.y,z[n]=G.z,i.Cartesian3.normalize(i.Cartesian3.cross(M,G,G),G),D[r]=G.x,D[a]=G.y,D[n]=G.z}return e.attributes.tangent=new u.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z}),e.attributes.bitangent=new u.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:D}),e};var F=new i.Cartesian2,k=new i.Cartesian3,_=new i.Cartesian3,q=new i.Cartesian3,U=new i.Cartesian2;function Y(e){switch(e.primitiveType){case u.PrimitiveType.TRIANGLE_FAN:return function(e){var t=u.Geometry.computeNumberOfVertices(e),r=l.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=1,r[1]=0,r[2]=2;for(var a=3,i=3;i<t;++i)r[a++]=i-1,r[a++]=0,r[a++]=i;return e.indices=r,e.primitiveType=u.PrimitiveType.TRIANGLES,e}(e);case u.PrimitiveType.TRIANGLE_STRIP:return function(e){var t=u.Geometry.computeNumberOfVertices(e),r=l.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=0,r[1]=1,r[2]=2,t>3&&(r[3]=0,r[4]=2,r[5]=3);for(var a=6,i=3;i<t-1;i+=2)r[a++]=i,r[a++]=i-1,r[a++]=i+1,i+2<t&&(r[a++]=i,r[a++]=i+1,r[a++]=i+2);return e.indices=r,e.primitiveType=u.PrimitiveType.TRIANGLES,e}(e);case u.PrimitiveType.TRIANGLES:return function(e){if(t.defined(e.indices))return e;for(var r=u.Geometry.computeNumberOfVertices(e),a=l.IndexDatatype.createTypedArray(r,r),i=0;i<r;++i)a[i]=i;return e.indices=a,e}(e);case u.PrimitiveType.LINE_STRIP:return function(e){var t=u.Geometry.computeNumberOfVertices(e),r=l.IndexDatatype.createTypedArray(t,2*(t-1));r[0]=0,r[1]=1;for(var a=2,i=2;i<t;++i)r[a++]=i-1,r[a++]=i;return e.indices=r,e.primitiveType=u.PrimitiveType.LINES,e}(e);case u.PrimitiveType.LINE_LOOP:return function(e){var t=u.Geometry.computeNumberOfVertices(e),r=l.IndexDatatype.createTypedArray(t,2*t);r[0]=0,r[1]=1;for(var a=2,i=2;i<t;++i)r[a++]=i-1,r[a++]=i;return r[a++]=t-1,r[a]=0,e.indices=r,e.primitiveType=u.PrimitiveType.LINES,e}(e);case u.PrimitiveType.LINES:return function(e){if(t.defined(e.indices))return e;for(var r=u.Geometry.computeNumberOfVertices(e),a=l.IndexDatatype.createTypedArray(r,r),i=0;i<r;++i)a[i]=i;return e.indices=a,e}(e)}return e}function Z(e,t){Math.abs(e.y)<a.CesiumMath.EPSILON6&&(e.y=t?-a.CesiumMath.EPSILON6:a.CesiumMath.EPSILON6)}h.compressVertices=function(e){var r,a,n=e.attributes.extrudeDirection;if(t.defined(n)){var s=n.values;a=s.length/3;var d=new Float32Array(2*a),l=0;for(r=0;r<a;++r)i.Cartesian3.fromArray(s,3*r,k),i.Cartesian3.equals(k,i.Cartesian3.ZERO)?l+=2:(U=p.AttributeCompression.octEncodeInRange(k,65535,U),d[l++]=U.x,d[l++]=U.y);return e.attributes.compressedAttributes=new u.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:d}),delete e.attributes.extrudeDirection,e}var f=e.attributes.normal,v=e.attributes.st,y=t.defined(f),c=t.defined(v);if(!y&&!c)return e;var m,C,h,b,g=e.attributes.tangent,A=e.attributes.bitangent,T=t.defined(g),x=t.defined(A);y&&(m=f.values),c&&(C=v.values),T&&(h=g.values),x&&(b=A.values);var P=a=(y?m.length:C.length)/(y?3:2),w=c&&y?2:1;w+=T||x?1:0;var S=new Float32Array(P*=w),I=0;for(r=0;r<a;++r){c&&(i.Cartesian2.fromArray(C,2*r,F),S[I++]=p.AttributeCompression.compressTextureCoordinates(F));var O=3*r;y&&t.defined(h)&&t.defined(b)?(i.Cartesian3.fromArray(m,O,k),i.Cartesian3.fromArray(h,O,_),i.Cartesian3.fromArray(b,O,q),p.AttributeCompression.octPack(k,_,q,F),S[I++]=F.x,S[I++]=F.y):(y&&(i.Cartesian3.fromArray(m,O,k),S[I++]=p.AttributeCompression.octEncodeFloat(k)),T&&(i.Cartesian3.fromArray(h,O,k),S[I++]=p.AttributeCompression.octEncodeFloat(k)),x&&(i.Cartesian3.fromArray(b,O,k),S[I++]=p.AttributeCompression.octEncodeFloat(k)))}return e.attributes.compressedAttributes=new u.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:w,values:S}),y&&delete e.attributes.normal,c&&delete e.attributes.st,x&&delete e.attributes.bitangent,T&&delete e.attributes.tangent,e};var H=new i.Cartesian3;function W(e,t,r,a){i.Cartesian3.add(e,i.Cartesian3.multiplyByScalar(i.Cartesian3.subtract(t,e,H),e.y/(e.y-t.y),H),r),i.Cartesian3.clone(r,a),Z(r,!0),Z(a,!1)}var X=new i.Cartesian3,j=new i.Cartesian3,J=new i.Cartesian3,K=new i.Cartesian3,Q={positions:new Array(7),indices:new Array(9)};function $(e,t,r){if(!(e.x>=0||t.x>=0||r.x>=0)){!function(e,t,r){if(0!==e.y&&0!==t.y&&0!==r.y)return Z(e,e.y<0),Z(t,t.y<0),void Z(r,r.y<0);var i=Math.abs(e.y),n=Math.abs(t.y),s=Math.abs(r.y),o=(i>n?i>s?a.CesiumMath.sign(e.y):a.CesiumMath.sign(r.y):n>s?a.CesiumMath.sign(t.y):a.CesiumMath.sign(r.y))<0;Z(e,o),Z(t,o),Z(r,o)}(e,t,r);var i=e.y<0,n=t.y<0,s=r.y<0,o=0;o+=i?1:0,o+=n?1:0;var u=Q.indices;1===(o+=s?1:0)?(u[1]=3,u[2]=4,u[5]=6,u[7]=6,u[8]=5,i?(W(e,t,X,J),W(e,r,j,K),u[0]=0,u[3]=1,u[4]=2,u[6]=1):n?(W(t,r,X,J),W(t,e,j,K),u[0]=1,u[3]=2,u[4]=0,u[6]=2):s&&(W(r,e,X,J),W(r,t,j,K),u[0]=2,u[3]=0,u[4]=1,u[6]=0)):2===o&&(u[2]=4,u[4]=4,u[5]=3,u[7]=5,u[8]=6,i?n?s||(W(r,e,X,J),W(r,t,j,K),u[0]=0,u[1]=1,u[3]=0,u[6]=2):(W(t,r,X,J),W(t,e,j,K),u[0]=2,u[1]=0,u[3]=2,u[6]=1):(W(e,t,X,J),W(e,r,j,K),u[0]=1,u[1]=2,u[3]=1,u[6]=0));var p=Q.positions;return p[0]=e,p[1]=t,p[2]=r,p.length=3,1!==o&&2!==o||(p[3]=X,p[4]=j,p[5]=J,p[6]=K,p.length=7),Q}}function ee(e,r){var a=e.attributes;if(0!==a.position.values.length){for(var i in a)if(a.hasOwnProperty(i)&&t.defined(a[i])&&t.defined(a[i].values)){var s=a[i];s.values=o.ComponentDatatype.createTypedArray(s.componentDatatype,s.values)}var p=u.Geometry.computeNumberOfVertices(e);return e.indices=l.IndexDatatype.createTypedArray(p,e.indices),r&&(e.boundingSphere=n.BoundingSphere.fromVertices(a.position.values)),e}}function te(e){var r=e.attributes,a={};for(var i in r)if(r.hasOwnProperty(i)&&t.defined(r[i])&&t.defined(r[i].values)){var n=r[i];a[i]=new u.GeometryAttribute({componentDatatype:n.componentDatatype,componentsPerAttribute:n.componentsPerAttribute,normalize:n.normalize,values:[]})}return new u.Geometry({attributes:a,indices:[],primitiveType:e.primitiveType})}function re(e,r,a){var i=t.defined(e.geometry.boundingSphere);r=ee(r,i),a=ee(a,i),t.defined(a)&&!t.defined(r)?e.geometry=a:!t.defined(a)&&t.defined(r)?e.geometry=r:(e.westHemisphereGeometry=r,e.eastHemisphereGeometry=a,e.geometry=void 0)}function ae(e,t){var r=new e,a=new e,i=new e;return function(n,s,o,u,p,d,l,f){var v=e.fromArray(p,n*t,r),y=e.fromArray(p,s*t,a),c=e.fromArray(p,o*t,i);e.multiplyByScalar(v,u.x,v),e.multiplyByScalar(y,u.y,y),e.multiplyByScalar(c,u.z,c);var m=e.add(v,y,v);e.add(m,c,m),f&&e.normalize(m,m),e.pack(m,d,l*t)}}var ie=ae(s.Cartesian4,4),ne=ae(i.Cartesian3,3),se=ae(i.Cartesian2,2),oe=new i.Cartesian3,ue=new i.Cartesian3,pe=new i.Cartesian3,de=new i.Cartesian3;function le(e,r,n,s,o,u,p,d,l,f,v,C,h,b,g,A){if(t.defined(u)||t.defined(p)||t.defined(d)||t.defined(l)||t.defined(f)||0!==b){var T=function(e,r,n,s,o){var u,p,d,l,f,v,C,h;if(t.defined(o)||(o=new i.Cartesian3),t.defined(r.z)){if(i.Cartesian3.equalsEpsilon(e,r,a.CesiumMath.EPSILON14))return i.Cartesian3.clone(i.Cartesian3.UNIT_X,o);if(i.Cartesian3.equalsEpsilon(e,n,a.CesiumMath.EPSILON14))return i.Cartesian3.clone(i.Cartesian3.UNIT_Y,o);if(i.Cartesian3.equalsEpsilon(e,s,a.CesiumMath.EPSILON14))return i.Cartesian3.clone(i.Cartesian3.UNIT_Z,o);u=i.Cartesian3.subtract(n,r,y),p=i.Cartesian3.subtract(s,r,c),d=i.Cartesian3.subtract(e,r,m),l=i.Cartesian3.dot(u,u),f=i.Cartesian3.dot(u,p),v=i.Cartesian3.dot(u,d),C=i.Cartesian3.dot(p,p),h=i.Cartesian3.dot(p,d)}else{if(i.Cartesian2.equalsEpsilon(e,r,a.CesiumMath.EPSILON14))return i.Cartesian3.clone(i.Cartesian3.UNIT_X,o);if(i.Cartesian2.equalsEpsilon(e,n,a.CesiumMath.EPSILON14))return i.Cartesian3.clone(i.Cartesian3.UNIT_Y,o);if(i.Cartesian2.equalsEpsilon(e,s,a.CesiumMath.EPSILON14))return i.Cartesian3.clone(i.Cartesian3.UNIT_Z,o);u=i.Cartesian2.subtract(n,r,y),p=i.Cartesian2.subtract(s,r,c),d=i.Cartesian2.subtract(e,r,m),l=i.Cartesian2.dot(u,u),f=i.Cartesian2.dot(u,p),v=i.Cartesian2.dot(u,d),C=i.Cartesian2.dot(p,p),h=i.Cartesian2.dot(p,d)}o.y=C*v-f*h,o.z=l*h-f*v;var b=l*C-f*f;return 0!==o.y&&(o.y/=b),0!==o.z&&(o.z/=b),o.x=1-o.y-o.z,o}(s,i.Cartesian3.fromArray(o,3*e,oe),i.Cartesian3.fromArray(o,3*r,ue),i.Cartesian3.fromArray(o,3*n,pe),de);if(t.defined(u)&&ne(e,r,n,T,u,C.normal.values,A,!0),t.defined(f)){var x,P=i.Cartesian3.fromArray(f,3*e,oe),w=i.Cartesian3.fromArray(f,3*r,ue),S=i.Cartesian3.fromArray(f,3*n,pe);i.Cartesian3.multiplyByScalar(P,T.x,P),i.Cartesian3.multiplyByScalar(w,T.y,w),i.Cartesian3.multiplyByScalar(S,T.z,S),i.Cartesian3.equals(P,i.Cartesian3.ZERO)&&i.Cartesian3.equals(w,i.Cartesian3.ZERO)&&i.Cartesian3.equals(S,i.Cartesian3.ZERO)?((x=oe).x=0,x.y=0,x.z=0):(x=i.Cartesian3.add(P,w,P),i.Cartesian3.add(x,S,x),i.Cartesian3.normalize(x,x)),i.Cartesian3.pack(x,C.extrudeDirection.values,3*A)}if(t.defined(v)&&function(e,t,r,i,n,s,o){var u=n[e]*i.x,p=n[t]*i.y,d=n[r]*i.z;s[o]=u+p+d>a.CesiumMath.EPSILON6?1:0}(e,r,n,T,v,C.applyOffset.values,A),t.defined(p)&&ne(e,r,n,T,p,C.tangent.values,A,!0),t.defined(d)&&ne(e,r,n,T,d,C.bitangent.values,A,!0),t.defined(l)&&se(e,r,n,T,l,C.st.values,A),b>0)for(var I=0;I<b;I++){var O=h[I];fe(e,r,n,T,A,g[O],C[O])}}}function fe(e,t,r,a,i,n,s){var o=n.componentsPerAttribute,u=n.values,p=s.values;switch(o){case 4:ie(e,t,r,a,u,p,i,!1);break;case 3:ne(e,t,r,a,u,p,i,!1);break;case 2:se(e,t,r,a,u,p,i,!1);break;default:p[i]=u[e]*a.x+u[t]*a.y+u[r]*a.z}}function ve(e,t,r,a,i,n){var s=e.position.values.length/3;if(-1!==i){var o=a[i],u=r[o];return-1===u?(r[o]=s,e.position.values.push(n.x,n.y,n.z),t.push(s),s):(t.push(u),u)}return e.position.values.push(n.x,n.y,n.z),t.push(s),s}var ye={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function ce(e){var r=e.geometry,a=r.attributes,n=a.position.values,s=t.defined(a.normal)?a.normal.values:void 0,o=t.defined(a.bitangent)?a.bitangent.values:void 0,u=t.defined(a.tangent)?a.tangent.values:void 0,p=t.defined(a.st)?a.st.values:void 0,d=t.defined(a.extrudeDirection)?a.extrudeDirection.values:void 0,l=t.defined(a.applyOffset)?a.applyOffset.values:void 0,f=r.indices,v=[];for(var y in a)a.hasOwnProperty(y)&&!ye[y]&&t.defined(a[y])&&v.push(y);var c,m,C,h,b=v.length,g=te(r),A=te(r),T=[];T.length=n.length/3;var x=[];for(x.length=n.length/3,h=0;h<T.length;++h)T[h]=-1,x[h]=-1;var P=f.length;for(h=0;h<P;h+=3){var w=f[h],S=f[h+1],I=f[h+2],O=i.Cartesian3.fromArray(n,3*w),E=i.Cartesian3.fromArray(n,3*S),N=i.Cartesian3.fromArray(n,3*I),L=$(O,E,N);if(t.defined(L)&&L.positions.length>3)for(var z=L.positions,D=L.indices,M=D.length,G=0;G<M;++G){var R=D[G],V=z[R];V.y<0?(c=A.attributes,m=A.indices,C=T):(c=g.attributes,m=g.indices,C=x),le(w,S,I,V,n,s,u,o,p,d,l,c,v,b,a,ve(c,m,C,f,R<3?h+R:-1,V))}else t.defined(L)&&(O=L.positions[0],E=L.positions[1],N=L.positions[2]),O.y<0?(c=A.attributes,m=A.indices,C=T):(c=g.attributes,m=g.indices,C=x),le(w,S,I,O,n,s,u,o,p,d,l,c,v,b,a,ve(c,m,C,f,h,O)),le(w,S,I,E,n,s,u,o,p,d,l,c,v,b,a,ve(c,m,C,f,h+1,E)),le(w,S,I,N,n,s,u,o,p,d,l,c,v,b,a,ve(c,m,C,f,h+2,N))}re(e,A,g)}var me=v.Plane.fromPointNormal(i.Cartesian3.ZERO,i.Cartesian3.UNIT_Y),Ce=new i.Cartesian3,he=new i.Cartesian3;function be(e,r,n,s,o,u,p){if(t.defined(p)){var d=i.Cartesian3.fromArray(s,3*e,oe);i.Cartesian3.equalsEpsilon(d,n,a.CesiumMath.EPSILON10)?u.applyOffset.values[o]=p[e]:u.applyOffset.values[o]=p[r]}}function ge(e){var r,n=e.geometry,s=n.attributes,o=s.position.values,u=t.defined(s.applyOffset)?s.applyOffset.values:void 0,p=n.indices,d=te(n),l=te(n),v=p.length,y=[];y.length=o.length/3;var c=[];for(c.length=o.length/3,r=0;r<y.length;++r)y[r]=-1,c[r]=-1;for(r=0;r<v;r+=2){var m=p[r],C=p[r+1],h=i.Cartesian3.fromArray(o,3*m,oe),b=i.Cartesian3.fromArray(o,3*C,ue);Math.abs(h.y)<a.CesiumMath.EPSILON6&&(h.y<0?h.y=-a.CesiumMath.EPSILON6:h.y=a.CesiumMath.EPSILON6),Math.abs(b.y)<a.CesiumMath.EPSILON6&&(b.y<0?b.y=-a.CesiumMath.EPSILON6:b.y=a.CesiumMath.EPSILON6);var g=d.attributes,A=d.indices,T=c,x=l.attributes,P=l.indices,w=y,S=f.IntersectionTests.lineSegmentPlane(h,b,me,pe);if(t.defined(S)){var I=i.Cartesian3.multiplyByScalar(i.Cartesian3.UNIT_Y,5*a.CesiumMath.EPSILON9,Ce);h.y<0&&(i.Cartesian3.negate(I,I),g=l.attributes,A=l.indices,T=y,x=d.attributes,P=d.indices,w=c);var O=i.Cartesian3.add(S,I,he);be(m,C,h,o,ve(g,A,T,p,r,h),g,u),be(m,C,O,o,ve(g,A,T,p,-1,O),g,u),i.Cartesian3.negate(I,I),i.Cartesian3.add(S,I,O),be(m,C,O,o,ve(x,P,w,p,-1,O),x,u),be(m,C,b,o,ve(x,P,w,p,r+1,b),x,u)}else{var E,N,L;h.y<0?(E=l.attributes,N=l.indices,L=y):(E=d.attributes,N=d.indices,L=c),be(m,C,h,o,ve(E,N,L,p,r,h),E,u),be(m,C,b,o,ve(E,N,L,p,r+1,b),E,u)}}re(e,l,d)}var Ae=new i.Cartesian2,Te=new i.Cartesian2,xe=new i.Cartesian3,Pe=new i.Cartesian3,we=new i.Cartesian3,Se=new i.Cartesian3,Ie=new i.Cartesian3,Oe=new i.Cartesian3,Ee=new s.Cartesian4;function Ne(e){for(var t=e.attributes,r=t.position.values,a=t.prevPosition.values,n=t.nextPosition.values,s=r.length,o=0;o<s;o+=3){var u=i.Cartesian3.unpack(r,o,xe);if(!(u.x>0)){var p=i.Cartesian3.unpack(a,o,Pe);(u.y<0&&p.y>0||u.y>0&&p.y<0)&&(o-3>0?(a[o]=r[o-3],a[o+1]=r[o-2],a[o+2]=r[o-1]):i.Cartesian3.pack(u,a,o));var d=i.Cartesian3.unpack(n,o,we);(u.y<0&&d.y>0||u.y>0&&d.y<0)&&(o+3<s?(n[o]=r[o+3],n[o+1]=r[o+4],n[o+2]=r[o+5]):i.Cartesian3.pack(u,n,o))}}}var Le=5*a.CesiumMath.EPSILON9,ze=a.CesiumMath.EPSILON6;h.splitLongitude=function(e){var r=e.geometry,o=r.boundingSphere;if(t.defined(o)&&(o.center.x-o.radius>0||n.BoundingSphere.intersectPlane(o,v.Plane.ORIGIN_ZX_PLANE)!==n.Intersect.INTERSECTING))return e;if(r.geometryType!==u.GeometryType.NONE)switch(r.geometryType){case u.GeometryType.POLYLINES:!function(e){var r,n,o,u=e.geometry,p=u.attributes,d=p.position.values,l=p.prevPosition.values,v=p.nextPosition.values,y=p.expandAndWidth.values,c=t.defined(p.st)?p.st.values:void 0,m=t.defined(p.color)?p.color.values:void 0,C=te(u),h=te(u),b=!1,g=d.length/3;for(r=0;r<g;r+=4){var A=r,T=r+2,x=i.Cartesian3.fromArray(d,3*A,xe),P=i.Cartesian3.fromArray(d,3*T,Pe);if(Math.abs(x.y)<ze)for(x.y=ze*(P.y<0?-1:1),d[3*r+1]=x.y,d[3*(r+1)+1]=x.y,n=3*A;n<3*A+12;n+=3)l[n]=d[3*r],l[n+1]=d[3*r+1],l[n+2]=d[3*r+2];if(Math.abs(P.y)<ze)for(P.y=ze*(x.y<0?-1:1),d[3*(r+2)+1]=P.y,d[3*(r+3)+1]=P.y,n=3*A;n<3*A+12;n+=3)v[n]=d[3*(r+2)],v[n+1]=d[3*(r+2)+1],v[n+2]=d[3*(r+2)+2];var w=C.attributes,S=C.indices,I=h.attributes,O=h.indices,E=f.IntersectionTests.lineSegmentPlane(x,P,me,Se);if(t.defined(E)){b=!0;var N=i.Cartesian3.multiplyByScalar(i.Cartesian3.UNIT_Y,Le,Ie);x.y<0&&(i.Cartesian3.negate(N,N),w=h.attributes,S=h.indices,I=C.attributes,O=C.indices);var L=i.Cartesian3.add(E,N,Oe);w.position.values.push(x.x,x.y,x.z,x.x,x.y,x.z),w.position.values.push(L.x,L.y,L.z),w.position.values.push(L.x,L.y,L.z),w.prevPosition.values.push(l[3*A],l[3*A+1],l[3*A+2]),w.prevPosition.values.push(l[3*A+3],l[3*A+4],l[3*A+5]),w.prevPosition.values.push(x.x,x.y,x.z,x.x,x.y,x.z),w.nextPosition.values.push(L.x,L.y,L.z),w.nextPosition.values.push(L.x,L.y,L.z),w.nextPosition.values.push(L.x,L.y,L.z),w.nextPosition.values.push(L.x,L.y,L.z),i.Cartesian3.negate(N,N),i.Cartesian3.add(E,N,L),I.position.values.push(L.x,L.y,L.z),I.position.values.push(L.x,L.y,L.z),I.position.values.push(P.x,P.y,P.z,P.x,P.y,P.z),I.prevPosition.values.push(L.x,L.y,L.z),I.prevPosition.values.push(L.x,L.y,L.z),I.prevPosition.values.push(L.x,L.y,L.z),I.prevPosition.values.push(L.x,L.y,L.z),I.nextPosition.values.push(P.x,P.y,P.z,P.x,P.y,P.z),I.nextPosition.values.push(v[3*T],v[3*T+1],v[3*T+2]),I.nextPosition.values.push(v[3*T+3],v[3*T+4],v[3*T+5]);var z=i.Cartesian2.fromArray(y,2*A,Ae),D=Math.abs(z.y);w.expandAndWidth.values.push(-1,D,1,D),w.expandAndWidth.values.push(-1,-D,1,-D),I.expandAndWidth.values.push(-1,D,1,D),I.expandAndWidth.values.push(-1,-D,1,-D);var M=i.Cartesian3.magnitudeSquared(i.Cartesian3.subtract(E,x,we));if(M/=i.Cartesian3.magnitudeSquared(i.Cartesian3.subtract(P,x,we)),t.defined(m)){var G=s.Cartesian4.fromArray(m,4*A,Ee),R=s.Cartesian4.fromArray(m,4*T,Ee),V=a.CesiumMath.lerp(G.x,R.x,M),B=a.CesiumMath.lerp(G.y,R.y,M),F=a.CesiumMath.lerp(G.z,R.z,M),k=a.CesiumMath.lerp(G.w,R.w,M);for(n=4*A;n<4*A+8;++n)w.color.values.push(m[n]);for(w.color.values.push(V,B,F,k),w.color.values.push(V,B,F,k),I.color.values.push(V,B,F,k),I.color.values.push(V,B,F,k),n=4*T;n<4*T+8;++n)I.color.values.push(m[n])}if(t.defined(c)){var _=i.Cartesian2.fromArray(c,2*A,Ae),q=i.Cartesian2.fromArray(c,2*(r+3),Te),U=a.CesiumMath.lerp(_.x,q.x,M);for(n=2*A;n<2*A+4;++n)w.st.values.push(c[n]);for(w.st.values.push(U,_.y),w.st.values.push(U,q.y),I.st.values.push(U,_.y),I.st.values.push(U,q.y),n=2*T;n<2*T+4;++n)I.st.values.push(c[n])}o=w.position.values.length/3-4,S.push(o,o+2,o+1),S.push(o+1,o+2,o+3),o=I.position.values.length/3-4,O.push(o,o+2,o+1),O.push(o+1,o+2,o+3)}else{var Y,Z;for(x.y<0?(Y=h.attributes,Z=h.indices):(Y=C.attributes,Z=C.indices),Y.position.values.push(x.x,x.y,x.z),Y.position.values.push(x.x,x.y,x.z),Y.position.values.push(P.x,P.y,P.z),Y.position.values.push(P.x,P.y,P.z),n=3*r;n<3*r+12;++n)Y.prevPosition.values.push(l[n]),Y.nextPosition.values.push(v[n]);for(n=2*r;n<2*r+8;++n)Y.expandAndWidth.values.push(y[n]),t.defined(c)&&Y.st.values.push(c[n]);if(t.defined(m))for(n=4*r;n<4*r+16;++n)Y.color.values.push(m[n]);o=Y.position.values.length/3-4,Z.push(o,o+2,o+1),Z.push(o+1,o+2,o+3)}}b&&(Ne(h),Ne(C)),re(e,h,C)}(e);break;case u.GeometryType.TRIANGLES:ce(e);break;case u.GeometryType.LINES:ge(e)}else Y(r),r.primitiveType===u.PrimitiveType.TRIANGLES?ce(e):r.primitiveType===u.PrimitiveType.LINES&&ge(e);return e},e.GeometryPipeline=h}));
