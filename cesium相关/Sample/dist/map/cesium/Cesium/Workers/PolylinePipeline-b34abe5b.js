define(["exports","./when-c2e8ef35","./Check-c4f3a3fc","./Math-d30358ed","./Cartesian2-f9492f23","./Transforms-8b7e0d39","./IntersectionTests-525ff5aa","./Plane-dbdf17bf","./EllipsoidRhumbLine-01c8204c","./EllipsoidGeodesic-c0017f17"],(function(a,e,r,t,i,n,o,s,c,l){"use strict";var u={numberOfPoints:function(a,e,r){var t=i.Cartesian3.distance(a,e);return Math.ceil(t/r)},numberOfPointsRhumbLine:function(a,e,r){var t=Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2);return Math.ceil(Math.sqrt(t/(r*r)))}},f=new i.Cartographic;u.extractHeights=function(a,e){for(var r=a.length,t=new Array(r),i=0;i<r;i++){var n=a[i];t[i]=e.cartesianToCartographic(n,f).height}return t};var h=new n.Matrix4,C=new i.Cartesian3,g=new i.Cartesian3,d=new s.Plane(i.Cartesian3.UNIT_X,0),p=new i.Cartesian3,v=new s.Plane(i.Cartesian3.UNIT_X,0),m=new i.Cartesian3,T=new i.Cartesian3,w=[];function P(a,e,r){var t,i=w;if(i.length=a,e===r){for(t=0;t<a;t++)i[t]=e;return i}var n=(r-e)/a;for(t=0;t<a;t++){var o=e+t*n;i[t]=o}return i}var y=new i.Cartographic,A=new i.Cartographic,E=new i.Cartesian3,b=new i.Cartesian3,S=new i.Cartesian3,R=new l.EllipsoidGeodesic,M=new c.EllipsoidRhumbLine;function D(a,e,r,t,n,o,s,c){var l=t.scaleToGeodeticSurface(a,b),f=t.scaleToGeodeticSurface(e,S),h=u.numberOfPoints(a,e,r),C=t.cartesianToCartographic(l,y),g=t.cartesianToCartographic(f,A),d=P(h,n,o);R.setEndPoints(C,g);var p=R.surfaceDistance/h,v=c;C.height=n;var m=t.cartographicToCartesian(C,E);i.Cartesian3.pack(m,s,v),v+=3;for(var T=1;T<h;T++){var w=R.interpolateUsingSurfaceDistance(T*p,A);w.height=d[T],m=t.cartographicToCartesian(w,E),i.Cartesian3.pack(m,s,v),v+=3}return v}function G(a,e,r,t,n,o,s,l){var f=t.scaleToGeodeticSurface(a,b),h=t.scaleToGeodeticSurface(e,S),C=t.cartesianToCartographic(f,y),g=t.cartesianToCartographic(h,A),d=u.numberOfPointsRhumbLine(C,g,r),p=P(d,n,o);M.ellipsoid.equals(t)||(M=new c.EllipsoidRhumbLine(void 0,void 0,t)),M.setEndPoints(C,g);var v=M.surfaceDistance/d,m=l;C.height=n;var T=t.cartographicToCartesian(C,E);i.Cartesian3.pack(T,s,m),m+=3;for(var w=1;w<d;w++){var R=M.interpolateUsingSurfaceDistance(w*v,A);R.height=p[w],T=t.cartographicToCartesian(R,E),i.Cartesian3.pack(T,s,m),m+=3}return m}u.wrapLongitude=function(a,r){var t=[],c=[];if(e.defined(a)&&a.length>0){r=e.defaultValue(r,n.Matrix4.IDENTITY);var l=n.Matrix4.inverseTransformation(r,h),u=n.Matrix4.multiplyByPoint(l,i.Cartesian3.ZERO,C),f=i.Cartesian3.normalize(n.Matrix4.multiplyByPointAsVector(l,i.Cartesian3.UNIT_Y,g),g),w=s.Plane.fromPointNormal(u,f,d),P=i.Cartesian3.normalize(n.Matrix4.multiplyByPointAsVector(l,i.Cartesian3.UNIT_X,p),p),y=s.Plane.fromPointNormal(u,P,v),A=1;t.push(i.Cartesian3.clone(a[0]));for(var E=t[0],b=a.length,S=1;S<b;++S){var R=a[S];if(s.Plane.getPointDistance(y,E)<0||s.Plane.getPointDistance(y,R)<0){var M=o.IntersectionTests.lineSegmentPlane(E,R,w,m);if(e.defined(M)){var D=i.Cartesian3.multiplyByScalar(f,5e-9,T);s.Plane.getPointDistance(w,E)<0&&i.Cartesian3.negate(D,D),t.push(i.Cartesian3.add(M,D,new i.Cartesian3)),c.push(A+1),i.Cartesian3.negate(D,D),t.push(i.Cartesian3.add(M,D,new i.Cartesian3)),A=1}}t.push(i.Cartesian3.clone(a[S])),A++,E=R}c.push(A)}return{positions:t,lengths:c}},u.generateArc=function(a){e.defined(a)||(a={});var r=a.positions,n=r.length,o=e.defaultValue(a.ellipsoid,i.Ellipsoid.WGS84),s=e.defaultValue(a.height,0),c=Array.isArray(s);if(n<1)return[];if(1===n){var l=o.scaleToGeodeticSurface(r[0],b);if(0!==(s=c?s[0]:s)){var f=o.geodeticSurfaceNormal(l,E);i.Cartesian3.multiplyByScalar(f,s,f),i.Cartesian3.add(l,f,l)}return[l.x,l.y,l.z]}var h=a.minDistance;if(!e.defined(h)){var C=e.defaultValue(a.granularity,t.CesiumMath.RADIANS_PER_DEGREE);h=t.CesiumMath.chordLength(C,o.maximumRadius)}var g,d=0;for(g=0;g<n-1;g++)d+=u.numberOfPoints(r[g],r[g+1],h);var p=3*(d+1),v=new Array(p),m=0;for(g=0;g<n-1;g++){m=D(r[g],r[g+1],h,o,c?s[g]:s,c?s[g+1]:s,v,m)}w.length=0;var T=r[n-1],P=o.cartesianToCartographic(T,y);P.height=c?s[n-1]:s;var A=o.cartographicToCartesian(P,E);return i.Cartesian3.pack(A,v,p-3),v};var x=new i.Cartographic,N=new i.Cartographic;u.generateRhumbArc=function(a){e.defined(a)||(a={});var r=a.positions,n=r.length,o=e.defaultValue(a.ellipsoid,i.Ellipsoid.WGS84),s=e.defaultValue(a.height,0),c=Array.isArray(s);if(n<1)return[];if(1===n){var l=o.scaleToGeodeticSurface(r[0],b);if(0!==(s=c?s[0]:s)){var f=o.geodeticSurfaceNormal(l,E);i.Cartesian3.multiplyByScalar(f,s,f),i.Cartesian3.add(l,f,l)}return[l.x,l.y,l.z]}var h,C,g=e.defaultValue(a.granularity,t.CesiumMath.RADIANS_PER_DEGREE),d=0,p=o.cartesianToCartographic(r[0],x);for(h=0;h<n-1;h++)C=o.cartesianToCartographic(r[h+1],N),d+=u.numberOfPointsRhumbLine(p,C,g),p=i.Cartographic.clone(C,x);var v=3*(d+1),m=new Array(v),T=0;for(h=0;h<n-1;h++){T=G(r[h],r[h+1],g,o,c?s[h]:s,c?s[h+1]:s,m,T)}w.length=0;var P=r[n-1],A=o.cartesianToCartographic(P,y);A.height=c?s[n-1]:s;var S=o.cartographicToCartesian(A,E);return i.Cartesian3.pack(S,m,v-3),m},u.generateCartesianArc=function(a){for(var e=u.generateArc(a),r=e.length/3,t=new Array(r),n=0;n<r;n++)t[n]=i.Cartesian3.unpack(e,3*n);return t},u.generateCartesianRhumbArc=function(a){for(var e=u.generateRhumbArc(a),r=e.length/3,t=new Array(r),n=0;n<r;n++)t[n]=i.Cartesian3.unpack(e,3*n);return t},a.PolylinePipeline=u}));
