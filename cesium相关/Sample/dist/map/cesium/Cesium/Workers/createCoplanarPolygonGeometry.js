define(["./when-c2e8ef35","./Check-c4f3a3fc","./Math-d30358ed","./Cartesian2-f9492f23","./BoundingSphere-dcb1d5fc","./Transforms-8b7e0d39","./RuntimeError-6122571f","./Rectangle-3285eeb3","./WebGLConstants-4ae0db90","./ComponentDatatype-5d3f6452","./GeometryAttribute-a5c051b9","./GeometryAttributes-57608efc","./AttributeCompression-72a6590f","./GeometryPipeline-01c9df66","./EncodedCartesian3-4f87492e","./IndexDatatype-e3260434","./IntersectionTests-525ff5aa","./Plane-dbdf17bf","./VertexFormat-ad523db1","./GeometryInstance-b1e4a9ef","./arrayRemoveDuplicates-a580a060","./BoundingRectangle-f5c8097c","./EllipsoidTangentPlane-98a8a37e","./OrientedBoundingBox-fd425b2c","./CoplanarPolygonGeometryLibrary-1fceda55","./ArcType-29cf2197","./EllipsoidRhumbLine-01c8204c","./PolygonPipeline-db004fe0","./PolygonGeometryLibrary-d78156f9"],(function(e,t,a,n,r,o,i,l,s,p,c,y,u,m,d,g,f,b,v,h,C,x,P,w,A,F,G,L,E){"use strict";var T=new n.Cartesian3,D=new x.BoundingRectangle,_=new n.Cartesian2,k=new n.Cartesian2,V=new n.Cartesian3,R=new n.Cartesian3,I=new n.Cartesian3,M=new n.Cartesian3,B=new n.Cartesian3,H=new n.Cartesian3,O=new o.Quaternion,S=new o.Matrix3,z=new o.Matrix3,N=new n.Cartesian3;function Q(e,t,r,i,l,s,u,m){var d=e.positions,f=L.PolygonPipeline.triangulate(e.positions2D,e.holes);f.length<3&&(f=[0,1,2]);var b=g.IndexDatatype.createTypedArray(d.length,f.length);b.set(f);var v=S;if(0!==i){var h=o.Quaternion.fromAxisAngle(s,i,O);if(v=o.Matrix3.fromQuaternion(h,v),t.tangent||t.bitangent){h=o.Quaternion.fromAxisAngle(s,-i,O);var C=o.Matrix3.fromQuaternion(h,z);u=n.Cartesian3.normalize(o.Matrix3.multiplyByVector(C,u,u),u),t.bitangent&&(m=n.Cartesian3.normalize(n.Cartesian3.cross(s,u,m),m))}}else v=o.Matrix3.clone(o.Matrix3.IDENTITY,v);var x=k;t.st&&(x.x=r.x,x.y=r.y);for(var P=d.length,w=3*P,A=new Float64Array(w),F=t.normal?new Float32Array(w):void 0,G=t.tangent?new Float32Array(w):void 0,E=t.bitangent?new Float32Array(w):void 0,D=t.st?new Float32Array(2*P):void 0,V=0,R=0,I=0,M=0,B=0,H=0;H<P;H++){var N=d[H];if(A[V++]=N.x,A[V++]=N.y,A[V++]=N.z,t.st){var Q=l(o.Matrix3.multiplyByVector(v,N,T),_);n.Cartesian2.subtract(Q,x,Q);var j=a.CesiumMath.clamp(Q.x/r.width,0,1),U=a.CesiumMath.clamp(Q.y/r.height,0,1);D[B++]=j,D[B++]=U}t.normal&&(F[R++]=s.x,F[R++]=s.y,F[R++]=s.z),t.tangent&&(G[M++]=u.x,G[M++]=u.y,G[M++]=u.z),t.bitangent&&(E[I++]=m.x,E[I++]=m.y,E[I++]=m.z)}var Y=new y.GeometryAttributes;return t.position&&(Y.position=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:A})),t.normal&&(Y.normal=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:F})),t.tangent&&(Y.tangent=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),t.bitangent&&(Y.bitangent=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:E})),t.st&&(Y.st=new c.GeometryAttribute({componentDatatype:p.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:D})),new c.Geometry({attributes:Y,indices:b,primitiveType:c.PrimitiveType.TRIANGLES})}function j(t){var a=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).polygonHierarchy,r=e.defaultValue(t.vertexFormat,v.VertexFormat.DEFAULT);this._vertexFormat=v.VertexFormat.clone(r),this._polygonHierarchy=a,this._stRotation=e.defaultValue(t.stRotation,0),this._ellipsoid=n.Ellipsoid.clone(e.defaultValue(t.ellipsoid,n.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=E.PolygonGeometryLibrary.computeHierarchyPackedLength(a)+v.VertexFormat.packedLength+n.Ellipsoid.packedLength+2}j.fromPositions=function(t){return new j({polygonHierarchy:{positions:(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:t.vertexFormat,stRotation:t.stRotation,ellipsoid:t.ellipsoid})},j.pack=function(t,a,r){return r=e.defaultValue(r,0),r=E.PolygonGeometryLibrary.packPolygonHierarchy(t._polygonHierarchy,a,r),n.Ellipsoid.pack(t._ellipsoid,a,r),r+=n.Ellipsoid.packedLength,v.VertexFormat.pack(t._vertexFormat,a,r),r+=v.VertexFormat.packedLength,a[r++]=t._stRotation,a[r]=t.packedLength,a};var U=n.Ellipsoid.clone(n.Ellipsoid.UNIT_SPHERE),Y=new v.VertexFormat,q={polygonHierarchy:{}};return j.unpack=function(t,a,r){a=e.defaultValue(a,0);var o=E.PolygonGeometryLibrary.unpackPolygonHierarchy(t,a);a=o.startingIndex,delete o.startingIndex;var i=n.Ellipsoid.unpack(t,a,U);a+=n.Ellipsoid.packedLength;var l=v.VertexFormat.unpack(t,a,Y);a+=v.VertexFormat.packedLength;var s=t[a++],p=t[a];return e.defined(r)||(r=new j(q)),r._polygonHierarchy=o,r._ellipsoid=n.Ellipsoid.clone(i,r._ellipsoid),r._vertexFormat=v.VertexFormat.clone(l,r._vertexFormat),r._stRotation=s,r.packedLength=p,r},j.createGeometry=function(e){var t=e._vertexFormat,o=e._polygonHierarchy,i=e._stRotation,l=o.positions;if(!((l=C.arrayRemoveDuplicates(l,n.Cartesian3.equalsEpsilon,!0)).length<3)){var s=V,p=R,y=I,u=B,d=H;if(A.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(l,M,u,d)){if(s=n.Cartesian3.cross(u,d,s),s=n.Cartesian3.normalize(s,s),!n.Cartesian3.equalsEpsilon(M,n.Cartesian3.ZERO,a.CesiumMath.EPSILON6)){var f=e._ellipsoid.geodeticSurfaceNormal(M,N);n.Cartesian3.dot(s,f)<0&&(s=n.Cartesian3.negate(s,s),u=n.Cartesian3.negate(u,u))}var b=A.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(M,u,d),v=A.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(M,u,d);t.tangent&&(p=n.Cartesian3.clone(u,p)),t.bitangent&&(y=n.Cartesian3.clone(d,y));var x=E.PolygonGeometryLibrary.polygonsFromHierarchy(o,b,!1),P=x.hierarchy,w=x.polygons;if(0!==P.length){l=P[0].outerRing;for(var F=r.BoundingSphere.fromPoints(l),G=E.PolygonGeometryLibrary.computeBoundingRectangle(s,v,l,i,D),L=[],T=0;T<w.length;T++){var _=new h.GeometryInstance({geometry:Q(w[T],t,G,i,v,s,p,y)});L.push(_)}var k=m.GeometryPipeline.combineInstances(L)[0];k.attributes.position.values=new Float64Array(k.attributes.position.values),k.indices=g.IndexDatatype.createTypedArray(k.attributes.position.values.length/3,k.indices);var O=k.attributes;return t.position||delete O.position,new c.Geometry({attributes:O,indices:k.indices,primitiveType:k.primitiveType,boundingSphere:F})}}}},function(t,a){return e.defined(a)&&(t=j.unpack(t,a)),j.createGeometry(t)}}));
