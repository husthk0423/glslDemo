<html lang="en">
<head>
 <meta charset="utf-8">
 <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">  <!-- Use Chrome Frame in IE -->
 <meta name="viewport"
       content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
 <meta name="description" content="A sample Vector dataset on terrain rendered with 3D Tiles.">
 <meta name="cesium-sandcastle-labels" content="Showcases, 3D Tiles">
 <!--引入cesium基础lib-->
 <link rel="stylesheet" href="../Build/bootstrap.css">
 <link href="../Build/Cesium/Widgets/widgets.css" rel="stylesheet" type="text/css" />
 <script src="../Build/Cesium/Cesium.js" type="text/javascript" ></script>
 <link href="../Build/mars3d-src.css" rel="stylesheet" type="text/css" />
 <script src="../Build/mars3d-src.js" type="text/javascript" ></script>
 <script type="text/javascript" src="./config.js"></script>

<!--  <link href="https://unpkg.com/mars3d-cesium/Build/Cesium/Widgets/widgets.css" rel="stylesheet" type="text/css" />-->
<!--  <script src="https://unpkg.com/mars3d-cesium/Build/Cesium/Cesium.js" type="text/javascript" ></script>-->
<!--  <link href="http://mars3d.cn/lib/mars3d/mars3d.css" rel="stylesheet" type="text/css" />-->
<!--  <script src="http://mars3d.cn/lib/mars3d/mars3d.js" type="text/javascript" ></script>-->
 </head>
 <body>
 <style>
  html, body, #cesiumContainer {
   width: 100%;
   height: 100%;
   margin: 0;
   padding: 0;
   overflow: hidden;
  }

  .cesium-viewer, .cesium-viewer-cesiumWidgetContainer, .cesium-widget {
   width: 100%;
   height: 100%;
   margin: 0;
   padding: 0;
   overflow: hidden;
  }

  canvas {
   width: 100%;
   height: 100%;
   margin: 0;
   padding: 0;
   overflow: hidden;
  }
 </style>

 <div id="cesiumContainer" class="fullSize"></div>
 <span style="position: absolute;top:10px;left:10px;">
    <button class="btn btn-primary" onclick="addSlope()">坡度坡向分析</button>
</span>
 <script>
  var map;
  var slope;
  var contourLine;
  function startup() {
   'use strict';
   createMap();
  }

  function addSlope() {
   var positions = [
    Cesium.Cartesian3.fromDegrees(119.237751, 28.371917, 1000),
    Cesium.Cartesian3.fromDegrees(119.177946, 28.372862, 1000),
    Cesium.Cartesian3.fromDegrees(119.175999, 28.442828, 1000),
    Cesium.Cartesian3.fromDegrees(119.212809, 28.444119, 1000)
   ];


   // slope.add(positions, {
   //  splitNum: 5, // splitNum插值分割的个数
   //  radius: 1, // 缓冲半径（影响坡度坡向的精度）
   //  count: 4 // 缓冲的数量（影响坡度坡向的精度）会求周边(count*4)个点
   // });


   contourLine.positions = positions;
  }


  function initSlope() {
   // 剖度坡向
   // slope = new mars3d.thing.Slope({
   //  arrow: {
   //   scale: 0.3, // 箭头长度的比例（范围0.1-0.9）
   //   color: Cesium.Color.YELLOW,
   //   width: 15, // 箭头宽度
   //   show: true
   //  },
   //  tooltip: function (event) {
   //   const attr = event.graphic?event.graphic.options.attr:event.target.attr;
   //   return `坡度: ${attr.slopeStr1}  (${attr.slopeStr2})<br />坡向: ${attr.direction}°`
   //  }
   // })
   // map.addThing(slope);

   // 渲染效果
   contourLine = new mars3d.thing.ContourLine({
    contourShow: false, // 是否显示等高线
    shadingType: "slope", // 地表渲染效果类型:无nono, 高程 elevation, 坡度slope, 坡向aspect
    shadingAlpha: 0.6, /// 地表渲染的透明度
    minHeight:600,
    maxHeight:1250,
    colorScheme :{
     elevation: {
      step: [0.0, 0.045, 0.1, 0.15, 0.37, 0.54, 1.0],
      color: ["#000000", "#2747E0", "#D33B7D", "#D33038", "#FF9742", "#FF9742", "#ffd700"],
     },
     slope: {
      step: [0.0, 0.29, 0.5, Math.sqrt(2) / 2, 0.87, 0.91, 1.0],
      color: ["#000000", "#2747E0", "#D33B7D", "#D33038", "#FF9742", "#FF9742", "#ffd700"],
     },
     aspect: {
      step: [0.0, 0.2, 0.4, 0.6, 0.8, 0.9, 1.0],
      color: ["#000000", "#2747E0", "#D33B7D", "#D33038", "#FF9742", "#FF9742", "#ffd700"],
     }
    }
   });

   map.addThing(contourLine);

   slope.on(mars3d.EventType.end, function (event) {
    console.log("分析完成", event)
   });
  }

  function createMap() {
   var mapOptions = {
    scene: {
     center: {lat: 28.49724744269, lng: 119.10514093954193, alt: 6199.96958, heading: 135.302, pitch: -21.81564}
    },
     terrain: {
      // url:'../data/zjTerrain',
      url: "//data.mars3d.cn/terrain",
      show: true
     },
    basemaps: [
     {
      name: "底图",
      type: "wmts",
      url: baseMapUrl,
      layer: "",
      format: "",
      tileMatrixSetID: "",
      tileMatrixLabels: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19"],
      crs: "EPSG:4326",
      show: true
     }
    ]
   };


   map = new mars3d.Map('cesiumContainer', mapOptions);
   initSlope();
  }

   startup(Cesium);
 </script>
 </body>
 </html>
