<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"> <!-- Use Chrome Frame in IE -->
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="description" content="A sample Vector dataset on terrain rendered with 3D Tiles.">
    <meta name="cesium-sandcastle-labels" content="Showcases, 3D Tiles">
    <title>对象绘制</title>
    <link rel="stylesheet" href="../Build/bootstrap.css">
    <script type="text/javascript" src="../Build/CesiumUnminified/Cesium.js"></script>
    <script type="text/javascript" src="../Build/CustomCesiumSDK.js"></script>
    <script type="text/javascript" src="./config.js"></script>
</head>

<body onload="startup()">
    <style>
        html,
        body,
        #cesiumContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        .cesium-viewer,
        .cesium-viewer-cesiumWidgetContainer,
        .cesium-widget {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        canvas {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
    <div id="cesiumContainer" class="fullSize"></div>
    <script>
        var viewer;
        function startup(Cesium) {
            createMap();
        }

        function addLine() {
            var line = [
                [118.924449, 31.354697],
                [118.926210, 31.354725]
            ]

            var positions = [];

            for (var j = 0; j < line.length; j++) {
                var x = line[j][0];
                var y = line[j][1];
                var cartesian3 = Cesium.Cartesian3.fromDegrees(x, y, 65);
                positions.push(cartesian3);
            }

            var geometry = new Cesium.PolylineGeometry({
                positions: positions,
                width: 10
            });

            var geometryInstance = new Cesium.GeometryInstance({
                geometry: geometry,
                attributes: {
                    color: Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromCssColorString('#f00').withAlpha(0.3)),
                    length: new Cesium.GeometryInstanceAttribute({
                        componentDatatype: Cesium.ComponentDatatype.FLOAT,
                        componentsPerAttribute: 1,
                        normalize: true,
                        value: new Float32Array([1])
                    }),
                }
            });

            var url = '../image/lineAarrow.png';


            let materialOption = {
                color: "#ff0000",
                repeat: {
                    x: 1,
                    y: 1
                },
                speed: 5,
                image: url
            };

            let line1 = Custom.ArrowLineGlow.createLines([geometryInstance], materialOption, 'Primitive', false);
            viewer.scene.primitives.add(line1);
        }

        function createMap() {
            viewer = new Cesium.Viewer('cesiumContainer', {
                selectionIndicator: false,
                useBrowserRecommendedResolution: false,
                animation: false,  //是否显示动画控件
                baseLayerPicker: false, //是否显示图层选择控件
                geocoder: false, //是否显示地名查找控件
                timeline: false, //是否显示时间线控件
                sceneModePicker: true, //是否显示投影方式控件
                navigationHelpButton: false, //是否显示帮助信息控件
                infoBox: false,  //是否显示点击要素之后显示的信息
                imageryProvider: false,
                fullscreenButton: true
            });

            viewer.scene.globe.preloadAncestors = false;

            viewer.scene.primitives.destroyPrimitives = false;
            viewer.scene.globe.depthTestAgainstTerrain = true;
            var imageryLayers = viewer.imageryLayers;

            Cesium.viewer = viewer;

            //天地图影像图层
            var tiandituImageLayer = new Cesium.ImageryLayer(new Cesium.WebMapTileServiceImageryProvider({
                url: baseMapUrl,
                layer: "tdtImg_c",
                style: "default",
                format: "tiles",
                tileMatrixSetID: "c",
                subdomains: ["t0", "t1", "t2", "t3", "t4", "t5", "t6", "t7"],
                tilingScheme: new Cesium.GeographicTilingScheme(),
                tileMatrixLabels: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19"],
                maximumLevel: 18,
            }));
            viewer.imageryLayers.add(tiandituImageLayer);

            viewer.camera.setView({
                destination: Cesium.Cartesian3.fromDegrees(118.93059026255222, 31.346008856371498, 468.28),
                orientation: {
                    heading: Cesium.Math.toRadians(359.9999),
                    pitch: Cesium.Math.toRadians(-28.672),
                    roll: Cesium.Math.toRadians(359.98606702327737)
                }
            });

            addLine();
        }

        // if (typeof Cesium !== 'undefined') {
        //     startup(Cesium);
        // }
    </script>
</body>

</html>